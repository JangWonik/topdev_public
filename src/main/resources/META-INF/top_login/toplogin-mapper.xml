<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="TopLoginMapper">

	<select id="getCenterIdByNoUserCnt" parameterType="String" resultType="Integer">
		SELECT 
			COUNT(*) as Cnt
		FROM top_rpt_head a
		WHERE a.suim_rpt_state = 0 
		AND IFNULL(a.user_no,0) = 0 
		AND IFNULL(a.del_date,0) = 0
		AND a.team_id IN (SELECT team_id FROM top_tm_bsc WHERE team_group_order = (SELECT team_group_order FROM top_tm_bsc WHERE team_id = #{center_team_id}))
	</select>

	<select id="getCenterIdByState1Cnt" parameterType="String" resultType="Integer">
		SELECT 
			COUNT(*) as Cnt
		FROM top_rpt_head a
		WHERE a.suim_rpt_state = 1
		AND a.team_id IN (SELECT team_id FROM top_tm_bsc WHERE team_group_order	= (SELECT team_group_order FROM top_tm_bsc WHERE team_id = #{center_team_id}))
	</select>
	
	<select id="getCenterIdByTeamGroupOrder" parameterType="String" resultType="String">
		SELECT
			GA.team_id AS center_team_id
		FROM
		(
			SELECT 
				team_id 
				,COUNT(*)
			FROM top_tm_bsc
			WHERE team_level = 0
			AND team_group_order = #{team_group_order}
		)GA		
	</select>
	
	<update id="updateLogoutDupAll">
		UPDATE top_login_dup SET login_state = 2
	</update>

	<update id="updateDupListSearch" parameterType="String">
		UPDATE top_login_dup SET login_state = 2 
		WHERE user_no = #{user_no}	
	</update>
	
	<delete id="deleteDupListSearch" parameterType="String">
		DELETE FROM top_login_dup
		WHERE user_no = #{user_no}
	</delete>

	<select id="selectDupListSearch" parameterType="String" resultType="hashmap">
		SELECT
			a.user_no
			,getTopTmBscTeamName(a.team_id_main) AS team_name
			,a.user_name
			,b.ip_addr
			,b.reg_date
			,DATE_FORMAT(FROM_UNIXTIME(b.reg_date), '%Y-%m-%d %H:%i:%s') reg_date_fmt
			,b.login_state
		FROM top_mbr_bsc a
		LEFT JOIN top_login_dup b
		ON a.user_no = b.user_no
		WHERE a.user_state != 1
		<if test="srchUserName != ''">
			AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
		</if>
		AND b.reg_date IS NOT NULL
	</select>	
	
	<select id="chkMbr" parameterType="java.util.HashMap" resultType="String">
		SELECT
			user_no
		FROM
			top_mbr_bsc
		WHERE
			jumin_no1 = #{jumin_no1} and
			jumin_no2 = #{jumin_no2} and
			user_state != 1 
	</select>
	
	<select id="getMbr" parameterType="String" resultType="kr.co.toplac.topteam.TopMbrBscVO">
		SELECT a.user_no
			  ,a.user_id
			  ,a.user_name
			  ,a.team_id_main
			  ,a.email
			  ,a.work_type work_type_cd
			  ,a.work_level work_level_cd 	
			  ,a.work_rank work_rank_cd 	
			  ,a.work_job work_job_cd 	
			  ,getCodeValue('top_mbr_bsc','work_type',a.work_type) work_type
     		  ,getCodeValue('top_mbr_bsc','work_level',a.work_level) work_level
     		  ,getCodeValue('top_mbr_bsc','work_rank',a.work_rank) work_rank
     		  ,getCodeValue('top_mbr_bsc','work_job',a.work_job) work_job
			  ,a.user_state
			  ,DATE_FORMAT(FROM_UNIXTIME(a.pwd_date), '%Y-%m-%d') pwd_date
     		  ,getCodeValue('top_mbr_bsc','user_state',a.user_state) user_state_val						
			  ,DATE_FORMAT(FROM_UNIXTIME(a.join_date), '%Y-%m-%d') join_date
			  ,team.team_name 
			  ,team.team_type
			  ,getTopTmBscCenterName(a.team_id_main) center_name
			  ,team.team_group_order
			  ,team.team_order
			  ,IFNULL((SELECT DISTINCT(team_manager) FROM top_tm_bsc WHERE team_manager = #{user_no}),0) team_manager_yn
			  ,a.email_pwd
			  ,a.handphone
			  ,team.team_center
			  ,team.team_sector
		  FROM top_mbr_bsc a
		 INNER JOIN	top_tm_bsc team
		    ON a.team_id_main = team.team_id 
		 WHERE a.user_state != 1
		   AND a.user_no = #{user_no}
	</select>
	
	<!-- 로그인 1차 검증 : 패스워드, 주민번호 일치하는 유저 정보 확인-->
	<select id="chkMbrForFirstStep" parameterType="java.util.HashMap" resultType="Integer">
		SELECT 
			count(user_no)
		FROM 
			top_mbr_bsc
		WHERE
			 user_id = #{topId} 
			 and jumin_no1 = #{jumin_no1}
			 and jumin_no2 = #{jumin_no2}
			 and user_pwd = #{passWord}
			 and user_state != 1
	</select>
	
	<!-- 인증키 유효시간보다 작은경우만 인증한다. -->
	<select id="chkMbrByMobileAuth" parameterType="hashmap" resultType="integer">
		SELECT count(*) 
		FROM top_mbr_mobile_auth
		WHERE user_no = #{user_no}
		AND auth_no = #{auth_no}
		AND del_date > now()
	</select>
 
	<select id="chkMbrByUserId" parameterType="hashmap" resultType="AsraMap">
		SELECT  A.USER_NO
			   ,A.USER_ID
			   ,A.USER_NAME
			   ,A.USER_PWD
               ,CONCAT(A.JUMIN_NO1, A.JUMIN_NO2) AS JUMIN_NO
               ,A.INVALID_PWD_CNT
               ,IFNULL(DATEDIFF(now(), FROM_UNIXTIME(A.PWD_DATE)),0) PWD_CHG_CNT
               ,IFNULL(A.HANDPHONE,0) AS HANDPHONE
               ,A.IS_PASS AS IS_PASS
		 FROM  top_mbr_bsc A
		WHERE  1=1
		  AND  BINARY A.USER_ID = #{user_id}
		  AND  A.USER_STATE !=1
	</select>
	
	<!-- 기존 핸드폰 인증 번호 제거 -->
	<delete id="deleteMobileAuth" parameterType="String">
		DELETE FROM top_mbr_mobile_auth
		WHERE user_no = #{_parameter}
	</delete>
	
	<!-- 신규 핸드폰 인증 번호 추가 -->
	<insert id="insertMobileAuth" parameterType="hashmap">
		INSERT INTO top_mbr_mobile_auth 
		(
			user_no
			,auth_no
			,reg_date
			,del_date
		) VALUES (
			#{user_no}
			,#{auth_no}
			,now()
			,DATE_ADD(now(), INTERVAL 3 MINUTE)
		)
	</insert>
	
	<update id="udtInvalidPwdCnt" parameterType="String">
		UPDATE top_mbr_bsc
		   SET invalid_pwd_cnt = invalid_pwd_cnt + 1
		 WHERE user_id = #{_parameter} 
	</update>
	
	<update id="udtInvalidPwdCntZero" parameterType="String">
		UPDATE top_mbr_bsc
		   SET invalid_pwd_cnt = 0
		 WHERE user_no = #{_parameter} 
	</update>
	
	
	<select  id="getAuth_backup_20180920" parameterType="String" resultType="kr.co.toplac.topteam.TopMbrAuthVO">
		SELECT
			serial_no,
			user_no,
			mbr_pms_1,
			mbr_pms_2,
			mbr_pms_3,
			mbr_pms_4,
			mbr_pms_5,
			mbr_pms_6,
			mbr_pms_7,
			mbr_pms_8,
			mbr_pms_9,
			mbr_pms_10,
			mbr_pms_11,
			mbr_pms_12,
			mbr_pms_13,
			mbr_pms_14,
			mbr_pms_15,
			mbr_pms_16,
			mbr_pms_17,
			mbr_pms_18,
			mbr_pms_19,
			mbr_pms_20,
			mbr_pms_21,
			mbr_pms_22,
			mbr_pms_23,
			mbr_pms_24,
			mbr_pms_25,
			mbr_pms_26,
			mbr_pms_27,
			mbr_pms_28,
			mbr_pms_29,
			getCodeValue("top_mbr_pms","mbr_pms_25", mbr_pms_25) pms25Val,
			reg_date
		FROM
			top_mbr_pms a
		WHERE
			user_no = #{user_no}
	</select>
	
	<select  id="getAuthCnt" parameterType="String" resultType="Integer">
		SELECT count(*) as Cnt
		  FROM top_mbr_pms
		 WHERE user_no = #{user_no}
	</select>	
	
	<select id="getLsAdmin7" parameterType="String" resultType="String">
		SELECT 
			ls_admin7
		FROM ls_admin 
		WHERE user_id = #{user_no}
	</select>
	
	<!-- 보고서 번호로 결재자(팀장) 정보 가져오기 -->
	<select id="getManagerInfoToSuimRptNo" parameterType="String" resultType="hashmap">
		SELECT
			c.user_name AS manager_name
			,c.email as manager_email
			,c.handphone as handphone
			,GA.team_manager AS manager_no			
		FROM
		(		
			SELECT
				b.team_manager
			FROM top_rpt_head a, top_tm_bsc b
			WHERE a.team_id = b.team_id
			AND a.suim_rpt_no = #{suim_rpt_no}			
		)GA
		LEFT JOIN top_mbr_bsc c
		ON GA.team_manager = c.user_no
	</select>
	
	<select  id="getAuth" parameterType="String" resultType="kr.co.toplac.topteam.TopMbrAuthVO">
		SELECT a.*
			  ,getCodeValue("top_mbr_pms","mbr_pms_25", mbr_pms_25) pms25Val
		  FROM top_mbr_pms a
		 WHERE user_no = #{user_no}
	</select>
	
	<insert id = "insTopMbrPms" parameterType="String">
		INSERT INTO top_mbr_pms
			(
			  	user_no, reg_date
			)
		VALUES
			(
				#{user_no}, unix_timestamp(now())
			)
	</insert>
	
	<select id="selectNoSendReportCnt" parameterType="String" resultType="integer">
		SELECT 
			COUNT(*) AS cnt 
		FROM top_rpt_head
		WHERE suim_rpt_state = 2
		AND team_id = #{team_id}
		AND close_date > UNIX_TIMESTAMP('2019-01-01')
		AND issue_send_result = 0
	</select>
	
	<select id="selectSiteNaviTeam" parameterType="String" resultType="hashmap">
		SELECT
			team_id
			,team_name
			,team_center
			,getTopTmBscCenterName(team_id) AS center_name
		FROM top_tm_bsc
		WHERE team_id = #{team_id}
	</select>
	
	<!-- 사용자별 현장보고서 리포트 결과, 일반건 전환일자조건 추가로 변경, 현장보고서 조건추가 by top3009-->
	<select id="selectSiteMemberReportListAll" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_no AS user_no
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(		
				SELECT 
					GA.user_no AS user_no	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
			
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3 -->
					AND ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3 -->
					AND ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3 -->
					AND ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3 -->
					AND ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.reg_date) &lt; 3 -->
					AND ( getDateDiff(th.reg_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.trans_date) &lt; 3 -->
					AND ( getDateDiff(th.trans_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.reg_date) >= 3 -->
					AND ( getDateDiff(th.reg_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.trans_date) >= 3 -->
					AND ( getDateDiff(th.trans_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)					
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB
			WHERE GB.user_no NOT IN (12, 1466)	
	</select>	
	
	<!-- 사용자별 현장보고서 리포트 결과, 일반건 전환일자조건 추가로 변경 by top3009-->
	<select id="selectSiteMemberReportListAll_20210429" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_no AS user_no
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(		
				SELECT 
					GA.user_no AS user_no	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
			
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL					
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB	
	</select>
	
	<!-- 사용자별 현장보고서 리포트 결과, 일반건 전환일자조건 추가로 변경 by top3009-->
	<select id="selectSiteMemberReportListAll_close" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_no AS user_no
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(		
				SELECT 
					GA.user_no AS user_no	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
			
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL					
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL					
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB	
	</select>	
	
	
	<!-- 사용자별 현장보고서 리포트 결과, 일반건 전환일자조건 추가로 변경 by top3009-->
	<select id="selectSiteMemberReportListAll_20210419" resultType="hashmap">
		SELECT
			GB.user_no AS user_no
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
		FROM
		(		
				SELECT 
					GA.user_no AS user_no	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
			
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
			
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB	
	</select>	
	
	<!-- 사용자별 현장보고서 리포트 결과  -->
	<select id="selectSiteMemberReportListAll_20210402" resultType="hashmap">
		SELECT 
			GA.user_no AS user_no	
			,SUM(GA.suim_cnt) AS suim_cnt
			,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
			,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
			,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
			,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
			,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
		FROM
		(
			SELECT
				th.user_no		
				,COUNT(*) AS suim_cnt	
				,0 AS sub_3_in_cnt
				,0 AS sub_3_over_cnt
				,0 AS not_3_in_cnt
				,0 AS not_3_over_cnt
				,0 AS not_30_over_cnt
			FROM top_rpt_head th
			WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
			AND th.pendncy_trget_at IN (1,4)
			AND th.suim_rpt_state IN (0,1,2)
			AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
			GROUP BY th.user_no
	
			UNION ALL
	
			SELECT
				th.user_no
				,0 AS suim_cnt	
				,COUNT(*) AS sub_3_in_cnt
				,0 AS sub_3_over_cnt
				,0 AS not_3_in_cnt
				,0 AS not_3_over_cnt
				,0 AS not_30_over_cnt
			FROM top_rpt_head th
			WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
			AND th.pendncy_trget_at IN (1,4)
			AND th.suim_rpt_state IN (0,1,2)
			AND th.site_rpt_state = 2
			AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
			AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
			GROUP BY th.user_no
			
			UNION ALL
			
			SELECT
				th.user_no
				,0 AS suim_cnt	
				,0 AS sub_3_in_cnt
				,COUNT(*) AS sub_3_over_cnt
				,0 AS not_3_in_cnt
				,0 AS not_3_over_cnt
				,0 AS not_30_over_cnt
			FROM top_rpt_head th
			WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
			AND th.pendncy_trget_at IN (1,4)
			AND th.suim_rpt_state IN (0,1,2)
			AND th.site_rpt_state = 2
			AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
			AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
			GROUP BY th.user_no
			
			UNION ALL
			
			SELECT
				th.user_no
				,0 AS suim_cnt	
				,0 AS sub_3_in_cnt
				,0 AS sub_3_over_cnt
				,COUNT(*) AS not_3_in_cnt
				,0 AS not_3_over_cnt
				,0 AS not_30_over_cnt
			FROM top_rpt_head th
			WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
			AND th.pendncy_trget_at IN (1,4)
			AND th.suim_rpt_state IN (0,1,2)
			AND th.site_rpt_state IN (0,1)
			AND getDateDiff(th.reg_date) &lt; 3
			AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
			GROUP BY th.user_no
			
			UNION ALL
			
			SELECT
				th.user_no
				,0 AS suim_cnt	
				,0 AS sub_3_in_cnt
				,0 AS sub_3_over_cnt
				,0 AS not_3_in_cnt
				,COUNT(*) AS not_3_over_cnt
				,0 AS not_30_over_cnt
			FROM top_rpt_head th
			WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
			AND th.pendncy_trget_at IN (1,4)
			AND th.suim_rpt_state IN (0,1,2)
			AND th.site_rpt_state IN (0,1)
			AND getDateDiff(th.reg_date) >= 3
			AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
			GROUP BY th.user_no
			
			UNION ALL
			
			SELECT
				th.user_no
				,0 AS suim_cnt	
				,0 AS sub_3_in_cnt
				,0 AS sub_3_over_cnt
				,0 AS not_3_in_cnt
				,0 AS not_3_over_cnt
				,COUNT(*) AS not_30_over_cnt
			FROM top_rpt_head th
			WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
			AND th.pendncy_trget_at IN (1,4)
			AND th.suim_rpt_state IN (0,1)
			AND th.site_rpt_state IN (0,1)				
			AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
			GROUP BY th.user_no
			
		) GA 
		GROUP BY GA.user_no		
	</select>
	
	<!-- 물보험 조사 부분 전체목록 -->
	<select id="selectSectorListFor1" resultType="hashmap">
		SELECT 
			col_cd AS team_sector
			,col_val AS sector_name
		FROM sysadm_codedic 
		WHERE tbl_nm = 'top_tm_bsc' 
		AND col_nm = 'team_sector'
		<!-- AND col_cd IN(11,12,21,31,32,33,41,61,62,63,71,72,73,81,82,91,92) -->
		AND col_cd IN(1,2,3)
	</select>
	
	<!-- 물보험 조사 센터 전체목록 -->
	<select id="selectCenterListFor1" resultType="hashmap">
		SELECT 
			col_cd AS center_no
			,col_val AS center_name
		FROM sysadm_codedic 
		WHERE tbl_nm = 'top_tm_bsc' 
		AND col_nm = 'team_center'
		<!-- AND col_cd IN(11,12,21,31,32,33,41,61,62,63,71,72,73,81,82,91,92) -->
		<!-- AND col_cd IN(11,12,21,31,32,33,41,61,63,71,72,73,81,82,91,92) -->
		AND col_cd IN(11,12,13,14,21,31,32,33,41,61,63,71,72,81,82,91,92)
	</select>
	
	<select id="selectSiteOverPerCal" parameterType="hashmap" resultType="String">
		SELECT	
			ROUND(((GD.sub_3_over_cnt + GD.not_3_over_cnt) / GD.suim_cnt * 100)) AS total_over_per
		FROM
		(
			SELECT
				COUNT(GC.team_id) AS team_cnt
				,SUM(GC.suim_cnt) AS suim_cnt
				,SUM(GC.sub_3_over_cnt) AS sub_3_over_cnt
				,SUM(GC.not_3_over_cnt) AS not_3_over_cnt
			FROM
				(
				SELECT
						GB.team_id AS team_id	
						,tb.team_center AS team_center			
						,( GB.suim_cnt + GB.trans_suim_cnt ) AS suim_cnt						
						,( GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt ) AS sub_3_over_cnt			
						,( GB.not_3_over_cnt + GB.trans_not_3_over_cnt ) AS not_3_over_cnt
					FROM(
							SELECT 
								GA.team_id AS team_id	
								,SUM(GA.suim_cnt) AS suim_cnt
								,SUM(GA.trans_suim_cnt) AS trans_suim_cnt					
								,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
								,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt					
								,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
								,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt					
							FROM
							(
								SELECT
									th.team_id		
									,COUNT(*) AS suim_cnt
									,0 AS trans_suim_cnt						
									,0 AS sub_3_over_cnt
									,0 AS trans_sub_3_over_cnt						
									,0 AS not_3_over_cnt
									,0 AS trans_not_3_over_cnt						
								FROM top_rpt_head th
								WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
								AND th.pendncy_trget_at IN (1,4)
								AND th.suim_rpt_state IN (0,1,2)
								AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								AND th.trans_date IS NULL
								GROUP BY th.team_id
								
								UNION ALL
								
								SELECT
									th.team_id		
									,0 AS suim_cnt
									,COUNT(*) AS trans_suim_cnt						
									,0 AS sub_3_over_cnt
									,0 AS trans_sub_3_over_cnt						
									,0 AS not_3_over_cnt
									,0 AS trans_not_3_over_cnt						
								FROM top_rpt_head th
								WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
								AND th.pendncy_trget_at IN (1,4)
								AND th.suim_rpt_state IN (0,1,2)
								AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								AND th.trans_date IS NOT NULL
								GROUP BY th.team_id
								
								UNION ALL
								
								SELECT
									th.team_id		
									,0 AS suim_cnt
									,0 AS trans_suim_cnt						
									,COUNT(*) AS sub_3_over_cnt
									,0 AS trans_sub_3_over_cnt						
									,0 AS not_3_over_cnt
									,0 AS trans_not_3_over_cnt						
								FROM top_rpt_head th
								WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
								AND th.pendncy_trget_at IN (1,4)
								AND th.suim_rpt_state IN (0,1,2)
								AND th.site_rpt_state = 2
								AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
								AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								AND th.trans_date IS NULL
								GROUP BY th.team_id
								
								UNION ALL
								
								SELECT
									th.team_id		
									,0 AS suim_cnt
									,0 AS trans_suim_cnt						
									,0 AS sub_3_over_cnt
									,COUNT(*) AS trans_sub_3_over_cnt						
									,0 AS not_3_over_cnt
									,0 AS trans_not_3_over_cnt						
								FROM top_rpt_head th
								WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
								AND th.pendncy_trget_at IN (1,4)
								AND th.suim_rpt_state IN (0,1,2)
								AND th.site_rpt_state = 2
								AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
								AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								AND th.trans_date IS NOT NULL
								GROUP BY th.team_id
								
								UNION ALL
								
								SELECT
									th.team_id		
									,0 AS suim_cnt
									,0 AS trans_suim_cnt						
									,0 AS sub_3_over_cnt
									,0 AS trans_sub_3_over_cnt						
									,COUNT(*) AS not_3_over_cnt
									,0 AS trans_not_3_over_cnt						
								FROM top_rpt_head th
								WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
								AND th.pendncy_trget_at IN (1,4)
								AND th.suim_rpt_state IN (0,1,2)
								AND th.site_rpt_state IN (0,1)
								AND getDateDiff(th.reg_date) >= 3
								AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								AND th.trans_date IS NULL
								GROUP BY th.team_id
								
								UNION ALL
								
								SELECT
									th.team_id		
									,0 AS suim_cnt
									,0 AS trans_suim_cnt						
									,0 AS sub_3_over_cnt
									,0 AS trans_sub_3_over_cnt						
									,0 AS not_3_over_cnt
									,COUNT(*) AS trans_not_3_over_cnt						
								FROM top_rpt_head th
								WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
								AND th.pendncy_trget_at IN (1,4)
								AND th.suim_rpt_state IN (0,1,2)
								AND th.site_rpt_state IN (0,1)
								AND getDateDiff(th.trans_date) >= 3
								AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								AND th.trans_date IS NOT NULL
								GROUP BY th.team_id
							) GA 
							GROUP BY GA.team_id
						)GB LEFT JOIN top_tm_bsc tb
					ON GB.team_id = tb.team_id
					WHERE tb.team_written = 0
					AND tb.team_type != 4
					<if test="sel_team_center != NULL and sel_team_center !=''">
						AND tb.team_center = #{sel_team_center}
					</if>
				)GC
			)GD
	</select>
	
	<!-- 팀별 현장보고서 리포트 결과, 일반건 전환일자 조건 추가로 수정, 현장보고서와 동일조건으로 변경 by top3009 -->
	<select id="selectSiteTeamReportListAll" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id	
			,tb.team_center AS team_center			
			,( GB.suim_cnt + GB.trans_suim_cnt ) AS suim_cnt			
			,( GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GB.not_3_in_cnt + GB.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GB.not_3_over_cnt + GB.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GB.not_30_over_cnt + GB.trans_not_30_over_cnt ) AS not_30_over_cnt
			, GB.end_total_cnt
			, GB.trans_end_tocal_cnt
			, GB.total_period_date
			, GB.trans_total_period_date
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt))),0) AS end_average_cnt			
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
					
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3 -->
					AND ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3 -->
					AND ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3 -->
					AND ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					<!-- AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3 -->
					AND ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.reg_date) &lt; 3 -->
					AND ( getDateDiff(th.reg_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.trans_date) &lt; 3 -->
					AND ( getDateDiff(th.trans_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.reg_date) >= 3 -->
					AND ( getDateDiff(th.reg_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.reg_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) )>= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					<!-- AND getDateDiff(th.trans_date) >= 3 -->
					AND ( getDateDiff(th.trans_date) - (SELECT COUNT(*) FROM sysadm_holiday WHERE holiday_date = DATE_FORMAT(FROM_UNIXTIME(th.trans_date),'%Y-%m-%d') AND holiday_code IN (0,1,7)) ) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id
		WHERE tb.team_written = 0
		AND tb.team_type != 4
	</select>	
	
	<!-- 팀별 현장보고서 리포트 결과, 일반건 전환일자 조건 추가로 수정 by top3009 -->
	<select id="selectSiteTeamReportListAll_20210429" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id	
			,tb.team_center AS team_center			
			,( GB.suim_cnt + GB.trans_suim_cnt ) AS suim_cnt			
			,( GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GB.not_3_in_cnt + GB.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GB.not_3_over_cnt + GB.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GB.not_30_over_cnt + GB.trans_not_30_over_cnt ) AS not_30_over_cnt
			, GB.end_total_cnt
			, GB.trans_end_tocal_cnt
			, GB.total_period_date
			, GB.trans_total_period_date
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt))),0) AS end_average_cnt			
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
					
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id
		WHERE tb.team_written = 0
	</select>
	
	<!-- 팀별 현장보고서 리포트 결과, 일반건 전환일자 조건 추가로 수정 by top3009 -->
	<select id="selectSiteTeamReportListAll_close" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id	
			,tb.team_center AS team_center			
			,( GB.suim_cnt + GB.trans_suim_cnt ) AS suim_cnt			
			,( GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GB.not_3_in_cnt + GB.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GB.not_3_over_cnt + GB.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GB.not_30_over_cnt + GB.trans_not_30_over_cnt ) AS not_30_over_cnt
			, GB.end_total_cnt
			, GB.trans_end_tocal_cnt
			, GB.total_period_date
			, GB.trans_total_period_date
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt))),0) AS end_average_cnt			
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
					
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2					
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id
	</select>	
	
	<!-- 팀별 현장보고서 리포트 결과, 일반건 전환일자 조건 추가로 수정 by top3009 -->
	<select id="selectSiteTeamReportListAll_20210419" resultType="hashmap">
		SELECT
			GB.team_id AS team_id	
			,tb.team_center AS team_center			
			,( GB.suim_cnt + GB.trans_suim_cnt ) AS suim_cnt			
			,( GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GB.not_3_in_cnt + GB.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GB.not_3_over_cnt + GB.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GB.not_30_over_cnt + GB.trans_not_30_over_cnt ) AS not_30_over_cnt
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id
	</select>
	
	<!-- 팀별 현장보고서 리포트 결과 -->
	<select id="selectSiteTeamReportListAll_20210402" resultType="hashmap">
		SELECT
			GB.team_id AS team_id	
			,tb.team_center AS team_center			
			,GB.suim_cnt AS suim_cnt
			,GB.sub_3_in_cnt AS sub_3_in_cnt
			,GB.sub_3_over_cnt AS sub_3_over_cnt
			,GB.not_3_in_cnt AS not_3_in_cnt
			,GB.not_3_over_cnt AS not_3_over_cnt
			,GB.not_30_over_cnt AS not_30_over_cnt
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,COUNT(*) AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id	
	</select>
	
	<!-- 팀별 현장보고서 리포트 결과 (속도가느려서 못씀)-->
	<select id="selectSiteTeamReportList_20210311" parameterType="String" resultType="hashmap">
		SELECT
			GB.team_name
			,GB.suim_cnt
			,GB.sub_3_in_cnt
			,GB.sub_3_over_cnt
			,GB.not_3_in_cnt
			,GB.not_3_over_cnt
			,GB.not_30_over_cnt
			,IFNULL(ROUND((GB.sub_3_over_cnt+GB.not_3_over_cnt) / GB.suim_cnt*100,1), 0.0) AS over_per
		FROM
			(
				SELECT
					GA.team_name
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
				FROM
					(
						SELECT
							team_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_tm_bsc
						WHERE team_id = #{team_id}
						
						UNION ALL
						
						SELECT
							"" AS team_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.team_id = #{team_id}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS team_name
							,0 AS suim_cnt
							,COUNT(*) AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.team_id = #{team_id}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS team_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,COUNT(*) AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.team_id = #{team_id}			
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						
						UNION ALL
				
						SELECT
							"" AS team_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,COUNT(*) AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.team_id = #{team_id}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND getDateDiff(th.reg_date) &lt; 3
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS team_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,COUNT(*) AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.team_id = #{team_id}			
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND getDateDiff(th.reg_date) >= 3
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS team_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,COUNT(*) AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.team_id = #{team_id}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1)
						AND th.site_rpt_state IN (0,1)				
						AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					)GA
				)GB
	</select>
	
	<!-- 개인현장보고서 리포트 결과, 일반전환일 조건추가로 변경, 평균처리일조건 현장보고서와 동일하게 추가 -->		
	<select id="selectSitePersonReportList" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_name
			,GB.suim_cnt
			,GB.sub_3_in_cnt
			,GB.sub_3_over_cnt
			,GB.not_3_in_cnt
			,GB.not_3_over_cnt
			,GB.not_30_over_cnt
			,IFNULL(ROUND((GB.sub_3_over_cnt+GB.not_3_over_cnt) / GB.suim_cnt*100,1), 0.0) AS over_per
			,IFNULL(ROUND((GB.total_period_date+GB.trans_total_period_date) / (GB.end_total_cnt+GB.trans_end_total_cnt) ,1), 0.0) AS end_average_cnt			 
		FROM
			(
				SELECT
					GA.user_name
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_total_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date					
				FROM
					(
						SELECT
							getTopMbrBscUserName(th.user_no) AS user_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND 
						(
							CASE 
								WHEN (th.trans_date IS NULL)
								THEN th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								ELSE th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,COUNT(*) AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,COUNT(*) AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)))
							END
						)
						
						UNION ALL
				
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,COUNT(*) AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,COUNT(*) AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,COUNT(*) AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE 
								WHEN ( th.trans_date IS NULL )
								THEN ( th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)				
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,COUNT(*) AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NULL
						AND th.suim_rpt_type1 IN (1,2,11,12,13)
						AND th.pendncy_trget_at IN (1,4)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,COUNT(*) AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NOT NULL
						AND th.suim_rpt_type1 IN (1,2,11,12,13)
						AND th.pendncy_trget_at IN (1,4)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NULL
						AND th.suim_rpt_type1 IN (1,2,11,12,13)
						AND th.pendncy_trget_at IN (1,4)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1 ) AS trans_total_period_date							
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NOT NULL
						AND th.suim_rpt_type1 IN (1,2,11,12,13)
						AND th.pendncy_trget_at IN (1,4)
						
					)GA
				)GB
	</select>
	
	<!-- 개인현장보고서 리포트 결과, 일반전환일 조건추가로 변경-->	
	<select id="selectSitePersonReportList_20210429" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_name
			,GB.suim_cnt
			,GB.sub_3_in_cnt
			,GB.sub_3_over_cnt
			,GB.not_3_in_cnt
			,GB.not_3_over_cnt
			,GB.not_30_over_cnt
			,IFNULL(ROUND((GB.sub_3_over_cnt+GB.not_3_over_cnt) / GB.suim_cnt*100,1), 0.0) AS over_per
			,IFNULL(ROUND((GB.total_period_date+GB.trans_total_period_date) / (GB.end_total_cnt+GB.trans_end_total_cnt) ,1), 0.0) AS end_average_cnt			 
		FROM
			(
				SELECT
					GA.user_name
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_total_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date					
				FROM
					(
						SELECT
							getTopMbrBscUserName(th.user_no) AS user_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND 
						(
							CASE 
								WHEN (th.trans_date IS NULL)
								THEN th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								ELSE th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,COUNT(*) AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,COUNT(*) AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)))
							END
						)
						
						UNION ALL
				
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,COUNT(*) AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,COUNT(*) AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,COUNT(*) AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE 
								WHEN ( th.trans_date IS NULL )
								THEN ( th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)				
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,COUNT(*) AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NULL
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,COUNT(*) AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NOT NULL
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NULL
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1 ) AS trans_total_period_date							
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NOT NULL
						
					)GA
				)GB
	</select>	
	
	<!-- 개인현장보고서 리포트 결과, 일반전환일 조건추가로 변경-->	
	<select id="selectSitePersonReportList_close" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_name
			,GB.suim_cnt
			,GB.sub_3_in_cnt
			,GB.sub_3_over_cnt
			,GB.not_3_in_cnt
			,GB.not_3_over_cnt
			,GB.not_30_over_cnt
			,IFNULL(ROUND((GB.sub_3_over_cnt+GB.not_3_over_cnt) / GB.suim_cnt*100,1), 0.0) AS over_per
			,IFNULL(ROUND((GB.total_period_date+GB.trans_total_period_date) / (GB.end_total_cnt+GB.trans_end_total_cnt) ,1), 0.0) AS end_average_cnt			 
		FROM
			(
				SELECT
					GA.user_name
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_total_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date					
				FROM
					(
						SELECT
							getTopMbrBscUserName(th.user_no) AS user_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND 
						(
							CASE 
								WHEN (th.trans_date IS NULL)
								THEN th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								ELSE th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,COUNT(*) AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,COUNT(*) AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)))
							END
						)
						
						UNION ALL
				
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,COUNT(*) AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,COUNT(*) AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,COUNT(*) AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE 
								WHEN ( th.trans_date IS NULL )
								THEN ( th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)				
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,COUNT(*) AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NULL
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,COUNT(*) AS trans_end_tocal_cnt
							,0 AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NOT NULL
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
							,0 AS trans_total_period_date
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NULL
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
							,0 AS end_total_cnt
							,0 AS trans_end_tocal_cnt
							,0 AS total_period_date
							,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1 ) AS trans_total_period_date							
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}
						AND th.suim_rpt_state = 2						
						AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
						AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
						AND th.trans_date IS NOT NULL
						
					)GA
				)GB
	</select>
	
	<!-- 개인현장보고서 리포트 결과, 일반전환일 조건추가로 변경-->	
	<select id="selectSitePersonReportList_20210416" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.user_name
			,GB.suim_cnt
			,GB.sub_3_in_cnt
			,GB.sub_3_over_cnt
			,GB.not_3_in_cnt
			,GB.not_3_over_cnt
			,GB.not_30_over_cnt
			,IFNULL(ROUND((GB.sub_3_over_cnt+GB.not_3_over_cnt) / GB.suim_cnt*100,1), 0.0) AS over_per
		FROM
			(
				SELECT
					GA.user_name
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
				FROM
					(
						SELECT
							getTopMbrBscUserName(th.user_no) AS user_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND 
						(
							CASE 
								WHEN (th.trans_date IS NULL)
								THEN th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								ELSE th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,COUNT(*) AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,COUNT(*) AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN ( getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3 AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3 AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)))
							END
						)
						
						UNION ALL
				
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,COUNT(*) AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND 
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date >= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,COUNT(*) AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE
								WHEN ( th.trans_date IS NULL )
								THEN (
									th.reg_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
								ELSE (
									th.trans_date &lt; ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
										  FROM ( SELECT holiday_date
													   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
														AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
									AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
								)
							END
						)								
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,COUNT(*) AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1)
						AND th.site_rpt_state IN (0,1)
						AND
						(
							CASE 
								WHEN ( th.trans_date IS NULL )
								THEN ( th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
								ELSE ( th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY)) )
							END
						)				
						
					)GA
				)GB
	</select>	
	
	<!-- 개인현장보고서 리포트 결과, 일반전환일 조건추가로 변경-->
	<select id="selectSitePersonReportList_20210402" parameterType="String" resultType="hashmap">
		SELECT
			GB.user_name
			,GB.suim_cnt
			,GB.sub_3_in_cnt
			,GB.sub_3_over_cnt
			,GB.not_3_in_cnt
			,GB.not_3_over_cnt
			,GB.not_30_over_cnt
			,IFNULL(ROUND((GB.sub_3_over_cnt+GB.not_3_over_cnt) / GB.suim_cnt*100,1), 0.0) AS over_per
		FROM
			(
				SELECT
					GA.user_name
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
				FROM
					(
						SELECT
							getTopMbrBscUserName(th.user_no) AS user_name
							,COUNT(*) AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,COUNT(*) AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,COUNT(*) AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state = 2
						AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
				
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,COUNT(*) AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						<!-- AND getDateDiff(th.reg_date) &lt; 3 -->
						AND th.reg_date > ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
								    		  FROM ( SELECT holiday_date
										  			   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
									 		  			AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,COUNT(*) AS not_3_over_cnt
							,0 AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1,2)
						AND th.site_rpt_state IN (0,1)
						<!-- AND getDateDiff(th.reg_date) >= 3 -->
						AND th.reg_date &lt;= ( SELECT UNIX_TIMESTAMP(MIN(tmp.holiday_date))
								    		  FROM ( SELECT holiday_date
										  			   FROM sysadm_holiday
													  WHERE holiday_code IN (2,3,4,5,6)
									 		  			AND holiday_date &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')
													  ORDER BY holiday_date DESC
												      LIMIT 0,3) tmp )
						AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
						
						UNION ALL
						
						SELECT
							"" AS user_name
							,0 AS suim_cnt
							,0 AS sub_3_in_cnt
							,0 AS sub_3_over_cnt
							,0 AS not_3_in_cnt
							,0 AS not_3_over_cnt
							,COUNT(*) AS not_30_over_cnt
						FROM top_rpt_head th
						WHERE 1=1
						AND th.user_no = #{user_no}		
						AND th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
						AND th.pendncy_trget_at IN (1,4)
						AND th.suim_rpt_state IN (0,1)
						AND th.site_rpt_state IN (0,1)				
						AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					)GA
				)GB
	</select>
	
	<select id="selectSuimCnt30" parameterType="String" resultType="integer">
		SELECT 
			COUNT(*) as Cnt
		FROM top_rpt_head 
		WHERE 1=1
		AND user_no = #{user_no}
		AND reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
	
	</select>
	
	<select id="selectTeamListAuth23" parameterType="String" resultType="String">
		SELECT 
			IFNULL(ls_admin23,'') as ls_admin23 
		FROM ls_admin 
		WHERE user_id = #{user_no}
	</select>
	
	<select id="selectTeamListAuth" parameterType="String" resultType="String">
		SELECT 
			IFNULL(ls_admin_nosend,'') as ls_admin_nosend 
		FROM ls_admin 
		WHERE user_id = #{user_no}
	</select>
	
	<select id="selectTeamListManager" parameterType="String" resultType="AsraMap">
		SELECT 
			team_id
			,team_name
			,team_center
		FROM top_tm_bsc 
		WHERE team_manager = #{team_manager}
		AND team_level = 1
		AND only_statistics = 0
		ORDER BY team_group_order DESC, team_order DESC, team_level;	
	</select>
	
	<select id="selectTeamListCenter" parameterType="String" resultType="AsraMap">
		SELECT 
			team_id
			,team_name
			,getTopTmBscCenterName(team_id) AS center_name
		FROM top_tm_bsc 
		WHERE team_center = #{team_center}
		AND team_level = 1
		AND only_statistics = 0
		ORDER BY team_group_order DESC, team_order DESC, team_level;	
	</select>
	
	<select id="selectTeamListSector" parameterType="String" resultType="AsraMap">
		SELECT 
			team_id
			,team_name
		FROM top_tm_bsc 
		WHERE team_sector = #{team_sector}
		AND team_level = 1
		AND only_statistics = 0
		ORDER BY team_group_order DESC, team_order DESC, team_level;	
	</select>
	
	<select id="selectTeamListAuthSearch" parameterType="hashmap" resultType="AsraMap">
		SELECT 
			team_id
			,team_name
		FROM top_tm_bsc 
		WHERE 1=1
		AND team_level = 1
		AND only_statistics = 0
		<if test="sqlTeam != NULL and sqlTeam !=''">
			AND team_id IN ( ${sqlTeam} )
		</if>
		ORDER BY team_group_order DESC, team_order DESC, team_level;	
	</select>
	
	<select id="selectTeamListAuthSearchFor1" parameterType="hashmap" resultType="AsraMap">
		SELECT 
			team_id
			,team_name
			,getTopTmBscCenterName(team_id) AS center_name
		FROM top_tm_bsc 
		WHERE 1=1
		AND team_level = 1
		AND only_statistics = 0
		AND team_type in (0,1)
		<if test="sqlTeam != NULL and sqlTeam !=''">
			AND team_id IN ( ${sqlTeam} )
		</if>
		ORDER BY team_group_order DESC, team_order DESC, team_level;	
	</select>
	
	<select  id="selectCenterCode" parameterType="String" resultType="String">
		SELECT team_center			
		  FROM top_tm_bsc
		 WHERE team_id = #{team_id}
	</select>
	
	<select  id="selectSectorCode" parameterType="String" resultType="String">
		SELECT team_sector			
		  FROM top_tm_bsc
		 WHERE team_id = #{team_id}
	</select>
	
	<select  id="getVacation1Auth" parameterType="String" resultType="kr.co.toplac.topteam.TopMbrAuthVO">
		SELECT ls_admin_vacation1			
		  FROM ls_admin
		 WHERE user_id = #{user_no}
	</select>
	
	<select  id="getVacationAuth" parameterType="String" resultType="kr.co.toplac.topteam.TopMbrAuthVO">
		SELECT ls_admin_vacation1
			,ls_admin_vacation2
		  FROM ls_admin
		 WHERE user_id = #{user_no}
	</select>
	
	
	<insert id = "insLoginLog" parameterType="java.util.HashMap">
		
		INSERT INTO top_login_log
			(
			  	user_no, ip_addr, reg_date
			)
		VALUES
			(
				#{user_no},#{ip}, unix_timestamp(now())
			)
		
	</insert>
	
	<select id="chkLoginDup" parameterType="String" resultType="kr.co.toplac.toplogin.TopLogInDuplicationVO">
		SELECT 
			login_state, ip_addr
		FROM 
		  	top_login_dup
		WHERE 
		 	user_no = #{user_no}
	</select>
	
	<insert id="insLoginDup" parameterType="java.util.HashMap">
	
		INSERT INTO top_login_dup
			(
			  	user_no, ip_addr, login_state, reg_date
			)
		VALUES
			(
				#{userNo},#{ip},#{loginState}, unix_timestamp(now())
			)
	</insert>
	
	<update id="udtLoginDup" parameterType="java.util.HashMap">
		UPDATE 
			top_login_dup
		SET
			ip_addr = #{ipAddr},
			login_state = 1,
			reg_date = unix_timestamp(now())
		WHERE
			user_no = #{userNo}
	</update>
	
	<update id="udtLogoutDup" parameterType="String">
		UPDATE 
			top_login_dup
		SET
			login_state = 2,
			reg_date = unix_timestamp(now())
		WHERE
			user_no = #{userNo}
	</update>
	
	<select id="selectNoSendReportResult"  parameterType="string" resultType="hashmap">
		SELECT
			IF(SUM(GA.con_method) > 0,'O','X') AS con_method
			,IF(SUM(GA.ins_method) > 0,'O','X') AS ins_method
			,IF(SUM(GA.cla_method) > 0,'O','X') AS cla_method	
		FROM
		(
			SELECT 
				COUNT(*) AS con_method
				,0 AS ins_method
				,0 AS cla_method
			FROM top_rpt_issue_send 
			WHERE 1=1 
			AND suim_rpt_no = #{suim_rpt_no}
			AND send_target = 1
			AND complete_flag = 1
		
			UNION ALL
		
			SELECT 
				0 AS con_method
				,COUNT(*) AS ins_method
				,0 AS cla_method
			FROM top_rpt_issue_send 
			WHERE 1=1 
			AND suim_rpt_no = #{suim_rpt_no}
			AND send_target = 5
			AND complete_flag = 1
		
			UNION ALL
		
			SELECT 
				0 AS con_method
				,0 AS ins_method
				,COUNT(*) AS cla_method
			FROM top_rpt_issue_send 
			WHERE 1=1 
			AND suim_rpt_no = #{suim_rpt_no}
			AND send_target = 10
			AND complete_flag = 1
		)GA	
	</select>
	
	<select id="selectNoSendReportList"  parameterType="hashmap" resultType="hashmap">
		SELECT
			suim_rpt_no 
			,suim_accept_no
			,getTopPtnrBscPtnrNick(ptnr_id) AS ptnr_name
			,DATE_FORMAT(FROM_UNIXTIME(close_date), '%Y-%m-%d') AS close_date_fmt	
		FROM top_rpt_head
		WHERE 1=1
		AND close_date > UNIX_TIMESTAMP('2019-01-01')
		AND issue_send_result = 0
		AND suim_rpt_state = 2
		AND user_no = #{user_no}
		ORDER BY close_date		
	</select> 
	
	<select id="selectNoSendMemberList"  parameterType="hashmap" resultType="hashmap">
		SELECT
			SUM(GA.total_cnt) AS total_cnt
			,(SUM(GA.total_cnt)-SUM(GA.type1_cnt)) AS type1_cnt
			,(SUM(GA.total_cnt)-SUM(GA.type5_cnt)) AS type5_cnt
			,(SUM(GA.total_cnt)-SUM(GA.type10_cnt)) AS type10_cnt
		FROM
		(
			SELECT 
				COUNT(*) AS total_cnt
				,0 AS type1_cnt
				,0 AS type5_cnt
				,0 AS type10_cnt
			FROM top_rpt_head 
			WHERE 1=1
			AND user_no = #{user_no}
			AND team_id = #{team_id}
			AND issue_send_result = 0
			AND suim_rpt_state = 2
			AND close_date > UNIX_TIMESTAMP('2019-01-01')
		
			UNION ALL
		
			SELECT
				0 AS total_cnt
				,COUNT(DISTINCT(a.suim_rpt_no))AS type1_cnt
				,0 AS type5_cnt
				,0 AS type10_cnt	
			FROM top_rpt_head a, top_rpt_issue_send b
			WHERE a.suim_rpt_no = b.suim_rpt_no
			AND a.user_no = #{user_no}
			AND a.team_id = #{team_id}
			AND a.issue_send_result = 0
			AND a.suim_rpt_state = 2
			AND a.close_date > UNIX_TIMESTAMP('2019-01-01')
			AND b.send_target = 1
			AND b.complete_flag = 1
		
			UNION ALL
		
			SELECT
				0 AS total_cnt
				,0 type1_cnt
				,COUNT(DISTINCT(a.suim_rpt_no))AS type5_cnt
				,0 AS type10_cnt	
			FROM top_rpt_head a, top_rpt_issue_send b
			WHERE a.suim_rpt_no = b.suim_rpt_no
			AND a.user_no = #{user_no}
			AND a.team_id = #{team_id}
			AND a.issue_send_result = 0
			AND a.suim_rpt_state = 2
			AND a.close_date > UNIX_TIMESTAMP('2019-01-01')
			AND b.send_target = 5
			AND b.complete_flag = 1
		
			UNION ALL
		
			SELECT
				0 AS total_cnt
				,0 type1_cnt
				,0 AS type5_cnt
				,COUNT(DISTINCT(a.suim_rpt_no)) AS type10_cnt	
			FROM top_rpt_head a, top_rpt_issue_send b
			WHERE a.suim_rpt_no = b.suim_rpt_no
			AND a.user_no = #{user_no}
			AND a.team_id = #{team_id}
			AND a.issue_send_result = 0
			AND a.suim_rpt_state = 2
			AND a.close_date > UNIX_TIMESTAMP('2019-01-01')
			AND b.send_target = 10
			AND b.complete_flag = 1
		)GA
	</select>	
	
	<select id="selectNoSendPersonInfo"  parameterType="String" resultType="hashmap">
		SELECT
			GA.user_no as user_no
			,getTopMbrBscUserName(GA.user_no) as user_name
			,SUM(GA.total_cnt) AS total_cnt
			,(SUM(GA.total_cnt)-SUM(GA.type1_cnt)) AS type1_cnt
			,(SUM(GA.total_cnt)-SUM(GA.type5_cnt)) AS type5_cnt
			,(SUM(GA.total_cnt)-SUM(GA.type10_cnt)) AS type10_cnt
		FROM
		(
			SELECT
				user_no				 
				,COUNT(*) AS total_cnt
				,0 AS type1_cnt
				,0 AS type5_cnt
				,0 AS type10_cnt
			FROM top_rpt_head 
			WHERE 1=1
			AND user_no = #{user_no}			
			AND issue_send_result = 0
			AND suim_rpt_state = 2
			AND close_date > UNIX_TIMESTAMP('2019-01-01')
		
			UNION ALL
		
			SELECT
				user_no
				,0 AS total_cnt
				,COUNT(DISTINCT(a.suim_rpt_no))AS type1_cnt
				,0 AS type5_cnt
				,0 AS type10_cnt	
			FROM top_rpt_head a, top_rpt_issue_send b
			WHERE a.suim_rpt_no = b.suim_rpt_no
			AND a.user_no = #{user_no}			
			AND a.issue_send_result = 0
			AND a.suim_rpt_state = 2
			AND a.close_date > UNIX_TIMESTAMP('2019-01-01')
			AND b.send_target = 1
			AND b.complete_flag = 1
		
			UNION ALL
		
			SELECT
				user_no
				,0 AS total_cnt
				,0 type1_cnt
				,COUNT(DISTINCT(a.suim_rpt_no))AS type5_cnt
				,0 AS type10_cnt	
			FROM top_rpt_head a, top_rpt_issue_send b
			WHERE a.suim_rpt_no = b.suim_rpt_no
			AND a.user_no = #{user_no}			
			AND a.issue_send_result = 0
			AND a.suim_rpt_state = 2
			AND a.close_date > UNIX_TIMESTAMP('2019-01-01')
			AND b.send_target = 5
			AND b.complete_flag = 1
		
			UNION ALL
		
			SELECT
				user_no
				,0 AS total_cnt
				,0 type1_cnt
				,0 AS type5_cnt
				,COUNT(DISTINCT(a.suim_rpt_no)) AS type10_cnt	
			FROM top_rpt_head a, top_rpt_issue_send b
			WHERE a.suim_rpt_no = b.suim_rpt_no
			AND a.user_no = #{user_no}			
			AND a.issue_send_result = 0
			AND a.suim_rpt_state = 2
			AND a.close_date > UNIX_TIMESTAMP('2019-01-01')
			AND b.send_target = 10
			AND b.complete_flag = 1
		)GA
	</select>	
	
</mapper>