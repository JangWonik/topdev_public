<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="MyEmpCertUdt">
	
	<select id="getMyInfo" resultType="kr.co.toplac.topteam.TopMbrBscVO" parameterType="String">
	
		SELECT
			a.user_no,
			a.user_name,
			a.home_address,
			a.team_id_loc,
			b.team_name,
			a.work_level work_level_cd,
			DATE_FORMAT(FROM_UNIXTIME(a.join_date), '%Y-%m-%d') join_date,
			getCodeValue('top_mbr_bsc','work_level',a.work_level) work_level
		FROM
			top_mbr_bsc a, top_tm_bsc b
		WHERE
			a.user_no = #{user_no} and
			a.team_id_loc = b.team_id
			
	</select>
	
	<update id = "udtMyCert" parameterType="kr.co.toplac.topteam.TopCertVO" >
	
		UPDATE
			top_emp_cert
		SET
			issue_state = #{issue_state}, state_chg_date = unix_timestamp(now())
		WHERE
			serial_no = #{serial_no}
	
	</update>
	
	<select id="certForUdt" resultType="kr.co.toplac.topteam.TopCertVO" parameterType="String">
	
		SELECT
			issue_reason,
			DATE_FORMAT(FROM_UNIXTIME(expiry_date), '%Y-%m-%d') expiry_date,
			serial_no,
			issue_state
		FROM
			top_emp_cert
		WHERE
			serial_no = #{serial_no}
	
	</select>
	
	
</mapper>