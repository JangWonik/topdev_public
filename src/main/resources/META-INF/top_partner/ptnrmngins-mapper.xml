<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="PtnrMngAddMapper">

	<select id="getLatestOrder" resultType="String" parameterType="String">
		SELECT max(ptnr_order)
		FROM top_ptnr_bsc
		WHERE 
			ptnr_group_order = #{gOrder}	
	</select>
	
	<select id="checkId" parameterType="String" resultType="String">		
		SELECT count(ptnr_id)
		FROM top_ptnr_bsc
		WHERE
			ptnr_id = #{ptnr_id}	
	</select>
	
	<select id="selectPtnrOrderMaxCount" resultType="Integer">
		SELECT
			MAX(statistics_order)+1 AS mCnt
		FROM top_ptnr_bsc
		WHERE 1=1
			AND ptnr_level = 1
			AND statistics_yn = 1 
			AND del_state != 1
	</select>
	
	<update id="updatePartnerOrder" parameterType="kr.co.toplac.topptnr.TopPtnrBscVO">
		UPDATE top_ptnr_bsc SET
			statistics_order = #{statistics_order}
		WHERE ptnr_id = #{ptnr_id}		
	</update>
	
	<insert id = "insPartner" parameterType="kr.co.toplac.topptnr.TopPtnrBscVO" useGeneratedKeys="true" keyProperty="ptnr_id">
	
		INSERT INTO top_ptnr_bsc
		
		(
			ptnr_type, 
			ptnr_level, 
			ptnr_group_order, 
			ptnr_order, 
			ptnr_nick,
			ptnr_name, 
			ptnr_biz_reg_no, 
			ptnr_ceo_nm, 
			ptnr_biz_type1,  
			ptnr_biz_type2, 
			ptnr_addr1,
			ptnr_addr,
			ptnr_postcode, 
			ptnr_tel, 
			ptnr_url, 
			ptnr_sms1, 
			ptnr_sms1_msg , 
			ptnr_sms2, 
			ptnr_sms2_msg , 
			ptnr_sms3, 
			ptnr_sms3_msg,
			issue_tax_invoice, 
			suitability_yn, 
			suitability_fee1, 
			suitability_fee2 , 
			top_accnt_id , 
			statistics_yn ,
			statistics_written_yn , 
			reg_date , 
			del_state ,
			statistics_order 
		)

		VALUES

		(
			
			#{ptnr_type},
			#{ptnr_level},
			#{ptnr_group_order},
			#{ptnr_order},
			#{ptnr_nick},
			#{ptnr_name},
			#{ptnr_biz_reg_no},
			#{ptnr_ceo_nm},
			#{ptnr_biz_type1}, 
			#{ptnr_biz_type2},
			#{ptnr_addr1},
			#{ptnr_addr},
			#{ptnr_postcode},
			#{ptnr_tel},
			#{ptnr_url},
			#{ptnr_sms1},
			#{ptnr_sms1_msg},
			#{ptnr_sms2},
			#{ptnr_sms2_msg},
			#{ptnr_sms3},
			#{ptnr_sms3_msg}, 
			#{issue_tax_invoice},
			#{suitability_yn},
			#{suitability_fee1},
			#{suitability_fee2},
			#{top_accnt_id},
			#{statistics_yn},
			#{statistics_written_yn}, 
			unix_timestamp(now()), 
			0,
			999 
		)
	
	</insert>




</mapper>
