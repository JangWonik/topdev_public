<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="LogIgMapper">

	<select id="gubunkind" parameterType="java.util.List" resultType="kr.co.toplac.lslog.LogIgVO">
		select distinct suim_rpt_type1 report_type from top_rpt_head
	</select>

	<select id="igskind1" parameterType="java.util.List" resultType="kr.co.toplac.lslog.LogIgVO">
		select ptnr_id ig_id, ptnr_nick ig_nick
		from top_ptnr_bsc 
		where ptnr_level='1'
		and statistics_yn='1' 
		order by ptnr_order desc, ptnr_id asc
	</select>

	<select id="logkind1" parameterType="java.util.HashMap" resultType="kr.co.toplac.lslog.LogIgVO">
		select ifnull(reg_m,0) reg_m, ifnull(reg_y,0) reg_y, ifnull(end_m,0) end_m, ifnull(end_y,0) end_y
			, ifnull(nend_p,0) nend_p
			, ifnull(round(endea_m,1),0) endea_m, ifnull(round(endea_y,1),0) endea_y
			, ifnull(price_assess,0) price_assess, ifnull(price_time,0) price_time, ifnull(price_assess+price_time,0) price_sum1
			, ifnull(price_traffic,0) price_traffic, ifnull(price_question,0) price_question, ifnull(price_receipt,0) price_receipt
			, ifnull(price_assess+price_time+price_traffic+price_question+price_receipt,0) price_sum2, ifnull(price_total,0) price_total
		from
			(select count(suim_rpt_no) reg_m
				from top_rpt_head
				where ptnr_id = #{tmpStr}
				and reg_date >= unix_timestamp(#{fromdate}) and reg_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) a
			,(select count(suim_rpt_no) reg_y
				from top_rpt_head
				where ptnr_id = #{tmpStr}
				and reg_date >= unix_timestamp(#{fromYear}) and reg_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) b
			,(select count(suim_rpt_no) end_m, sum(suim_rpt_ea) endea_m
				from top_rpt_head
				where ptnr_id = #{tmpStr}
				and close_date >= unix_timestamp(#{fromdate}) and close_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) c
			,(select count(suim_rpt_no) end_y, sum(suim_rpt_ea) endea_y
				from top_rpt_head
				where ptnr_id = #{tmpStr}
				and close_date >= unix_timestamp(#{fromYear}) and close_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) d
			,(select count(suim_rpt_no) nend_p
				from top_rpt_head
				where ptnr_id = #{tmpStr}
				and suim_rpt_state!='2' and suim_rpt_state!='3' and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) e
			,(select count(suim_rpt_no) nend_30
				from top_rpt_head
				where ptnr_id = #{tmpStr}
				and suim_rpt_state!='2' and suim_rpt_state!='3' and reg_date &lt; unix_timestamp(DATE_SUB(SYSDATE(), INTERVAL 45 DAY)) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			)f
			,(select sum(g2.amt_basic) price_assess, sum(g2.amt_daily) price_time, sum(g2.amt_traffic) price_traffic
				, sum(g2.amt_counsel) price_question, sum(g2.amt_etc) price_receipt
				from top_rpt_head g1, top_rpt_invoice g2
				where g1.ptnr_id = #{tmpStr}
				and g1.close_date >= unix_timestamp(#{fromdate}) and g1.close_date &lt; unix_timestamp(#{todate}) and g1.suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
				and g1.suim_rpt_no = g2.suim_rpt_no
			) g
			,(select sum(g2.amt_total) price_total
				from top_rpt_head g1, top_rpt_invoice g2
				where g1.ptnr_id = #{tmpStr} and g1.close_date &gt; 0
				and g1.suim_rpt_no = g2.suim_rpt_no and g2.deposit_date  &lt; 1
			) h
	</select>
	
	<select id="igskind4" parameterType="java.util.List" resultType="kr.co.toplac.lslog.LogIgVO">
		select ptnr_id ig_id, ptnr_nick ig_nick
		from top_ptnr_bsc 
		where ptnr_level='1'
		and statistics_yn='1' 
		order by ptnr_order desc, ptnr_id asc
	</select>

	<select id="logkind4" parameterType="java.util.HashMap" resultType="kr.co.toplac.lslog.LogIgVO">
		select ifnull(reg_m,0) reg_m, ifnull(reg_y,0) reg_y, ifnull(end_m,0) end_m, ifnull(end_y,0) end_y
			, ifnull(nend_p,0) nend_p
			, ifnull(round(endea_m,1),0) endea_m, ifnull(round(endea_y,1),0) endea_y
			, ifnull(price_assess,0) price_assess, ifnull(price_time,0) price_time, ifnull(price_assess+price_time,0) price_sum1
			, ifnull(price_traffic,0) price_traffic, ifnull(price_question,0) price_question, ifnull(price_receipt,0) price_receipt
			, ifnull(price_assess+price_time+price_traffic+price_question+price_receipt,0) price_sum2, ifnull(price_total,0) price_total
		from
			(select count(suim_rpt_no) reg_m
				from top_rpt_head
				where ptnr_id = #{tmpStr2}
				and reg_date >= unix_timestamp(#{fromdate}) and reg_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (3,4)
			) a
			,(select count(suim_rpt_no) reg_y
				from top_rpt_head
				where ptnr_id = #{tmpStr2}
				and reg_date >= unix_timestamp(#{fromYear}) and reg_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (3,4)
			) b
			,(select count(suim_rpt_no) end_m, sum(suim_rpt_ea) endea_m
				from top_rpt_head
				where ptnr_id = #{tmpStr2}
				and close_date >= unix_timestamp(#{fromdate}) and close_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (3,4)
			) c
			,(select count(suim_rpt_no) end_y, sum(suim_rpt_ea) endea_y
				from top_rpt_head
				where ptnr_id = #{tmpStr2}
				and close_date >= unix_timestamp(#{fromYear}) and close_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (3,4)
			) d
			,(select count(suim_rpt_no) nend_p
				from top_rpt_head
				where ptnr_id = #{tmpStr2}
				and suim_rpt_state!='2' and suim_rpt_state!='3' and suim_rpt_type1 in (3,4)
			) e
			,(select count(suim_rpt_no) nend_30
				from top_rpt_head
				where ptnr_id = #{tmpStr2}
				and suim_rpt_state!='2' and suim_rpt_state!='3' and reg_date &lt; unix_timestamp(DATE_SUB(SYSDATE(), INTERVAL 45 DAY)) and suim_rpt_type1 in (3,4)
			)f
			,(select sum(g2.amt_basic) price_assess, sum(g2.amt_daily) price_time, sum(g2.amt_traffic) price_traffic
				, sum(g2.amt_counsel) price_question, sum(g2.amt_etc) price_receipt
				from top_rpt_head g1, top_rpt_invoice g2
				where g1.ptnr_id = #{tmpStr2}
				and g1.close_date >= unix_timestamp(#{fromdate}) and g1.close_date &lt; unix_timestamp(#{todate}) and g1.suim_rpt_type1 in (3,4)
				and g1.suim_rpt_no = g2.suim_rpt_no
			) g
			,(select sum(g2.amt_total) price_total
				from top_rpt_head g1, top_rpt_invoice g2
				where g1.ptnr_id = #{tmpStr2} and g1.close_date &gt; 0
				and g1.suim_rpt_no = g2.suim_rpt_no and g2.deposit_date  &lt; 1
			) h
	</select>

</mapper>
