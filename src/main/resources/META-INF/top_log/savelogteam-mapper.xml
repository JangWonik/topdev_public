<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="SaveLogTeamMapper">

	<select id="sel_TIkind1" parameterType="java.util.List" resultType="kr.co.toplac.lslog.SaveLogTeamVO">
		select team_id_1 from save_log_team where no = #{no}
	</select>
	
	<select id="sel_Tkind1" parameterType="java.util.HashMap" resultType="kr.co.toplac.lslog.SaveLogTeamVO">
		select team_name from top_tm_bsc where team_id = #{tmpTI}
	</select>

	<select id="S_LogT_kind1" parameterType="java.util.HashMap" resultType="kr.co.toplac.lslog.SaveLogTeamVO">
		select ifnull(reg_m,0) reg_m, ifnull(reg_y,0) reg_y, ifnull(end_m,0) end_m, ifnull(end_y,0) end_y
		, ifnull(round((end_m/reg_m)*100,1),0) proc_m, ifnull(round((end_y/reg_y)*100,1),0) proc_y
		, ifnull(nend_p,0) nend_p, ifnull(round((nend_30/nend_p)*100),0) nend_30r
		, ifnull(round(endea_m,1),0) endea_m, ifnull(round(endea_y,1),0) endea_y
		, ifnull(price_assess,0) price_assess, ifnull(price_time,0) price_time, ifnull(price_assess+price_time,0) price_sum1
		, ifnull(price_traffic,0) price_traffic, ifnull(price_question,0) price_question, ifnull(price_receipt,0) price_receipt
		, ifnull(price_assess+price_time+price_traffic+price_question+price_receipt,0) price_sum2, ifnull(price_total,0) price_total
		from
			(select count(suim_rpt_no) reg_m
			from top_rpt_head rpt
			where team_id = #{tmpStr}
			and reg_date >= unix_timestamp(#{fromdate}) and reg_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) a
			,(select count(suim_rpt_no) reg_y
			from top_rpt_head rpt
			where team_id = #{tmpStr}
			and reg_date >= unix_timestamp(#{fromYear}) and reg_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) b
			,(select count(suim_rpt_no) end_m, sum(report_ea) endea_m
			from top_rpt_head rpt
			where team_id = #{tmpStr}
			and rpt.close_date >= unix_timestamp(#{fromdate}) and rpt.close_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) c
			,(select count(suim_rpt_no) end_y, sum(report_ea) endea_y
			from top_rpt_head rpt
			where team_id = #{tmpStr}
			and rpt.close_date >= unix_timestamp(#{fromYear}) and rpt.close_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) d
			,(select count(suim_rpt_no) nend_p
			from top_rpt_head rpt
			where team_id = #{tmpStr}
			and rpt.suim_rpt_state!='2' and rpt.suim_rpt_state!='3' and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			) e
			,(select count(suim_rpt_no) nend_30
			from top_rpt_head rpt
			where team_id = #{tmpStr}
			and rpt.suim_rpt_state!='2' and rpt.suim_rpt_state!='3' and reg_date &lt; unix_timestamp(DATE_SUB(SYSDATE(), INTERVAL 45 DAY)) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			)f
			,(select sum(amt_basic) price_assess, sum(amt_daily) price_time, sum(amt_traffic) price_traffic, sum(amt_counsel) price_question
			, sum(amt_etc) price_receipt
			from top_rpt_head rpt, top_rpt_invoice inv
			where team_id = #{tmpStr}
			and rpt.close_date >= unix_timestamp(#{fromdate}) and rpt.close_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
			and rpt.suim_rpt_no = inv.suim_rpt_no
			) g
			,(select sum(price_total) price_total
			from top_rpt_head rpt, top_rpt_invoice inv
			where team_id = #{tmpStr}
			and rpt.close_date &gt; 0
			and rpt.suim_rpt_no = inv.suim_rpt_no
			and inv.deposit_date &lt; 1
			) h
	</select>
	
	<select id="teamskind4" parameterType="java.util.List" resultType="kr.co.toplac.lslog.LogTeamVO">
		select team_name, team_id 
		from top_tm_bsc 
		where team_statistics4='0'
		and team_type='4'
		order by team_order desc, team_id asc
	</select>

	<select id="logkind4" parameterType="java.lang.String" resultType="kr.co.toplac.lslog.LogTeamVO">
		select ifnull(reg_m,0) reg_m, ifnull(reg_y,0) reg_y, ifnull(end_m,0) end_m, ifnull(end_y,0) end_y
		, ifnull(round((end_m/reg_m)*100,1),0) proc_m, ifnull(round((end_y/reg_y)*100,1),0) proc_y
		, ifnull(nend_p,0) nend_p, ifnull(round((nend_30/nend_p)*100),0) nend_30r
		, ifnull(round(endea_m,1),0) endea_m, ifnull(round(endea_y,1),0) endea_y
		, ifnull(price_assess,0) price_assess, ifnull(price_time,0) price_time, ifnull(price_assess+price_time,0) price_sum1
		, ifnull(price_traffic,0) price_traffic, ifnull(price_question,0) price_question, ifnull(price_receipt,0) price_receipt
		, ifnull(price_assess+price_time+price_traffic+price_question+price_receipt,0) price_sum2, ifnull(price_total,0) price_total
		from
			(select count(suim_rpt_no) reg_m
			from top_rpt_head rpt
			where team_id = #{tmpStr2}
			and reg_date >= unix_timestamp(#{fromdate}) and reg_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (3,4)
			) a
			,(select count(suim_rpt_no) reg_y
			from top_rpt_head rpt
			where team_id = #{tmpStr2}
			and reg_date >= unix_timestamp(#{fromYear}) and reg_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (3,4)
			) b
			,(select count(suim_rpt_no) end_m, sum(report_ea) endea_m
			from top_rpt_head rpt
			where team_id = #{tmpStr2}
			and rpt.close_date >= unix_timestamp(#{fromdate}) and rpt.close_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (3,4)
			) c
			,(select count(suim_rpt_no) end_y, sum(report_ea) endea_y
			from top_rpt_head rpt
			where team_id = #{tmpStr2}
			and rpt.close_date >= unix_timestamp(#{fromYear}) and rpt.close_date &lt; unix_timestamp(#{toYear}) and suim_rpt_type1 in (3,4)
			) d
			,(select count(suim_rpt_no) nend_p
			from top_rpt_head rpt
			where team_id = #{tmpStr2}
			and rpt.suim_rpt_state!='2' and rpt.suim_rpt_state!='3' and (report_type='4')
			) e
			,(select count(suim_rpt_no) nend_30
			from top_rpt_head rpt
			where team_id = #{tmpStr2}
			and rpt.suim_rpt_state!='2' and rpt.suim_rpt_state!='3' and reg_date &lt; unix_timestamp(DATE_SUB(SYSDATE(), INTERVAL 45 DAY)) and suim_rpt_type1 in (3,4)
			)f
			,(select sum(amt_basic) price_assess, sum(amt_daily) price_time, sum(amt_traffic) price_traffic, sum(amt_counsel) price_question
			, sum(amt_etc) price_receipt
			from top_rpt_head rpt, top_rpt_invoice inv
			where team_id = #{tmpStr2}
			and rpt.close_date >= unix_timestamp(#{fromdate}) and rpt.close_date &lt; unix_timestamp(#{todate}) and suim_rpt_type1 in (3,4)
			and rpt.suim_rpt_no = inv.suim_rpt_no
			) g
			,(select sum(price_total) price_total
			from top_rpt_head rpt, top_rpt_invoice inv
			where team_id = #{tmpStr2}
			and rpt.close_date &gt; 0
			and rpt.suim_rpt_no = inv.suim_rpt_no
			and inv.deposit_date &lt; 1
			) h
	</select>

</mapper>
