<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MisRegTmMapper">

	<!-- 팀별 현장보고서 제출 현황 -->	
	<select id="selectEndIntervalTeamList" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id
			,tb.team_name AS team_name
			,getTopTmBscCenterName(GB.team_id) AS center_name	
			,tb.team_center AS team_center
			,tb.team_sector AS team_sector
			,(GB.total_period_date + GB.trans_total_period_date) AS all_total_period_date
			,(GB.end_total_cnt + GB.trans_end_tocal_cnt) AS all_end_total_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM(
		
			SELECT 
					GA.team_id AS team_id
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(				
					
					SELECT
						th.team_id						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id	
		WHERE 1=1
			AND tb.team_written = 0
			AND tb.team_type != 4
		<if test='team_id !=null and team_id !=""'>
			AND tb.team_id = #{team_id}
		</if>
		ORDER BY tb.team_group_order DESC, tb.team_order DESC
	</select>
	
	<!-- 팀별 현장보고서 제출 현황, 평균처리일 내 현장보고서 조건추가 -->	
	<select id="selectSiteReportTeamListAll" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id
			,tb.team_name AS team_name	
			,tb.team_center AS team_center
			,tb.team_sector AS team_sector			
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt	
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))					
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))					
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id	
		WHERE 1=1
			AND tb.team_written = 0
			AND tb.team_type != 4
		<if test='team_id !=null and team_id !=""'>
			AND tb.team_id = #{team_id}
		</if>		
	</select>		

	<!-- 팀별 현장보고서 제출 현황 -->	
	<select id="selectSiteReportTeamListAll_20210429" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id
			,tb.team_name AS team_name	
			,tb.team_center AS team_center
			,tb.team_sector AS team_sector			
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt	
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))					
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))					
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id	
		WHERE 1=1
			AND tb.team_written = 0
		<if test='team_id !=null and team_id !=""'>
			AND tb.team_id = #{team_id}
		</if>
	</select>

	<!-- 팀별 현장보고서 제출 현황 -->	
	<select id="selectSiteReportTeamListAll_close" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id
			,tb.team_name AS team_name	
			,tb.team_center AS team_center
			,tb.team_sector AS team_sector			
			,(GB.suim_cnt + GB.trans_suim_cnt) AS suim_cnt
			,(GB.sub_3_in_cnt + GB.trans_sub_3_in_cnt) AS sub_3_in_cnt
			,(GB.sub_3_over_cnt + GB.trans_sub_3_over_cnt) AS sub_3_over_cnt
			,(GB.not_3_in_cnt + GB.trans_not_3_in_cnt) AS not_3_in_cnt
			,(GB.not_3_over_cnt + GB.trans_not_3_over_cnt) AS not_3_over_cnt
			,(GB.not_30_over_cnt + GB.trans_not_30_over_cnt) AS not_30_over_cnt
			,IFNULL(ROUND(((GB.total_period_date + GB.trans_total_period_date) / (GB.end_total_cnt + GB.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id		
						,0 AS suim_cnt	
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))					
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))					
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id	
		WHERE 1=1
		<if test='team_id !=null and team_id !=""'>
			AND tb.team_id = #{team_id}
		</if>
	</select>	

	<!-- 팀별 현장보고서 제출 현황 -->	
	<select id="selectSiteReportTeamListAll_20210419" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.team_id AS team_id
			,tb.team_name AS team_name	
			,tb.team_center AS team_center
			,tb.team_sector AS team_sector			
			,GB.suim_cnt AS suim_cnt
			,GB.sub_3_in_cnt AS sub_3_in_cnt
			,GB.sub_3_over_cnt AS sub_3_over_cnt
			,GB.not_3_in_cnt AS not_3_in_cnt
			,GB.not_3_over_cnt AS not_3_over_cnt
			,GB.not_30_over_cnt AS not_30_over_cnt
		FROM(
				SELECT 
					GA.team_id AS team_id	
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
				FROM
				(
					SELECT
						th.team_id		
						,COUNT(*) AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
			
					UNION ALL
			
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,COUNT(*) AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
					UNION ALL
					
					SELECT
						th.team_id
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.team_id
					
				) GA 
				GROUP BY GA.team_id
			)GB LEFT JOIN top_tm_bsc tb
		ON GB.team_id = tb.team_id	
		WHERE 1=1
		<if test='team_id !=null and team_id !=""'>
			AND tb.team_id = #{team_id}
		</if>
	</select>
	
	<!-- 개인별 평균처리일 목록 -->
	<select id="selectEndIntervalMemberList" parameterType="hashmap" resultType="hashmap">
		SELECT
			GC.user_no
			,GC.user_name
			,GC.user_state
			,GC.team_id_main
			,getTopTmBscCenterName(GC.team_id_main) center_name
			,TB.team_name
			,TB.team_group_order
			,TB.team_order
			,GC.work_level
			,GC.new_work_order
			,GC.join_date			
			,(GC.total_period_date + GC.trans_total_period_date) AS all_total_period_date
			,(GC.end_total_cnt + GC.trans_end_tocal_cnt) AS all_end_total_cnt
			,IFNULL(ROUND(((GC.total_period_date + GC.trans_total_period_date) / (GC.end_total_cnt + GC.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(
			SELECT
				GB.user_no
				,TM.user_state
				,TM.user_name				
				,TM.team_id_main
				,TM.work_level
				,CASE TM.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15	
				END AS new_work_order
				,TM.join_date				
				
				,GB.end_total_cnt
				,GB.trans_end_tocal_cnt
				,GB.total_period_date
				,GB.trans_total_period_date	
			FROM(	
				SELECT 
					GA.user_no AS user_no
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(					
					
					SELECT
						th.user_no
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no						
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no						
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no						
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB LEFT JOIN top_mbr_bsc TM
			ON GB.user_no = TM.user_no
		)GC LEFT JOIN top_tm_bsc TB
		ON GC.team_id_main = TB.team_id		
		WHERE GC.user_no != 0
		AND GC.user_name IS NOT NULL
		AND GC.user_no NOT IN ( 12, 1466 )
		<!-- AND TB.team_type != 4 -->
		AND TB.team_type IN (0,1)
		<if test='user_state !=null and user_state !=""'>		
			AND GC.user_state != #{user_no}
		</if>
		<if test='user_no !=null and user_no !=""'>		
			AND GC.user_no = #{user_no}
		</if>
		ORDER BY TB.team_group_order DESC, TB.team_order DESC, GC.new_work_order, GC.work_level DESC, GC.join_date	
	</select>	

	<!-- 개인별 현장보고서 제출현황, 평균처리일 내 현장보고서조건 추가  -->
	<select id="selectSiteReportMemberList" parameterType="hashmap" resultType="hashmap">
		SELECT
			GC.user_no
			,GC.user_name
			,GC.user_state
			,GC.team_id_main
			,getTopTmBscCenterName(GC.team_id_main) center_name
			,TB.team_name
			,TB.team_group_order
			,TB.team_order
			,GC.work_level
			,GC.new_work_order
			,GC.join_date
			,( GC.suim_cnt + GC.trans_suim_cnt ) AS suim_cnt
			,( GC.sub_3_in_cnt + GC.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GC.sub_3_over_cnt + GC.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GC.not_3_in_cnt + GC.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GC.not_3_over_cnt + GC.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GC.not_30_over_cnt + GC.trans_not_30_over_cnt ) AS not_30_over_cnt
			,IFNULL(ROUND((((GC.sub_3_over_cnt + GC.not_3_over_cnt)*100)/GC.suim_cnt),0),0) AS over_per			
			,IFNULL(ROUND(((GC.total_period_date + GC.trans_total_period_date) / (GC.end_total_cnt + GC.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(
			SELECT
				GB.user_no
				,TM.user_state
				,TM.user_name				
				,TM.team_id_main
				,TM.work_level
				,CASE TM.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15	
				END AS new_work_order
				,TM.join_date
				,GB.suim_cnt
				,GB.trans_suim_cnt
				,GB.sub_3_in_cnt
				,GB.trans_sub_3_in_cnt
				,GB.sub_3_over_cnt
				,GB.trans_sub_3_over_cnt
				,GB.not_3_in_cnt
				,GB.trans_not_3_in_cnt
				,GB.not_3_over_cnt
				,GB.trans_not_3_over_cnt
				,GB.not_30_over_cnt
				,GB.trans_not_30_over_cnt
				
				,GB.end_total_cnt
				,GB.trans_end_tocal_cnt
				,GB.total_period_date
				,GB.trans_total_period_date	
			FROM(	
				SELECT 
					GA.user_no AS user_no		
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt	
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
	
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					AND th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB LEFT JOIN top_mbr_bsc TM
			ON GB.user_no = TM.user_no
		)GC LEFT JOIN top_tm_bsc TB
		ON GC.team_id_main = TB.team_id
		WHERE GC.user_no != 0
		AND GC.user_name IS NOT NULL
		<if test='user_state !=null and user_state !=""'>		
			AND GC.user_state != #{user_no}
		</if>
		<if test='user_no !=null and user_no !=""'>		
			AND GC.user_no = #{user_no}
		</if>
		AND GC.user_no NOT IN ( 12, 1466 )
		AND TB.team_type != 4
		ORDER BY TB.team_group_order DESC, TB.team_order DESC, GC.new_work_order, GC.work_level DESC, GC.join_date	
	</select>
	
	<!-- 개인별 현장보고서 제출현황 -->
	<select id="selectSiteReportMemberList_20210429" parameterType="hashmap" resultType="hashmap">
		SELECT
			GC.user_no
			,GC.user_name
			,GC.user_state
			,GC.team_id_main
			,getTopTmBscCenterName(GC.team_id_main) center_name
			,TB.team_name
			,TB.team_group_order
			,TB.team_order
			,GC.work_level
			,GC.new_work_order
			,GC.join_date
			,( GC.suim_cnt + GC.trans_suim_cnt ) AS suim_cnt
			,( GC.sub_3_in_cnt + GC.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GC.sub_3_over_cnt + GC.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GC.not_3_in_cnt + GC.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GC.not_3_over_cnt + GC.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GC.not_30_over_cnt + GC.trans_not_30_over_cnt ) AS not_30_over_cnt
			,IFNULL(ROUND((((GC.sub_3_over_cnt + GC.not_3_over_cnt)*100)/GC.suim_cnt),0),0) AS over_per			
			,IFNULL(ROUND(((GC.total_period_date + GC.trans_total_period_date) / (GC.end_total_cnt + GC.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(
			SELECT
				GB.user_no
				,TM.user_state
				,TM.user_name				
				,TM.team_id_main
				,TM.work_level
				,CASE TM.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15	
				END AS new_work_order
				,TM.join_date
				,GB.suim_cnt
				,GB.trans_suim_cnt
				,GB.sub_3_in_cnt
				,GB.trans_sub_3_in_cnt
				,GB.sub_3_over_cnt
				,GB.trans_sub_3_over_cnt
				,GB.not_3_in_cnt
				,GB.trans_not_3_in_cnt
				,GB.not_3_over_cnt
				,GB.trans_not_3_over_cnt
				,GB.not_30_over_cnt
				,GB.trans_not_30_over_cnt
				
				,GB.end_total_cnt
				,GB.trans_end_tocal_cnt
				,GB.total_period_date
				,GB.trans_total_period_date	
			FROM(	
				SELECT 
					GA.user_no AS user_no		
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt	
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
	
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.close_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.close_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB LEFT JOIN top_mbr_bsc TM
			ON GB.user_no = TM.user_no
		)GC LEFT JOIN top_tm_bsc TB
		ON GC.team_id_main = TB.team_id
		WHERE GC.user_no != 0
		AND GC.user_name IS NOT NULL
		<if test='user_state !=null and user_state !=""'>		
			AND GC.user_state != #{user_no}
		</if>
		<if test='user_no !=null and user_no !=""'>		
			AND GC.user_no = #{user_no}
		</if>
		ORDER BY TB.team_group_order DESC, TB.team_order DESC, GC.new_work_order, GC.work_level DESC, GC.join_date	
	</select>	
	
	<!-- 개인별 현장보고서 제출현황 -->
	<select id="selectSiteReportMemberList_close" parameterType="hashmap" resultType="hashmap">
		SELECT
			GC.user_no
			,GC.user_name
			,GC.user_state
			,GC.team_id_main
			,getTopTmBscCenterName(GC.team_id_main) center_name
			,TB.team_name
			,TB.team_group_order
			,TB.team_order
			,GC.work_level
			,GC.new_work_order
			,GC.join_date
			,( GC.suim_cnt + GC.trans_suim_cnt ) AS suim_cnt
			,( GC.sub_3_in_cnt + GC.trans_sub_3_in_cnt ) AS sub_3_in_cnt
			,( GC.sub_3_over_cnt + GC.trans_sub_3_over_cnt ) AS sub_3_over_cnt
			,( GC.not_3_in_cnt + GC.trans_not_3_in_cnt ) AS not_3_in_cnt
			,( GC.not_3_over_cnt + GC.trans_not_3_over_cnt ) AS not_3_over_cnt
			,( GC.not_30_over_cnt + GC.trans_not_30_over_cnt ) AS not_30_over_cnt
			,IFNULL(ROUND((((GC.sub_3_over_cnt + GC.not_3_over_cnt)*100)/GC.suim_cnt),0),0) AS over_per			
			,IFNULL(ROUND(((GC.total_period_date + GC.trans_total_period_date) / (GC.end_total_cnt + GC.trans_end_tocal_cnt)),0),0) AS end_average_cnt
		FROM
		(
			SELECT
				GB.user_no
				,TM.user_state
				,TM.user_name				
				,TM.team_id_main
				,TM.work_level
				,CASE TM.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15	
				END AS new_work_order
				,TM.join_date
				,GB.suim_cnt
				,GB.trans_suim_cnt
				,GB.sub_3_in_cnt
				,GB.trans_sub_3_in_cnt
				,GB.sub_3_over_cnt
				,GB.trans_sub_3_over_cnt
				,GB.not_3_in_cnt
				,GB.trans_not_3_in_cnt
				,GB.not_3_over_cnt
				,GB.trans_not_3_over_cnt
				,GB.not_30_over_cnt
				,GB.trans_not_30_over_cnt
				
				,GB.end_total_cnt
				,GB.trans_end_tocal_cnt
				,GB.total_period_date
				,GB.trans_total_period_date	
			FROM(	
				SELECT 
					GA.user_no AS user_no		
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.trans_suim_cnt) AS trans_suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.trans_sub_3_in_cnt) AS trans_sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.trans_sub_3_over_cnt) AS trans_sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.trans_not_3_in_cnt) AS trans_not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.trans_not_3_over_cnt) AS trans_not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
					,SUM(GA.trans_not_30_over_cnt) AS trans_not_30_over_cnt
					
					,SUM(GA.end_total_cnt) AS end_total_cnt
					,SUM(GA.trans_end_tocal_cnt) AS trans_end_tocal_cnt
					,SUM(GA.total_period_date) AS total_period_date
					,SUM(GA.trans_total_period_date) AS trans_total_period_date
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no		
						,0 AS suim_cnt	
						,COUNT(*) AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
	
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,COUNT(*) AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,COUNT(*) AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.trans_date,th.site_rpt_aprv_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) &lt; 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.trans_date) >= 3
					AND th.trans_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,COUNT(*) AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.trans_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,COUNT(*) AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,COUNT(*) AS trans_end_tocal_cnt
						,0 AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,SUM( DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.reg_date) ) + 1 ) AS total_period_date
						,0 AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.reg_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.reg_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NULL
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS trans_suim_cnt
						,0 AS sub_3_in_cnt
						,0 AS trans_sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS trans_sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS trans_not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS trans_not_3_over_cnt
						,0 AS not_30_over_cnt
						,0 AS trans_not_30_over_cnt
						
						,0 AS end_total_cnt
						,0 AS trans_end_tocal_cnt
						,0 AS total_period_date
						,SUM(DATEDIFF( FROM_UNIXTIME(th.close_date), FROM_UNIXTIME(th.trans_date) ) + 1) AS trans_total_period_date
					FROM top_rpt_head th
					WHERE th.suim_rpt_state = 2
					AND th.trans_date >= UNIX_TIMESTAMP(#{start_date})
					AND th.trans_date &lt; UNIX_TIMESTAMP(#{end_date})
					AND th.trans_date IS NOT NULL
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB LEFT JOIN top_mbr_bsc TM
			ON GB.user_no = TM.user_no
		)GC LEFT JOIN top_tm_bsc TB
		ON GC.team_id_main = TB.team_id
		WHERE GC.user_no != 0
		AND GC.user_name IS NOT NULL
		<if test='user_state !=null and user_state !=""'>		
			AND GC.user_state != #{user_no}
		</if>
		<if test='user_no !=null and user_no !=""'>		
			AND GC.user_no = #{user_no}
		</if>
		ORDER BY TB.team_group_order DESC, TB.team_order DESC, GC.new_work_order, GC.work_level DESC, GC.join_date	
	</select>
	

	<!-- 개인별 현장보고서 제출현황 -->
	<select id="selectSiteReportMemberList_20210419" parameterType="hashmap" resultType="hashmap">
		SELECT
			GC.user_no
			,GC.user_name
			,GC.user_state
			,GC.team_id_main
			,getTopTmBscCenterName(GC.team_id_main) center_name
			,TB.team_name
			,TB.team_group_order
			,TB.team_order
			,GC.work_level
			,GC.new_work_order
			,GC.join_date
			,GC.suim_cnt
			,GC.sub_3_in_cnt
			,GC.sub_3_over_cnt
			,GC.not_3_in_cnt
			,GC.not_3_over_cnt
			,GC.not_30_over_cnt
			,IFNULL((((GC.sub_3_over_cnt + GC.not_3_over_cnt)*100)/GC.suim_cnt),0) AS over_per				
		FROM
		(
			SELECT
				GB.user_no
				,TM.user_state
				,TM.user_name				
				,TM.team_id_main
				,TM.work_level
				,CASE TM.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15	
				END AS new_work_order
				,TM.join_date
				,GB.suim_cnt
				,GB.sub_3_in_cnt
				,GB.sub_3_over_cnt
				,GB.not_3_in_cnt
				,GB.not_3_over_cnt
				,GB.not_30_over_cnt	
			FROM(	
				SELECT 
					GA.user_no AS user_no		
					,SUM(GA.suim_cnt) AS suim_cnt
					,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
					,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
					,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
					,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
					,SUM(GA.not_30_over_cnt) AS not_30_over_cnt
				FROM
				(
					SELECT
						th.user_no		
						,COUNT(*) AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1,2,11,12,13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.user_no
	
					UNION ALL
	
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,COUNT(*) AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,COUNT(*) AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state = 2
					AND getDateDiffDiv(th.reg_date,th.site_rpt_aprv_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,COUNT(*) AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) &lt; 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,COUNT(*) AS not_3_over_cnt
						,0 AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1,2)
					AND th.site_rpt_state IN (0,1)
					AND getDateDiff(th.reg_date) >= 3
					AND th.reg_date > UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.user_no
					
					UNION ALL
					
					SELECT
						th.user_no
						,0 AS suim_cnt	
						,0 AS sub_3_in_cnt
						,0 AS sub_3_over_cnt
						,0 AS not_3_in_cnt
						,0 AS not_3_over_cnt
						,COUNT(*) AS not_30_over_cnt
					FROM top_rpt_head th
					WHERE th.suim_rpt_type1 IN (1, 2, 11, 12, 13)
					AND th.pendncy_trget_at IN (1,4)
					AND th.suim_rpt_state IN (0,1)
					AND th.site_rpt_state IN (0,1)				
					AND th.reg_date &lt;= UNIX_TIMESTAMP(DATE_SUB(NOW(),INTERVAL 30 DAY))
					GROUP BY th.user_no
					
				) GA 
				GROUP BY GA.user_no
			)GB LEFT JOIN top_mbr_bsc TM
			ON GB.user_no = TM.user_no
		)GC LEFT JOIN top_tm_bsc TB
		ON GC.team_id_main = TB.team_id
		WHERE GC.user_no != 0
		AND GC.user_name IS NOT NULL
		<if test='user_state !=null and user_state !=""'>		
			AND GC.user_state != #{user_no}
		</if>
		<if test='user_no !=null and user_no !=""'>		
			AND GC.user_no = #{user_no}
		</if>
		ORDER BY TB.team_group_order DESC, TB.team_order DESC, GC.new_work_order, GC.work_level DESC, GC.join_date	
	</select>

	<!-- 수임건 내 취소건 제외-->
	<select id="getMisRegWrittenTm1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisRegTmVO">
		SELECT
			GA.team_id
			,SUM(GA.reg_12) reg_12, SUM(GA.reg_11) reg_11, SUM(GA.reg_10) reg_10, SUM(GA.reg_9) reg_9, SUM(GA.reg_8) reg_8, SUM(GA.reg_7) reg_7, SUM(GA.reg_6) reg_6, SUM(GA.reg_5) reg_5, SUM(GA.reg_4) reg_4, SUM(GA.reg_3) reg_3, SUM(GA.reg_2) reg_2, SUM(GA.reg_1) reg_1
			,SUM(GA.reg_wc_12) reg_wc_12, SUM(GA.reg_wc_11) reg_wc_11, SUM(GA.reg_wc_10) reg_wc_10, SUM(GA.reg_wc_9) reg_wc_9, SUM(GA.reg_wc_8) reg_wc_8, SUM(GA.reg_wc_7) reg_wc_7, SUM(GA.reg_wc_6) reg_wc_6, SUM(GA.reg_wc_5) reg_wc_5, SUM(GA.reg_wc_4) reg_wc_4, SUM(GA.reg_wc_3) reg_wc_3, SUM(GA.reg_wc_2) reg_wc_2, SUM(GA.reg_wc_1) reg_wc_1 
			,SUM(GA.cls_12) cls_12, SUM(GA.cls_11) cls_11, SUM(GA.cls_10) cls_10, SUM(GA.cls_9) cls_9, SUM(GA.cls_8) cls_8, SUM(GA.cls_7) cls_7, SUM(GA.cls_6) cls_6, SUM(GA.cls_5) cls_5, SUM(GA.cls_4) cls_4, SUM(GA.cls_3) cls_3, SUM(GA.cls_2) cls_2, SUM(GA.cls_1) cls_1 
			,SUM(GA.cls_wc_12) cls_wc_12, SUM(GA.cls_wc_11) cls_wc_11, SUM(GA.cls_wc_10) cls_wc_10, SUM(GA.cls_wc_9) cls_wc_9, SUM(GA.cls_wc_8) cls_wc_8, SUM(GA.cls_wc_7) cls_wc_7, SUM(GA.cls_wc_6) cls_wc_6, SUM(GA.cls_wc_5) cls_wc_5, SUM(GA.cls_wc_4) cls_wc_4, SUM(GA.cls_wc_3) cls_wc_3, SUM(GA.cls_wc_2) cls_wc_2, SUM(GA.cls_wc_1) cls_wc_1 
		FROM
			(
				SELECT
					#{team_id} as team_id
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM DUAL
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,IFNULL(SUM(suim_cnt),0) AS reg_12
					,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_12					
					,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,IFNULL(SUM(end_cnt),0) AS cls_12					
					,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,IFNULL(SUM(end_cnt),0) AS cls_wc_12
					,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore12}
				AND base_date &lt; #{monBefore11}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12
					,IFNULL(SUM(suim_cnt),0) AS reg_11
					,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_11					
					,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12
					,IFNULL(SUM(end_cnt),0) AS cls_11					
					,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12
					,IFNULL(SUM(end_cnt),0) AS cls_wc_11
					,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore11}
				AND base_date &lt; #{monBefore10}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11
					,IFNULL(SUM(suim_cnt),0) AS reg_10
					,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_10					
					,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11
					,IFNULL(SUM(end_cnt),0) AS cls_10					
					,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11
					,IFNULL(SUM(end_cnt),0) AS cls_wc_10
					,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore10}
				AND base_date &lt; #{monBefore9}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10
					,IFNULL(SUM(suim_cnt),0) AS reg_9
					,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_9					
					,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10
					,IFNULL(SUM(end_cnt),0) AS cls_9					
					,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10
					,IFNULL(SUM(end_cnt),0) AS cls_wc_9
					,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore9}
				AND base_date &lt; #{monBefore8}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9
					,IFNULL(SUM(suim_cnt),0) AS reg_8
					,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_8					
					,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9
					,IFNULL(SUM(end_cnt),0) AS cls_8					
					,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9
					,IFNULL(SUM(end_cnt),0) AS cls_wc_8
					,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore8}
				AND base_date &lt; #{monBefore7}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8
					,IFNULL(SUM(suim_cnt),0) AS reg_7
					,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_7					
					,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8
					,IFNULL(SUM(end_cnt),0) AS cls_7					
					,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8
					,IFNULL(SUM(end_cnt),0) AS cls_wc_7
					,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore7}
				AND base_date &lt; #{monBefore6}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7
					,IFNULL(SUM(suim_cnt),0) AS reg_6
					,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_6					
					,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7
					,IFNULL(SUM(end_cnt),0) AS cls_6					
					,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7
					,IFNULL(SUM(end_cnt),0) AS cls_wc_6
					,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore6}
				AND base_date &lt; #{monBefore5}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6
					,IFNULL(SUM(suim_cnt),0) AS reg_5
					,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_5					
					,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6
					,IFNULL(SUM(end_cnt),0) AS cls_5					
					,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6
					,IFNULL(SUM(end_cnt),0) AS cls_wc_5
					,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore5}
				AND base_date &lt; #{monBefore4}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5
					,IFNULL(SUM(suim_cnt),0) AS reg_4
					,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_4					
					,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5
					,IFNULL(SUM(end_cnt),0) AS cls_4					
					,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5
					,IFNULL(SUM(end_cnt),0) AS cls_wc_4
					,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore4}
				AND base_date &lt; #{monBefore3}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4
					,IFNULL(SUM(suim_cnt),0) AS reg_3
					,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_3					
					,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4
					,IFNULL(SUM(end_cnt),0) AS cls_3					
					,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4
					,IFNULL(SUM(end_cnt),0) AS cls_wc_3
					,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore3}
				AND base_date &lt; #{monBefore2}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3
					,IFNULL(SUM(suim_cnt),0) AS reg_2
					,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_2					
					,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3
					,IFNULL(SUM(end_cnt),0) AS cls_2					
					,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3
					,IFNULL(SUM(end_cnt),0) AS cls_wc_2
					,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore2}
				AND base_date &lt; #{monBefore1}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2
					,IFNULL(SUM(suim_cnt),0) AS reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2
					,IFNULL(SUM(suim_cnt),0) AS reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2
					,IFNULL(SUM(end_cnt),0) AS cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2
					,IFNULL(SUM(end_cnt),0) AS cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore1}
				AND base_date &lt; #{monBefore0}
			) GA
	</select>
	
	<select id="getMisRegWrittenTm1_20200518" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisRegTmVO">
		SELECT
			GA.team_id
			,SUM(GA.reg_12) reg_12, SUM(GA.reg_11) reg_11, SUM(GA.reg_10) reg_10, SUM(GA.reg_9) reg_9, SUM(GA.reg_8) reg_8, SUM(GA.reg_7) reg_7, SUM(GA.reg_6) reg_6, SUM(GA.reg_5) reg_5, SUM(GA.reg_4) reg_4, SUM(GA.reg_3) reg_3, SUM(GA.reg_2) reg_2, SUM(GA.reg_1) reg_1
			,SUM(GA.reg_wc_12) reg_wc_12, SUM(GA.reg_wc_11) reg_wc_11, SUM(GA.reg_wc_10) reg_wc_10, SUM(GA.reg_wc_9) reg_wc_9, SUM(GA.reg_wc_8) reg_wc_8, SUM(GA.reg_wc_7) reg_wc_7, SUM(GA.reg_wc_6) reg_wc_6, SUM(GA.reg_wc_5) reg_wc_5, SUM(GA.reg_wc_4) reg_wc_4, SUM(GA.reg_wc_3) reg_wc_3, SUM(GA.reg_wc_2) reg_wc_2, SUM(GA.reg_wc_1) reg_wc_1 
			,SUM(GA.cls_12) cls_12, SUM(GA.cls_11) cls_11, SUM(GA.cls_10) cls_10, SUM(GA.cls_9) cls_9, SUM(GA.cls_8) cls_8, SUM(GA.cls_7) cls_7, SUM(GA.cls_6) cls_6, SUM(GA.cls_5) cls_5, SUM(GA.cls_4) cls_4, SUM(GA.cls_3) cls_3, SUM(GA.cls_2) cls_2, SUM(GA.cls_1) cls_1 
			,SUM(GA.cls_wc_12) cls_wc_12, SUM(GA.cls_wc_11) cls_wc_11, SUM(GA.cls_wc_10) cls_wc_10, SUM(GA.cls_wc_9) cls_wc_9, SUM(GA.cls_wc_8) cls_wc_8, SUM(GA.cls_wc_7) cls_wc_7, SUM(GA.cls_wc_6) cls_wc_6, SUM(GA.cls_wc_5) cls_wc_5, SUM(GA.cls_wc_4) cls_wc_4, SUM(GA.cls_wc_3) cls_wc_3, SUM(GA.cls_wc_2) cls_wc_2, SUM(GA.cls_wc_1) cls_wc_1 
		FROM
			(
				SELECT
					#{team_id} as team_id
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM DUAL
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_12
					,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_12					
					,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,SUM(IFNULL(end_cnt,0)) AS cls_12					
					,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_12
					,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore12}
				AND base_date &lt; #{monBefore11}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_11
					,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_11					
					,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12
					,SUM(IFNULL(end_cnt,0)) AS cls_11					
					,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_11
					,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore11}
				AND base_date &lt; #{monBefore10}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_10
					,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_10					
					,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11
					,SUM(IFNULL(end_cnt,0)) AS cls_10					
					,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_10
					,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore10}
				AND base_date &lt; #{monBefore9}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_9
					,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_9					
					,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10
					,SUM(IFNULL(end_cnt,0)) AS cls_9					
					,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_9
					,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore9}
				AND base_date &lt; #{monBefore8}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_8
					,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_8					
					,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9
					,SUM(IFNULL(end_cnt,0)) AS cls_8					
					,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_8
					,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore8}
				AND base_date &lt; #{monBefore7}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_7
					,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_7					
					,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8
					,SUM(IFNULL(end_cnt,0)) AS cls_7					
					,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_7
					,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore7}
				AND base_date &lt; #{monBefore6}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_6
					,0 reg_5,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_6					
					,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7
					,SUM(IFNULL(end_cnt,0)) AS cls_6					
					,0 cls_5,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_6
					,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore6}
				AND base_date &lt; #{monBefore5}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_5
					,0 reg_4,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_5					
					,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6
					,SUM(IFNULL(end_cnt,0)) AS cls_5					
					,0 cls_4,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_5
					,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore5}
				AND base_date &lt; #{monBefore4}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_4
					,0 reg_3,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_4					
					,0 reg_wc_3,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5
					,SUM(IFNULL(end_cnt,0)) AS cls_4					
					,0 cls_3,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_4
					,0 cls_wc_3,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore4}
				AND base_date &lt; #{monBefore3}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_3
					,0 reg_2,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_3					
					,0 reg_wc_2,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4
					,SUM(IFNULL(end_cnt,0)) AS cls_3					
					,0 cls_2,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_3
					,0 cls_wc_2,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore3}
				AND base_date &lt; #{monBefore2}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_2
					,0 reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_2					
					,0 reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3
					,SUM(IFNULL(end_cnt,0)) AS cls_2					
					,0 cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_2
					,0 cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore2}
				AND base_date &lt; #{monBefore1}
				
				UNION ALL
				
				SELECT
					"" as team_id					
					,0 reg_12,0 reg_11,0 reg_10,0 reg_9,0 reg_8,0 reg_7,0 reg_6,0 reg_5,0 reg_4,0 reg_3,0 reg_2
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_1
					,0 reg_wc_12,0 reg_wc_11,0 reg_wc_10,0 reg_wc_9,0 reg_wc_8,0 reg_wc_7,0 reg_wc_6,0 reg_wc_5,0 reg_wc_4,0 reg_wc_3,0 reg_wc_2
					,( IFNULL(SUM(suim_cnt),0) - IFNULL(SUM(cancel_cnt),0) ) AS reg_wc_1
					,0 cls_12,0 cls_11,0 cls_10,0 cls_9,0 cls_8,0 cls_7,0 cls_6,0 cls_5,0 cls_4,0 cls_3,0 cls_2
					,SUM(IFNULL(end_cnt,0)) AS cls_1
					,0 cls_wc_12,0 cls_wc_11,0 cls_wc_10,0 cls_wc_9,0 cls_wc_8,0 cls_wc_7,0 cls_wc_6,0 cls_wc_5,0 cls_wc_4,0 cls_wc_3,0 cls_wc_2
					,SUM(IFNULL(end_cnt,0)) AS cls_wc_1
				FROM top_rpt_written_info 
				WHERE 1=1				
				AND team_id = #{team_id}
				AND base_date >= #{monBefore1}
				AND base_date &lt; #{monBefore0}
			) GA
	</select>
	
	<!-- 현장보고서 부문별 초과율 그래프 최근 30일 센터내 팀갯수 가져오기 -->
	<select id="selectSiteSector30OverChartCnt" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="integer">
		SELECT 
			COUNT(DISTINCT(TA.team_id)) AS cnt				
		FROM top_site_daily_team TA
		WHERE 1=1
		AND TA.regdate >= #{dayBefore30}
		AND TA.regdate &lt; #{dayBefore0}
		AND TA.team_sector = #{team_sector}
	</select>
	
	<!-- 현장보고서 전직원(인원)별 초과율 그래프 최근 30일 인원수 가져오기 -->
	<select id="selectSiteAll30OverChartCnt" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="integer">
		SELECT 
			COUNT(DISTINCT(TA.user_no)) AS cnt				
		FROM top_site_daily_member TA
		WHERE 1=1
		AND TA.regdate >= #{dayBefore30}
		AND TA.regdate &lt; #{dayBefore0}		
	</select>
	
	<!-- 현장보고서 센터별 초과율 그래프 최근 30일 센터내 팀갯수 가져오기 -->
	<select id="selectSiteCenter30OverChartCnt" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="integer">
		SELECT 
			COUNT(DISTINCT(TA.team_id)) AS cnt				
		FROM top_site_daily_team TA
		WHERE 1=1
		AND TA.regdate >= #{dayBefore30}
		AND TA.regdate &lt; #{dayBefore0}
		AND TA.team_center = #{team_center}
	</select>
	
	<!-- 현장보고서 부문별 초과율 그래프 최근 30일 정보 가져오기  -->
	<select id="selectSiteSector30OverChart" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT
			GA.team_id
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,( select col_val from sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector ) as sector_name
			,GA.team_name
			,GA.team_center
			,GA.team_sector	
			,GA.team_group_order
			,GA.team_order			
			,ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30			
		FROM(
		
			SELECT 
				TA.team_id
				,TA.team_name
				,TA.team_center
				,TA.team_sector
				,TB.team_group_order
				,TB.team_order				
				,CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_team TA			
			LEFT JOIN top_tm_bsc TB
			ON TA.team_id = TB.team_id
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA
		WHERE GA.team_sector = #{team_sector}		
	</select>
	
	<!-- 현장보고서 센터별 초과율 그래프 최근 30일 정보 가져오기  -->
	<select id="selectSiteCenter30OverChart" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT
			GA.team_id
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,( select col_val from sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector ) as sector_name
			,GA.team_name
			,GA.team_center
			,GA.team_sector	
			,GA.team_group_order
			,GA.team_order			
			,ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30			
		FROM(
		
			SELECT 
				TA.team_id
				,TA.team_name
				,TA.team_center
				,TA.team_sector
				,TB.team_group_order
				,TB.team_order				
				,CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_team TA			
			LEFT JOIN top_tm_bsc TB
			ON TA.team_id = TB.team_id
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA 
		<!-- GROUP BY GA.team_id -->
		WHERE GA.team_center = #{team_center}		
	</select>	
	
	<!-- 현장보고서 팀별 초과율 그래프 최근 30일 정보 가져오기  -->
	<select id="selectSiteTeam30OverChart" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT
			GA.team_id
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,( select col_val from sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector ) as sector_name
			,GA.team_name
			,GA.team_center
			,GA.team_sector	
			,GA.team_group_order
			,GA.team_order			
			,ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30			
		FROM(
		
			SELECT 
				TA.team_id
				,TA.team_name
				,TA.team_center
				,TA.team_sector
				,TB.team_group_order
				,TB.team_order				
				,CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_team TA
			LEFT JOIN top_tm_bsc TB
			ON TA.team_id = TB.team_id
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA 
		<!-- GROUP BY GA.team_id -->
		WHERE GA.team_id = #{team_id}
		ORDER BY GA.team_group_order DESC, GA.team_order DESC
	</select>
	
	<!-- 현장보고서 팀별 최근 30일 초과율 정보 가져오기  -->
	<select id="selectSiteTeam30Over" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT
			GA.team_id
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,GA.team_name
			,GA.team_center
			,GA.team_sector	
			,GA.team_group_order
			,GA.team_order			
			,ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30			
		FROM(
		
			SELECT 
				TA.team_id
				,TA.team_name
				,TA.team_center
				,TA.team_sector
				,TB.team_group_order
				,TB.team_order				
				,CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_team TA
			LEFT JOIN top_tm_bsc TB
			ON TA.team_id = TB.team_id
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA 
		GROUP BY GA.team_id
		ORDER BY GA.team_group_order DESC, GA.team_order DESC
	</select>
	
	<!-- 현장보고서 부문 통계 상세정보 갯수 확인 -->
	<select id="selectSectorDetailInfoCnt" parameterType="hashmap" resultType="integer">
		SELECT
			count(*) as Cnt
		FROM top_site_daily_team
		WHERE 1=1
		AND team_sector = #{team_sector}
		AND regdate = #{reg_date}
	</select>
	
	<!-- 현장보고서 센터 통계 상세정보 갯수 확인 -->
	<select id="selectCenterDetailInfoCnt" parameterType="hashmap" resultType="integer">
		SELECT
			count(*) as Cnt
		FROM top_site_daily_team
		WHERE 1=1
		AND team_center = #{team_center}
		AND regdate = #{reg_date}
	</select>
	
	<!-- 현장보고서 팀 통계 상세정보 갯수 확인 -->
	<select id="selectTeamDetailInfoCnt" parameterType="hashmap" resultType="integer">
		SELECT
			count(*) as Cnt
		FROM top_site_daily_team
		WHERE 1=1
		AND team_id = #{team_id}
		AND regdate = #{reg_date}
	</select>
	<!-- 현장보고서 개인 통계 상세정보 갯수확인 -->
	<select id="selectMemberDetailInfoCnt" parameterType="hashmap" resultType="integer">
		SELECT
			count(*) as Cnt
		FROM top_site_daily_member
		WHERE 1=1
		AND user_no = #{user_no}
		AND regdate = #{reg_date}
	</select>
	
	<!-- 현장보고서 부문 통계 없는 경우 기본정보만 제공 -->
	<select id="selectSectorDetailInfoSimple" parameterType="hashmap" resultType="hashmap">
		SELECT
			col_cd as team_sector
			,col_val as sector_name			
			,0 as suim_cnt
			,0 as sub_3_in_cnt
			,0 as sub_3_over_cnt
			,0 as not_3_in_cnt
			,0 as not_3_over_cnt
			,0 as not_30_over_cnt
			,0 as over_per
			,#{reg_date} as regdate
		FROM sysadm_codedic
		WHERE 1=1
		AND tbl_nm = 'top_tm_bsc'
		AND col_nm = 'team_sector'
		AND col_cd = #{team_sector}
	</select>
	
	<!-- 현장보고서 센터 통계 없는 경우 기본정보만 제공 -->
	<select id="selectCenterDetailInfoSimple" parameterType="hashmap" resultType="hashmap">
		SELECT
			col_cd as team_center
			,col_val as center_name			
			,0 as suim_cnt
			,0 as sub_3_in_cnt
			,0 as sub_3_over_cnt
			,0 as not_3_in_cnt
			,0 as not_3_over_cnt
			,0 as not_30_over_cnt
			,0 as over_per
			,#{reg_date} as regdate
		FROM sysadm_codedic
		WHERE 1=1
		AND tbl_nm = 'top_tm_bsc'
		AND col_nm = 'team_center'
		AND col_cd = #{team_center}
	</select>
	
	<!-- 현장보고서 팀 통계 없는 경우 기본정보만 제공 -->
	<select id="selectTeamDetailInfoSimple" parameterType="hashmap" resultType="hashmap">
		SELECT
			team_id
			,team_name
			,getTopTmbscCenterName(team_id) as center_name			
			,0 as suim_cnt
			,0 as sub_3_in_cnt
			,0 as sub_3_over_cnt
			,0 as not_3_in_cnt
			,0 as not_3_over_cnt
			,0 as not_30_over_cnt
			,0 as over_per
			,#{reg_date} as regdate
		FROM top_tm_bsc
		WHERE 1=1
		AND team_id = #{team_id}
	</select>
	
	<!-- 현장보고서 개인 통계 없는 경우 기본정보만 제공 -->
	<select id="selectMemberDetailInfoSimple" parameterType="hashmap" resultType="hashmap">
		SELECT
			user_no
			,user_name
			,getTopTmbscCenterName(team_id_main) as center_name
			,getTopTmbscTeamName(team_id_main) as team_name
			,0 as suim_cnt
			,0 as sub_3_in_cnt
			,0 as sub_3_over_cnt
			,0 as not_3_in_cnt
			,0 as not_3_over_cnt
			,0 as not_30_over_cnt
			,0 as over_per
			,#{reg_date} as regdate
		FROM top_mbr_bsc
		WHERE 1=1
		AND user_no = #{user_no}
	</select>
	
	<!-- 현장보고서 부문 통계 상세정보 보기 -->
	<select id="selectSectorDetailInfo" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.team_sector
			,( select col_val from sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector ) as sector_name
			,SUM(GA.suim_cnt) AS suim_cnt
			,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
			,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
			,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
			,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
			,SUM(GA.not_30_over_cnt) AS not_30_over_cnt	
			,ROUND( SUM(GA.over_per) / MAX(GA.rownum) ) AS over_per
			,GA.regdate
		FROM
		(
			SELECT
				team_sector				
				,suim_cnt
				,sub_3_in_cnt
				,sub_3_over_cnt
				,not_3_in_cnt
				,not_3_over_cnt
				,not_30_over_cnt
				,over_per
				,#{reg_date} AS regdate
				,@rownum:=@rownum+1 AS rownum	
			FROM top_site_daily_team,(SELECT @rownum :=0) tmp
			WHERE 1=1
			AND team_sector = #{team_sector}
			AND regdate = #{reg_date}
		)GA
	</select>
	
	<!-- 현장보고서 센터 통계 상세정보 보기 -->
	<select id="selectCenterDetailInfo" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.team_center
			,GA.center_name
			,SUM(GA.suim_cnt) AS suim_cnt
			,SUM(GA.sub_3_in_cnt) AS sub_3_in_cnt
			,SUM(GA.sub_3_over_cnt) AS sub_3_over_cnt
			,SUM(GA.not_3_in_cnt) AS not_3_in_cnt
			,SUM(GA.not_3_over_cnt) AS not_3_over_cnt
			,SUM(GA.not_30_over_cnt) AS not_30_over_cnt	
			,ROUND( SUM(GA.over_per) / MAX(GA.rownum) ) AS over_per
			,GA.regdate
		FROM
		(
			SELECT
				team_center
				,getTopTmbscCenterName(team_id) AS center_name
				,suim_cnt
				,sub_3_in_cnt
				,sub_3_over_cnt
				,not_3_in_cnt
				,not_3_over_cnt
				,not_30_over_cnt
				,over_per
				,#{reg_date} AS regdate
				,@rownum:=@rownum+1 AS rownum	
			FROM top_site_daily_team,(SELECT @rownum :=0) tmp
			WHERE 1=1
			AND team_center = #{team_center}
			AND regdate = #{reg_date}
		)GA
	</select>
	
	<!-- 현장보고서 팀 통계 상세정보 보기 -->
	<select id="selectTeamDetailInfo" parameterType="hashmap" resultType="hashmap">
		SELECT
			team_id
			,team_name
			,getTopTmbscCenterName(team_id) as center_name
			,suim_cnt
			,sub_3_in_cnt
			,sub_3_over_cnt
			,not_3_in_cnt
			,not_3_over_cnt
			,not_30_over_cnt
			,over_per
			,#{reg_date} as regdate
		FROM top_site_daily_team
		WHERE 1=1
		AND team_id = #{team_id}
		AND regdate = #{reg_date}
	</select>
	
	<!-- 현장보고서 개인 통계 상세정보 보기 -->
	<select id="selectMemberDetailInfo" parameterType="hashmap" resultType="hashmap">
		SELECT
			user_no
			,user_name
			,center_name
			,team_name
			,suim_cnt
			,sub_3_in_cnt
			,sub_3_over_cnt
			,not_3_in_cnt
			,not_3_over_cnt
			,not_30_over_cnt
			,over_per
			,#{reg_date} as regdate
		FROM top_site_daily_member
		WHERE 1=1
		AND user_no = #{user_no}
		AND regdate = #{reg_date}
	</select>
	
	
	
	<!-- 현장보고서 전체 차트표시용 최근 30일 초과율 정보 가져오기 //dayBefore0:오늘날짜 -->
	<select id="selectSiteAll30OverChart" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT								
			ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30						
		FROM(		
			SELECT 
				CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_member TA
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA 	
	</select>	
	
	<!-- 현장보고서 개인별 차트표시용 최근 30일 초과율 정보 가져오기 //dayBefore0:오늘날짜 -->
	<select id="selectSiteMember30OverChart" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT
			GA.user_no
			,GA.user_name
			,GA.team_id
			,GA.team_name	
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,( select col_val from sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = TM.team_sector ) as sector_name					
			,ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30
			,TM.team_center
			,TM.team_sector			
		FROM(
		
			SELECT 
				TA.user_no
				,TA.user_name
				,TA.team_id
				,TA.team_name
				,TA.team_group_order
				,TA.team_order
				,TA.new_work_order
				,TA.work_level
				,TA.join_date				
				,CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_member TA
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA LEFT JOIN top_tm_bsc TM
		ON GA.team_id = TM.team_id		
		WHERE 1=1
		AND GA.user_no = #{user_no}
		ORDER BY GA.team_group_order DESC, GA.team_order DESC, GA.new_work_order, GA.work_level DESC, GA.join_date
	
	</select>
	
	
	<!-- 현장보고서 개인별 최근 30일 초과율 정보 가져오기 //dayBefore0:오늘날짜 -->
	<select id="selectSiteMember30Over" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="hashmap">
		SELECT
			GA.user_no
			,GA.user_name
			,GA.team_id
			,GA.team_name			
			,ROUND(SUM(GA.over_per_1)) AS over_per_1
			,ROUND(SUM(GA.over_per_2)) AS over_per_2
			,ROUND(SUM(GA.over_per_3)) AS over_per_3
			,ROUND(SUM(GA.over_per_4)) AS over_per_4
			,ROUND(SUM(GA.over_per_5)) AS over_per_5
			,ROUND(SUM(GA.over_per_6)) AS over_per_6
			,ROUND(SUM(GA.over_per_7)) AS over_per_7
			,ROUND(SUM(GA.over_per_8)) AS over_per_8
			,ROUND(SUM(GA.over_per_9)) AS over_per_9
			,ROUND(SUM(GA.over_per_10)) AS over_per_10
			,ROUND(SUM(GA.over_per_11)) AS over_per_11
			,ROUND(SUM(GA.over_per_12)) AS over_per_12
			,ROUND(SUM(GA.over_per_13)) AS over_per_13
			,ROUND(SUM(GA.over_per_14)) AS over_per_14
			,ROUND(SUM(GA.over_per_15)) AS over_per_15
			,ROUND(SUM(GA.over_per_16)) AS over_per_16
			,ROUND(SUM(GA.over_per_17)) AS over_per_17
			,ROUND(SUM(GA.over_per_18)) AS over_per_18
			,ROUND(SUM(GA.over_per_19)) AS over_per_19
			,ROUND(SUM(GA.over_per_20)) AS over_per_20
			,ROUND(SUM(GA.over_per_21)) AS over_per_21
			,ROUND(SUM(GA.over_per_22)) AS over_per_22
			,ROUND(SUM(GA.over_per_23)) AS over_per_23
			,ROUND(SUM(GA.over_per_24)) AS over_per_24
			,ROUND(SUM(GA.over_per_25)) AS over_per_25
			,ROUND(SUM(GA.over_per_26)) AS over_per_26
			,ROUND(SUM(GA.over_per_27)) AS over_per_27
			,ROUND(SUM(GA.over_per_28)) AS over_per_28
			,ROUND(SUM(GA.over_per_29)) AS over_per_29
			,ROUND(SUM(GA.over_per_30)) AS over_per_30			
		FROM(
		
			SELECT 
				TA.user_no
				,TA.user_name
				,TA.team_id
				,TA.team_name
				,TA.team_group_order
				,TA.team_order
				,TA.new_work_order
				,TA.work_level
				,TA.join_date				
				,CASE WHEN TA.regdate = #{dayBefore1} THEN TA.over_per ELSE 0 END AS over_per_1
				,CASE WHEN TA.regdate = #{dayBefore2} THEN TA.over_per ELSE 0 END AS over_per_2
				,CASE WHEN TA.regdate = #{dayBefore3} THEN TA.over_per ELSE 0 END AS over_per_3
				,CASE WHEN TA.regdate = #{dayBefore4} THEN TA.over_per ELSE 0 END AS over_per_4
				,CASE WHEN TA.regdate = #{dayBefore5} THEN TA.over_per ELSE 0 END AS over_per_5
				,CASE WHEN TA.regdate = #{dayBefore6} THEN TA.over_per ELSE 0 END AS over_per_6
				,CASE WHEN TA.regdate = #{dayBefore7} THEN TA.over_per ELSE 0 END AS over_per_7
				,CASE WHEN TA.regdate = #{dayBefore8} THEN TA.over_per ELSE 0 END AS over_per_8
				,CASE WHEN TA.regdate = #{dayBefore9} THEN TA.over_per ELSE 0 END AS over_per_9
				,CASE WHEN TA.regdate = #{dayBefore10} THEN TA.over_per ELSE 0 END AS over_per_10
				
				,CASE WHEN TA.regdate = #{dayBefore11} THEN TA.over_per ELSE 0 END AS over_per_11
				,CASE WHEN TA.regdate = #{dayBefore12} THEN TA.over_per ELSE 0 END AS over_per_12
				,CASE WHEN TA.regdate = #{dayBefore13} THEN TA.over_per ELSE 0 END AS over_per_13
				,CASE WHEN TA.regdate = #{dayBefore14} THEN TA.over_per ELSE 0 END AS over_per_14
				,CASE WHEN TA.regdate = #{dayBefore15} THEN TA.over_per ELSE 0 END AS over_per_15
				,CASE WHEN TA.regdate = #{dayBefore16} THEN TA.over_per ELSE 0 END AS over_per_16
				,CASE WHEN TA.regdate = #{dayBefore17} THEN TA.over_per ELSE 0 END AS over_per_17
				,CASE WHEN TA.regdate = #{dayBefore18} THEN TA.over_per ELSE 0 END AS over_per_18
				,CASE WHEN TA.regdate = #{dayBefore19} THEN TA.over_per ELSE 0 END AS over_per_19
				,CASE WHEN TA.regdate = #{dayBefore20} THEN TA.over_per ELSE 0 END AS over_per_20
				
				,CASE WHEN TA.regdate = #{dayBefore21} THEN TA.over_per ELSE 0 END AS over_per_21
				,CASE WHEN TA.regdate = #{dayBefore22} THEN TA.over_per ELSE 0 END AS over_per_22
				,CASE WHEN TA.regdate = #{dayBefore23} THEN TA.over_per ELSE 0 END AS over_per_23
				,CASE WHEN TA.regdate = #{dayBefore24} THEN TA.over_per ELSE 0 END AS over_per_24
				,CASE WHEN TA.regdate = #{dayBefore25} THEN TA.over_per ELSE 0 END AS over_per_25
				,CASE WHEN TA.regdate = #{dayBefore26} THEN TA.over_per ELSE 0 END AS over_per_26
				,CASE WHEN TA.regdate = #{dayBefore27} THEN TA.over_per ELSE 0 END AS over_per_27
				,CASE WHEN TA.regdate = #{dayBefore28} THEN TA.over_per ELSE 0 END AS over_per_28
				,CASE WHEN TA.regdate = #{dayBefore29} THEN TA.over_per ELSE 0 END AS over_per_29
				,CASE WHEN TA.regdate = #{dayBefore30} THEN TA.over_per ELSE 0 END AS over_per_30
			FROM top_site_daily_member TA
			WHERE 1=1
			AND TA.regdate >= #{dayBefore30}
			AND TA.regdate &lt; #{dayBefore0}	
		)GA 
		GROUP BY GA.user_no
		ORDER BY GA.team_group_order DESC, GA.team_order DESC, GA.new_work_order, GA.work_level DESC, GA.join_date
	
	</select>
    
    <select id="getMisRegTm1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisRegTmVO">
        SELECT  GA.team_id 
               ,GA.team_name
               ,GA.team_type
               ,GA.team_sector
               ,GA.team_center
               ,GA.team_written
               <!-- user_state = 0 -->
               ,(select count(*) from top_mbr_bsc where team_id_main = GA.team_id and user_state != 1 and work_type not in (10, 12) ) as member_cnt
               ,GB.reg_12 ,GB.reg_11 ,GB.reg_10 ,GB.reg_9 ,GB.reg_8 ,GB.reg_7 ,GB.reg_6 ,GB.reg_5 ,GB.reg_4 ,GB.reg_3 ,GB.reg_2 ,GB.reg_1
               ,GB.reg_wc_12 ,GB.reg_wc_11 ,GB.reg_wc_10 ,GB.reg_wc_9 ,GB.reg_wc_8 ,GB.reg_wc_7 ,GB.reg_wc_6 ,GB.reg_wc_5 ,GB.reg_wc_4 ,GB.reg_wc_3 ,GB.reg_wc_2 ,GB.reg_wc_1
               ,GC.cls_12 ,GC.cls_11 ,GC.cls_10 ,GC.cls_9 ,GC.cls_8 ,GC.cls_7 ,GC.cls_6 ,GC.cls_5 ,GC.cls_4 ,GC.cls_3 ,GC.cls_2 ,GC.cls_1
               ,GC.cls_wc_12 ,GC.cls_wc_11 ,GC.cls_wc_10 ,GC.cls_wc_9 ,GC.cls_wc_8 ,GC.cls_wc_7 ,GC.cls_wc_6 ,GC.cls_wc_5 ,GC.cls_wc_4 ,GC.cls_wc_3 ,GC.cls_wc_2 ,GC.cls_wc_1
                
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.REG_12) AS reg_12
                             ,SUM(C.REG_11) AS reg_11
                             ,SUM(C.REG_10) AS reg_10
                             ,SUM(C.REG_9) AS reg_9
                             ,SUM(C.REG_8) AS reg_8
                             ,SUM(C.REG_7) AS reg_7
                             ,SUM(C.REG_6) AS reg_6
                             ,SUM(C.REG_5) AS reg_5
                             ,SUM(C.REG_4) AS reg_4
                             ,SUM(C.REG_3) AS reg_3
                             ,SUM(C.REG_2) AS reg_2
                             ,SUM(C.REG_1) AS reg_1
                             
                             ,SUM(C.REG_WC_12) AS reg_wc_12
                             ,SUM(C.REG_WC_11) AS reg_wc_11
                             ,SUM(C.REG_WC_10) AS reg_wc_10
                             ,SUM(C.REG_WC_9) AS reg_wc_9
                             ,SUM(C.REG_WC_8) AS reg_wc_8
                             ,SUM(C.REG_WC_7) AS reg_wc_7
                             ,SUM(C.REG_WC_6) AS reg_wc_6
                             ,SUM(C.REG_WC_5) AS reg_wc_5
                             ,SUM(C.REG_WC_4) AS reg_wc_4
                             ,SUM(C.REG_WC_3) AS reg_wc_3
                             ,SUM(C.REG_WC_2) AS reg_wc_2
                             ,SUM(C.REG_WC_1) AS reg_wc_1
                        FROM  (
                              SELECT  0 AS TEAM_ID 
                                     ,0 AS SUIM_RPT_NO
                                     ,0 AS REG_12
                                     ,0 AS REG_11
                                     ,0 AS REG_10
                                     ,0 AS REG_9
                                     ,0 AS REG_8
                                     ,0 AS REG_7
                                     ,0 AS REG_6
                                     ,0 AS REG_5
                                     ,0 AS REG_4
                                     ,0 AS REG_3
                                     ,0 AS REG_2
                                     ,0 AS REG_1
                                     
                                     ,0 AS REG_WC_12
                                     ,0 AS REG_WC_11
                                     ,0 AS REG_WC_10
                                     ,0 AS REG_WC_9
                                     ,0 AS REG_WC_8
                                     ,0 AS REG_WC_7
                                     ,0 AS REG_WC_6
                                     ,0 AS REG_WC_5
                                     ,0 AS REG_WC_4
                                     ,0 AS REG_WC_3
                                     ,0 AS REG_WC_2
                                     ,0 AS REG_WC_1
                                FROM  dual                        
                        	<if test='basicYN == "Y"'>
							   UNION ALL                        	
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS REG_12
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS REG_11
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS REG_10
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS REG_9
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS REG_8
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS REG_7
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS REG_6
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS REG_5
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS REG_4
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS REG_3
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS REG_2
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS REG_1
                                     
                                     ,0 AS REG_WC_12
                                     ,0 AS REG_WC_11
                                     ,0 AS REG_WC_10
                                     ,0 AS REG_WC_9
                                     ,0 AS REG_WC_8
                                     ,0 AS REG_WC_7
                                     ,0 AS REG_WC_6
                                     ,0 AS REG_WC_5
                                     ,0 AS REG_WC_4
                                     ,0 AS REG_WC_3
                                     ,0 AS REG_WC_2
                                     ,0 AS REG_WC_1
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_TYPE1 IN(1, 2, 11, 12, 13, 14, 15 ,16, 17, 18)
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                                 
                               UNION ALL                        	
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0 AS REG_12
                                     ,0 AS REG_11
                                     ,0 AS REG_10
                                     ,0 AS REG_9
                                     ,0 AS REG_8
                                     ,0 AS REG_7
                                     ,0 AS REG_6
                                     ,0 AS REG_5
                                     ,0 AS REG_4
                                     ,0 AS REG_3
                                     ,0 AS REG_2
                                     ,0 AS REG_1
                                     
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS REG_WC_12
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS REG_WC_11
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS REG_WC_10
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS REG_WC_9
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS REG_WC_8
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS REG_WC_7
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS REG_WC_6
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS REG_WC_5
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS REG_WC_4
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS REG_WC_3
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS REG_WC_2
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS REG_WC_1
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND ( (A.SUIM_RPT_TYPE1 = 11 AND A.WORKLOAD_TYPE IN (25, 30)) OR (A.SUIM_RPT_TYPE1 = 12 AND A.WORKLOAD_TYPE IN (30, 35)) OR (A.SUIM_RPT_TYPE1 = 2 AND A.WORKLOAD_TYPE IN (30, 35, 60, 65)) )
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                        	</if>
							<if test='primYN == "Y"'>
                               UNION ALL
                              SELECT  B.TEAM_ID 
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS REG_12
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS REG_11
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS REG_10
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS REG_9
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS REG_8
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS REG_7
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS REG_6
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS REG_5
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS REG_4
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS REG_3
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS REG_2
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS REG_1
                                                                          
                                     ,0 AS REG_WC_12
                                     ,0 AS REG_WC_11
                                     ,0 AS REG_WC_10
                                     ,0 AS REG_WC_9
                                     ,0 AS REG_WC_8
                                     ,0 AS REG_WC_7
                                     ,0 AS REG_WC_6
                                     ,0 AS REG_WC_5
                                     ,0 AS REG_WC_4
                                     ,0 AS REG_WC_3
                                     ,0 AS REG_WC_2
                                     ,0 AS REG_WC_1
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_STATE != '3'
                                 AND  B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                                 
                               ) C
                       WHERE  1=1
                      GROUP BY C.TEAM_ID  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.CLS_12) AS cls_12
                             ,SUM(C.CLS_11) AS cls_11
                             ,SUM(C.CLS_10) AS cls_10
                             ,SUM(C.CLS_9) AS cls_9
                             ,SUM(C.CLS_8) AS cls_8
                             ,SUM(C.CLS_7) AS cls_7
                             ,SUM(C.CLS_6) AS cls_6
                             ,SUM(C.CLS_5) AS cls_5
                             ,SUM(C.CLS_4) AS cls_4
                             ,SUM(C.CLS_3) AS cls_3
                             ,SUM(C.CLS_2) AS cls_2
                             ,SUM(C.CLS_1) AS cls_1
                             
                             ,SUM(C.CLS_WC_12) AS cls_wc_12
                             ,SUM(C.CLS_WC_11) AS cls_wc_11
                             ,SUM(C.CLS_WC_10) AS cls_wc_10
                             ,SUM(C.CLS_WC_9) AS cls_wc_9
                             ,SUM(C.CLS_WC_8) AS cls_wc_8
                             ,SUM(C.CLS_WC_7) AS cls_wc_7
                             ,SUM(C.CLS_WC_6) AS cls_wc_6
                             ,SUM(C.CLS_WC_5) AS cls_wc_5
                             ,SUM(C.CLS_WC_4) AS cls_wc_4
                             ,SUM(C.CLS_WC_3) AS cls_wc_3
                             ,SUM(C.CLS_WC_2) AS cls_wc_2
                             ,SUM(C.CLS_WC_1) AS cls_wc_1
                        FROM  (
                        
                              SELECT  0 AS TEAM_ID 
                                     ,0 AS SUIM_RPT_NO
                                     ,0 AS CLS_12
                                     ,0 AS CLS_11
                                     ,0 AS CLS_10
                                     ,0 AS CLS_9
                                     ,0 AS CLS_8
                                     ,0 AS CLS_7
                                     ,0 AS CLS_6
                                     ,0 AS CLS_5
                                     ,0 AS CLS_4
                                     ,0 AS CLS_3
                                     ,0 AS CLS_2
                                     ,0 AS CLS_1
                                     
                                     ,0 AS CLS_WC_12
                                     ,0 AS CLS_WC_11
                                     ,0 AS CLS_WC_10
                                     ,0 AS CLS_WC_9
                                     ,0 AS CLS_WC_8
                                     ,0 AS CLS_WC_7
                                     ,0 AS CLS_WC_6
                                     ,0 AS CLS_WC_5
                                     ,0 AS CLS_WC_4
                                     ,0 AS CLS_WC_3
                                     ,0 AS CLS_WC_2
                                     ,0 AS CLS_WC_1
                                FROM  dual                        
                        	<if test='basicYN == "Y"'>                        
                               UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS CLS_12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS CLS_11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS CLS_10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS CLS_9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS CLS_8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS CLS_7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS CLS_6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS CLS_5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS CLS_4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS CLS_3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS CLS_2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS CLS_1
                                     
                                     ,0 AS CLS_WC_12
                                     ,0 AS CLS_WC_11
                                     ,0 AS CLS_WC_10
                                     ,0 AS CLS_WC_9
                                     ,0 AS CLS_WC_8
                                     ,0 AS CLS_WC_7
                                     ,0 AS CLS_WC_6
                                     ,0 AS CLS_WC_5
                                     ,0 AS CLS_WC_4
                                     ,0 AS CLS_WC_3
                                     ,0 AS CLS_WC_2
                                     ,0 AS CLS_WC_1
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_TYPE1 IN(1, 2, 11, 12, 13, 14, 15, 16, 17, 18, 19)
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                                 
                               UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0 AS CLS_12
                                     ,0 AS CLS_11
                                     ,0 AS CLS_10
                                     ,0 AS CLS_9
                                     ,0 AS CLS_8
                                     ,0 AS CLS_7
                                     ,0 AS CLS_6
                                     ,0 AS CLS_5
                                     ,0 AS CLS_4
                                     ,0 AS CLS_3
                                     ,0 AS CLS_2
                                     ,0 AS CLS_1
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS CLS_WC_12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS CLS_WC_11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS CLS_WC_10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS CLS_WC_9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS CLS_WC_8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS CLS_WC_7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS CLS_WC_6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS CLS_WC_5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS CLS_WC_4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS CLS_WC_3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS CLS_WC_2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS CLS_WC_1
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND ( (A.SUIM_RPT_TYPE1 = 11 AND A.WORKLOAD_TYPE IN (25, 30)) OR (A.SUIM_RPT_TYPE1 = 12 AND A.WORKLOAD_TYPE IN (30, 35)) OR (A.SUIM_RPT_TYPE1 = 2 AND A.WORKLOAD_TYPE IN (30, 35, 60, 65)) )
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                        	</if>
							<if test='primYN == "Y"'>                                 
                               UNION ALL
                              SELECT  B.TEAM_ID 
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS CLS_12
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS CLS_11
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS CLS_10
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS CLS_9
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS CLS_8
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS CLS_7
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS CLS_6
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS CLS_5
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS CLS_4
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS CLS_3
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS CLS_2
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS CLS_1
                                     
                                     ,0 AS CLS_WC_12
                                     ,0 AS CLS_WC_11
                                     ,0 AS CLS_WC_10
                                     ,0 AS CLS_WC_9
                                     ,0 AS CLS_WC_8
                                     ,0 AS CLS_WC_7
                                     ,0 AS CLS_WC_6
                                     ,0 AS CLS_WC_5
                                     ,0 AS CLS_WC_4
                                     ,0 AS CLS_WC_3
                                     ,0 AS CLS_WC_2
                                     ,0 AS CLS_WC_1
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_STATE != '3'
                                 AND  B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
							 -- 보고서에 없는 팀 아이디를 추가하기위해 추가함
							UNION ALL
                              SELECT  team_id
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                FROM  top_tm_bsc
					 			WHERE team_type != 4 AND team_statistics1 = 0							
                               ) C
                       WHERE  1=1
                      GROUP BY C.TEAM_ID    
                     ) GC
            ON  GA.TEAM_ID = GC.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE != 4
           AND  GA.TEAM_STATISTICS1 = 0 
        ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 
    </select>

    <select id="getMisRegTm4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisRegTmVO">
        SELECT  GA.team_id 
               ,GA.team_name
               ,GA.team_type
               ,GA.team_sector
               ,GA.team_center
               <!-- user_state = 0 -->
               ,(select count(*) from top_mbr_bsc where team_id_main = GA.team_id and user_state != 1 and work_type not in (10, 12) ) as member_cnt
               ,GB.reg_12 ,GB.reg_11 ,GB.reg_10 ,GB.reg_9 ,GB.reg_8 ,GB.reg_7 ,GB.reg_6 ,GB.reg_5 ,GB.reg_4 ,GB.reg_3 ,GB.reg_2 ,GB.reg_1
               ,GC.cls_12 ,GC.cls_11 ,GC.cls_10 ,GC.cls_9 ,GC.cls_8 ,GC.cls_7 ,GC.cls_6 ,GC.cls_5 ,GC.cls_4 ,GC.cls_3 ,GC.cls_2 ,GC.cls_1 
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.REG_12) AS reg_12
                             ,SUM(C.REG_11) AS reg_11
                             ,SUM(C.REG_10) AS reg_10
                             ,SUM(C.REG_9) AS reg_9
                             ,SUM(C.REG_8) AS reg_8
                             ,SUM(C.REG_7) AS reg_7
                             ,SUM(C.REG_6) AS reg_6
                             ,SUM(C.REG_5) AS reg_5
                             ,SUM(C.REG_4) AS reg_4
                             ,SUM(C.REG_3) AS reg_3
                             ,SUM(C.REG_2) AS reg_2
                             ,SUM(C.REG_1) AS reg_1
                        FROM  (
                              SELECT  0 AS TEAM_ID 
                                     ,0 AS SUIM_RPT_NO
                                     ,0 AS REG_12
                                     ,0 AS REG_11
                                     ,0 AS REG_10
                                     ,0 AS REG_9
                                     ,0 AS REG_8
                                     ,0 AS REG_7
                                     ,0 AS REG_6
                                     ,0 AS REG_5
                                     ,0 AS REG_4
                                     ,0 AS REG_3
                                     ,0 AS REG_2
                                     ,0 AS REG_1
                                FROM  dual                        
                        	<if test='basicYN == "Y"'>
                        	   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS REG_12
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS REG_11
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS REG_10
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS REG_9
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS REG_8
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS REG_7
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS REG_6
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS REG_5
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS REG_4
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS REG_3
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS REG_2
                                     ,CASE WHEN A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS REG_1
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_TYPE1 IN(3, 4)
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
							<if test='primYN == "Y"'>
                               UNION ALL
                              SELECT  B.TEAM_ID 
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS REG_12
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS REG_11
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS REG_10
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS REG_9
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS REG_8
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS REG_7
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS REG_6
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS REG_5
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS REG_4
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS REG_3
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS REG_2
                                     ,CASE WHEN B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS REG_1
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_STATE != '3'
                                 AND  B.REG_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.REG_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.TEAM_ID  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.CLS_12) AS cls_12
                             ,SUM(C.CLS_11) AS cls_11
                             ,SUM(C.CLS_10) AS cls_10
                             ,SUM(C.CLS_9) AS cls_9
                             ,SUM(C.CLS_8) AS cls_8
                             ,SUM(C.CLS_7) AS cls_7
                             ,SUM(C.CLS_6) AS cls_6
                             ,SUM(C.CLS_5) AS cls_5
                             ,SUM(C.CLS_4) AS cls_4
                             ,SUM(C.CLS_3) AS cls_3
                             ,SUM(C.CLS_2) AS cls_2
                             ,SUM(C.CLS_1) AS cls_1
                        FROM  (
                              SELECT  0 AS TEAM_ID 
                                     ,0 AS SUIM_RPT_NO
                                     ,0 AS CLS_12
                                     ,0 AS CLS_11
                                     ,0 AS CLS_10
                                     ,0 AS CLS_9
                                     ,0 AS CLS_8
                                     ,0 AS CLS_7
                                     ,0 AS CLS_6
                                     ,0 AS CLS_5
                                     ,0 AS CLS_4
                                     ,0 AS CLS_3
                                     ,0 AS CLS_2
                                     ,0 AS CLS_1
                                FROM  dual                        
                        	<if test='basicYN == "Y"'>
                        	   UNION ALL                            
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS CLS_12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS CLS_11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS CLS_10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS CLS_9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS CLS_8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS CLS_7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS CLS_6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS CLS_5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS CLS_4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS CLS_3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS CLS_2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS CLS_1
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_TYPE1 IN(3, 4)
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
							<if test='primYN == "Y"' >
                              UNION ALL
                              SELECT  B.TEAM_ID 
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS CLS_12
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS CLS_11
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS CLS_10
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS CLS_9
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS CLS_8
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS CLS_7
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS CLS_6
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS CLS_5
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS CLS_4
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS CLS_3
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS CLS_2
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS CLS_1
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_STATE != '3'
                                 AND  B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
							 -- 보고서에 없는 팀 아이디를 추가하기위해 추가함
							UNION ALL
                              SELECT  team_id
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0
                                     ,0                                     
                                FROM  top_tm_bsc
					 			WHERE team_type = 4 AND team_statistics4 = 0
                               ) C
                       WHERE  1=1
                      GROUP BY C.TEAM_ID    
                     ) GC
            ON  GA.TEAM_ID = GC.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS4 = 0 
        ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 
    </select>    
    
</mapper>
