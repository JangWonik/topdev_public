<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MisEndTmMapper">	
	
	<select id="getInsuReportListBySendMethod" parameterType="String" resultType="AsraMap">
		SELECT
			IFNULL(GROUP_CONCAT(DISTINCT GA.con_method),'') AS con_method
			,IFNULL(GROUP_CONCAT(DISTINCT GA.ins_method),'') AS ins_method
			,IFNULL(GROUP_CONCAT(DISTINCT GA.cla_method),'') AS cla_method
		FROM(
			SELECT
				CASE
					WHEN (send_target = 1)
					THEN IF(privacy_agree = 2,'disagree',send_method)	
				END AS con_method
				,CASE
					WHEN (send_target = 5)
					THEN IF(privacy_agree = 2,'disagree',send_method)	
				END AS ins_method
				,CASE
					WHEN (send_target = 10)
					THEN IF(privacy_agree = 2,'disagree',send_method)	
				END AS cla_method
			FROM top_rpt_issue_send
			WHERE suim_rpt_no = #{suim_rpt_no}
			AND complete_flag = 1
		)GA		
	</select>

	<select id="getInsuReportListByDetail" parameterType="HashMap" resultType="AsraMap">
		SELECT th.suim_rpt_no
			, getCodeValue('top_rpt_head','suim_rpt_type1',th.suim_rpt_type1) suim_rpt_type1_nm		
			, th.suim_accept_no		
			, th.suim_close_no
			, th.del_date
			, getTopPtnrBscPtnrNick(th.ptnr_id) ptnr_nick		
			, th.policyholder_nm
			, th.beneficiary_nm
			, th.damaged_nm
			, th.issue_send_result AS compCnt 
			, FROM_UNIXTIME(th.close_date,'%Y-%m-%d') AS close_date
			, FROM_UNIXTIME(th.reg_date,'%Y-%m-%d') AS reg_date
			, FROM_UNIXTIME(th.accident_date,'%Y-%m-%d') AS accident_date		
			, tb.policy_no
			, tb.accident_facts
			, tb.accident_no
			, (SELECT count(*) from top_rpt_issue_file where suim_rpt_no = th.suim_rpt_no) file_chk			
		FROM top_rpt_head th, top_tm_bsc tm, top_rpt_body tb
		WHERE th.team_id = tm.team_id
			and th.suim_rpt_no = tb.suim_rpt_no
			<if test='srchTeamType == 1'>
				and tm.team_type != 4
			</if>
			<if test='srchTeamType == 4'>
				and tm.team_type = 4
			</if>
			<if test='srchUserNo != 0'>
				and th.user_no = #{srchUserNo}
			</if>
			<if test='srchPtnrId != 0'>
				and th.ptnr_id = #{srchPtnrId}
			</if>			
			and th.suim_rpt_state = 2 
			and th.close_date >= UNIX_TIMESTAMP(#{srchSdate}) 
			and th.close_date &lt; UNIX_TIMESTAMP(#{srchEdate}) 
			ORDER BY close_date DESC ,suim_close_no DESC
	</select>
	
	<select id="getInsuReportList" parameterType="HashMap" resultType="AsraMap">
		SELECT th.suim_rpt_no
			, getCodeValue('top_rpt_head','suim_rpt_type1',th.suim_rpt_type1) suim_rpt_type1_nm		
			, th.suim_accept_no		
			, th.suim_close_no
			, th.del_date
			, getTopPtnrBscPtnrNick(#{ptnr_id}) ptnr_nick		
			, th.policyholder_nm
			, th.beneficiary_nm
			, th.damaged_nm		
			, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1 LIMIT 1) AS con_method
			, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1 LIMIT 1) AS ins_method
			, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1 LIMIT 1) AS cla_method
			, th.issue_send_result AS compCnt 
			, FROM_UNIXTIME(th.close_date,'%Y-%m-%d') AS close_date
			, FROM_UNIXTIME(th.reg_date,'%Y-%m-%d') AS reg_date
			, FROM_UNIXTIME(th.accident_date,'%Y-%m-%d') AS accident_date		
			, (SELECT policy_no FROM top_rpt_body WHERE suim_rpt_no = th.suim_rpt_no) policy_no
			, (SELECT accident_facts FROM top_rpt_body WHERE suim_rpt_no = th.suim_rpt_no) accident_facts
			, (SELECT accident_no FROM top_rpt_body WHERE suim_rpt_no = th.suim_rpt_no) accident_no
			, (SELECT count(*) from top_rpt_issue_file where suim_rpt_no = th.suim_rpt_no) file_chk
		FROM top_rpt_head th, top_tm_bsc tm
		WHERE th.team_id = tm.team_id
			<if test='insu_type == 1'>
				and tm.team_type != 4
			</if>
			<if test='insu_type == 4'>
				and tm.team_type = 4
			</if>		 
			and th.ptnr_id = #{ptnr_id} 
			and th.suim_rpt_state = 2 
			and th.close_date >= UNIX_TIMESTAMP(#{startDate}) 
			and th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
			<if test="menuId == 'old'">
				AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
			</if>
			<if test="menuId == 'new'">
				AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
			</if> 
			ORDER BY close_date DESC ,suim_close_no DESC	
	</select>
	
	<select id="getInsuReportList_20190807" parameterType="HashMap" resultType="AsraMap">
	SELECT th.suim_rpt_no
		, getCodeValue('top_rpt_head','suim_rpt_type1',th.suim_rpt_type1) suim_rpt_type1_nm		
		, th.suim_accept_no		
		, th.suim_close_no
		, th.del_date
		, getTopPtnrBscPtnrNick(#{ptnr_id}) ptnr_nick		
		, th.policyholder_nm
		, th.beneficiary_nm
		, th.damaged_nm		
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1 LIMIT 1) AS con_method
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1 LIMIT 1) AS ins_method
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1 LIMIT 1) AS cla_method
		, (SELECT if(count(distinct(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt 
		, FROM_UNIXTIME(th.close_date,'%Y-%m-%d') AS close_date
		, FROM_UNIXTIME(th.reg_date,'%Y-%m-%d') AS reg_date
		, FROM_UNIXTIME(th.accident_date,'%Y-%m-%d') AS accident_date		
		, (SELECT policy_no FROM top_rpt_body WHERE suim_rpt_no = th.suim_rpt_no) policy_no
		, (SELECT accident_facts FROM top_rpt_body WHERE suim_rpt_no = th.suim_rpt_no) accident_facts
		, (SELECT accident_no FROM top_rpt_body WHERE suim_rpt_no = th.suim_rpt_no) accident_no
		, (SELECT count(*) from top_rpt_issue_file where suim_rpt_no = th.suim_rpt_no) file_chk
	FROM top_rpt_head th, top_tm_bsc tm
	WHERE th.team_id = tm.team_id
		<if test='insu_type == 1'>
			and tm.team_type != 4
		</if>
		<if test='insu_type == 4'>
			and tm.team_type = 4
		</if>		 
		and th.ptnr_id = #{ptnr_id} 
		and th.suim_rpt_state = 2 
		and th.close_date >= UNIX_TIMESTAMP(#{startDate}) 
		and th.close_date &lt; UNIX_TIMESTAMP(#{endDate}) 
		ORDER BY close_date DESC ,suim_close_no DESC	
	</select>
	
	<select id="getReportList" parameterType="HashMap" resultType="AsraMap">
	SELECT th.suim_rpt_no
		, getCodeValue('top_rpt_head','suim_rpt_type1',th.suim_rpt_type1) suim_rpt_type1_nm		
		, th.suim_accept_no		
		, th.suim_close_no
		, th.del_date
		, getTopMbrBscUserName(#{user_no}) as user_name		
		, getTopPtnrBscPtnrNick(th.ptnr_id) ptnr_nick		
		, getTopPtnrDeptBscPtnrDeptName(th.ptnr_dept_id) ptnr_dept_nm
		, getTopPtnrMbrBscPtnrMbrName(th.ptnr_mbr_no) ptnr_mbr_nm
		, getTopTmBscTeamName(th.team_id) team_name
		, th.policyholder_nm
		, th.beneficiary_nm
		, th.damaged_nm		
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1 LIMIT 1) AS con_method
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1 LIMIT 1) AS ins_method
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1 LIMIT 1) AS cla_method
		, th.issue_send_result AS compCnt 
		, th.close_date		
	FROM top_rpt_head th
	WHERE th.user_no = #{user_no} 
	AND th.suim_rpt_state = 2 
	AND th.close_date >= UNIX_TIMESTAMP(#{startDate}) 
	AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
	<if test="menuId == 'old'">
		AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
	</if>
	<if test="menuId == 'new'">
		AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
	</if>
	ORDER BY close_date DESC ,suim_close_no DESC	
	</select>
	
	<select id="getReportList_20190807" parameterType="HashMap" resultType="AsraMap">
	SELECT th.suim_rpt_no
		, getCodeValue('top_rpt_head','suim_rpt_type1',th.suim_rpt_type1) suim_rpt_type1_nm		
		, th.suim_accept_no		
		, th.suim_close_no
		, th.del_date
		, getTopMbrBscUserName(#{user_no}) as user_name		
		, getTopPtnrBscPtnrNick(th.ptnr_id) ptnr_nick		
		, getTopPtnrDeptBscPtnrDeptName(th.ptnr_dept_id) ptnr_dept_nm
		, getTopPtnrMbrBscPtnrMbrName(th.ptnr_mbr_no) ptnr_mbr_nm
		, getTopTmBscTeamName(th.team_id) team_name
		, th.policyholder_nm
		, th.beneficiary_nm
		, th.damaged_nm		
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1 LIMIT 1) AS con_method
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1 LIMIT 1) AS ins_method
		, (SELECT if(privacy_agree = 2,'disagree',send_method) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1 LIMIT 1) AS cla_method
		, (SELECT if(count(distinct(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt 
		, th.close_date		
	FROM top_rpt_head th
	WHERE th.user_no = #{user_no} AND th.suim_rpt_state = 2 and th.close_date >= UNIX_TIMESTAMP(#{startDate}) and th.close_date &lt; UNIX_TIMESTAMP(#{endDate}) ORDER BY close_date DESC ,suim_close_no DESC	
	</select>
	
	<select id="getMemberList" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.user_no
		,GA.user_name
		,GA.center_name
		,CASE GA.work_type
			WHEN 1 THEN 1
			WHEN 2 THEN 2
			WHEN 6 THEN 3
			WHEN 14 THEN 4
			WHEN 15 THEN 5
			WHEN 3 THEN 6
			WHEN 7 THEN 7
			WHEN 4 THEN 8
			WHEN 8 THEN 9
			WHEN 5 THEN 10
			WHEN 9 THEN 11
			WHEN 10 THEN 12
			WHEN 12 THEN 13
			WHEN 11 THEN 14
			WHEN 13 THEN 15	
		END AS new_work_order
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT
				mb.user_no 
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,1 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_rpt_head th
			WHERE 
				mb.user_no = th.user_no
				AND mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				
			UNION ALL
				
			SELECT
				mb.user_no 
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt			
				,0 AS primCnt				 
				,1 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				mb.user_no = th.user_no
				AND mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.complete_flag = 1
				AND ts.send_target = 1
				GROUP BY ts.suim_rpt_no
			
			UNION ALL
				
			SELECT
				mb.user_no 
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt			
				,0 AS primCnt				 
				,0 AS conCnt
				,1 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				mb.user_no = th.user_no
				AND mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.complete_flag = 1
				AND ts.send_target = 5
				GROUP BY ts.suim_rpt_no
			
			UNION ALL
				
			SELECT
				mb.user_no 
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt			
				,0 AS primCnt				 
				,0 AS conCnt
				,0 AS insCnt
				,1 AS claCnt
				,0 AS compCnt						
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				mb.user_no = th.user_no
				AND mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.complete_flag = 1
				AND ts.send_target = 10
				GROUP BY ts.suim_rpt_no
			
			UNION ALL
				
			SELECT
				mb.user_no 
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt			
				,0 AS primCnt				 
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,1 AS compCnt						
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				mb.user_no = th.user_no
				AND mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.complete_flag = 1
				AND th.issue_send_result = 1
				GROUP BY ts.suim_rpt_no
						
			UNION ALL
			
			SELECT 
				mb.user_no
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_prim_biz_rpt_head bh
			WHERE 
				mb.user_no = bh.user_no
				AND mb.team_id_main = #{team_id}
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND bh.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND bh.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				
			UNION ALL
		
			SELECT 
				mb.user_no
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb
			WHERE 
				mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 )		
				) GA
		GROUP BY GA.user_name
		ORDER BY new_work_order, GA.work_level DESC	
	</select>
	
	<select id="getMemberList_20190807" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.user_no
		,GA.user_name
		,GA.center_name
		,CASE GA.work_type
			WHEN 1 THEN 1
			WHEN 2 THEN 2
			WHEN 6 THEN 3
			WHEN 14 THEN 4
			WHEN 15 THEN 5
			WHEN 3 THEN 6
			WHEN 7 THEN 7
			WHEN 4 THEN 8
			WHEN 8 THEN 9
			WHEN 5 THEN 10
			WHEN 9 THEN 11
			WHEN 10 THEN 12
			WHEN 12 THEN 13
			WHEN 11 THEN 14
			WHEN 13 THEN 15	
		END AS new_work_order
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT
				mb.user_no 
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,1 AS basicCnt			
				,0 AS primCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS conCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS insCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS claCnt
				,(SELECT IF(COUNT(DISTINCT(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt						
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_rpt_head th
			WHERE 
				mb.user_no = th.user_no
				AND mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
						
			UNION ALL
			
			SELECT 
				mb.user_no
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb, top_prim_biz_rpt_head bh
			WHERE 
				mb.user_no = bh.user_no
				AND mb.team_id_main = #{team_id}
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 ) 
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				
			UNION ALL
		
			SELECT 
				mb.user_no
				,mb.user_name
				,getToptmBscCenterName(mb.team_id_main) as center_name
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,work_type
				,work_level
			FROM
				top_mbr_bsc mb
			WHERE 
				mb.team_id_main = #{team_id} 
				AND ( mb.out_date is null or ( mb.out_date >= UNIX_TIMESTAMP(#{startDate} ) and mb.out_date &lt; UNIX_TIMESTAMP(#{endDate} ) )	 )		
				) GA
		GROUP BY GA.user_name
		ORDER BY new_work_order, GA.work_level DESC	
	</select>
	
	<select id="getReportInsu1" parameterType="HashMap" resultType="AsraMap">
		SELECT 
			GB.ptnr_nick
			,GB.ptnr_id
			,SUM(GB.basicCnt) AS basicCnt
			,SUM(GB.primCnt) AS primCnt
			,SUM(GB.conCnt) AS conCnt
			,SUM(GB.insCnt) AS insCnt
			,SUM(GB.claCnt) AS claCnt
			,SUM(GB.compCnt) AS compCnt
			FROM(
				select
					GA.ptnr_nick
					,GA.ptnr_id
					,GA.basicCnt AS basicCnt
					,GA.primCnt AS primCnt
					,GA.conCnt AS conCnt
					,GA.insCnt AS insCnt
					,GA.claCnt AS claCnt
					,GA.compCnt AS compCnt
					,GA.ptnr_order			
				from	
						(SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,1 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND th.suim_rpt_state = 2
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>		
							
							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,1 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.send_target = 1
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY ts.suim_rpt_no

							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,1 AS insCnt
								,0 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.send_target = 5
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY ts.suim_rpt_no
							
							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,1 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.send_target = 10
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY ts.suim_rpt_no

							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,1 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.issue_send_result = 1
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY th.suim_rpt_no

							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt
								,1 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt
								,tp.ptnr_order
								,bh.team_id
							FROM
								top_ptnr_bsc tp, top_prim_biz_rpt_head bh
							WHERE 
								tp.ptnr_id = bh.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND bh.suim_rpt_state = 2
								AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND bh.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND bh.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>		
							
							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id										
								,0 AS basicCnt
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt			
								,tp.ptnr_order					
								,'default' AS team_id
							FROM
								top_ptnr_bsc tp
							WHERE
								tp.ptnr_level = 1
								AND tp.statistics_yn = 1
							) GA, top_tm_bsc tm 
						WHERE 
						(GA.team_id = tm.team_id or GA.team_id = 'default')
						AND tm.team_type != 4
						) GB							
			GROUP BY GB.ptnr_id
			ORDER BY GB.ptnr_order DESC, GB.ptnr_id ASC	
	</select>
	
	<select id="getReportInsu1_20190806" parameterType="HashMap" resultType="AsraMap">
		SELECT 
			GB.ptnr_nick
			,GB.ptnr_id
			,SUM(GB.basicCnt) AS basicCnt
			,SUM(GB.primCnt) AS primCnt
			,SUM(GB.conCnt) AS conCnt
			,SUM(GB.insCnt) AS insCnt
			,SUM(GB.claCnt) AS claCnt
			,SUM(GB.compCnt) AS compCnt
			FROM(
				select
					GA.ptnr_nick
					,GA.ptnr_id
					,GA.basicCnt AS basicCnt
					,GA.primCnt AS primCnt
					,GA.conCnt AS conCnt
					,GA.insCnt AS insCnt
					,GA.claCnt AS claCnt
					,GA.compCnt AS compCnt
					,GA.ptnr_order			
				from	
						(SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,1 AS basicCnt			
								,0 AS primCnt
								,(CASE WHEN 
								(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1) > 0
								THEN 1 ELSE 0 END) AS conCnt
								,(CASE WHEN 
								(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1) > 0
								THEN 1 ELSE 0 END) AS insCnt
								,(CASE WHEN 
								(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1) > 0
								THEN 1 ELSE 0 END) AS claCnt
								,(SELECT IF(COUNT(DISTINCT(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND th.suim_rpt_state = 2
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt
								,1 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt
								,tp.ptnr_order
								,bh.team_id
							FROM
								top_ptnr_bsc tp, top_prim_biz_rpt_head bh
							WHERE 
								tp.ptnr_id = bh.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND bh.suim_rpt_state = 2
								AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
							
							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id										
								,0 AS basicCnt
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt			
								,tp.ptnr_order					
								,'default' AS team_id
							FROM
								top_ptnr_bsc tp
							WHERE
								tp.ptnr_level = 1
								AND tp.statistics_yn = 1
							) GA, top_tm_bsc tm 
						WHERE 
						(GA.team_id = tm.team_id or GA.team_id = 'default')
						AND tm.team_type != 4
						) GB							
			GROUP BY GB.ptnr_id
			ORDER BY GB.ptnr_order DESC, GB.ptnr_id ASC	
	</select>
	
	<select id="getReportInsu4" parameterType="HashMap" resultType="AsraMap">
		SELECT 
			GB.ptnr_nick
			,GB.ptnr_id
			,SUM(GB.basicCnt) AS basicCnt
			,SUM(GB.primCnt) AS primCnt
			,SUM(GB.conCnt) AS conCnt
			,SUM(GB.insCnt) AS insCnt
			,SUM(GB.claCnt) AS claCnt
			,SUM(GB.compCnt) AS compCnt
			FROM(
				select
					GA.ptnr_nick
					,GA.ptnr_id
					,GA.basicCnt AS basicCnt
					,GA.primCnt AS primCnt
					,GA.conCnt AS conCnt
					,GA.insCnt AS insCnt
					,GA.claCnt AS claCnt
					,GA.compCnt AS compCnt
					,GA.ptnr_order			
				from	
						(SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,1 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND th.suim_rpt_state = 2
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>		
							
							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,1 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.send_target = 1
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY ts.suim_rpt_no

							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,1 AS insCnt
								,0 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.send_target = 5
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY ts.suim_rpt_no
							
							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,1 AS claCnt
								,0 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND ts.send_target = 10
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY ts.suim_rpt_no

							UNION ALL

							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt			
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,1 AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th, top_rpt_issue_send ts
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1
								AND th.suim_rpt_state = 2
								AND th.suim_rpt_no = ts.suim_rpt_no
								AND th.issue_send_result = 1
								AND ts.complete_flag = 1								
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>
								GROUP BY th.suim_rpt_no

							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt
								,1 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt
								,tp.ptnr_order
								,bh.team_id
							FROM
								top_ptnr_bsc tp, top_prim_biz_rpt_head bh
							WHERE 
								tp.ptnr_id = bh.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND bh.suim_rpt_state = 2
								AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})
								<if test="menuId == 'old'">
									AND bh.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
								</if>
								<if test="menuId == 'new'">
									AND bh.close_date >= UNIX_TIMESTAMP(#{chkDate})
								</if>		
							
							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id										
								,0 AS basicCnt
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt			
								,tp.ptnr_order					
								,'default' AS team_id
							FROM
								top_ptnr_bsc tp
							WHERE
								tp.ptnr_level = 1
								AND tp.statistics_yn = 1
							) GA, top_tm_bsc tm 
						WHERE 
						(GA.team_id = tm.team_id or GA.team_id = 'default')
						AND tm.team_type = 4
						) GB							
			GROUP BY GB.ptnr_id
			ORDER BY GB.ptnr_order DESC, GB.ptnr_id ASC	
	</select>
	
	<select id="getReportInsu4_20190806" parameterType="HashMap" resultType="AsraMap">
		SELECT 
			GB.ptnr_nick
			,GB.ptnr_id
			,SUM(GB.basicCnt) AS basicCnt
			,SUM(GB.primCnt) AS primCnt
			,SUM(GB.conCnt) AS conCnt
			,SUM(GB.insCnt) AS insCnt
			,SUM(GB.claCnt) AS claCnt
			,SUM(GB.compCnt) AS compCnt
			FROM(
				select
					GA.ptnr_nick
					,GA.ptnr_id
					,GA.basicCnt AS basicCnt
					,GA.primCnt AS primCnt
					,GA.conCnt AS conCnt
					,GA.insCnt AS insCnt
					,GA.claCnt AS claCnt
					,GA.compCnt AS compCnt
					,GA.ptnr_order			
				from	
						(SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,1 AS basicCnt			
								,0 AS primCnt
								,(CASE WHEN 
								(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1) > 0
								THEN 1 ELSE 0 END) AS conCnt
								,(CASE WHEN 
								(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1) > 0
								THEN 1 ELSE 0 END) AS insCnt
								,(CASE WHEN 
								(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1) > 0
								THEN 1 ELSE 0 END) AS claCnt
								,(SELECT IF(COUNT(DISTINCT(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt						
								,tp.ptnr_order
								,th.team_id
							FROM
								top_ptnr_bsc tp, top_rpt_head th
							WHERE 
								tp.ptnr_id = th.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND th.suim_rpt_state = 2
								AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id					
								,0 AS basicCnt
								,1 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt
								,tp.ptnr_order
								,bh.team_id
							FROM
								top_ptnr_bsc tp, top_prim_biz_rpt_head bh
							WHERE 
								tp.ptnr_id = bh.ptnr_id
								AND tp.ptnr_level = 1
								AND tp.statistics_yn = 1			
								AND bh.suim_rpt_state = 2
								AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
								AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
							
							UNION ALL
							
							SELECT 
								tp.ptnr_nick
								,tp.ptnr_id										
								,0 AS basicCnt
								,0 AS primCnt
								,0 AS conCnt
								,0 AS insCnt
								,0 AS claCnt
								,0 AS compCnt			
								,tp.ptnr_order					
								,'default' AS team_id
							FROM
								top_ptnr_bsc tp
							WHERE
								tp.ptnr_level = 1
								AND tp.statistics_yn = 1
							) GA, top_tm_bsc tm 
						WHERE (GA.team_id = tm.team_id or GA.team_id = 'default')
						AND tm.team_type = 4
						) GB							
			GROUP BY GB.ptnr_id
			ORDER BY GB.ptnr_order DESC, GB.ptnr_id ASC	
	
	</select>

	<select id="getReportTeam1_20190617_work" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.team_name
		,GA.team_id
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,1 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})	
					
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,IF(COUNT(ts.suim_rpt_no) > 0, 1, 0) AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 1 
				AND ts.complete_flag = 1
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
						
			UNION ALL
						
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,IF(COUNT(ts.suim_rpt_no) > 0, 1, 0) AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 5 
				AND ts.complete_flag = 1
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
						
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,IF(COUNT(ts.suim_rpt_no) > 0, 1, 0) AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 10 
				AND ts.complete_flag = 1
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
						
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,IF(COUNT(DISTINCT(ts.send_target))=3,1,0) AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.suim_rpt_no = ts.suim_rpt_no				
				AND ts.complete_flag = 1
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
						
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_prim_biz_rpt_head bh
			WHERE 
				tm.team_id = bh.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
			
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type			
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt			
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm
			WHERE
				tm.team_type = 1
				AND tm.team_statistics1 = 0
			) GA
	
	GROUP BY GA.team_id
	ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC		
	</select>
	
	<select id="getReportTeam1" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.team_name
		,GA.team_id
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,1 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})	
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
						
			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,1 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 1
				AND ts.complete_flag = 1
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY ts.suim_rpt_no

			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt				 
				,1 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 5
				AND ts.complete_flag = 1
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})	
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY ts.suim_rpt_no
			
			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,1 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 10
				AND ts.complete_flag = 1
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY ts.suim_rpt_no

			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,1 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND th.issue_send_result = 1
				AND ts.complete_flag = 1				
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})	
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY th.suim_rpt_no

			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_prim_biz_rpt_head bh
			WHERE 
				tm.team_id = bh.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})		
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND bh.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND bh.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
			
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type			
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt			
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm
			WHERE
				tm.team_type = 1
				AND tm.team_statistics1 = 0
			) GA
	
	GROUP BY GA.team_id
	ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC	
	</select>
	
	<select id="getReportTeam1_20190806" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.team_name
		,GA.team_id
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,1 AS basicCnt			
				,0 AS primCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS conCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS insCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS claCnt
				,(SELECT IF(COUNT(DISTINCT(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_prim_biz_rpt_head bh
			WHERE 
				tm.team_id = bh.team_id
				AND tm.team_type = 1
				AND tm.team_statistics1 = 0			
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
			
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type			
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt			
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm
			WHERE
				tm.team_type = 1
				AND tm.team_statistics1 = 0
			) GA
	
	GROUP BY GA.team_id
	ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC		
	</select>
	
	<select id="getReportTeam4" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.team_name
		,GA.team_id
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,1 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
			
			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,1 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 1
				AND ts.complete_flag = 1
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY ts.suim_rpt_no

			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt				 
				,1 AS insCnt
				,0 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 5
				AND ts.complete_flag = 1
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})	
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY ts.suim_rpt_no
			
			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,1 AS claCnt
				,0 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND ts.send_target = 10
				AND ts.complete_flag = 1
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})		
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY ts.suim_rpt_no

			UNION ALL

			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt			
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,1 AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th, top_rpt_issue_send ts
			WHERE 
				tm.team_id = th.team_id
				AND th.suim_rpt_no = ts.suim_rpt_no
				AND th.issue_send_result = 1
				AND ts.complete_flag = 1
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})	
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND th.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND th.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>
				GROUP BY th.suim_rpt_no
					
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_prim_biz_rpt_head bh
			WHERE 
				tm.team_id = bh.team_id
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})
				<if test="menuId == 'old'">
					AND bh.close_date &lt; UNIX_TIMESTAMP(#{chkDate})	
				</if>
				<if test="menuId == 'new'">
					AND bh.close_date >= UNIX_TIMESTAMP(#{chkDate})
				</if>		
			
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type			
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt			
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm
			WHERE							
				tm.team_type = 4
				AND tm.team_statistics4 = 0
			) GA
	
	GROUP BY GA.team_id
	ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC						
	</select>
	
	<select id="getReportTeam4_20190806" parameterType="HashMap" resultType="AsraMap">
	SELECT 
		GA.team_name
		,GA.team_id
		,SUM(GA.basicCnt) AS basicCnt
		,SUM(GA.primCnt) AS primCnt
		,SUM(GA.conCnt) AS conCnt
		,SUM(GA.insCnt) AS insCnt
		,SUM(GA.claCnt) AS claCnt
		,SUM(GA.compCnt) AS compCnt
		FROM(
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,1 AS basicCnt			
				,0 AS primCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 1 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS conCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 5 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS insCnt
				,(CASE WHEN 
				(SELECT COUNT(*) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND send_target = 10 AND complete_flag = 1) > 0
				THEN 1 ELSE 0 END) AS claCnt
				,(SELECT IF(COUNT(DISTINCT(send_target))=3,1,0) FROM top_rpt_issue_send WHERE suim_rpt_no = th.suim_rpt_no AND complete_flag = 1) AS compCnt						
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_rpt_head th
			WHERE 
				tm.team_id = th.team_id
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND th.suim_rpt_state = 2
				AND th.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND th.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type
				,0 AS basicCnt
				,1 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm, top_prim_biz_rpt_head bh
			WHERE 
				tm.team_id = bh.team_id
				AND tm.team_type = 4
				AND tm.team_statistics4 = 0			
				AND bh.suim_rpt_state = 2
				AND bh.close_date >= UNIX_TIMESTAMP(#{startDate})
				AND bh.close_date &lt; UNIX_TIMESTAMP(#{endDate})		
			
			UNION ALL
			
			SELECT 
				tm.team_name
				,tm.team_id
				,tm.team_type			
				,0 AS basicCnt
				,0 AS primCnt
				,0 AS conCnt
				,0 AS insCnt
				,0 AS claCnt
				,0 AS compCnt			
				,tm.team_group_order
				,tm.team_order
			FROM
				top_tm_bsc tm
			WHERE							
				tm.team_type = 4
				AND tm.team_statistics4 = 0
			) GA
	
	GROUP BY GA.team_id
	ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC
		<!-- SELECT tm.team_name
		,tm.team_id
		,tm.team_type
		,(SELECT COUNT(*) FROM top_rpt_head WHERE suim_rpt_state = 2 AND team_id = tm.team_id) AS basicCnt		
		,(SELECT COUNT(*) FROM top_prim_biz_rpt_head WHERE suim_rpt_state = 2 AND team_id = tm.team_id) AS primCnt
		,(SELECT COUNT(*) FROM top_rpt_head th, top_rpt_issue_send ts WHERE th.suim_rpt_state = 2 AND th.team_id = tm.team_id AND th.suim_rpt_no = ts.suim_rpt_no AND
		 ts.send_target = 1 AND ts.complete_flag = 1 ) AS conCnt
		,(SELECT COUNT(*) FROM top_rpt_head th, top_rpt_issue_send ts WHERE th.suim_rpt_state = 2 AND th.team_id = tm.team_id AND th.suim_rpt_no = ts.suim_rpt_no AND
		 ts.send_target = 5 AND ts.complete_flag = 1 ) AS insCnt
		,(SELECT COUNT(*) FROM top_rpt_head th, top_rpt_issue_send ts WHERE th.suim_rpt_state = 2 AND th.team_id = tm.team_id AND th.suim_rpt_no = ts.suim_rpt_no AND
		 ts.send_target = 10 AND ts.complete_flag = 1 ) AS claCnt		
		FROM top_tm_bsc tm
		WHERE tm.team_type = 4
		AND tm.team_statistics4 = 0
		ORDER BY tm.TEAM_GROUP_ORDER DESC, tm.TEAM_ORDER DESC -->				
	</select>
	
	<select id="MisEndWrittenTm1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT
			GA.team_id
			,SUM(GA.end_rid12) end_rid12
			,SUM(GA.end_rid11) end_rid11
			,SUM(GA.end_rid10) end_rid10
			,SUM(GA.end_rid9) end_rid9
			,SUM(GA.end_rid8) end_rid8
			,SUM(GA.end_rid7) end_rid7
			,SUM(GA.end_rid6) end_rid6
			,SUM(GA.end_rid5) end_rid5
			,SUM(GA.end_rid4) end_rid4
			,SUM(GA.end_rid3) end_rid3
			,SUM(GA.end_rid2) end_rid2
			,SUM(GA.end_rid) end_rid
		FROM
			(
		
			SELECT
				#{team_id} as team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM DUAL
			
			UNION ALL
			
			SELECT
				"" team_id				
				,IFNULL(SUM(end_cnt),0) AS end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1
			AND team_id = #{team_id}
			AND base_date >= #{monBefore12}
			AND base_date &lt; #{monBefore11}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12				
				,IFNULL(SUM(end_cnt),0) AS end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore11}
			AND base_date &lt; #{monBefore10}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11								
				,IFNULL(SUM(end_cnt),0) AS end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore10}
			AND base_date &lt; #{monBefore9}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10				
				,IFNULL(SUM(end_cnt),0) AS end_rid9				
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore9}
			AND base_date &lt; #{monBefore8}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9				
				,IFNULL(SUM(end_cnt),0) AS end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore8}
			AND base_date &lt; #{monBefore7}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8				
				,IFNULL(SUM(end_cnt),0) AS end_rid7				
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore7}
			AND base_date &lt; #{monBefore6}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7				
				,IFNULL(SUM(end_cnt),0) AS end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore6}
			AND base_date &lt; #{monBefore5}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6				
				,IFNULL(SUM(end_cnt),0) AS end_rid5				
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore5}
			AND base_date &lt; #{monBefore4}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5				
				,IFNULL(SUM(end_cnt),0) AS end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore4}
			AND base_date &lt; #{monBefore3}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4				
				,IFNULL(SUM(end_cnt),0) AS end_rid3				
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore3}
			AND base_date &lt; #{monBefore2}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3				
				,IFNULL(SUM(end_cnt),0) AS end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore2}
			AND base_date &lt; #{monBefore1}
			
			UNION ALL
			
			SELECT 
				"" team_id
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2				
				,IFNULL(SUM(end_cnt),0) AS end_rid				
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND team_id = #{team_id}
			AND base_date >= #{monBefore1}
			AND base_date &lt; #{monBefore0}			
			) GA
	</select>
	
	<select id="MisEndTm1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_name
               ,getTopTmBscCenterName(GA.team_id) center_name
               ,GA.team_type
               ,GA.team_written
               ,GB.end_rid12 ,GB.end_rid11 ,GB.end_rid10 ,GB.end_rid9 ,GB.end_rid8 ,GB.end_rid7 ,GB.end_rid6 ,GB.end_rid5 ,GB.end_rid4 ,GB.end_rid3 ,GB.end_rid2 ,GB.end_rid
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.end_rid12) AS end_rid12
                             ,SUM(C.end_rid11) AS end_rid11
                             ,SUM(C.end_rid10) AS end_rid10
                             ,SUM(C.end_rid9) AS end_rid9
                             ,SUM(C.end_rid8) AS end_rid8
                             ,SUM(C.end_rid7) AS end_rid7
                             ,SUM(C.end_rid6) AS end_rid6
                             ,SUM(C.end_rid5) AS end_rid5
                             ,SUM(C.end_rid4) AS end_rid4
                             ,SUM(C.end_rid3) AS end_rid3
                             ,SUM(C.end_rid2) AS end_rid2
                             ,SUM(C.end_rid) AS end_rid
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS SUIM_RPT_NO
		                             ,0 AS end_rid12
		                             ,0 AS end_rid11
		                             ,0 AS end_rid10
		                             ,0 AS end_rid9
		                             ,0 AS end_rid8
		                             ,0 AS end_rid7
		                             ,0 AS end_rid6
		                             ,0 AS end_rid5
		                             ,0 AS end_rid4
		                             ,0 AS end_rid3
		                             ,0 AS end_rid2
		                             ,0 AS end_rid
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS end_rid12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS end_rid11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS end_rid10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS end_rid9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS end_rid8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS end_rid7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS end_rid6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS end_rid5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS end_rid4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS end_rid3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS end_rid2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS end_rid
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                            <if test='primYN == "Y"'>
                              UNION ALL
                              SELECT  B.TEAM_ID
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS end_rid12
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS end_rid11
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS end_rid10
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS end_rid9
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS end_rid8
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS end_rid7
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS end_rid6
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS end_rid5
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS end_rid4
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS end_rid3
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS end_rid2
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS end_rid
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_STATE = '2'
                                 AND  B.SUIM_RPT_TYPE1 = 5
                                 AND  B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           <!-- AND  GA.TEAM_TYPE = 1 -->
           AND  GA.TEAM_TYPE IN (0,1)
           AND  GA.TEAM_STATISTICS1 = 0 
        ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC           
	</select>
	
	
	<select id="MisEndTm4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_name
			   ,getTopTmBscCenterName(GA.team_id) center_name               
               ,GA.team_type
               ,GA.team_written
               ,GB.end_rid12 ,GB.end_rid11 ,GB.end_rid10 ,GB.end_rid9 ,GB.end_rid8 ,GB.end_rid7 ,GB.end_rid6 ,GB.end_rid5 ,GB.end_rid4 ,GB.end_rid3 ,GB.end_rid2 ,GB.end_rid
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.end_rid12) AS end_rid12
                             ,SUM(C.end_rid11) AS end_rid11
                             ,SUM(C.end_rid10) AS end_rid10
                             ,SUM(C.end_rid9) AS end_rid9
                             ,SUM(C.end_rid8) AS end_rid8
                             ,SUM(C.end_rid7) AS end_rid7
                             ,SUM(C.end_rid6) AS end_rid6
                             ,SUM(C.end_rid5) AS end_rid5
                             ,SUM(C.end_rid4) AS end_rid4
                             ,SUM(C.end_rid3) AS end_rid3
                             ,SUM(C.end_rid2) AS end_rid2
                             ,SUM(C.end_rid) AS end_rid
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS SUIM_RPT_NO
		                             ,0 AS end_rid12
		                             ,0 AS end_rid11
		                             ,0 AS end_rid10
		                             ,0 AS end_rid9
		                             ,0 AS end_rid8
		                             ,0 AS end_rid7
		                             ,0 AS end_rid6
		                             ,0 AS end_rid5
		                             ,0 AS end_rid4
		                             ,0 AS end_rid3
		                             ,0 AS end_rid2
		                             ,0 AS end_rid
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS end_rid12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS end_rid11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS end_rid10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS end_rid9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS end_rid8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS end_rid7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS end_rid6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS end_rid5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS end_rid4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS end_rid3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS end_rid2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS end_rid
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                            <if test='primYN == "Y"'>
                              UNION ALL
                              SELECT  B.TEAM_ID
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS end_rid12
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS end_rid11
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS end_rid10
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS end_rid9
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS end_rid8
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS end_rid7
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS end_rid6
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS end_rid5
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS end_rid4
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS end_rid3
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS end_rid2
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS end_rid
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_TYPE1 = 5
                                 AND  B.SUIM_RPT_STATE = '2'
                                 AND  B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC           
	</select>	

	<select id="MisEndTmAssess1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_assess12, GB.price_assess11, GB.price_assess10, GB.price_assess9, GB.price_assess8, GB.price_assess7
			  ,GB.price_assess6, GB.price_assess5, GB.price_assess4, GB.price_assess3, GB.price_assess2, GB.price_assess
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_assess12 + C.price_assess12_PLUS - C.price_assess12_MINUS) AS price_assess12
                             ,SUM(C.price_assess11 + C.price_assess11_PLUS - C.price_assess11_MINUS) AS price_assess11
                             ,SUM(C.price_assess10 + C.price_assess10_PLUS - C.price_assess10_MINUS) AS price_assess10
                             ,SUM(C.price_assess9 + C.price_assess9_PLUS - C.price_assess9_MINUS) AS price_assess9
                             ,SUM(C.price_assess8 + C.price_assess8_PLUS - C.price_assess8_MINUS) AS price_assess8
                             ,SUM(C.price_assess7 + C.price_assess7_PLUS - C.price_assess7_MINUS) AS price_assess7
                             ,SUM(C.price_assess6 + C.price_assess6_PLUS - C.price_assess6_MINUS) AS price_assess6
                             ,SUM(C.price_assess5 + C.price_assess5_PLUS - C.price_assess5_MINUS) AS price_assess5
                             ,SUM(C.price_assess4 + C.price_assess4_PLUS - C.price_assess4_MINUS) AS price_assess4
                             ,SUM(C.price_assess3 + C.price_assess3_PLUS - C.price_assess3_MINUS) AS price_assess3
                             ,SUM(C.price_assess2 + C.price_assess2_PLUS - C.price_assess2_MINUS) AS price_assess2
                             ,SUM(C.price_assess + C.price_assess_PLUS - C.price_assess_MINUS) AS price_assess
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_assess12
		                             ,0 AS price_assess11
		                             ,0 AS price_assess10
		                             ,0 AS price_assess9
		                             ,0 AS price_assess8
		                             ,0 AS price_assess7
		                             ,0 AS price_assess6
		                             ,0 AS price_assess5
		                             ,0 AS price_assess4
		                             ,0 AS price_assess3
		                             ,0 AS price_assess2
		                             ,0 AS price_assess
							  		 
		                             ,0 AS price_assess12_PLUS
		                             ,0 AS price_assess11_PLUS
		                             ,0 AS price_assess10_PLUS
		                             ,0 AS price_assess9_PLUS
		                             ,0 AS price_assess8_PLUS
		                             ,0 AS price_assess7_PLUS
		                             ,0 AS price_assess6_PLUS
		                             ,0 AS price_assess5_PLUS
		                             ,0 AS price_assess4_PLUS
		                             ,0 AS price_assess3_PLUS
		                             ,0 AS price_assess2_PLUS
		                             ,0 AS price_assess_PLUS

		                             ,0 AS price_assess12_MINUS
		                             ,0 AS price_assess11_MINUS
		                             ,0 AS price_assess10_MINUS
		                             ,0 AS price_assess9_MINUS
		                             ,0 AS price_assess8_MINUS
		                             ,0 AS price_assess7_MINUS
		                             ,0 AS price_assess6_MINUS
		                             ,0 AS price_assess5_MINUS
		                             ,0 AS price_assess4_MINUS
		                             ,0 AS price_assess3_MINUS
		                             ,0 AS price_assess2_MINUS
		                             ,0 AS price_assess_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     
                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess -->
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     
                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_PLUS -->
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     
                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_MINUS -->
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID				           
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           <!-- AND  GA.TEAM_TYPE = 1 -->
           AND  GA.TEAM_TYPE IN (0,1)
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>
	
	<select id="MisEndTmAssess1_20230619" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_assess12, GB.price_assess11, GB.price_assess10, GB.price_assess9, GB.price_assess8, GB.price_assess7
			  ,GB.price_assess6, GB.price_assess5, GB.price_assess4, GB.price_assess3, GB.price_assess2, GB.price_assess
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_assess12 + C.price_assess12_PLUS - C.price_assess12_MINUS) AS price_assess12
                             ,SUM(C.price_assess11 + C.price_assess11_PLUS - C.price_assess11_MINUS) AS price_assess11
                             ,SUM(C.price_assess10 + C.price_assess10_PLUS - C.price_assess10_MINUS) AS price_assess10
                             ,SUM(C.price_assess9 + C.price_assess9_PLUS - C.price_assess9_MINUS) AS price_assess9
                             ,SUM(C.price_assess8 + C.price_assess8_PLUS - C.price_assess8_MINUS) AS price_assess8
                             ,SUM(C.price_assess7 + C.price_assess7_PLUS - C.price_assess7_MINUS) AS price_assess7
                             ,SUM(C.price_assess6 + C.price_assess6_PLUS - C.price_assess6_MINUS) AS price_assess6
                             ,SUM(C.price_assess5 + C.price_assess5_PLUS - C.price_assess5_MINUS) AS price_assess5
                             ,SUM(C.price_assess4 + C.price_assess4_PLUS - C.price_assess4_MINUS) AS price_assess4
                             ,SUM(C.price_assess3 + C.price_assess3_PLUS - C.price_assess3_MINUS) AS price_assess3
                             ,SUM(C.price_assess2 + C.price_assess2_PLUS - C.price_assess2_MINUS) AS price_assess2
                             ,SUM(C.price_assess + C.price_assess_PLUS - C.price_assess_MINUS) AS price_assess
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_assess12
		                             ,0 AS price_assess11
		                             ,0 AS price_assess10
		                             ,0 AS price_assess9
		                             ,0 AS price_assess8
		                             ,0 AS price_assess7
		                             ,0 AS price_assess6
		                             ,0 AS price_assess5
		                             ,0 AS price_assess4
		                             ,0 AS price_assess3
		                             ,0 AS price_assess2
		                             ,0 AS price_assess
							  		 
		                             ,0 AS price_assess12_PLUS
		                             ,0 AS price_assess11_PLUS
		                             ,0 AS price_assess10_PLUS
		                             ,0 AS price_assess9_PLUS
		                             ,0 AS price_assess8_PLUS
		                             ,0 AS price_assess7_PLUS
		                             ,0 AS price_assess6_PLUS
		                             ,0 AS price_assess5_PLUS
		                             ,0 AS price_assess4_PLUS
		                             ,0 AS price_assess3_PLUS
		                             ,0 AS price_assess2_PLUS
		                             ,0 AS price_assess_PLUS

		                             ,0 AS price_assess12_MINUS
		                             ,0 AS price_assess11_MINUS
		                             ,0 AS price_assess10_MINUS
		                             ,0 AS price_assess9_MINUS
		                             ,0 AS price_assess8_MINUS
		                             ,0 AS price_assess7_MINUS
		                             ,0 AS price_assess6_MINUS
		                             ,0 AS price_assess5_MINUS
		                             ,0 AS price_assess4_MINUS
		                             ,0 AS price_assess3_MINUS
		                             ,0 AS price_assess2_MINUS
		                             ,0 AS price_assess_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID				           
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 1
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>

	<select id="MisEndTmAssess4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_assess12, GB.price_assess11, GB.price_assess10, GB.price_assess9, GB.price_assess8, GB.price_assess7
			  ,GB.price_assess6, GB.price_assess5, GB.price_assess4, GB.price_assess3, GB.price_assess2, GB.price_assess
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_assess12 + C.price_assess12_PLUS - C.price_assess12_MINUS) AS price_assess12
                             ,SUM(C.price_assess11 + C.price_assess11_PLUS - C.price_assess11_MINUS) AS price_assess11
                             ,SUM(C.price_assess10 + C.price_assess10_PLUS - C.price_assess10_MINUS) AS price_assess10
                             ,SUM(C.price_assess9 + C.price_assess9_PLUS - C.price_assess9_MINUS) AS price_assess9
                             ,SUM(C.price_assess8 + C.price_assess8_PLUS - C.price_assess8_MINUS) AS price_assess8
                             ,SUM(C.price_assess7 + C.price_assess7_PLUS - C.price_assess7_MINUS) AS price_assess7
                             ,SUM(C.price_assess6 + C.price_assess6_PLUS - C.price_assess6_MINUS) AS price_assess6
                             ,SUM(C.price_assess5 + C.price_assess5_PLUS - C.price_assess5_MINUS) AS price_assess5
                             ,SUM(C.price_assess4 + C.price_assess4_PLUS - C.price_assess4_MINUS) AS price_assess4
                             ,SUM(C.price_assess3 + C.price_assess3_PLUS - C.price_assess3_MINUS) AS price_assess3
                             ,SUM(C.price_assess2 + C.price_assess2_PLUS - C.price_assess2_MINUS) AS price_assess2
                             ,SUM(C.price_assess + C.price_assess_PLUS - C.price_assess_MINUS) AS price_assess
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_assess12
		                             ,0 AS price_assess11
		                             ,0 AS price_assess10
		                             ,0 AS price_assess9
		                             ,0 AS price_assess8
		                             ,0 AS price_assess7
		                             ,0 AS price_assess6
		                             ,0 AS price_assess5
		                             ,0 AS price_assess4
		                             ,0 AS price_assess3
		                             ,0 AS price_assess2
		                             ,0 AS price_assess
							  		 
		                             ,0 AS price_assess12_PLUS
		                             ,0 AS price_assess11_PLUS
		                             ,0 AS price_assess10_PLUS
		                             ,0 AS price_assess9_PLUS
		                             ,0 AS price_assess8_PLUS
		                             ,0 AS price_assess7_PLUS
		                             ,0 AS price_assess6_PLUS
		                             ,0 AS price_assess5_PLUS
		                             ,0 AS price_assess4_PLUS
		                             ,0 AS price_assess3_PLUS
		                             ,0 AS price_assess2_PLUS
		                             ,0 AS price_assess_PLUS

		                             ,0 AS price_assess12_MINUS
		                             ,0 AS price_assess11_MINUS
		                             ,0 AS price_assess10_MINUS
		                             ,0 AS price_assess9_MINUS
		                             ,0 AS price_assess8_MINUS
		                             ,0 AS price_assess7_MINUS
		                             ,0 AS price_assess6_MINUS
		                             ,0 AS price_assess5_MINUS
		                             ,0 AS price_assess4_MINUS
		                             ,0 AS price_assess3_MINUS
		                             ,0 AS price_assess2_MINUS
		                             ,0 AS price_assess_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_assess_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID				           
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 		
	</select>


	<select id="MisEndTmTime1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_time12, GB.price_time11, GB.price_time10, GB.price_time9, GB.price_time8, GB.price_time7
			  ,GB.price_time6, GB.price_time5, GB.price_time4, GB.price_time3, GB.price_time2, GB.price_time
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_time12 + C.price_time12_PLUS - C.price_time12_MINUS) AS price_time12
                             ,SUM(C.price_time11 + C.price_time11_PLUS - C.price_time11_MINUS) AS price_time11
                             ,SUM(C.price_time10 + C.price_time10_PLUS - C.price_time10_MINUS) AS price_time10
                             ,SUM(C.price_time9 + C.price_time9_PLUS - C.price_time9_MINUS) AS price_time9
                             ,SUM(C.price_time8 + C.price_time8_PLUS - C.price_time8_MINUS) AS price_time8
                             ,SUM(C.price_time7 + C.price_time7_PLUS - C.price_time7_MINUS) AS price_time7
                             ,SUM(C.price_time6 + C.price_time6_PLUS - C.price_time6_MINUS) AS price_time6
                             ,SUM(C.price_time5 + C.price_time5_PLUS - C.price_time5_MINUS) AS price_time5
                             ,SUM(C.price_time4 + C.price_time4_PLUS - C.price_time4_MINUS) AS price_time4
                             ,SUM(C.price_time3 + C.price_time3_PLUS - C.price_time3_MINUS) AS price_time3
                             ,SUM(C.price_time2 + C.price_time2_PLUS - C.price_time2_MINUS) AS price_time2
                             ,SUM(C.price_time + C.price_time_PLUS - C.price_time_MINUS) AS price_time
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_time12
		                             ,0 AS price_time11
		                             ,0 AS price_time10
		                             ,0 AS price_time9
		                             ,0 AS price_time8
		                             ,0 AS price_time7
		                             ,0 AS price_time6
		                             ,0 AS price_time5
		                             ,0 AS price_time4
		                             ,0 AS price_time3
		                             ,0 AS price_time2
		                             ,0 AS price_time
							  		 
		                             ,0 AS price_time12_PLUS
		                             ,0 AS price_time11_PLUS
		                             ,0 AS price_time10_PLUS
		                             ,0 AS price_time9_PLUS
		                             ,0 AS price_time8_PLUS
		                             ,0 AS price_time7_PLUS
		                             ,0 AS price_time6_PLUS
		                             ,0 AS price_time5_PLUS
		                             ,0 AS price_time4_PLUS
		                             ,0 AS price_time3_PLUS
		                             ,0 AS price_time2_PLUS
		                             ,0 AS price_time_PLUS

		                             ,0 AS price_time12_MINUS
		                             ,0 AS price_time11_MINUS
		                             ,0 AS price_time10_MINUS
		                             ,0 AS price_time9_MINUS
		                             ,0 AS price_time8_MINUS
		                             ,0 AS price_time7_MINUS
		                             ,0 AS price_time6_MINUS
		                             ,0 AS price_time5_MINUS
		                             ,0 AS price_time4_MINUS
		                             ,0 AS price_time3_MINUS
		                             ,0 AS price_time2_MINUS
		                             ,0 AS price_time_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID				           
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           <!-- AND  GA.TEAM_TYPE = 1 -->
           AND  GA.TEAM_TYPE IN (0,1)
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>

	<select id="MisEndTmTime4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_time12, GB.price_time11, GB.price_time10, GB.price_time9, GB.price_time8, GB.price_time7
			  ,GB.price_time6, GB.price_time5, GB.price_time4, GB.price_time3, GB.price_time2, GB.price_time
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_time12 + C.price_time12_PLUS - C.price_time12_MINUS) AS price_time12
                             ,SUM(C.price_time11 + C.price_time11_PLUS - C.price_time11_MINUS) AS price_time11
                             ,SUM(C.price_time10 + C.price_time10_PLUS - C.price_time10_MINUS) AS price_time10
                             ,SUM(C.price_time9 + C.price_time9_PLUS - C.price_time9_MINUS) AS price_time9
                             ,SUM(C.price_time8 + C.price_time8_PLUS - C.price_time8_MINUS) AS price_time8
                             ,SUM(C.price_time7 + C.price_time7_PLUS - C.price_time7_MINUS) AS price_time7
                             ,SUM(C.price_time6 + C.price_time6_PLUS - C.price_time6_MINUS) AS price_time6
                             ,SUM(C.price_time5 + C.price_time5_PLUS - C.price_time5_MINUS) AS price_time5
                             ,SUM(C.price_time4 + C.price_time4_PLUS - C.price_time4_MINUS) AS price_time4
                             ,SUM(C.price_time3 + C.price_time3_PLUS - C.price_time3_MINUS) AS price_time3
                             ,SUM(C.price_time2 + C.price_time2_PLUS - C.price_time2_MINUS) AS price_time2
                             ,SUM(C.price_time + C.price_time_PLUS - C.price_time_MINUS) AS price_time
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_time12
		                             ,0 AS price_time11
		                             ,0 AS price_time10
		                             ,0 AS price_time9
		                             ,0 AS price_time8
		                             ,0 AS price_time7
		                             ,0 AS price_time6
		                             ,0 AS price_time5
		                             ,0 AS price_time4
		                             ,0 AS price_time3
		                             ,0 AS price_time2
		                             ,0 AS price_time
							  		 
		                             ,0 AS price_time12_PLUS
		                             ,0 AS price_time11_PLUS
		                             ,0 AS price_time10_PLUS
		                             ,0 AS price_time9_PLUS
		                             ,0 AS price_time8_PLUS
		                             ,0 AS price_time7_PLUS
		                             ,0 AS price_time6_PLUS
		                             ,0 AS price_time5_PLUS
		                             ,0 AS price_time4_PLUS
		                             ,0 AS price_time3_PLUS
		                             ,0 AS price_time2_PLUS
		                             ,0 AS price_time_PLUS

		                             ,0 AS price_time12_MINUS
		                             ,0 AS price_time11_MINUS
		                             ,0 AS price_time10_MINUS
		                             ,0 AS price_time9_MINUS
		                             ,0 AS price_time8_MINUS
		                             ,0 AS price_time7_MINUS
		                             ,0 AS price_time6_MINUS
		                             ,0 AS price_time5_MINUS
		                             ,0 AS price_time4_MINUS
		                             ,0 AS price_time3_MINUS
		                             ,0 AS price_time2_MINUS
		                             ,0 AS price_time_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>


	<select id="MisEndTmTraffic1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_traffic12, GB.price_traffic11, GB.price_traffic10, GB.price_traffic9, GB.price_traffic8, GB.price_traffic7
			  ,GB.price_traffic6, GB.price_traffic5, GB.price_traffic4, GB.price_traffic3, GB.price_traffic2, GB.price_traffic
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_traffic12 + C.price_traffic12_PLUS - C.price_traffic12_MINUS) AS price_traffic12
                             ,SUM(C.price_traffic11 + C.price_traffic11_PLUS - C.price_traffic11_MINUS) AS price_traffic11
                             ,SUM(C.price_traffic10 + C.price_traffic10_PLUS - C.price_traffic10_MINUS) AS price_traffic10
                             ,SUM(C.price_traffic9 + C.price_traffic9_PLUS - C.price_traffic9_MINUS) AS price_traffic9
                             ,SUM(C.price_traffic8 + C.price_traffic8_PLUS - C.price_traffic8_MINUS) AS price_traffic8
                             ,SUM(C.price_traffic7 + C.price_traffic7_PLUS - C.price_traffic7_MINUS) AS price_traffic7
                             ,SUM(C.price_traffic6 + C.price_traffic6_PLUS - C.price_traffic6_MINUS) AS price_traffic6
                             ,SUM(C.price_traffic5 + C.price_traffic5_PLUS - C.price_traffic5_MINUS) AS price_traffic5
                             ,SUM(C.price_traffic4 + C.price_traffic4_PLUS - C.price_traffic4_MINUS) AS price_traffic4
                             ,SUM(C.price_traffic3 + C.price_traffic3_PLUS - C.price_traffic3_MINUS) AS price_traffic3
                             ,SUM(C.price_traffic2 + C.price_traffic2_PLUS - C.price_traffic2_MINUS) AS price_traffic2
                             ,SUM(C.price_traffic + C.price_traffic_PLUS - C.price_traffic_MINUS) AS price_traffic
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_traffic12
		                             ,0 AS price_traffic11
		                             ,0 AS price_traffic10
		                             ,0 AS price_traffic9
		                             ,0 AS price_traffic8
		                             ,0 AS price_traffic7
		                             ,0 AS price_traffic6
		                             ,0 AS price_traffic5
		                             ,0 AS price_traffic4
		                             ,0 AS price_traffic3
		                             ,0 AS price_traffic2
		                             ,0 AS price_traffic
							  		 
		                             ,0 AS price_traffic12_PLUS
		                             ,0 AS price_traffic11_PLUS
		                             ,0 AS price_traffic10_PLUS
		                             ,0 AS price_traffic9_PLUS
		                             ,0 AS price_traffic8_PLUS
		                             ,0 AS price_traffic7_PLUS
		                             ,0 AS price_traffic6_PLUS
		                             ,0 AS price_traffic5_PLUS
		                             ,0 AS price_traffic4_PLUS
		                             ,0 AS price_traffic3_PLUS
		                             ,0 AS price_traffic2_PLUS
		                             ,0 AS price_traffic_PLUS

		                             ,0 AS price_traffic12_MINUS
		                             ,0 AS price_traffic11_MINUS
		                             ,0 AS price_traffic10_MINUS
		                             ,0 AS price_traffic9_MINUS
		                             ,0 AS price_traffic8_MINUS
		                             ,0 AS price_traffic7_MINUS
		                             ,0 AS price_traffic6_MINUS
		                             ,0 AS price_traffic5_MINUS
		                             ,0 AS price_traffic4_MINUS
		                             ,0 AS price_traffic3_MINUS
		                             ,0 AS price_traffic2_MINUS
		                             ,0 AS price_traffic_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID				           
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           <!-- AND  GA.TEAM_TYPE = 1 -->
           AND  GA.TEAM_TYPE IN (0,1)
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>


	<select id="MisEndTmTraffic4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_traffic12, GB.price_traffic11, GB.price_traffic10, GB.price_traffic9, GB.price_traffic8, GB.price_traffic7
			  ,GB.price_traffic6, GB.price_traffic5, GB.price_traffic4, GB.price_traffic3, GB.price_traffic2, GB.price_traffic
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_traffic12 + C.price_traffic12_PLUS - C.price_traffic12_MINUS) AS price_traffic12
                             ,SUM(C.price_traffic11 + C.price_traffic11_PLUS - C.price_traffic11_MINUS) AS price_traffic11
                             ,SUM(C.price_traffic10 + C.price_traffic10_PLUS - C.price_traffic10_MINUS) AS price_traffic10
                             ,SUM(C.price_traffic9 + C.price_traffic9_PLUS - C.price_traffic9_MINUS) AS price_traffic9
                             ,SUM(C.price_traffic8 + C.price_traffic8_PLUS - C.price_traffic8_MINUS) AS price_traffic8
                             ,SUM(C.price_traffic7 + C.price_traffic7_PLUS - C.price_traffic7_MINUS) AS price_traffic7
                             ,SUM(C.price_traffic6 + C.price_traffic6_PLUS - C.price_traffic6_MINUS) AS price_traffic6
                             ,SUM(C.price_traffic5 + C.price_traffic5_PLUS - C.price_traffic5_MINUS) AS price_traffic5
                             ,SUM(C.price_traffic4 + C.price_traffic4_PLUS - C.price_traffic4_MINUS) AS price_traffic4
                             ,SUM(C.price_traffic3 + C.price_traffic3_PLUS - C.price_traffic3_MINUS) AS price_traffic3
                             ,SUM(C.price_traffic2 + C.price_traffic2_PLUS - C.price_traffic2_MINUS) AS price_traffic2
                             ,SUM(C.price_traffic + C.price_traffic_PLUS - C.price_traffic_MINUS) AS price_traffic
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_traffic12
		                             ,0 AS price_traffic11
		                             ,0 AS price_traffic10
		                             ,0 AS price_traffic9
		                             ,0 AS price_traffic8
		                             ,0 AS price_traffic7
		                             ,0 AS price_traffic6
		                             ,0 AS price_traffic5
		                             ,0 AS price_traffic4
		                             ,0 AS price_traffic3
		                             ,0 AS price_traffic2
		                             ,0 AS price_traffic
							  		 
		                             ,0 AS price_traffic12_PLUS
		                             ,0 AS price_traffic11_PLUS
		                             ,0 AS price_traffic10_PLUS
		                             ,0 AS price_traffic9_PLUS
		                             ,0 AS price_traffic8_PLUS
		                             ,0 AS price_traffic7_PLUS
		                             ,0 AS price_traffic6_PLUS
		                             ,0 AS price_traffic5_PLUS
		                             ,0 AS price_traffic4_PLUS
		                             ,0 AS price_traffic3_PLUS
		                             ,0 AS price_traffic2_PLUS
		                             ,0 AS price_traffic_PLUS

		                             ,0 AS price_traffic12_MINUS
		                             ,0 AS price_traffic11_MINUS
		                             ,0 AS price_traffic10_MINUS
		                             ,0 AS price_traffic9_MINUS
		                             ,0 AS price_traffic8_MINUS
		                             ,0 AS price_traffic7_MINUS
		                             ,0 AS price_traffic6_MINUS
		                             ,0 AS price_traffic5_MINUS
		                             ,0 AS price_traffic4_MINUS
		                             ,0 AS price_traffic3_MINUS
		                             ,0 AS price_traffic2_MINUS
		                             ,0 AS price_traffic_MINUS		                             		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>

	<select id="MisEndTmQr1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_qr12, GB.price_qr11, GB.price_qr10, GB.price_qr9, GB.price_qr8, GB.price_qr7
			  ,GB.price_qr6, GB.price_qr5, GB.price_qr4, GB.price_qr3, GB.price_qr2, GB.price_qr
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_qr12 + C.price_qr12_PLUS - C.price_qr12_MINUS) AS price_qr12
                             ,SUM(C.price_qr11 + C.price_qr11_PLUS - C.price_qr11_MINUS) AS price_qr11
                             ,SUM(C.price_qr10 + C.price_qr10_PLUS - C.price_qr10_MINUS) AS price_qr10
                             ,SUM(C.price_qr9 + C.price_qr9_PLUS - C.price_qr9_MINUS) AS price_qr9
                             ,SUM(C.price_qr8 + C.price_qr8_PLUS - C.price_qr8_MINUS) AS price_qr8
                             ,SUM(C.price_qr7 + C.price_qr7_PLUS - C.price_qr7_MINUS) AS price_qr7
                             ,SUM(C.price_qr6 + C.price_qr6_PLUS - C.price_qr6_MINUS) AS price_qr6
                             ,SUM(C.price_qr5 + C.price_qr5_PLUS - C.price_qr5_MINUS) AS price_qr5
                             ,SUM(C.price_qr4 + C.price_qr4_PLUS - C.price_qr4_MINUS) AS price_qr4
                             ,SUM(C.price_qr3 + C.price_qr3_PLUS - C.price_qr3_MINUS) AS price_qr3
                             ,SUM(C.price_qr2 + C.price_qr2_PLUS - C.price_qr2_MINUS) AS price_qr2
                             ,SUM(C.price_qr + C.price_qr_PLUS - C.price_qr_MINUS) AS price_qr
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_qr12
		                             ,0 AS price_qr11
		                             ,0 AS price_qr10
		                             ,0 AS price_qr9
		                             ,0 AS price_qr8
		                             ,0 AS price_qr7
		                             ,0 AS price_qr6
		                             ,0 AS price_qr5
		                             ,0 AS price_qr4
		                             ,0 AS price_qr3
		                             ,0 AS price_qr2
		                             ,0 AS price_qr
							  		 
		                             ,0 AS price_qr12_PLUS
		                             ,0 AS price_qr11_PLUS
		                             ,0 AS price_qr10_PLUS
		                             ,0 AS price_qr9_PLUS
		                             ,0 AS price_qr8_PLUS
		                             ,0 AS price_qr7_PLUS
		                             ,0 AS price_qr6_PLUS
		                             ,0 AS price_qr5_PLUS
		                             ,0 AS price_qr4_PLUS
		                             ,0 AS price_qr3_PLUS
		                             ,0 AS price_qr2_PLUS
		                             ,0 AS price_qr_PLUS

		                             ,0 AS price_qr12_MINUS
		                             ,0 AS price_qr11_MINUS
		                             ,0 AS price_qr10_MINUS
		                             ,0 AS price_qr9_MINUS
		                             ,0 AS price_qr8_MINUS
		                             ,0 AS price_qr7_MINUS
		                             ,0 AS price_qr6_MINUS
		                             ,0 AS price_qr5_MINUS
		                             ,0 AS price_qr4_MINUS
		                             ,0 AS price_qr3_MINUS
		                             ,0 AS price_qr2_MINUS
		                             ,0 AS price_qr_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_COUNSEL  + B.AMT_ETC) ELSE 0 END AS price_qr9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           <!-- AND  GA.TEAM_TYPE = 1 -->
           AND  GA.TEAM_TYPE IN (0,1)
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>


	<select id="MisEndTmQr4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_qr12, GB.price_qr11, GB.price_qr10, GB.price_qr9, GB.price_qr8, GB.price_qr7
			  ,GB.price_qr6, GB.price_qr5, GB.price_qr4, GB.price_qr3, GB.price_qr2, GB.price_qr
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_qr12 + C.price_qr12_PLUS - C.price_qr12_MINUS) AS price_qr12
                             ,SUM(C.price_qr11 + C.price_qr11_PLUS - C.price_qr11_MINUS) AS price_qr11
                             ,SUM(C.price_qr10 + C.price_qr10_PLUS - C.price_qr10_MINUS) AS price_qr10
                             ,SUM(C.price_qr9 + C.price_qr9_PLUS - C.price_qr9_MINUS) AS price_qr9
                             ,SUM(C.price_qr8 + C.price_qr8_PLUS - C.price_qr8_MINUS) AS price_qr8
                             ,SUM(C.price_qr7 + C.price_qr7_PLUS - C.price_qr7_MINUS) AS price_qr7
                             ,SUM(C.price_qr6 + C.price_qr6_PLUS - C.price_qr6_MINUS) AS price_qr6
                             ,SUM(C.price_qr5 + C.price_qr5_PLUS - C.price_qr5_MINUS) AS price_qr5
                             ,SUM(C.price_qr4 + C.price_qr4_PLUS - C.price_qr4_MINUS) AS price_qr4
                             ,SUM(C.price_qr3 + C.price_qr3_PLUS - C.price_qr3_MINUS) AS price_qr3
                             ,SUM(C.price_qr2 + C.price_qr2_PLUS - C.price_qr2_MINUS) AS price_qr2
                             ,SUM(C.price_qr + C.price_qr_PLUS - C.price_qr_MINUS) AS price_qr
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_qr12
		                             ,0 AS price_qr11
		                             ,0 AS price_qr10
		                             ,0 AS price_qr9
		                             ,0 AS price_qr8
		                             ,0 AS price_qr7
		                             ,0 AS price_qr6
		                             ,0 AS price_qr5
		                             ,0 AS price_qr4
		                             ,0 AS price_qr3
		                             ,0 AS price_qr2
		                             ,0 AS price_qr
							  		 
		                             ,0 AS price_qr12_PLUS
		                             ,0 AS price_qr11_PLUS
		                             ,0 AS price_qr10_PLUS
		                             ,0 AS price_qr9_PLUS
		                             ,0 AS price_qr8_PLUS
		                             ,0 AS price_qr7_PLUS
		                             ,0 AS price_qr6_PLUS
		                             ,0 AS price_qr5_PLUS
		                             ,0 AS price_qr4_PLUS
		                             ,0 AS price_qr3_PLUS
		                             ,0 AS price_qr2_PLUS
		                             ,0 AS price_qr_PLUS

		                             ,0 AS price_qr12_MINUS
		                             ,0 AS price_qr11_MINUS
		                             ,0 AS price_qr10_MINUS
		                             ,0 AS price_qr9_MINUS
		                             ,0 AS price_qr8_MINUS
		                             ,0 AS price_qr7_MINUS
		                             ,0 AS price_qr6_MINUS
		                             ,0 AS price_qr5_MINUS
		                             ,0 AS price_qr4_MINUS
		                             ,0 AS price_qr3_MINUS
		                             ,0 AS price_qr2_MINUS
		                             ,0 AS price_qr_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_COUNSEL  + B.AMT_ETC) ELSE 0 END AS price_qr9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>


	<select id="MisEndTmTotal1" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_total12, GB.price_total11, GB.price_total10, GB.price_total9, GB.price_total8, GB.price_total7
			  ,GB.price_total6, GB.price_total5, GB.price_total4, GB.price_total3, GB.price_total2, GB.price_total
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_total12 + C.price_total12_PLUS - C.price_total12_MINUS) AS price_total12
                             ,SUM(C.price_total11 + C.price_total11_PLUS - C.price_total11_MINUS) AS price_total11
                             ,SUM(C.price_total10 + C.price_total10_PLUS - C.price_total10_MINUS) AS price_total10
                             ,SUM(C.price_total9 + C.price_total9_PLUS - C.price_total9_MINUS) AS price_total9
                             ,SUM(C.price_total8 + C.price_total8_PLUS - C.price_total8_MINUS) AS price_total8
                             ,SUM(C.price_total7 + C.price_total7_PLUS - C.price_total7_MINUS) AS price_total7
                             ,SUM(C.price_total6 + C.price_total6_PLUS - C.price_total6_MINUS) AS price_total6
                             ,SUM(C.price_total5 + C.price_total5_PLUS - C.price_total5_MINUS) AS price_total5
                             ,SUM(C.price_total4 + C.price_total4_PLUS - C.price_total4_MINUS) AS price_total4
                             ,SUM(C.price_total3 + C.price_total3_PLUS - C.price_total3_MINUS) AS price_total3
                             ,SUM(C.price_total2 + C.price_total2_PLUS - C.price_total2_MINUS) AS price_total2
                             ,SUM(C.price_total + C.price_total_PLUS - C.price_total_MINUS) AS price_total
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_total12
		                             ,0 AS price_total11
		                             ,0 AS price_total10
		                             ,0 AS price_total9
		                             ,0 AS price_total8
		                             ,0 AS price_total7
		                             ,0 AS price_total6
		                             ,0 AS price_total5
		                             ,0 AS price_total4
		                             ,0 AS price_total3
		                             ,0 AS price_total2
		                             ,0 AS price_total
							  		 
		                             ,0 AS price_total12_PLUS
		                             ,0 AS price_total11_PLUS
		                             ,0 AS price_total10_PLUS
		                             ,0 AS price_total9_PLUS
		                             ,0 AS price_total8_PLUS
		                             ,0 AS price_total7_PLUS
		                             ,0 AS price_total6_PLUS
		                             ,0 AS price_total5_PLUS
		                             ,0 AS price_total4_PLUS
		                             ,0 AS price_total3_PLUS
		                             ,0 AS price_total2_PLUS
		                             ,0 AS price_total_PLUS

		                             ,0 AS price_total12_MINUS
		                             ,0 AS price_total11_MINUS
		                             ,0 AS price_total10_MINUS
		                             ,0 AS price_total9_MINUS
		                             ,0 AS price_total8_MINUS
		                             ,0 AS price_total7_MINUS
		                             ,0 AS price_total6_MINUS
		                             ,0 AS price_total5_MINUS
		                             ,0 AS price_total4_MINUS
		                             ,0 AS price_total3_MINUS
		                             ,0 AS price_total2_MINUS
		                             ,0 AS price_total_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_PLUS -->
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_PLUS                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_MINUS -->
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_MINUS                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID			                               
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           <!-- AND  GA.TEAM_TYPE = 1 -->
           AND  GA.TEAM_TYPE IN (0,1)
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>

	<select id="MisEndTmTotal1_20201217" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_total12, GB.price_total11, GB.price_total10, GB.price_total9, GB.price_total8, GB.price_total7
			  ,GB.price_total6, GB.price_total5, GB.price_total4, GB.price_total3, GB.price_total2, GB.price_total
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_total12 + C.price_total12_PLUS - C.price_total12_MINUS) AS price_total12
                             ,SUM(C.price_total11 + C.price_total11_PLUS - C.price_total11_MINUS) AS price_total11
                             ,SUM(C.price_total10 + C.price_total10_PLUS - C.price_total10_MINUS) AS price_total10
                             ,SUM(C.price_total9 + C.price_total9_PLUS - C.price_total9_MINUS) AS price_total9
                             ,SUM(C.price_total8 + C.price_total8_PLUS - C.price_total8_MINUS) AS price_total8
                             ,SUM(C.price_total7 + C.price_total7_PLUS - C.price_total7_MINUS) AS price_total7
                             ,SUM(C.price_total6 + C.price_total6_PLUS - C.price_total6_MINUS) AS price_total6
                             ,SUM(C.price_total5 + C.price_total5_PLUS - C.price_total5_MINUS) AS price_total5
                             ,SUM(C.price_total4 + C.price_total4_PLUS - C.price_total4_MINUS) AS price_total4
                             ,SUM(C.price_total3 + C.price_total3_PLUS - C.price_total3_MINUS) AS price_total3
                             ,SUM(C.price_total2 + C.price_total2_PLUS - C.price_total2_MINUS) AS price_total2
                             ,SUM(C.price_total + C.price_total_PLUS - C.price_total_MINUS) AS price_total
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_total12
		                             ,0 AS price_total11
		                             ,0 AS price_total10
		                             ,0 AS price_total9
		                             ,0 AS price_total8
		                             ,0 AS price_total7
		                             ,0 AS price_total6
		                             ,0 AS price_total5
		                             ,0 AS price_total4
		                             ,0 AS price_total3
		                             ,0 AS price_total2
		                             ,0 AS price_total
							  		 
		                             ,0 AS price_total12_PLUS
		                             ,0 AS price_total11_PLUS
		                             ,0 AS price_total10_PLUS
		                             ,0 AS price_total9_PLUS
		                             ,0 AS price_total8_PLUS
		                             ,0 AS price_total7_PLUS
		                             ,0 AS price_total6_PLUS
		                             ,0 AS price_total5_PLUS
		                             ,0 AS price_total4_PLUS
		                             ,0 AS price_total3_PLUS
		                             ,0 AS price_total2_PLUS
		                             ,0 AS price_total_PLUS

		                             ,0 AS price_total12_MINUS
		                             ,0 AS price_total11_MINUS
		                             ,0 AS price_total10_MINUS
		                             ,0 AS price_total9_MINUS
		                             ,0 AS price_total8_MINUS
		                             ,0 AS price_total7_MINUS
		                             ,0 AS price_total6_MINUS
		                             ,0 AS price_total5_MINUS
		                             ,0 AS price_total4_MINUS
		                             ,0 AS price_total3_MINUS
		                             ,0 AS price_total2_MINUS
		                             ,0 AS price_total_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 NOT IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_NO = B.SUIM_RPT_NO
					             AND  B.SUIM_RPT_NO = C.SUIM_RPT_NO
					             AND  A.SUIM_RPT_TYPE1 NOT IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID			                               
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 1
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>


	<select id="MisEndTmTotal4" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT GA.team_id
              ,getTopTmBscCenterName(GA.team_id) center_name		
			  ,GA.team_name
              ,GA.team_type			  
			  ,GB.price_total12, GB.price_total11, GB.price_total10, GB.price_total9, GB.price_total8, GB.price_total7
			  ,GB.price_total6, GB.price_total5, GB.price_total4, GB.price_total3, GB.price_total2, GB.price_total
          FROM  top_tm_bsc GA
          LEFT  JOIN (
                      SELECT  C.TEAM_ID
                             ,SUM(C.price_total12 + C.price_total12_PLUS - C.price_total12_MINUS) AS price_total12
                             ,SUM(C.price_total11 + C.price_total11_PLUS - C.price_total11_MINUS) AS price_total11
                             ,SUM(C.price_total10 + C.price_total10_PLUS - C.price_total10_MINUS) AS price_total10
                             ,SUM(C.price_total9 + C.price_total9_PLUS - C.price_total9_MINUS) AS price_total9
                             ,SUM(C.price_total8 + C.price_total8_PLUS - C.price_total8_MINUS) AS price_total8
                             ,SUM(C.price_total7 + C.price_total7_PLUS - C.price_total7_MINUS) AS price_total7
                             ,SUM(C.price_total6 + C.price_total6_PLUS - C.price_total6_MINUS) AS price_total6
                             ,SUM(C.price_total5 + C.price_total5_PLUS - C.price_total5_MINUS) AS price_total5
                             ,SUM(C.price_total4 + C.price_total4_PLUS - C.price_total4_MINUS) AS price_total4
                             ,SUM(C.price_total3 + C.price_total3_PLUS - C.price_total3_MINUS) AS price_total3
                             ,SUM(C.price_total2 + C.price_total2_PLUS - C.price_total2_MINUS) AS price_total2
                             ,SUM(C.price_total + C.price_total_PLUS - C.price_total_MINUS) AS price_total
                        FROM  (
							  SELECT  0 AS TEAM_ID
							  		 ,0 AS USER_NO
							  		 
		                             ,0 AS price_total12
		                             ,0 AS price_total11
		                             ,0 AS price_total10
		                             ,0 AS price_total9
		                             ,0 AS price_total8
		                             ,0 AS price_total7
		                             ,0 AS price_total6
		                             ,0 AS price_total5
		                             ,0 AS price_total4
		                             ,0 AS price_total3
		                             ,0 AS price_total2
		                             ,0 AS price_total
							  		 
		                             ,0 AS price_total12_PLUS
		                             ,0 AS price_total11_PLUS
		                             ,0 AS price_total10_PLUS
		                             ,0 AS price_total9_PLUS
		                             ,0 AS price_total8_PLUS
		                             ,0 AS price_total7_PLUS
		                             ,0 AS price_total6_PLUS
		                             ,0 AS price_total5_PLUS
		                             ,0 AS price_total4_PLUS
		                             ,0 AS price_total3_PLUS
		                             ,0 AS price_total2_PLUS
		                             ,0 AS price_total_PLUS

		                             ,0 AS price_total12_MINUS
		                             ,0 AS price_total11_MINUS
		                             ,0 AS price_total10_MINUS
		                             ,0 AS price_total9_MINUS
		                             ,0 AS price_total8_MINUS
		                             ,0 AS price_total7_MINUS
		                             ,0 AS price_total6_MINUS
		                             ,0 AS price_total5_MINUS
		                             ,0 AS price_total4_MINUS
		                             ,0 AS price_total3_MINUS
		                             ,0 AS price_total2_MINUS
		                             ,0 AS price_total_MINUS		                             		                             
		                             
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != '3'
                                 AND  A.SUIM_RPT_TYPE1 IN( 3, 4 )
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP) ELSE 0 END AS price_total_MINUS
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_TYPE1 IN(3, 4)						            
					             AND  A.SUIM_RPT_STATE != 3
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	                               
							</if>
							
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE != 3
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.TEAM_ID
		          			   UNION ALL                        
                              SELECT  B.SHARE_TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_TEAM_ID		
		          			   UNION ALL                        
                              SELECT  A.TEAM_ID 
                                     ,A.USER_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.TEAM_ID	
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.team_id  
                     ) GB
            ON  GA.TEAM_ID = GB.TEAM_ID  
         WHERE  1=1
           AND  GA.TEAM_TYPE = 4
           AND  GA.TEAM_STATISTICS1 = 0 
         ORDER BY GA.TEAM_GROUP_ORDER DESC, GA.TEAM_ORDER DESC 			  
	</select>
	
	<select id="chkWrittenTeam" parameterType="String" resultType="String">
		SELECT team_written
		FROM top_tm_bsc 
		WHERE team_id = #{team_id}
	</select>
	
	<select id="MisEndWrittenTmMbr" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT
			GA.user_no
			,SUM(GA.end_rid12) end_rid12
			,SUM(GA.end_rid11) end_rid11
			,SUM(GA.end_rid10) end_rid10
			,SUM(GA.end_rid9) end_rid9
			,SUM(GA.end_rid8) end_rid8
			,SUM(GA.end_rid7) end_rid7
			,SUM(GA.end_rid6) end_rid6
			,SUM(GA.end_rid5) end_rid5
			,SUM(GA.end_rid4) end_rid4
			,SUM(GA.end_rid3) end_rid3
			,SUM(GA.end_rid2) end_rid2
			,SUM(GA.end_rid) end_rid
		FROM
			(
		
			SELECT
				#{user_no} as user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM DUAL
			
			UNION ALL
			
			SELECT
				"" user_no				
				,IFNULL(SUM(end_cnt),0) AS end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore12}
			AND base_date &lt; #{monBefore11}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12				
				,IFNULL(SUM(end_cnt),0) AS end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore11}
			AND base_date &lt; #{monBefore10}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11				
				,IFNULL(SUM(end_cnt),0) AS end_rid10				
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore10}
			AND base_date &lt; #{monBefore9}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,IFNULL(SUM(end_cnt),0) AS end_rid9				
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore9}
			AND base_date &lt; #{monBefore8}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9				
				,IFNULL(SUM(end_cnt),0) AS end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore8}
			AND base_date &lt; #{monBefore7}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8				
				,IFNULL(SUM(end_cnt),0) AS end_rid7				
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore7}
			AND base_date &lt; #{monBefore6}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7				
				,IFNULL(SUM(end_cnt),0) AS end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore6}
			AND base_date &lt; #{monBefore5}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6				
				,IFNULL(SUM(end_cnt),0) AS end_rid5				
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore5}
			AND base_date &lt; #{monBefore4}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5				
				,IFNULL(SUM(end_cnt),0) AS end_rid4
				,0 end_rid3
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore4}
			AND base_date &lt; #{monBefore3}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4				
				,IFNULL(SUM(end_cnt),0) AS end_rid3				
				,0 end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore3}
			AND base_date &lt; #{monBefore2}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3				
				,IFNULL(SUM(end_cnt),0) AS end_rid2
				,0 end_rid
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore2}
			AND base_date &lt; #{monBefore1}
			
			UNION ALL
			
			SELECT 
				"" user_no
				,0 end_rid12
				,0 end_rid11
				,0 end_rid10
				,0 end_rid9
				,0 end_rid8
				,0 end_rid7
				,0 end_rid6
				,0 end_rid5
				,0 end_rid4
				,0 end_rid3
				,0 end_rid2				
				,IFNULL(SUM(end_cnt),0) AS end_rid								
			FROM 
				top_rpt_written_info 
			WHERE 1=1			
			AND user_no = #{user_no}
			AND base_date >= #{monBefore1}
			AND base_date &lt; #{monBefore0}			
			) GA
	</select>

	<select id="MisEndTmMbr" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,GA.team_written
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name			   
			   ,GB.user_no
			   ,GB.user_name
               ,GC.end_rid12 ,GC.end_rid11 ,GC.end_rid10 ,GC.end_rid9 ,GC.end_rid8 ,GC.end_rid7 ,GC.end_rid6 ,GC.end_rid5 ,GC.end_rid4 ,GC.end_rid3 ,GC.end_rid2 ,GC.end_rid
               ,CASE GB.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15	
				END AS new_work_order
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                             ,SUM(C.end_rid12) AS end_rid12
                             ,SUM(C.end_rid11) AS end_rid11
                             ,SUM(C.end_rid10) AS end_rid10
                             ,SUM(C.end_rid9) AS end_rid9
                             ,SUM(C.end_rid8) AS end_rid8
                             ,SUM(C.end_rid7) AS end_rid7
                             ,SUM(C.end_rid6) AS end_rid6
                             ,SUM(C.end_rid5) AS end_rid5
                             ,SUM(C.end_rid4) AS end_rid4
                             ,SUM(C.end_rid3) AS end_rid3
                             ,SUM(C.end_rid2) AS end_rid2
                             ,SUM(C.end_rid) AS end_rid
                        FROM  (
							  SELECT  0 AS USER_NO
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS end_rid12
		                             ,0 AS end_rid11
		                             ,0 AS end_rid10
		                             ,0 AS end_rid9
		                             ,0 AS end_rid8
		                             ,0 AS end_rid7
		                             ,0 AS end_rid6
		                             ,0 AS end_rid5
		                             ,0 AS end_rid4
		                             ,0 AS end_rid3
		                             ,0 AS end_rid2
		                             ,0 AS end_rid
		                        FROM  DUAL          			
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS end_rid12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS end_rid11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS end_rid10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS end_rid9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS end_rid8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS end_rid7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS end_rid6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS end_rid5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS end_rid4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS end_rid3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS end_rid2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS end_rid
                                FROM  top_rpt_head A 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                            <if test='primYN == "Y"'>
                              UNION ALL
                              SELECT  B.USER_NO
                                     ,B.SUIM_RPT_NO
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN 1 ELSE 0 END AS end_rid12
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN 1 ELSE 0 END AS end_rid11
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN 1 ELSE 0 END AS end_rid10
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN 1 ELSE 0 END AS end_rid9
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN 1 ELSE 0 END AS end_rid8
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN 1 ELSE 0 END AS end_rid7
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN 1 ELSE 0 END AS end_rid6
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN 1 ELSE 0 END AS end_rid5
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN 1 ELSE 0 END AS end_rid4
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN 1 ELSE 0 END AS end_rid3
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN 1 ELSE 0 END AS end_rid2
                                     ,CASE WHEN B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN 1 ELSE 0 END AS end_rid
                                FROM  top_prim_biz_rpt_head B 
                               WHERE  1=1
                                 AND  B.SUIM_RPT_STATE = '2'
				 				 AND  B.TEAM_ID = #{team_id}
                                 AND  B.SUIM_RPT_TYPE1 = 5
                                 AND  B.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  B.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.END_RID IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY new_work_order, work_level DESC, user_no	
	</select>


	<select id="MisEndTmMbrAssess" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name
			   ,GB.user_no
			   ,GB.user_name
               ,GC.price_assess12 ,GC.price_assess11 ,GC.price_assess10 ,GC.price_assess9 ,GC.price_assess8 ,GC.price_assess7 ,GC.price_assess6 ,GC.price_assess5 ,GC.price_assess4 ,GC.price_assess3 ,GC.price_assess2 ,GC.price_assess
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                      		 ,C.TEAM_ID
                             ,SUM(C.price_assess12 + C.price_assess12_PLUS - C.price_assess12_MINUS) AS price_assess12
                             ,SUM(C.price_assess11 + C.price_assess11_PLUS - C.price_assess11_MINUS) AS price_assess11
                             ,SUM(C.price_assess10 + C.price_assess10_PLUS - C.price_assess10_MINUS) AS price_assess10
                             ,SUM(C.price_assess9 + C.price_assess9_PLUS - C.price_assess9_MINUS) AS price_assess9
                             ,SUM(C.price_assess8 + C.price_assess8_PLUS - C.price_assess8_MINUS) AS price_assess8
                             ,SUM(C.price_assess7 + C.price_assess7_PLUS - C.price_assess7_MINUS) AS price_assess7
                             ,SUM(C.price_assess6 + C.price_assess6_PLUS - C.price_assess6_MINUS) AS price_assess6
                             ,SUM(C.price_assess5 + C.price_assess5_PLUS - C.price_assess5_MINUS) AS price_assess5
                             ,SUM(C.price_assess4 + C.price_assess4_PLUS - C.price_assess4_MINUS) AS price_assess4
                             ,SUM(C.price_assess3 + C.price_assess3_PLUS - C.price_assess3_MINUS) AS price_assess3
                             ,SUM(C.price_assess2 + C.price_assess2_PLUS - C.price_assess2_MINUS) AS price_assess2
                             ,SUM(C.price_assess + C.price_assess_PLUS - C.price_assess_MINUS) AS price_assess
                        FROM  (
							  SELECT  0 AS USER_NO
							  		 ,0 AS TEAM_ID
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS price_assess12
		                             ,0 AS price_assess11
		                             ,0 AS price_assess10
		                             ,0 AS price_assess9
		                             ,0 AS price_assess8
		                             ,0 AS price_assess7
		                             ,0 AS price_assess6
		                             ,0 AS price_assess5
		                             ,0 AS price_assess4
		                             ,0 AS price_assess3
		                             ,0 AS price_assess2
		                             ,0 AS price_assess
							  		 
		                             ,0 AS price_assess12_PLUS
		                             ,0 AS price_assess11_PLUS
		                             ,0 AS price_assess10_PLUS
		                             ,0 AS price_assess9_PLUS
		                             ,0 AS price_assess8_PLUS
		                             ,0 AS price_assess7_PLUS
		                             ,0 AS price_assess6_PLUS
		                             ,0 AS price_assess5_PLUS
		                             ,0 AS price_assess4_PLUS
		                             ,0 AS price_assess3_PLUS
		                             ,0 AS price_assess2_PLUS
		                             ,0 AS price_assess_PLUS

		                             ,0 AS price_assess12_MINUS
		                             ,0 AS price_assess11_MINUS
		                             ,0 AS price_assess10_MINUS
		                             ,0 AS price_assess9_MINUS
		                             ,0 AS price_assess8_MINUS
		                             ,0 AS price_assess7_MINUS
		                             ,0 AS price_assess6_MINUS
		                             ,0 AS price_assess5_MINUS
		                             ,0 AS price_assess4_MINUS
		                             ,0 AS price_assess3_MINUS
		                             ,0 AS price_assess2_MINUS
		                             ,0 AS price_assess_MINUS	
		                        FROM  DUAL          	
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     
                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess -->
                                     
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM((B.AMT_BASIC+getCollaboApprovalAmt(A.SUIM_RPT_NO))) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO
                                   
							   UNION ALL
                              SELECT  B.USER_ID
                              		 ,B.SHARE_TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_PLUS -->
		                                     
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_PLUS
                                     	</when>
                                     	<otherwise>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_PLUS                                     	
                                     	</otherwise>
                                     </choose>
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.USER_ID	 
                                 
 							   UNION ALL
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, C.AMT_BASIC * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_MINUS -->
		                                     
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess12_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess11_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess10_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess9_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess8_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess7_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess6_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess5_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess4_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess3_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess2_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) ) ELSE 0 END AS price_assess_MINUS
                                     	</when>
                                     	<otherwise>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_MINUS                                     	
                                     	</otherwise>
                                     </choose>
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO                                
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = 2
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO        
                            
                     		   UNION ALL                        
                              SELECT  B.SHARE_USER_NO 
                              		 ,B.SHARE_TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_USER_NO     
 
 		          			   UNION ALL                        
                              SELECT  A.USER_NO 
                                     ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			
					             AND  A.TEAM_ID = #{team_id}            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO	                           
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.PRICE_ASSESS IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY work_type, work_level DESC, USER_NO	
	</select>
	
	<select id="MisEndTmMbrAssess_20230619" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name
			   ,GB.user_no
			   ,GB.user_name
               ,GC.price_assess12 ,GC.price_assess11 ,GC.price_assess10 ,GC.price_assess9 ,GC.price_assess8 ,GC.price_assess7 ,GC.price_assess6 ,GC.price_assess5 ,GC.price_assess4 ,GC.price_assess3 ,GC.price_assess2 ,GC.price_assess
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                      		 ,C.TEAM_ID
                             ,SUM(C.price_assess12 + C.price_assess12_PLUS - C.price_assess12_MINUS) AS price_assess12
                             ,SUM(C.price_assess11 + C.price_assess11_PLUS - C.price_assess11_MINUS) AS price_assess11
                             ,SUM(C.price_assess10 + C.price_assess10_PLUS - C.price_assess10_MINUS) AS price_assess10
                             ,SUM(C.price_assess9 + C.price_assess9_PLUS - C.price_assess9_MINUS) AS price_assess9
                             ,SUM(C.price_assess8 + C.price_assess8_PLUS - C.price_assess8_MINUS) AS price_assess8
                             ,SUM(C.price_assess7 + C.price_assess7_PLUS - C.price_assess7_MINUS) AS price_assess7
                             ,SUM(C.price_assess6 + C.price_assess6_PLUS - C.price_assess6_MINUS) AS price_assess6
                             ,SUM(C.price_assess5 + C.price_assess5_PLUS - C.price_assess5_MINUS) AS price_assess5
                             ,SUM(C.price_assess4 + C.price_assess4_PLUS - C.price_assess4_MINUS) AS price_assess4
                             ,SUM(C.price_assess3 + C.price_assess3_PLUS - C.price_assess3_MINUS) AS price_assess3
                             ,SUM(C.price_assess2 + C.price_assess2_PLUS - C.price_assess2_MINUS) AS price_assess2
                             ,SUM(C.price_assess + C.price_assess_PLUS - C.price_assess_MINUS) AS price_assess
                        FROM  (
							  SELECT  0 AS USER_NO
							  		 ,0 AS TEAM_ID
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS price_assess12
		                             ,0 AS price_assess11
		                             ,0 AS price_assess10
		                             ,0 AS price_assess9
		                             ,0 AS price_assess8
		                             ,0 AS price_assess7
		                             ,0 AS price_assess6
		                             ,0 AS price_assess5
		                             ,0 AS price_assess4
		                             ,0 AS price_assess3
		                             ,0 AS price_assess2
		                             ,0 AS price_assess
							  		 
		                             ,0 AS price_assess12_PLUS
		                             ,0 AS price_assess11_PLUS
		                             ,0 AS price_assess10_PLUS
		                             ,0 AS price_assess9_PLUS
		                             ,0 AS price_assess8_PLUS
		                             ,0 AS price_assess7_PLUS
		                             ,0 AS price_assess6_PLUS
		                             ,0 AS price_assess5_PLUS
		                             ,0 AS price_assess4_PLUS
		                             ,0 AS price_assess3_PLUS
		                             ,0 AS price_assess2_PLUS
		                             ,0 AS price_assess_PLUS

		                             ,0 AS price_assess12_MINUS
		                             ,0 AS price_assess11_MINUS
		                             ,0 AS price_assess10_MINUS
		                             ,0 AS price_assess9_MINUS
		                             ,0 AS price_assess8_MINUS
		                             ,0 AS price_assess7_MINUS
		                             ,0 AS price_assess6_MINUS
		                             ,0 AS price_assess5_MINUS
		                             ,0 AS price_assess4_MINUS
		                             ,0 AS price_assess3_MINUS
		                             ,0 AS price_assess2_MINUS
		                             ,0 AS price_assess_MINUS	
		                        FROM  DUAL          	
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO
                                   
							   UNION ALL
                              SELECT  B.USER_ID
                              		 ,B.SHARE_TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_PLUS
                                     	</when>
                                     	<otherwise>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_PLUS                                     	
                                     	</otherwise>
                                     </choose>
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.USER_ID	 
                                 
 							   UNION ALL
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_PLUS
                                     	</when>
                                     	<otherwise>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_PP + B.WRITTEN_BASIC) ELSE 0 END AS price_assess_PLUS                                     	
                                     	</otherwise>
                                     </choose>
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO                                
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_BASIC) ELSE 0 END AS price_assess
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = 2
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO        
                            
                     		   UNION ALL                        
                              SELECT  B.SHARE_USER_NO 
                              		 ,B.SHARE_TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_USER_NO     
 
 		          			   UNION ALL                        
                              SELECT  A.USER_NO 
                                     ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_BASIC) ELSE 0 END AS price_assess_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			
					             AND  A.TEAM_ID = #{team_id}            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO	                           
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.PRICE_ASSESS IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY work_type, work_level DESC, USER_NO	
	</select>

	<select id="MisEndTmMbrTime" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name
			   ,GB.user_no
			   ,GB.user_name
               ,GC.price_time12 ,GC.price_time11 ,GC.price_time10 ,GC.price_time9 ,GC.price_time8 ,GC.price_time7 ,GC.price_time6 ,GC.price_time5 ,GC.price_time4 ,GC.price_time3 ,GC.price_time2 ,GC.price_time
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                      		 ,C.TEAM_ID
                             ,SUM(C.price_time12 + C.price_time12_PLUS - C.price_time12_MINUS) AS price_time12
                             ,SUM(C.price_time11 + C.price_time11_PLUS - C.price_time11_MINUS) AS price_time11
                             ,SUM(C.price_time10 + C.price_time10_PLUS - C.price_time10_MINUS) AS price_time10
                             ,SUM(C.price_time9 + C.price_time9_PLUS - C.price_time9_MINUS) AS price_time9
                             ,SUM(C.price_time8 + C.price_time8_PLUS - C.price_time8_MINUS) AS price_time8
                             ,SUM(C.price_time7 + C.price_time7_PLUS - C.price_time7_MINUS) AS price_time7
                             ,SUM(C.price_time6 + C.price_time6_PLUS - C.price_time6_MINUS) AS price_time6
                             ,SUM(C.price_time5 + C.price_time5_PLUS - C.price_time5_MINUS) AS price_time5
                             ,SUM(C.price_time4 + C.price_time4_PLUS - C.price_time4_MINUS) AS price_time4
                             ,SUM(C.price_time3 + C.price_time3_PLUS - C.price_time3_MINUS) AS price_time3
                             ,SUM(C.price_time2 + C.price_time2_PLUS - C.price_time2_MINUS) AS price_time2
                             ,SUM(C.price_time + C.price_time_PLUS - C.price_time_MINUS) AS price_time
                        FROM  (
							  SELECT  0 AS USER_NO
							  		 ,0 AS TEAM_ID
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS price_time12
		                             ,0 AS price_time11
		                             ,0 AS price_time10
		                             ,0 AS price_time9
		                             ,0 AS price_time8
		                             ,0 AS price_time7
		                             ,0 AS price_time6
		                             ,0 AS price_time5
		                             ,0 AS price_time4
		                             ,0 AS price_time3
		                             ,0 AS price_time2
		                             ,0 AS price_time
							  		 
		                             ,0 AS price_time12_PLUS
		                             ,0 AS price_time11_PLUS
		                             ,0 AS price_time10_PLUS
		                             ,0 AS price_time9_PLUS
		                             ,0 AS price_time8_PLUS
		                             ,0 AS price_time7_PLUS
		                             ,0 AS price_time6_PLUS
		                             ,0 AS price_time5_PLUS
		                             ,0 AS price_time4_PLUS
		                             ,0 AS price_time3_PLUS
		                             ,0 AS price_time2_PLUS
		                             ,0 AS price_time_PLUS

		                             ,0 AS price_time12_MINUS
		                             ,0 AS price_time11_MINUS
		                             ,0 AS price_time10_MINUS
		                             ,0 AS price_time9_MINUS
		                             ,0 AS price_time8_MINUS
		                             ,0 AS price_time7_MINUS
		                             ,0 AS price_time6_MINUS
		                             ,0 AS price_time5_MINUS
		                             ,0 AS price_time4_MINUS
		                             ,0 AS price_time3_MINUS
		                             ,0 AS price_time2_MINUS
		                             ,0 AS price_time_MINUS	
		                        FROM  DUAL          	
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO
                                   
							   UNION ALL
                              SELECT  B.USER_ID
                              		 ,B.SHARE_TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time12_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time11_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time10_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time9_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time8_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time7_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time6_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time5_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time4_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time3_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time2_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time_PLUS
                                     	</when>
                                     	<otherwise>
											,0,0,0,0,0,0,0,0,0,0,0,0                                     	
                                     	</otherwise>
                                     </choose>
                                     ,0,0,0,0,0,0,0,0,0,0,0,0         
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.USER_ID	 
                                 
 							   UNION ALL
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0                                     
                                     <choose>
                                     	<when test='team_type == "1"'>
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time12_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time11_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time10_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time9_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time8_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time7_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time6_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time5_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time4_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time3_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time2_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) ELSE 0 END AS price_time_PLUS
                                     	</when>
                                     	<otherwise>
											,0,0,0,0,0,0,0,0,0,0,0,0                                 	
                                     	</otherwise>
                                     </choose>
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO                                
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_DAILY) ELSE 0 END AS price_time
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = 2
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO        
                            
                     		   UNION ALL                        
                              SELECT  B.SHARE_USER_NO 
                              		 ,B.SHARE_TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_USER_NO     
 
 		          			   UNION ALL                        
                              SELECT  A.USER_NO 
                                     ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_DAILY) ELSE 0 END AS price_time_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			
					             AND  A.TEAM_ID = #{team_id}            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO	                           
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.PRICE_TIME IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY work_type, work_level DESC, USER_NO	
	</select>


	<select id="MisEndTmMbrTraffic" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name
			   ,GB.user_no
			   ,GB.user_name
               ,GC.price_traffic12 ,GC.price_traffic11 ,GC.price_traffic10 ,GC.price_traffic9 ,GC.price_traffic8 ,GC.price_traffic7 ,GC.price_traffic6 ,GC.price_traffic5 ,GC.price_traffic4 ,GC.price_traffic3 ,GC.price_traffic2 ,GC.price_traffic
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                      		 ,C.TEAM_ID
                             ,SUM(C.price_traffic12 + C.price_traffic12_PLUS - C.price_traffic12_MINUS) AS price_traffic12
                             ,SUM(C.price_traffic11 + C.price_traffic11_PLUS - C.price_traffic11_MINUS) AS price_traffic11
                             ,SUM(C.price_traffic10 + C.price_traffic10_PLUS - C.price_traffic10_MINUS) AS price_traffic10
                             ,SUM(C.price_traffic9 + C.price_traffic9_PLUS - C.price_traffic9_MINUS) AS price_traffic9
                             ,SUM(C.price_traffic8 + C.price_traffic8_PLUS - C.price_traffic8_MINUS) AS price_traffic8
                             ,SUM(C.price_traffic7 + C.price_traffic7_PLUS - C.price_traffic7_MINUS) AS price_traffic7
                             ,SUM(C.price_traffic6 + C.price_traffic6_PLUS - C.price_traffic6_MINUS) AS price_traffic6
                             ,SUM(C.price_traffic5 + C.price_traffic5_PLUS - C.price_traffic5_MINUS) AS price_traffic5
                             ,SUM(C.price_traffic4 + C.price_traffic4_PLUS - C.price_traffic4_MINUS) AS price_traffic4
                             ,SUM(C.price_traffic3 + C.price_traffic3_PLUS - C.price_traffic3_MINUS) AS price_traffic3
                             ,SUM(C.price_traffic2 + C.price_traffic2_PLUS - C.price_traffic2_MINUS) AS price_traffic2
                             ,SUM(C.price_traffic + C.price_traffic_PLUS - C.price_traffic_MINUS) AS price_traffic
                        FROM  (
							  SELECT  0 AS USER_NO
							  		 ,0 AS TEAM_ID
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS price_traffic12
		                             ,0 AS price_traffic11
		                             ,0 AS price_traffic10
		                             ,0 AS price_traffic9
		                             ,0 AS price_traffic8
		                             ,0 AS price_traffic7
		                             ,0 AS price_traffic6
		                             ,0 AS price_traffic5
		                             ,0 AS price_traffic4
		                             ,0 AS price_traffic3
		                             ,0 AS price_traffic2
		                             ,0 AS price_traffic
							  		 
		                             ,0 AS price_traffic12_PLUS
		                             ,0 AS price_traffic11_PLUS
		                             ,0 AS price_traffic10_PLUS
		                             ,0 AS price_traffic9_PLUS
		                             ,0 AS price_traffic8_PLUS
		                             ,0 AS price_traffic7_PLUS
		                             ,0 AS price_traffic6_PLUS
		                             ,0 AS price_traffic5_PLUS
		                             ,0 AS price_traffic4_PLUS
		                             ,0 AS price_traffic3_PLUS
		                             ,0 AS price_traffic2_PLUS
		                             ,0 AS price_traffic_PLUS

		                             ,0 AS price_traffic12_MINUS
		                             ,0 AS price_traffic11_MINUS
		                             ,0 AS price_traffic10_MINUS
		                             ,0 AS price_traffic9_MINUS
		                             ,0 AS price_traffic8_MINUS
		                             ,0 AS price_traffic7_MINUS
		                             ,0 AS price_traffic6_MINUS
		                             ,0 AS price_traffic5_MINUS
		                             ,0 AS price_traffic4_MINUS
		                             ,0 AS price_traffic3_MINUS
		                             ,0 AS price_traffic2_MINUS
		                             ,0 AS price_traffic_MINUS	
		                        FROM  DUAL          	
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO
                                   
							   UNION ALL
                              SELECT  B.USER_ID
                              		 ,B.SHARE_TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic12_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic11_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic10_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic9_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic8_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic7_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic6_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic5_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic4_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic3_PLUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic2_PLUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic_PLUS
                                     	</when>
                                     	<otherwise>
											,0,0,0,0,0,0,0,0,0,0,0,0                                     	
                                     	</otherwise>
                                     </choose>
                                     ,0,0,0,0,0,0,0,0,0,0,0,0         
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.USER_ID	 
                                 
 							   UNION ALL
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0                                     
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic12_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic11_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic10_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic9_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic8_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic7_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic6_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic5_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic4_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic3_MINUS
		                                    ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic2_MINUS
											,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.COLLABO_TRAFFIC) ELSE 0 END AS price_traffic_MINUS
                                     	</when>
                                     	<otherwise>
											,0,0,0,0,0,0,0,0,0,0,0,0                                 	
                                     	</otherwise>
                                     </choose>
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO                                
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TRAFFIC) ELSE 0 END AS price_traffic
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = 2
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO        
                            
                     		   UNION ALL                        
                              SELECT  B.SHARE_USER_NO 
                              		 ,B.SHARE_TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_USER_NO     
 
 		          			   UNION ALL                        
                              SELECT  A.USER_NO 
                                     ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TRAFFIC) ELSE 0 END AS price_traffic_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			
					             AND  A.TEAM_ID = #{team_id}            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO	                           
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.PRICE_TRAFFIC IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY work_type, work_level DESC, USER_NO	
	</select>



	<select id="MisEndTmMbrQr" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name
			   ,GB.user_no
			   ,GB.user_name
               ,GC.price_qr12 ,GC.price_qr11 ,GC.price_qr10 ,GC.price_qr9 ,GC.price_qr8 ,GC.price_qr7 ,GC.price_qr6 ,GC.price_qr5 ,GC.price_qr4 ,GC.price_qr3 ,GC.price_qr2 ,GC.price_qr
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                      		 ,C.TEAM_ID
                             ,SUM(C.price_qr12 + C.price_qr12_PLUS - C.price_qr12_MINUS) AS price_qr12
                             ,SUM(C.price_qr11 + C.price_qr11_PLUS - C.price_qr11_MINUS) AS price_qr11
                             ,SUM(C.price_qr10 + C.price_qr10_PLUS - C.price_qr10_MINUS) AS price_qr10
                             ,SUM(C.price_qr9 + C.price_qr9_PLUS - C.price_qr9_MINUS) AS price_qr9
                             ,SUM(C.price_qr8 + C.price_qr8_PLUS - C.price_qr8_MINUS) AS price_qr8
                             ,SUM(C.price_qr7 + C.price_qr7_PLUS - C.price_qr7_MINUS) AS price_qr7
                             ,SUM(C.price_qr6 + C.price_qr6_PLUS - C.price_qr6_MINUS) AS price_qr6
                             ,SUM(C.price_qr5 + C.price_qr5_PLUS - C.price_qr5_MINUS) AS price_qr5
                             ,SUM(C.price_qr4 + C.price_qr4_PLUS - C.price_qr4_MINUS) AS price_qr4
                             ,SUM(C.price_qr3 + C.price_qr3_PLUS - C.price_qr3_MINUS) AS price_qr3
                             ,SUM(C.price_qr2 + C.price_qr2_PLUS - C.price_qr2_MINUS) AS price_qr2
                             ,SUM(C.price_qr + C.price_qr_PLUS - C.price_qr_MINUS) AS price_qr
                        FROM  (
							  SELECT  0 AS USER_NO
							  		 ,0 AS TEAM_ID
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS price_qr12
		                             ,0 AS price_qr11
		                             ,0 AS price_qr10
		                             ,0 AS price_qr9
		                             ,0 AS price_qr8
		                             ,0 AS price_qr7
		                             ,0 AS price_qr6
		                             ,0 AS price_qr5
		                             ,0 AS price_qr4
		                             ,0 AS price_qr3
		                             ,0 AS price_qr2
		                             ,0 AS price_qr
							  		 
		                             ,0 AS price_qr12_PLUS
		                             ,0 AS price_qr11_PLUS
		                             ,0 AS price_qr10_PLUS
		                             ,0 AS price_qr9_PLUS
		                             ,0 AS price_qr8_PLUS
		                             ,0 AS price_qr7_PLUS
		                             ,0 AS price_qr6_PLUS
		                             ,0 AS price_qr5_PLUS
		                             ,0 AS price_qr4_PLUS
		                             ,0 AS price_qr3_PLUS
		                             ,0 AS price_qr2_PLUS
		                             ,0 AS price_qr_PLUS

		                             ,0 AS price_qr12_MINUS
		                             ,0 AS price_qr11_MINUS
		                             ,0 AS price_qr10_MINUS
		                             ,0 AS price_qr9_MINUS
		                             ,0 AS price_qr8_MINUS
		                             ,0 AS price_qr7_MINUS
		                             ,0 AS price_qr6_MINUS
		                             ,0 AS price_qr5_MINUS
		                             ,0 AS price_qr4_MINUS
		                             ,0 AS price_qr3_MINUS
		                             ,0 AS price_qr2_MINUS
		                             ,0 AS price_qr_MINUS	
		                        FROM  DUAL          	
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_COUNSEL + B.AMT_ETC) ELSE 0 END AS price_qr
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = 2
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO        
                            
                     		   UNION ALL                        
                              SELECT  B.SHARE_USER_NO 
                              		 ,B.SHARE_TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_USER_NO     
 
 		          			   UNION ALL                        
                              SELECT  A.USER_NO 
                                     ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_COUNSEL + B.SHARE_AMT_ETC) ELSE 0 END AS price_qr_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			
					             AND  A.TEAM_ID = #{team_id}            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO	                           
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.PRICE_QR IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY work_type, work_level DESC, USER_NO	
	</select>


	<select id="MisEndTmMbrTotal" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
        SELECT  GA.team_id 
               ,GA.team_type
               ,getTopTmBscTeamName(#{team_id}) team_name
			   ,getTopTmBscCenterName(#{team_id}) center_name
			   ,GB.user_no
			   ,GB.user_name
               ,GC.price_total12 ,GC.price_total11 ,GC.price_total10 ,GC.price_total9 ,GC.price_total8 ,GC.price_total7 ,GC.price_total6 ,GC.price_total5 ,GC.price_total4 ,GC.price_total3 ,GC.price_total2 ,GC.price_total
          FROM  top_tm_bsc GA
		 INNER  JOIN top_mbr_bsc GB
			ON  GA.team_id = GB.team_id_main
          LEFT  JOIN (
                      SELECT  C.USER_NO
                      		 ,C.TEAM_ID
                             ,SUM(C.price_total12 + C.price_total12_PLUS - C.price_total12_MINUS) AS price_total12
                             ,SUM(C.price_total11 + C.price_total11_PLUS - C.price_total11_MINUS) AS price_total11
                             ,SUM(C.price_total10 + C.price_total10_PLUS - C.price_total10_MINUS) AS price_total10
                             ,SUM(C.price_total9 + C.price_total9_PLUS - C.price_total9_MINUS) AS price_total9
                             ,SUM(C.price_total8 + C.price_total8_PLUS - C.price_total8_MINUS) AS price_total8
                             ,SUM(C.price_total7 + C.price_total7_PLUS - C.price_total7_MINUS) AS price_total7
                             ,SUM(C.price_total6 + C.price_total6_PLUS - C.price_total6_MINUS) AS price_total6
                             ,SUM(C.price_total5 + C.price_total5_PLUS - C.price_total5_MINUS) AS price_total5
                             ,SUM(C.price_total4 + C.price_total4_PLUS - C.price_total4_MINUS) AS price_total4
                             ,SUM(C.price_total3 + C.price_total3_PLUS - C.price_total3_MINUS) AS price_total3
                             ,SUM(C.price_total2 + C.price_total2_PLUS - C.price_total2_MINUS) AS price_total2
                             ,SUM(C.price_total + C.price_total_PLUS - C.price_total_MINUS) AS price_total
                        FROM  (
							  SELECT  0 AS USER_NO
							  		 ,0 AS TEAM_ID
								     ,0 AS SUIM_RPT_NO
		                             ,0 AS price_total12
		                             ,0 AS price_total11
		                             ,0 AS price_total10
		                             ,0 AS price_total9
		                             ,0 AS price_total8
		                             ,0 AS price_total7
		                             ,0 AS price_total6
		                             ,0 AS price_total5
		                             ,0 AS price_total4
		                             ,0 AS price_total3
		                             ,0 AS price_total2
		                             ,0 AS price_total
							  		 
		                             ,0 AS price_total12_PLUS
		                             ,0 AS price_total11_PLUS
		                             ,0 AS price_total10_PLUS
		                             ,0 AS price_total9_PLUS
		                             ,0 AS price_total8_PLUS
		                             ,0 AS price_total7_PLUS
		                             ,0 AS price_total6_PLUS
		                             ,0 AS price_total5_PLUS
		                             ,0 AS price_total4_PLUS
		                             ,0 AS price_total3_PLUS
		                             ,0 AS price_total2_PLUS
		                             ,0 AS price_total_PLUS

		                             ,0 AS price_total12_MINUS
		                             ,0 AS price_total11_MINUS
		                             ,0 AS price_total10_MINUS
		                             ,0 AS price_total9_MINUS
		                             ,0 AS price_total8_MINUS
		                             ,0 AS price_total7_MINUS
		                             ,0 AS price_total6_MINUS
		                             ,0 AS price_total5_MINUS
		                             ,0 AS price_total4_MINUS
		                             ,0 AS price_total3_MINUS
		                             ,0 AS price_total2_MINUS
		                             ,0 AS price_total_MINUS	
		                        FROM  DUAL          	
							<if test='basicYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_rpt_head A
                               INNER  JOIN top_rpt_invoice B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO 
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = '2'
				 				 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO
                                   
							   UNION ALL
                              SELECT  B.USER_ID
                              		 ,B.SHARE_TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_PLUS -->
		                                     
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_PLUS                                     
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_PLUS
                                     	</when>
                                     	<otherwise>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total12_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total11_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total10_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total9_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total8_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total7_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total6_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total5_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total4_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total3_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total2_PLUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total_PLUS                  	
                                     	</otherwise>
                                     </choose>
                                     ,0,0,0,0,0,0,0,0,0,0,0,0         
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.USER_ID	 
                                 
 							   UNION ALL
                              SELECT  A.USER_NO
                              		 ,A.TEAM_ID
                              	     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0                                     
                                     <choose>
                                     	<when test='team_type == "1"'>
		                                     <!-- ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( (C.AMT_BASIC * B.COLLABO_PP * 0.01 + B.WRITTEN_BASIC) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_MINUS -->
		                                     
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total12_MINUS                                     
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total11_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total10_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total9_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total8_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total7_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total6_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total5_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total4_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total3_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total2_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( IF(B.COLLABO_PRICE_TYPE = 0, (C.AMT_BASIC + getCollaboApprovalAmt(A.SUIM_RPT_NO)) * B.COLLABO_PP * 0.01, B.COLLABO_PRICE) + IFNULL(B.WRITTEN_BASIC,0) + (IF(B.COLLABO_DAILY_TYPE = 0, C.AMT_DAILY * B.COLLABO_DAILY * 0.01, B.COLLABO_DAILY)) + B.COLLABO_TRAFFIC ) ELSE 0 END AS price_total_MINUS
                                     	</when>
                                     	<otherwise>
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total12_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total11_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total10_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total9_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total8_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total7_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total6_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total5_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total4_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total3_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total2_MINUS
		                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM( B.COLLABO_PP + B.WRITTEN_BASIC ) ELSE 0 END AS price_total_MINUS                                    	
                                     	</otherwise>
                                     </choose>
                                FROM  top_rpt_head A 
                               INNER  JOIN top_rpt_collabo B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               INNER  JOIN top_rpt_invoice C
                                  ON  B.SUIM_RPT_NO = C.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE = '2'
					             AND  B.USER_ID IS NOT NULL
					             AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO                                
							</if>
                            <if test='primYN == "Y"'>
		          			   UNION ALL                        
                              SELECT  A.USER_NO
                                     ,A.TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total12
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total11
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total10
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total9
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total8
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total7
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total6
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total5
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total4
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total3
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total2
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.AMT_TOTAL) ELSE 0 END AS price_total
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
                                 AND  A.SUIM_RPT_STATE = 2
                                 AND  A.SUIM_RPT_TYPE1 = 5
                                 AND  A.TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
                               GROUP BY A.SUIM_RPT_NO, A.USER_NO        
                            
                     		   UNION ALL                        
                              SELECT  B.SHARE_USER_NO 
                              		 ,B.SHARE_TEAM_ID 
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_PLUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_PLUS
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			            
					             AND  B.SHARE_TEAM_ID = #{team_id}
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, B.SHARE_USER_NO     
 
 		          			   UNION ALL                        
                              SELECT  A.USER_NO 
                                     ,A.TEAM_ID
                                     ,A.SUIM_RPT_NO
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,0,0,0,0,0,0,0,0,0,0,0,0
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore11}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total12_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore11}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore10}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total11_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore10}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore9}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total10_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore9}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore8}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total9_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore8}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore7}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total8_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore7}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore6}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total7_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore6}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore5}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total6_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore5}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore4}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total5_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore4}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore3}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total4_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore3}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore2}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total3_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore2}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore1}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total2_MINUS
                                     ,CASE WHEN A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore1}) AND A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0}) THEN SUM(B.SHARE_AMT_TOTAL) ELSE 0 END AS price_total_MINUS
                                FROM  top_prim_biz_rpt_head A 
                               INNER  JOIN top_prim_biz_inv_share B
                                  ON  A.SUIM_RPT_NO = B.SUIM_RPT_NO
                               WHERE  1=1
					             AND  A.SUIM_RPT_STATE != 3
					             AND  A.SUIM_RPT_TYPE1 = 5			
					             AND  A.TEAM_ID = #{team_id}            
					             AND  B.SHARE_TEAM_ID IS NOT NULL
                                 AND  A.CLOSE_DATE >= UNIX_TIMESTAMP(#{monBefore12})
                                 AND  A.CLOSE_DATE &lt; UNIX_TIMESTAMP(#{monBefore0})
					           GROUP BY A.SUIM_RPT_NO, A.USER_NO	                           
							</if>
                               ) C
                       WHERE  1=1
                      GROUP BY C.USER_NO  
                    ) GC
            ON  GB.USER_NO = GC.USER_NO  
         WHERE  1=1
		   AND  GC.PRICE_TOTAL IS NOT NULL
		   AND (
				  (GB.user_state ='1' AND GB.out_date >= UNIX_TIMESTAMP(#{monBefore12})) OR  
				  (GB.user_state!='1' AND GB.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day)))
			   )
         ORDER  BY work_type, work_level DESC, USER_NO	
	</select>

	<!-- 
	
		  180830 
	
	 -->
	<select id="MisEndTm1_backup_20180824" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, end_rid12, end_rid11, end_rid10, end_rid9, end_rid8, end_rid7, end_rid6, end_rid5, end_rid4, end_rid3, end_rid2, end_rid
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=1 AND team_statistics1=0
				ORDER BY team_order DESC, team_id ASC) tmBsc
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid12
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore12})
						AND close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid11
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore11})
						AND close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid10
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore10})
						AND close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid9
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore9})
						AND close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid8
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore8})
						AND close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid7
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore7})
						AND close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid6
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore6})
						AND close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid5
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore5})
						AND close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid4
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore4})
						AND close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid3
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore3})
						AND close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid2
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore2})
						AND close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND close_date >= unix_timestamp(#{monBefore1})
						AND close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
			ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>



	<select id="MisEndTm4_backup_180824" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, end_rid12, end_rid11, end_rid10, end_rid9, end_rid8, end_rid7, end_rid6, end_rid5, end_rid4, end_rid3, end_rid2, end_rid
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=4 AND team_statistics4=0
				ORDER BY team_order DESC, team_id ASC) tmBsc
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid12
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore12})
						AND close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid11
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore11})
						AND close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid10
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore10})
						AND close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid9
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore9})
						AND close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid8
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore8})
						AND close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid7
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore7})
						AND close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid6
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore6})
						AND close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid5
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore5})
						AND close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid4
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore4})
						AND close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid3
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore3})
						AND close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid2
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore2})
						AND close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
			LEFT JOIN (SELECT team_id, count(suim_rpt_no) end_rid
						FROM top_rpt_head
						WHERE
						 suim_rpt_type1 in (3,4)
						AND close_date >= unix_timestamp(#{monBefore1})
						AND close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
			ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC
	</select>
	
	
	<select id="MisEndTmAssess1_backup_180827" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_assess12, price_assess11, price_assess10, price_assess9, price_assess8, price_assess7, price_assess6, price_assess5, price_assess4, price_assess3
			, price_assess2, price_assess
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=1 AND team_statistics1=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC
	</select>
	
	<select id="MisEndTmAssess4_backup_180827" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_assess12, price_assess11, price_assess10, price_assess9, price_assess8, price_assess7, price_assess6, price_assess5, price_assess4, price_assess3
			, price_assess2, price_assess
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=4 AND team_statistics4=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_basic), 0) price_assess
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	<select id="MisEndTmTime1_backup_20180828" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_time12, price_time11, price_time10, price_time9, price_time8, price_time7, price_time6, price_time5, price_time4, price_time3
			, price_time2, price_time
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=1 AND team_statistics1=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	<select id="MisEndTmTime4_backup_20180828" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_time12, price_time11, price_time10, price_time9, price_time8, price_time7, price_time6, price_time5, price_time4, price_time3
			, price_time2, price_time
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=4 AND team_statistics4=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_daily), 0) price_time
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	<select id="MisEndTmTraffic1_backup_20180829" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_traffic12, price_traffic11, price_traffic10, price_traffic9, price_traffic8, price_traffic7, 
			, price_traffic6, price_traffic5, price_traffic4, price_tra1ffic3, price_traffic2, price_traffic
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=1 AND team_statistics1=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC
	</select>
	
	<select id="MisEndTmTraffic4_backup_20180829" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_traffic12, price_traffic11, price_traffic10, price_traffic9, price_traffic8, price_traffic7, price_traffic6, price_traffic5, price_traffic4, price_traffic3
			, price_traffic2, price_traffic
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=4 AND team_statistics4=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_traffic), 0) price_traffic
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC
	</select>
	
	<select id="MisEndTmQr1_backup_180829" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_qr12, price_qr11, price_qr10, price_qr9, price_qr8, price_qr7, price_qr6, price_qr5, price_qr4, price_qr3
			, price_qr2, price_qr
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=1 AND team_statistics1=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	<select id="MisEndTmQr4_backup_180829" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_qr12, price_qr11, price_qr10, price_qr9, price_qr8, price_qr7, price_qr6, price_qr5, price_qr4, price_qr3
			, price_qr2, price_qr
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=4 AND team_statistics4=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_counsel + amt_etc), 0) price_qr
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	<select id="MisEndTmTotal1_backup_20180829" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_total12, price_total11, price_total10, price_total9, price_total8, price_total7, price_total6, price_total5, price_total4, price_total3
			, price_total2, price_total
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=1 AND team_statistics1=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (1,2,11,12,13,14,15,16,17,18,19)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	<select id="MisEndTmTotal4_backup_20180829" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmBsc.team_id, tmBsc.team_name
			, price_total12, price_total11, price_total10, price_total9, price_total8, price_total7, price_total6, price_total5, price_total4, price_total3
			, price_total2, price_total
			
		FROM
			(SELECT team_order, team_group_order, team_id, team_name, team_type FROM top_tm_bsc
				WHERE team_type=4 AND team_statistics4=0) tmBsc
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY team_id) a1 ON tmBsc.team_id = a1.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY team_id) a2 ON tmBsc.team_id = a2.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY team_id) a3 ON tmBsc.team_id = a3.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY team_id) a4 ON tmBsc.team_id = a4.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY team_id) a5 ON tmBsc.team_id = a5.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY team_id) a6 ON tmBsc.team_id = a6.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY team_id) a7 ON tmBsc.team_id = a7.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY team_id) a8 ON tmBsc.team_id = a8.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY team_id) a9 ON tmBsc.team_id = a9.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY team_id) a10 ON tmBsc.team_id = a10.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY team_id) a11 ON tmBsc.team_id = a11.team_id
		LEFT JOIN (SELECT team_id, ifnull(sum(amt_total), 0) price_total
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE
						 suim_rpt_type1 in (3,4)
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY team_id) a12 ON tmBsc.team_id = a12.team_id
		ORDER BY tmBsc.team_group_order DESC, tmBsc.team_order DESC

	</select>
	
	
	
	
	
	
	
	
	
	
	<select id="MisEndTmMbr_backup_180830" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmMbr.user_no, tmMbr.user_name, tmMbr.team_id, getTopTmBscTeamName(tmMbr.team_id) team_name
			, end_rid12, end_rid11, end_rid10, end_rid9, end_rid8, end_rid7, end_rid6, end_rid5, end_rid4, end_rid3, end_rid2, end_rid
		FROM
			(SELECT mbrBsc.team_id_main team_id, mbrBsc.user_no, mbrBsc.user_name
			  FROM top_mbr_bsc mbrBsc
			 WHERE mbrBsc.team_id_main = #{team_id}
			   AND ((mbrBsc.user_state='1' AND mbrBsc.out_date >= UNIX_TIMESTAMP(#{monBefore12}))
				OR  (mbrBsc.user_state!='1' AND mbrBsc.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day))))
			 ORDER BY mbrBsc.work_type, mbrBsc.work_level DESC, mbrBsc.user_no ASC) tmMbr
			  LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid12
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore12})
						AND close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY user_no) a1 ON tmMbr.user_no = a1.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid11
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore11})
						AND close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY user_no) a2 ON tmMbr.user_no = a2.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid10
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore10})
						AND close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY user_no) a3 ON tmMbr.user_no = a3.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid9
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore9})
						AND close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY user_no) a4 ON tmMbr.user_no = a4.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid8
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore8})
						AND close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY user_no) a5 ON tmMbr.user_no = a5.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid7
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore7})
						AND close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY user_no) a6 ON tmMbr.user_no = a6.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid6
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore6})
						AND close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY user_no) a7 ON tmMbr.user_no = a7.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid5
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore5})
						AND close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY user_no) a8 ON tmMbr.user_no = a8.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid4
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore4})
						AND close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY user_no) a9 ON tmMbr.user_no = a9.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid3
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore3})
						AND close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY user_no) a10 ON tmMbr.user_no = a10.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid2
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore2})
						AND close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY user_no) a11 ON tmMbr.user_no = a11.user_no
			LEFT JOIN (SELECT user_no, count(suim_rpt_no) end_rid
						FROM top_rpt_head
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND close_date >= unix_timestamp(#{monBefore1})
						AND close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY user_no) a12 ON tmMbr.user_no = a12.user_no
			

	</select>
	
	
	<select id="MisEndTmMbrAssess_backup_180903" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmMbr.user_no, tmMbr.user_name, tmMbr.team_id, getTopTmBscTeamName(tmMbr.team_id) team_name
			, price_assess12, price_assess11, price_assess10, price_assess9, price_assess8, price_assess7, price_assess6, price_assess5, price_assess4, price_assess3
			, price_assess2, price_assess
		FROM
			(SELECT mbrBsc.team_id_main team_id, mbrBsc.user_no, mbrBsc.user_name
			FROM top_mbr_bsc mbrBsc
			WHERE mbrBsc.team_id_main = #{team_id}
			AND ((mbrBsc.user_state='1' AND mbrBsc.out_date >= UNIX_TIMESTAMP(#{monBefore12}))
				OR (mbrBsc.user_state!='1' AND mbrBsc.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day))))
			ORDER BY mbrBsc.work_type, mbrBsc.work_level DESC, mbrBsc.user_no ASC) tmMbr
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY user_no) a1 ON tmMbr.user_no = a1.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY user_no) a2 ON tmMbr.user_no = a2.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY user_no) a3 ON tmMbr.user_no = a3.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY user_no) a4 ON tmMbr.user_no = a4.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY user_no) a5 ON tmMbr.user_no = a5.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY user_no) a6 ON tmMbr.user_no = a6.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY user_no) a7 ON tmMbr.user_no = a7.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY user_no) a8 ON tmMbr.user_no = a8.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY user_no) a9 ON tmMbr.user_no = a9.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY user_no) a10 ON tmMbr.user_no = a10.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY user_no) a11 ON tmMbr.user_no = a11.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_basic), 0) price_assess
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY user_no) a12 ON tmMbr.user_no = a12.user_no

	</select>
	
	<select id="MisEndTmMbrTime_backup_20180904" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmMbr.user_no, tmMbr.user_name, tmMbr.team_id, getTopTmBscTeamName(tmMbr.team_id) team_name
			, price_time12, price_time11, price_time10, price_time9, price_time8, price_time7, price_time6, price_time5, price_time4, price_time3
			, price_time2, price_time
		FROM
			(SELECT mbrBsc.team_id_main team_id, mbrBsc.user_no, mbrBsc.user_name
			FROM top_mbr_bsc mbrBsc
			WHERE mbrBsc.team_id_main = #{team_id}
			AND ((mbrBsc.user_state='1' AND mbrBsc.out_date >= UNIX_TIMESTAMP(#{monBefore12}))
				OR (mbrBsc.user_state!='1' AND mbrBsc.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day))))
			ORDER BY mbrBsc.work_type, mbrBsc.work_level DESC, mbrBsc.user_no ASC) tmMbr
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY user_no) a1 ON tmMbr.user_no = a1.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY user_no) a2 ON tmMbr.user_no = a2.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY user_no) a3 ON tmMbr.user_no = a3.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY user_no) a4 ON tmMbr.user_no = a4.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY user_no) a5 ON tmMbr.user_no = a5.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY user_no) a6 ON tmMbr.user_no = a6.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY user_no) a7 ON tmMbr.user_no = a7.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY user_no) a8 ON tmMbr.user_no = a8.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY user_no) a9 ON tmMbr.user_no = a9.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY user_no) a10 ON tmMbr.user_no = a10.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY user_no) a11 ON tmMbr.user_no = a11.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_daily), 0) price_time
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY user_no) a12 ON tmMbr.user_no = a12.user_no

	</select>
	
	
	<select id="MisEndTmMbrTraffic_backup_180905" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmMbr.user_no, tmMbr.user_name, tmMbr.team_id, getTopTmBscTeamName(tmMbr.team_id) team_name
			, price_traffic12, price_traffic11, price_traffic10, price_traffic9, price_traffic8, price_traffic7, price_traffic6, price_traffic5, price_traffic4, price_traffic3
			, price_traffic2, price_traffic
		FROM
			(SELECT mbrBsc.team_id_main team_id, mbrBsc.user_no, mbrBsc.user_name
			FROM top_mbr_bsc mbrBsc
			WHERE mbrBsc.team_id_main = #{team_id}
			AND ((mbrBsc.user_state='1' AND mbrBsc.out_date >= UNIX_TIMESTAMP(#{monBefore12}))
				OR (mbrBsc.user_state!='1' AND mbrBsc.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day))))
			ORDER BY mbrBsc.work_type, mbrBsc.work_level DESC, mbrBsc.user_no ASC) tmMbr
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY user_no) a1 ON tmMbr.user_no = a1.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY user_no) a2 ON tmMbr.user_no = a2.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY user_no) a3 ON tmMbr.user_no = a3.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY user_no) a4 ON tmMbr.user_no = a4.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY user_no) a5 ON tmMbr.user_no = a5.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY user_no) a6 ON tmMbr.user_no = a6.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY user_no) a7 ON tmMbr.user_no = a7.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY user_no) a8 ON tmMbr.user_no = a8.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY user_no) a9 ON tmMbr.user_no = a9.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY user_no) a10 ON tmMbr.user_no = a10.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY user_no) a11 ON tmMbr.user_no = a11.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_traffic), 0) price_traffic
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY user_no) a12 ON tmMbr.user_no = a12.user_no

	</select>
	
	
	<select id="MisEndTmMbrQr_backup_20180905" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmMbr.user_no, tmMbr.user_name, tmMbr.team_id, getTopTmBscTeamName(tmMbr.team_id) team_name
			, price_qr12, price_qr11, price_qr10, price_qr9, price_qr8, price_qr7, price_qr6, price_qr5, price_qr4, price_qr3
			, price_qr2, price_qr
		FROM
			(SELECT mbrBsc.team_id_main team_id, mbrBsc.user_no, mbrBsc.user_name
			FROM top_mbr_bsc mbrBsc
			WHERE mbrBsc.team_id_main = #{team_id}
			AND ((mbrBsc.user_state='1' AND mbrBsc.out_date >= UNIX_TIMESTAMP(#{monBefore12}))
				OR (mbrBsc.user_state!='1' AND mbrBsc.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day))))
			ORDER BY mbrBsc.work_type, mbrBsc.work_level DESC, mbrBsc.user_no ASC) tmMbr
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY user_no) a1 ON tmMbr.user_no = a1.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY user_no) a2 ON tmMbr.user_no = a2.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY user_no) a3 ON tmMbr.user_no = a3.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY user_no) a4 ON tmMbr.user_no = a4.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY user_no) a5 ON tmMbr.user_no = a5.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY user_no) a6 ON tmMbr.user_no = a6.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY user_no) a7 ON tmMbr.user_no = a7.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY user_no) a8 ON tmMbr.user_no = a8.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY user_no) a9 ON tmMbr.user_no = a9.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY user_no) a10 ON tmMbr.user_no = a10.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY user_no) a11 ON tmMbr.user_no = a11.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_counsel + amt_etc), 0) price_qr
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY user_no) a12 ON tmMbr.user_no = a12.user_no

	</select>
	
	
	<select id="MisEndTmMbrTotal_backup_20180905" parameterType="kr.co.toplac.topstatistics.StatisticsNowVO" resultType="kr.co.toplac.topstatistics.MisEndTmVO">
		SELECT tmMbr.user_no, tmMbr.user_name, tmMbr.team_id, getTopTmBscTeamName(tmMbr.team_id) team_name
			, price_total12, price_total11, price_total10, price_total9, price_total8, price_total7, price_total6, price_total5, price_total4, price_total3
			, price_total2, price_total
		FROM
			(SELECT mbrBsc.team_id_main team_id, mbrBsc.user_no, mbrBsc.user_name
			FROM top_mbr_bsc mbrBsc
			WHERE mbrBsc.team_id_main = #{team_id}
			AND ((mbrBsc.user_state='1' AND mbrBsc.out_date >= UNIX_TIMESTAMP(#{monBefore12}))
				OR (mbrBsc.user_state!='1' AND mbrBsc.join_date &lt; UNIX_TIMESTAMP(DATE_ADD(#{monBefore0},INTERVAL 1 day))))
			ORDER BY mbrBsc.work_type, mbrBsc.work_level DESC, mbrBsc.user_no ASC) tmMbr
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total12
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore12})
						AND a.close_date &lt; unix_timestamp(#{monBefore11})
						GROUP BY user_no) a1 ON tmMbr.user_no = a1.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total11
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore11})
						AND a.close_date &lt; unix_timestamp(#{monBefore10})
						GROUP BY user_no) a2 ON tmMbr.user_no = a2.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total10
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore10})
						AND a.close_date &lt; unix_timestamp(#{monBefore9})
						GROUP BY user_no) a3 ON tmMbr.user_no = a3.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total9
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore9})
						AND a.close_date &lt; unix_timestamp(#{monBefore8})
						GROUP BY user_no) a4 ON tmMbr.user_no = a4.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total8
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore8})
						AND a.close_date &lt; unix_timestamp(#{monBefore7})
						GROUP BY user_no) a5 ON tmMbr.user_no = a5.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total7
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore7})
						AND a.close_date &lt; unix_timestamp(#{monBefore6})
						GROUP BY user_no) a6 ON tmMbr.user_no = a6.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total6
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore6})
						AND a.close_date &lt; unix_timestamp(#{monBefore5})
						GROUP BY user_no) a7 ON tmMbr.user_no = a7.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total5
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore5})
						AND a.close_date &lt; unix_timestamp(#{monBefore4})
						GROUP BY user_no) a8 ON tmMbr.user_no = a8.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total4
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore4})
						AND a.close_date &lt; unix_timestamp(#{monBefore3})
						GROUP BY user_no) a9 ON tmMbr.user_no = a9.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total3
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore3})
						AND a.close_date &lt; unix_timestamp(#{monBefore2})
						GROUP BY user_no) a10 ON tmMbr.user_no = a10.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total2
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore2})
						AND a.close_date &lt; unix_timestamp(#{monBefore1})
						GROUP BY user_no) a11 ON tmMbr.user_no = a11.user_no
			LEFT JOIN (SELECT user_no, ifnull(sum(amt_total), 0) price_total
						FROM top_rpt_head a, top_rpt_invoice b
						WHERE 
						team_id=#{team_id} 
						AND suim_rpt_state='2'
						AND a.suim_rpt_no = b.suim_rpt_no
						AND a.close_date >= unix_timestamp(#{monBefore1})
						AND a.close_date &lt; unix_timestamp(#{monBefore0})
						GROUP BY user_no) a12 ON tmMbr.user_no = a12.user_no

	</select>
	

</mapper>
