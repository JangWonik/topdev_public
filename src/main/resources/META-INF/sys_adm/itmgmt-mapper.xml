<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ItMgmtMapper">

	<!-- 물보험 관리자(팀장, 센터장) 분기 정보 갱신-->
	<update id="updateBonusManagerInfoByMkey" parameterType="hashmap">
		UPDATE sch_bonus_quarter_manager_info SET
			sdate = #{sdate}
			,edate = #{edate}
			,bonus_pay = #{bonus_pay}
			,workday_cnt = #{workday_cnt}
			,workday_interval = #{workday_interval}
			,workday_per = #{workday_per}
			,workload_target = #{workload_target}
			,workload_cnt = #{workload_cnt}
			,workload_per = #{workload_per}
			,update_flag = 1
		WHERE mkey = #{mkey}		
	</update>
	
	<select id="selectBonusMemberInfoBySkey" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.skey
			,GA.user_no
			,GA.team_id
			,GA.team_center
			,GA.center_name
			,GA.team_sector
			,GA.team_sector_name			
			,GA.team_name
			,GA.work_level_name
			,GA.work_type_name
			,GA.user_name
			,GA.bonus_pay
			,GA.workday_cnt
			,GA.workday_interval			
			,GA.workday_per
			,GA.workload_target
			,GA.workload_cnt
			,GA.workload_per						
			,GA.base_year			
			,GA.base_date
			,GA.quarter_flag
			,GA.base_date_fmt
			,GA.reg_date			
			,GA.reg_date_fmt
			,GA.sdate_fmt
			,GA.edate_fmt
			,GA.user_state
			,GA.out_date
			,GA.out_date_fmt
			,GA.manager_name
			,GA.join_date
			,GA.join_date_fmt
			,GA.bonus_career_state
			,CASE
				WHEN GA.bonus_career_state = 2
				THEN GA.join_date_fmt
				WHEN GA.bonus_career_state = 1
				THEN DATE_ADD(GA.join_date_fmt, INTERVAL 3 MONTH)
				ELSE DATE_ADD(GA.join_date_fmt, INTERVAL 1 YEAR)
			END AS work_sdate			
		FROM(
			SELECT 
				a.skey
				,a.user_no
				,a.team_id
				,a.team_center
				,a.center_name
				,a.team_sector
				,a.team_sector_name			
				,a.team_name
				,a.work_level_name
				,a.work_type_name
				,a.user_name
				,a.bonus_pay
				,a.workday_cnt
				,a.workday_interval			
				,a.workday_per
				,a.workload_target
				,a.workload_cnt
				,a.workload_per						
				,a.base_year			
				,a.base_date
				,a.quarter_flag
				,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
				,a.reg_date			
				,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
				,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
				,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt
				,b.user_state
				,IFNULL(b.out_date,'') AS out_date
				,IFNULL(FROM_UNIXTIME(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
				,a.manager_name
				,b.join_date
				,from_unixtime(b.join_date,"%Y-%m-%d") AS join_date_fmt
				,a.bonus_career_state
			FROM sch_bonus_quarter_member_daily a
			LEFT JOIN top_mbr_bsc b
			ON a.user_no = b.user_no
			WHERE 1=1
			AND a.skey = #{skey}
		)GA		 		
	</select>
	
	<!-- 관리자(팀장, 센터장) 마지막 발령일자 가져오기 -->
	<select id="selectBonusManagerInfoByAppointDate" parameterType="hashmap" resultType="String">
		SELECT 	
			IFNULL(FROM_UNIXTIME(appoint_date,'%Y-%m-%d'),'') AS appoint_date_fmt
			<!-- ,COUNT(*) AS cnt -->
		  FROM top_mbr_appoint 
		 WHERE user_no = #{manager_no}
		   AND appoint_team_id = #{team_id}
		   AND appoint_date &lt;= UNIX_TIMESTAMP(#{edate_fmt})
		   ORDER BY appoint_date DESC
		 LIMIT 0, 1
	</select>
	
	<!-- 물보험 관리자(팀장, 센터장) 분기 정보 가져오기 -->
	<select id="selectBonusManagerInfoByMkey" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.mkey
			,GA.manager_no
			,GA.manager_name
			,GA.team_id
			,GA.team_center
			,GA.center_name
			,GA.team_name
			,GA.team_sector
			,GA.team_sector_name
			,GA.work_level
			,GA.work_level_name
			,GA.work_type
			,GA.work_type_name
			,GA.work_job
			,GA.bonus_pay
			,GA.workday_cnt
			,GA.workday_interval
			,GA.workday_per
			,GA.workload_target
			,GA.workload_cnt
			,GA.workload_per
			,GA.base_year
			,GA.quarter_flag
			,GA.bonus_career_state
			,GA.team_written
			,GA.base_date
			,GA.sdate
			,GA.sdate_fmt
			,GA.edate
			,GA.edate_fmt
			,GA.user_state
			,GA.out_date
			,GA.out_date_fmt
			,GA.team_group_order
			,GA.team_order
			,GA.reg_date
			,GA.reg_date_fmt
			,GA.join_date
			,GA.join_date_fmt
			,CASE
				WHEN GA.bonus_career_state = 2
				THEN GA.join_date_fmt
				WHEN GA.bonus_career_state = 1
				THEN DATE_ADD(GA.join_date_fmt, INTERVAL 3 MONTH)
				ELSE DATE_ADD(GA.join_date_fmt, INTERVAL 1 YEAR)
			END AS work_sdate
			,GA.update_flag
		FROM
		(
			SELECT
				a.mkey
				,a.manager_no
				,a.manager_name
				,a.team_id
				,a.team_center
				,a.center_name
				,a.team_name
				,a.team_sector
				,a.team_sector_name
				,a.work_level
				,a.work_level_name
				,a.work_type
				,a.work_type_name
				,a.work_job
				,a.bonus_pay
				,a.workday_cnt
				,a.workday_interval
				,a.workday_per
				,a.workload_target
				,a.workload_cnt
				,a.workload_per
				,a.base_year
				,a.quarter_flag
				,a.bonus_career_state
				,a.team_written
				,a.base_date
				,a.sdate
				,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
				,a.edate
				,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt
				,a.user_state
				,a.out_date
				,DATE_FORMAT(a.out_date,'%Y-%m-%d') AS out_date_fmt
				,a.team_group_order
				,a.team_order
				,a.reg_date
				,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
				,b.join_date
				,from_unixtime(b.join_date,"%Y-%m-%d") AS join_date_fmt
				,a.update_flag
			FROM sch_bonus_quarter_manager_info a
			LEFT JOIN top_mbr_bsc b
			ON a.manager_no = b.user_no
			WHERE mkey = #{mkey}
		)GA
	</select>
	
	<!-- 물보험 관리자(팀장, 센터장) 분기별 중복데이터 체크 -->
	<select id="countBonusManagerListByQuarter" parameterType="hashmap" resultType="integer">
		SELECT 
			COUNT(*) AS nCnt 
		FROM sch_bonus_quarter_manager_info
		WHERE manager_no = #{manager_no}
		AND base_year = #{base_year}
		AND quarter_flag = #{quarter_flag}
	</select>
	
	<!-- 물보험 관리자(팀장, 센터장) 분기별 설정 정보 삭제 -->
	<delete id="deleteBonusManagerInfoByQuarter"  parameterType="String">
		DELETE FROM sch_bonus_quarter_manager_info WHERE mkey = #{mkey}
	</delete>
	
	<!-- 물보험 관리자(팀장, 센터장) 분기별 설정 정보 등록 -->
	<insert id="insertBonusManagerInfoByQuarter" parameterType="hashmap">
		INSERT INTO sch_bonus_quarter_manager_info (
			manager_no
			,manager_name
			,team_id
			,team_center
			,center_name
			,team_name
			,team_sector
			,team_sector_name
			,work_level
			,work_level_name
			,work_type
			,work_type_name
			,work_job
			,bonus_pay
			,workday_cnt
			,workday_interval
			,workday_per
			,workload_target
			,workload_cnt
			,workload_per
			,base_year
			,quarter_flag
			,bonus_career_state
			,team_written
			,base_date
			,sdate
			,edate
			,user_state
			<if test="out_date != null and out_date != ''">
				,out_date
			</if>
			,team_group_order
			,team_order			
			,reg_date			
		) VALUES (
			#{manager_no}
			,#{manager_name}
			,#{team_id}
			,#{team_center}
			,#{center_name}
			,#{team_name}
			,#{team_sector}
			,#{team_sector_name}
			,#{work_level}
			,#{work_level_name}
			,#{work_type}
			,#{work_type_name}
			,#{work_job}
			,#{bonus_pay}
			,#{workday_cnt}
			,#{workday_interval}
			,#{workday_per}
			,#{workload_target}
			,#{workload_cnt}
			,#{workload_per}
			,#{base_year}
			,#{quarter_flag}
			,#{bonus_career_state}
			,#{team_written}
			,#{base_date}
			,#{sdate}
			,#{edate}
			,#{user_state}
			<if test="out_date != null and out_date != ''">
				,#{out_date}
			</if>
			,#{team_group_order}
			,#{team_order}
			,now()
		)		
	</insert>
	
	<!-- 물보험 관리자(팀장, 센터장) 분기별 설정 정보 등록 -->	
	<insert id="insertBonusManagerListByQuarter" parameterType="java.util.List">
		INSERT INTO sch_bonus_quarter_manager_info (
			manager_no
			,manager_name
			,team_id
			,team_center
			,center_name
			,team_name
			,team_sector
			,team_sector_name
			,work_level
			,work_level_name
			,work_type
			,work_type_name
			,work_job
			,bonus_pay
			,workday_cnt
			,workday_interval
			,workday_per
			,workload_target
			,workload_cnt
			,workload_per
			,base_year
			,quarter_flag
			,bonus_career_state
			,team_written
			,base_date
			,sdate
			,edate
			,user_state
			,out_date
			,reg_date			
		) VALUES
		<foreach collection="list" item="item" separator=",">
		(
			#{item.manager_no}
			,#{item.manager_name}
			,#{item.team_id}
			,#{item.team_center}
			,#{item.center_name}
			,#{item.team_name}
			,#{item.team_sector}
			,#{item.team_sector_name}
			,#{item.work_level}
			,#{item.work_level_name}
			,#{item.work_type}
			,#{item.work_type_name}
			,#{item.work_job}
			,#{item.bonus_pay}
			,#{item.workday_cnt}
			,#{item.workday_interval}
			,#{item.workday_per}
			,#{item.workload_target}
			,#{item.workload_cnt}
			,#{item.workload_per}
			,#{item.base_year}
			,#{item.quarter_flag}
			,#{item.bonus_career_state}
			,#{item.team_written}
			,#{item.base_date}
			,#{item.sdate}
			,#{item.edate}
			,#{item.user_state}
			,#{item.out_date}
			,now()
		)
		</foreach>
	</insert>

	<!-- 물보험 관리자(팀장, 센터장) 분기별 설정 정보 가져오기 -->
	<select id="selectBonusManagerListByQuarter" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.manager_no
			,GA.manager_name
			,GA.team_id
			,GA.team_center
			,GA.center_name
			,GA.team_name
			,GA.team_sector
			,GA.team_sector_name
			,GA.work_level
			,GA.work_level_name
			,GA.work_type
			,GA.work_type_name
			,GA.work_job
			,GA.bonus_career_state
			,GA.team_written
			,GA.user_state
			,IFNULL(GA.out_date, '') AS out_date
			,GA.team_group_order
			,GA.team_order
			,#{sDate} AS sdate
			,#{eDate} AS edate
			,#{base_year} AS base_year
			,#{base_date} AS base_date
			,#{quarter_flag} AS quarter_flag
			,#{workday_cnt} AS workday_cnt
			,#{workday_interval} AS workday_interval
			,#{workday_per} AS workday_per
		FROM(
			SELECT 
				a.user_no AS manager_no
				,a.user_name AS manager_name	
				,b.team_id
				,b.team_center	
				,(SELECT col_val FROM sysadm_codedic WHERE col_cd = b.team_center AND tbl_nm = 'top_tm_bsc' AND col_nm = 'team_center') AS center_name
				,b.team_name
				,b.team_sector
				,(SELECT col_val FROM sysadm_codedic WHERE col_cd = b.team_sector AND tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector') AS team_sector_name
				,a.work_level
				,getCodeValue("top_mbr_bsc", "work_level", a.work_level) AS work_level_name
				,a.work_type
				,getCodeValue("top_mbr_bsc", "work_type", a.work_type) AS work_type_name	
				,a.work_job
				,a.bonus_career_state
				,b.team_written	
				,a.user_state	
				,FROM_UNIXTIME(a.out_date) AS out_date	
				,b.team_group_order
				,b.team_order
			FROM top_mbr_bsc a, top_tm_bsc b
			WHERE a.team_id_main = b.team_id
			<if test='view_type == "Team"'>
				AND a.work_type = 3
			</if>
			<if test='view_type == "Center"'>
				AND a.work_type = 14
			</if>			
			AND ( a.user_state != 1 OR ( FROM_UNIXTIME(a.out_date) >= #{yearSdate} AND FROM_UNIXTIME(a.out_date) &lt; #{yearEdate})) 
			AND b.team_type != 4
		)GA
		ORDER BY GA.team_group_order DESC, GA.team_order DESC	
	</select>
	
	<!-- 물보험 직원 년간 목표건수 설정 추가 -->
	<insert id="insertMemberTargetVal" parameterType="HashMap">
		INSERT INTO top_workload_target (
			user_no
			,base_year
			,target_val
		) VALUES (
			#{user_no}
			,#{base_year}
			,#{target_val}
		)		
	</insert>
	
	<!-- 물보험 직원 년간 목표건수 설정 변경 -->
	<update id="updateMemberTargetVal" parameterType="HashMap">
		UPDATE top_workload_target SET
			target_val = #{target_val}
		WHERE user_no = #{user_no}
		AND base_year = #{base_year}
	</update>

	<!-- 물보험 성과급 신입/경력 설정 변경 -->
	<update id="updateCareerBonusState" parameterType="HashMap">
		UPDATE top_mbr_bsc SET
	  	   bonus_career_state = #{bonus_career_state}
	  	 WHERE user_no = #{user_no}	
	</update>

	<!-- 물보험 관리자 성과급 설정 변경 -->
	<update id="updateManagerBonusState" parameterType="HashMap">
		UPDATE top_mbr_bsc SET
	  	   bonus_manager_state = #{bonus_manager_state}
	  	 WHERE user_no = #{user_no}	
	</update>

	<!-- 물보험 직원 성과급 설정 변경 -->
	<update id="updateMemberBonusState" parameterType="HashMap">
		UPDATE top_mbr_bsc SET
	  	   bonus_state = #{bonus_state}
	  	 WHERE user_no = #{user_no}	
	</update>
	
	<delete id="deleteSuimPeriod" parameterType="hashmap">
		DELETE FROM top_rpt_period
		WHERE ptnr_id = #{ptnr_id}
		AND ptnr_id_sub = #{ptnr_id_sub}
	</delete>
	
	<delete id="deleteSuimType" parameterType="hashmap">
		DELETE FROM top_rpt_type
		WHERE  suim_rpt_type1 = #{suim_rpt_type1}
		AND workload_type = #{workload_type}
	</delete>
	
	<insert id="insertSuimPeriod" parameterType="hashmap">
		INSERT INTO top_rpt_period (
			ptnr_id
			,ptnr_id_sub
			,period_flag
		) VALUES (
			#{ptnr_id}
			,#{ptnr_id_sub}
			,#{period_flag}
		)
	</insert>
	
	<insert id="insertSuimType" parameterType="hashmap">
		INSERT INTO top_rpt_type (
			suim_rpt_type1
			,workload_type
			,div_type
		) VALUES (
			#{suim_rpt_type1}
			,#{workload_type}
			,#{div_type}
		)
	</insert>
	
	<update id="updateSuimPeriod" parameterType="hashmap">
		UPDATE top_rpt_period SET
			period_flag = #{period_flag}
		WHERE ptnr_id = #{ptnr_id}
		AND ptnr_id_sub = #{ptnr_id_sub}	
	</update>
	
	<update id="updateSuimType" parameterType="hashmap">
		UPDATE top_rpt_type SET
			div_type = #{div_type}
		WHERE suim_rpt_type1 = #{suim_rpt_type1}
		AND workload_type = #{workload_type}	
	</update>
	
	<select id="countSuimPeriodSearch" parameterType="hashmap" resultType="integer">
		SELECT COUNT(*) FROM top_rpt_period
		WHERE ptnr_id = #{ptnr_id}
		AND ptnr_id_sub = #{ptnr_id_sub}	
	</select>
	
	<select id="countSuimTypeSearch" parameterType="hashmap" resultType="integer">
		SELECT COUNT(*) FROM top_rpt_type
		WHERE suim_rpt_type1 = #{suim_rpt_type1}
		AND workload_type = #{workload_type}	
	</select>
	
	<select id="selectSuimRptPeriodListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.ptnr_id
			,GB.ptnr_name
			,GB.ptnr_id_sub
			,GB.ptnr_id_sub_name
			,GB.period_flag
		FROM
		(
			SELECT
				GA.ptnr_id
				,GA.ptnr_name
				,GA.ptnr_id_sub
				,GA.ptnr_id_sub_name
				,IFNULL(TP.period_flag, 0) AS period_flag		
			FROM
			(
				SELECT 
					a.ptnr_id AS ptnr_id
					,a.ptnr_nick AS ptnr_name			
					,b.col_cd1 AS col_cd1 
					,CAST(b.col_cd2 AS SIGNED INTEGER) AS ptnr_id_sub				
					,b.col_val AS ptnr_id_sub_name
				FROM top_ptnr_bsc a, sysadm_codedic2 b
				WHERE a.ptnr_id = b.col_cd1
				AND a.del_state = 0
				AND b.tbl_nm = 'top_rpt_head'
				AND b.col_nm = 'ptnr_id_sub'
				<if test="ptnrSearch != 0">
					AND a.ptnr_id = #{ptnrSearch}
				</if>
				ORDER BY a.statistics_order, b.col_cd2 ASC
			)GA
			LEFT JOIN top_rpt_period TP
			ON GA.ptnr_id = TP.ptnr_id
			AND GA.ptnr_id_sub = TP.ptnr_id_sub	
		)GB
		WHERE 1=1
		<if test="periodSearch != 9">
			AND GB.period_flag = #{periodSearch}
		</if>		
	</select>
	
	<select id="selectSuimRptTypeCodeListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.type_code1
			,GA.type_code2
			,GA.type_name1
			,GA.type_name2
			,IFNULL(TY.div_type,0) AS div_type
		FROM
			(
				SELECT		
					a.col_cd1 AS type_code1
					,CAST(a.col_cd2 AS SIGNED INTEGER) AS type_code2
					,b.col_val AS type_name1
					,a.col_val AS type_name2
				FROM sysadm_codedic2 a, sysadm_codedic b
				WHERE a.tbl_nm = b.tbl_nm
				AND a.col_cd1 = b.col_cd
				AND a.tbl_nm = 'top_rpt_head'
				AND a.col_nm = 'workload_type_div'
				AND b.col_nm = 'suim_rpt_type1'
			)GA 
			LEFT JOIN top_rpt_type TY
			ON GA.type_code1 = TY.suim_rpt_type1
			AND GA.type_code2 = TY.workload_type
			
			WHERE 1=1
			<if test="srchRptType != '9999'">
				AND div_type = #{srchRptType}
			</if>
			<if test="srchTypeName != ''">
				AND GA.type_name2 LIKE CONCAT('%',#{srchTypeName},'%')
			</if>				
	</select>
	
	<!-- 물보험 직원 성과급 년간 목표 정보 가져오기 -->
	<select id="selectBonusYearMemberListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.user_no
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,(SELECT col_val FROM sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector) AS team_sector_name
			,GA.team_sector
			,GA.team_name AS team_name
			,GA.user_name AS user_name  
			,getCodeValue("top_mbr_bsc", "work_level", GA.work_level) AS work_level_name
			,getCodeValue("top_mbr_bsc", "work_type", GA.work_type) AS work_type_name
			,GA.user_state
			,GA.work_job
			,getCodeValue("top_mbr_bsc", "user_state", GA.user_state) AS user_state_name
			,GA.team_id	
			,GA.team_center
			,GA.join_date
			,GA.join_date_fmt
			,GA.bonus_state	
			,IFNULL(WT.base_year,'') AS base_year
			,IFNULL(WT.target_val,0) AS target_val		
		FROM (
			SELECT
				a.user_no
				,a.user_name
				,a.work_level
				,a.work_type
				,a.join_date
				,from_unixtime(a.join_date,"%Y-%m-%d") as join_date_fmt				
				,a.bonus_state
				,a.user_state
				,a.work_job
				,b.team_id
				,b.team_name
				,b.team_group_order
				,b.team_order 
				,b.team_type
				,b.team_center
				,b.team_sector
				,CASE a.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15
				END AS new_work_order
			FROM top_mbr_bsc a, top_tm_bsc b
			WHERE a.team_id_main = b.team_id
			AND b.team_type IN(0,1)			
			<if test="srchStatus == 0">
				AND a.user_state != 1 
			</if>
			<if test="srchStatus == 1">
				AND a.user_state = 1 
			</if>			
			<if test="srchUserName != ''">
				AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
			</if>		
			<if test="srchCenterList != ''">
				AND b.team_center = #{srchCenterList}
			</if>
			<if test="tmSearchMain != ''">
				AND b.team_id = #{tmSearchMain}
			</if>			
 		)GA 
 		LEFT JOIN top_workload_target WT
		ON GA.user_no = WT.user_no
		<if test="srchBaseYear != '9999'">
			AND WT.base_year = #{srchBaseYear}			
		</if>
 		ORDER BY GA.user_state, GA.team_group_order DESC, GA.team_order DESC, GA.work_level DESC, GA.join_date, GA.new_work_order
	</select>
	
	<select id="selectStaffMemberList" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.user_no
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,(SELECT col_val FROM sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector) AS team_sector_name
			,GA.team_sector
			,GA.team_name AS team_name
			,GA.user_name AS user_name  
			,getCodeValue("top_mbr_bsc", "work_level", GA.work_level) AS work_level_name
			,getCodeValue("top_mbr_bsc", "work_type", GA.work_type) AS work_type_name
			,GA.team_id	
			,GA.team_center
			,GA.join_date
			,GA.join_date_fmt
			,GA.out_date
			,GA.out_date_fmt
			,GA.user_id
			,getCodeValue('top_mbr_bsc','user_state',GA.user_state) AS user_state_name
			,GA.jumin_no1
			,GA.jumin_no2
			,(SELECT COUNT(*) FROM top_mbr_work WHERE user_no = GA.user_no) as leave_cnt
			,GA.exp_agree						
		FROM (
			SELECT
				a.user_no
				,a.user_name
				,a.user_id
				,a.work_level
				,a.work_type
				,a.join_date
				,from_unixtime(a.join_date,"%Y-%m-%d") AS join_date_fmt
				,a.out_date
				,from_unixtime(a.out_date,"%Y-%m-%d") AS out_date_fmt
				,a.user_state
				,a.bonus_state
				,b.team_id
				,b.team_name
				,b.team_group_order
				,b.team_order 
				,b.team_type
				,b.team_center
				,b.team_sector
				,CASE a.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15
				END AS new_work_order
				,IFNULL(a.jumin_no1,'') AS jumin_no1
				,IFNULL(a.jumin_no2,'') AS jumin_no2
				,a.exp_agree				
			FROM top_mbr_bsc a, top_tm_bsc b
			WHERE a.team_id_main = b.team_id						
			<if test="srchState == 0">
				AND a.user_state != 1 
			</if>
			<if test="srchState == 3">
				AND a.user_state = 3 
			</if>
			<if test="srchState == 1">
				AND a.user_state = 1 
			</if>
			<if test="srchTeamId != ''">
				AND b.team_id = #{srchTeamId}
			</if>
			<if test="sJoinDate != ''">
				AND a.join_date >= UNIX_TIMESTAMP( #{sJoinDate} )
			</if>	
			<if test="eJoinDate != ''">
				AND a.join_date &lt;= UNIX_TIMESTAMP( #{eJoinDate} )
			</if>
			<if test="sOutDate != ''">
				AND a.out_date >= UNIX_TIMESTAMP( #{sOutDate} )
			</if>	
			<if test="eOutDate != ''">
				AND a.out_date &lt;= UNIX_TIMESTAMP( #{eOutDate} )
			</if>	
			
			<if test="searchStr != null and searchStr != ''">
				AND ( a.user_name like CONCAT('%',#{searchStr},'%')
				     OR a.user_id like CONCAT('%',#{searchStr},'%')
				     OR a.handphone like CONCAT('%',#{searchStr},'%')
				     OR a.office_tel like CONCAT('%',#{searchStr},'%') )
			</if>					
 		)GA
 		ORDER BY 
	 		<if test='joinDateOrder == "ASC" '>
	 			GA.join_date ASC, 
	 		</if>
	 		<if test='joinDateOrder == "DESC" '>
	 			GA.join_date DESC,
	 		</if>
	 		<if test='outDateOrder == "ASC" '>
	 			GA.out_date ASC, 
	 		</if>
	 		<if test='outDateOrder == "DESC" '>
	 			GA.out_date DESC,
	 		</if> 		
 		GA.user_state, GA.team_group_order DESC, GA.team_order DESC, GA.work_level DESC, GA.join_date, GA.new_work_order
	</select>
	
	<!-- 물보험 성과급 신입/경력 설정 조회설정목록 가져오기 -->
	<select id="selectBonusStatusCareerListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.user_no
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,(SELECT col_val FROM sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector) AS team_sector_name
			,GA.team_sector
			,GA.team_name AS team_name
			,GA.user_name AS user_name  
			,getCodeValue("top_mbr_bsc", "work_level", GA.work_level) AS work_level_name
			,getCodeValue("top_mbr_bsc", "work_type", GA.work_type) AS work_type_name
			,GA.team_id	
			,GA.team_center
			,GA.join_date
			,GA.join_date_fmt
			,GA.bonus_state
			,GA.bonus_career_state
			,GA.bonus_manager_state				
		FROM (
			SELECT
				a.user_no
				,a.user_name
				,a.work_level
				,a.work_type
				,a.join_date
				,from_unixtime(a.join_date,"%Y-%m-%d") as join_date_fmt
				,a.user_state
				,a.bonus_state
				,a.bonus_career_state
				,a.bonus_manager_state				
				,b.team_id
				,b.team_name
				,b.team_group_order
				,b.team_order 
				,b.team_type
				,b.team_center
				,b.team_sector
				,CASE a.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15
				END AS new_work_order
			FROM top_mbr_bsc a, top_tm_bsc b
			WHERE a.team_id_main = b.team_id
			AND b.team_type IN (0,1)
			<if test="srchStatus == 0">
				AND a.user_state != 1 
			</if>
			<if test="srchStatus == 1">
				AND a.user_state = 1 
			</if>
			<if test="srchCareerStatus != '9999'">
				AND a.bonus_career_state = #{srchCareerStatus}
			</if>
			<if test="srchUserName != ''">
				AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
			</if>		
			<if test="srchCenterList != ''">
				AND b.team_center = #{srchCenterList}
			</if>
			<if test="tmSearchMain != ''">
				AND b.team_id = #{tmSearchMain}
			</if>			
 		)GA
 		ORDER BY GA.user_state, GA.team_group_order DESC, GA.team_order DESC, GA.work_level DESC, GA.join_date, GA.new_work_order
	</select>
	
	<!-- 물보험 관리자(팀장,센터장) 성과급 조회설정목록 가져오기 -->
	<select id="selectBonusStatusManagerListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.user_no
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,(SELECT col_val FROM sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector) AS team_sector_name
			,GA.team_sector
			,GA.team_name AS team_name
			,GA.user_name AS user_name  
			,getCodeValue("top_mbr_bsc", "work_level", GA.work_level) AS work_level_name
			,getCodeValue("top_mbr_bsc", "work_type", GA.work_type) AS work_type_name
			,GA.team_id	
			,GA.team_center
			,GA.join_date
			,GA.join_date_fmt
			,GA.bonus_state
			,GA.bonus_manager_state				
		FROM (
			SELECT
				a.user_no
				,a.user_name
				,a.work_level
				,a.work_type
				,a.join_date
				,from_unixtime(a.join_date,"%Y-%m-%d") as join_date_fmt
				,a.user_state
				,a.bonus_state
				,a.bonus_manager_state
				,b.team_id
				,b.team_name
				,b.team_group_order
				,b.team_order 
				,b.team_type
				,b.team_center
				,b.team_sector
				,CASE a.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15
				END AS new_work_order
			FROM top_mbr_bsc a, top_tm_bsc b
			WHERE a.team_id_main = b.team_id
			AND b.team_type IN (0,1)	
			AND a.work_type IN (3,14)
			<if test="srchStatus == 0">
				AND a.user_state != 1 
			</if>
			<if test="srchStatus == 1">
				AND a.user_state = 1 
			</if>
			<if test="srchBonusStatus != '9999'">
				AND a.bonus_manager_state = #{srchBonusStatus}
			</if>
			<if test="srchUserName != ''">
				AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
			</if>		
			<if test="srchCenterList != ''">
				AND b.team_center = #{srchCenterList}
			</if>
			<if test="tmSearchMain != ''">
				AND b.team_id = #{tmSearchMain}
			</if>			
 		)GA
 		ORDER BY GA.user_state, GA.team_group_order DESC, GA.team_order DESC, GA.work_level DESC, GA.join_date, GA.new_work_order
	</select>

	<!-- 물보험 직원 성과급 조회 설정 목록 가져오기 -->
	<select id="selectBonusStatusMemberListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.user_no
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,(SELECT col_val FROM sysadm_codedic WHERE tbl_nm = 'top_tm_bsc' AND col_nm = 'team_sector' AND col_cd = GA.team_sector) AS team_sector_name
			,GA.team_sector
			,GA.team_name AS team_name
			,GA.user_name AS user_name  
			,getCodeValue("top_mbr_bsc", "work_level", GA.work_level) AS work_level_name
			,getCodeValue("top_mbr_bsc", "work_type", GA.work_type) AS work_type_name
			,GA.team_id	
			,GA.team_center
			,GA.join_date
			,GA.join_date_fmt
			,GA.bonus_state		
		FROM (
			SELECT
				a.user_no
				,a.user_name
				,a.work_level
				,a.work_type
				,a.join_date
				,from_unixtime(a.join_date,"%Y-%m-%d") as join_date_fmt
				,a.user_state
				,a.bonus_state
				,b.team_id
				,b.team_name
				,b.team_group_order
				,b.team_order 
				,b.team_type
				,b.team_center
				,b.team_sector
				,CASE a.work_type
					WHEN 1 THEN 1
					WHEN 2 THEN 2
					WHEN 6 THEN 3
					WHEN 14 THEN 4
					WHEN 15 THEN 5
					WHEN 3 THEN 6
					WHEN 7 THEN 7
					WHEN 4 THEN 8
					WHEN 8 THEN 9
					WHEN 5 THEN 10
					WHEN 9 THEN 11
					WHEN 10 THEN 12
					WHEN 12 THEN 13
					WHEN 11 THEN 14
					WHEN 13 THEN 15
				END AS new_work_order
			FROM top_mbr_bsc a, top_tm_bsc b
			WHERE a.team_id_main = b.team_id
			AND b.team_type IN(0,1)			
			<if test="srchStatus == 0">
				AND a.user_state != 1 
			</if>
			<if test="srchStatus == 1">
				AND a.user_state = 1 
			</if>
			<if test="srchBonusStatus != '9999'">
				AND a.bonus_state = #{srchBonusStatus}
			</if>
			<if test="srchUserName != ''">
				AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
			</if>		
			<if test="srchCenterList != ''">
				AND b.team_center = #{srchCenterList}
			</if>
			<if test="tmSearchMain != ''">
				AND b.team_id = #{tmSearchMain}
			</if>			
 		)GA
 		ORDER BY GA.user_state, GA.team_group_order DESC, GA.team_order DESC, GA.work_level DESC, GA.join_date, GA.new_work_order
	</select>
	
	<!-- 팀기준 분기별 성과급 스케줄러 정보 가져오기 -->
	<select id="selectSchBonusTeamQuarterInfoBySkey" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name			
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,a.quarter_flag
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_team_quarter_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1
		AND a.skey = #{skey}
	</select>
	
	<!-- 팀기준 성과급 스케줄러 정보 가져오기 -->
	<select id="selectSchBonusTeamInfoBySkey" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name			
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_team_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1
		AND a.skey = #{skey}
	</select>
	
	<!-- 개인 기준 성과급 연간 스케줄러 정보 가져오기 -->
	<select id="selectSchBonusYearInfoBySkey" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name			
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_year_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1
		AND a.skey = #{skey}
	</select>
	
	<!-- 개인 기준 성과급 분기 스케줄러 정보 가져오기 -->
	<select id="selectSchBonusInfoBySkey" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name			
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year
			,a.quater_flag
			,a.base_date
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1
		AND a.skey = #{skey}
	</select>
	
	<!-- 팀 기준 성과급 스케줄러 로그조회 -->
	<select id="selectSchBonusTeamListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date			
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
			,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_team_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1		
		<if test="srchUserName != ''">
			AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
		</if>		
		<if test="srchCenterList != ''">
			AND a.team_center = #{srchCenterList}
		</if>
		<if test="srchSectorList != ''">
			AND a.team_sector = #{srchSectorList}
		</if>
		<if test="tmSearchMain != ''">
			AND a.team_id = #{tmSearchMain}
		</if>
		<if test="srchBaseYear != 9999">
			AND a.base_year = #{srchBaseYear}
		</if>		
		<if test="srchSdate != ''">
			AND a.base_date >= #{srchSdate}
		</if>
		<if test="srchEdate != ''">
			AND a.base_date &lt;= #{srchEdate}
		</if>
		<if test="srchWorkType != 9999">
			AND b.work_type = #{srchWorkType}
		</if>
		<if test="srchUserState == 0">
			AND b.user_state != 1
		</if>
		<if test="srchUserState == 1">
			AND b.user_state = 1
		</if>
		ORDER BY a.skey ASC
	</select>
	
	<!-- 분기별 관리자 기준 팅원 실적 등록 -->
	<insert id="insertSchBonusMemberListQuarterByManagerNo" parameterType="hashmap">		
		INSERT INTO sch_bonus_quarter_member_daily (
			user_no
			,team_id
			,team_center
			,center_name
			,team_name
			,team_sector
			,team_sector_name
			,work_level_name
			,work_type_name
			,user_name
			,work_job
			,bonus_pay
			,workday_cnt
			,workday_interval
			,workday_per
			,workload_target
			,workload_cnt
			,workload_per
			,base_year
			,quarter_flag
			,bonus_career_state
			,team_written
			,base_date
			,sdate
			,edate
			,manager_no
			,manager_name
			,reg_date
		) VALUES (
			#{user_no}
			,#{team_id}
			,#{team_center}
			,#{center_name}
			,#{team_name}
			,#{team_sector}
			,#{team_sector_name}
			,#{work_level_name}
			,#{work_type_name}
			,#{user_name}
			,#{work_job}
			,#{bonus_pay}
			,#{workday_cnt}
			,#{workday_interval}
			,#{workday_per}
			,#{workload_target}
			,#{workload_cnt}
			,#{workload_per}
			,#{base_year}
			,#{quarter_flag}
			,#{bonus_career_state}
			,#{team_written}
			,#{base_date_fmt}
			,#{sdate_fmt}
			,#{edate_fmt}
			,#{manager_no}
			,#{manager_name}
			,now()
		)
	</insert>
	
	<!-- 분기별 관리자 기준 팀원 실적 등록여부 확인 -->
	<select id="countSchBonusMemberListQuarterByManagerNo" parameterType="hashmap" resultType="Integer">
		SELECT 
			COUNT(*) AS nCnt
		FROM sch_bonus_quarter_member_daily
		WHERE base_date = #{base_date_fmt}
			AND quarter_flag = #{quarter_flag}
			AND base_year = #{base_year}
			AND user_no = #{user_no}
			AND manager_no = #{manager_no}
			AND sdate = #{sdate_fmt}		
	</select>
	
	<!-- 분기별 팀원 목록 불러오기 (팀장 발령일보다 이전 실적은 제외한다.)-->
	<select id="selectSchBonusMemberListQuarterByTeamId" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name
			,a.work_type_name
			,a.user_name
			,a.work_job
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,a.quarter_flag
			,a.bonus_career_state
			,a.team_written
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date			
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
			,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt 
		FROM sch_bonus_team_quarter_daily a 
		WHERE 1=1
			AND a.base_date = #{base_date}
			AND a.quarter_flag = #{quarter_flag}
			<if test="work_type == 3">
				AND a.team_id = #{team_id}	
			</if>
			<if test="work_type == 14">
				AND a.team_center = #{team_center}	
			</if>			
			AND a.user_no != #{manager_no} 
			<!-- AND a.edate >= #{sdate_fmt} -->
			AND a.edate >= #{ap_date_fmt}		
	</select>	
	
	<!-- 분기별 팀장 설정 목록 조회 -->
	<select id="selectSchBonusManagerListQuarterSearchByBaseYear" parameterType="hashmap" resultType="hashmap">
		SELECT
			mkey
			,manager_no
			,manager_name
			,team_id
			,team_center
			,work_type
			,quarter_flag
			,sdate
			,DATE_FORMAT(sdate,'%Y-%m-%d') AS sdate_fmt
			,edate
			,DATE_FORMAT(edate,'%Y-%m-%d') AS edate_fmt
		FROM sch_bonus_quarter_manager_info
		WHERE 1=1
		AND base_year = #{base_year}
		ORDER BY quarter_flag ASC, work_type ASC, team_group_order DESC, team_order DESC
	</select>
	
	<!-- 분기별 팀장 설정 목록 조회 -->
	<select id="selectSchBonusManagerListQuarterSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.mkey
			,GA.manager_no
			,GA.manager_name
			,GA.team_id
			,GA.team_center
			,GA.center_name
			,GA.team_name
			,GA.team_sector
			,GA.team_sector_name
			,GA.work_level
			,GA.work_level_name
			,GA.work_type
			,GA.work_type_name
			,GA.work_job
			,GA.bonus_pay
			,GA.workday_cnt
			,GA.workday_interval
			,GA.workday_per
			,GA.workload_target
			,GA.workload_cnt
			,GA.workload_per
			,GA.base_year
			,GA.quarter_flag
			,GA.bonus_career_state
			,GA.team_written
			,GA.base_date
			,GA.sdate
			,GA.sdate_fmt
			,GA.edate
			,GA.edate_fmt
			,GA.user_state
			,GA.out_date
			,GA.team_group_order
			,GA.team_order
			,GA.reg_date
			,GA.reg_date_fmt
			,GA.join_date
			,GA.join_date_fmt
			,CASE
				WHEN GA.bonus_career_state = 2
				THEN GA.join_date_fmt
				WHEN GA.bonus_career_state = 1
				THEN DATE_ADD(GA.join_date_fmt, INTERVAL 3 MONTH)
				ELSE DATE_ADD(GA.join_date_fmt, INTERVAL 1 YEAR)
			END AS work_sdate
			,GA.update_flag
		FROM
		(
			SELECT
				a.mkey
				,a.manager_no
				,a.manager_name
				,a.team_id
				,a.team_center
				,a.center_name
				,a.team_name
				,a.team_sector
				,a.team_sector_name
				,a.work_level
				,a.work_level_name
				,a.work_type
				,a.work_type_name
				,a.work_job
				,a.bonus_pay
				,a.workday_cnt
				,a.workday_interval
				,a.workday_per
				,a.workload_target
				,a.workload_cnt
				,a.workload_per
				,a.base_year
				,a.quarter_flag
				,a.bonus_career_state
				,a.team_written
				,a.base_date
				,a.sdate
				,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
				,a.edate
				,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt
				,a.user_state
				,IFNULL(a.out_date,'') AS out_date
				,a.team_group_order
				,a.team_order
				,a.reg_date
				,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
				,b.join_date
				,from_unixtime(b.join_date,"%Y-%m-%d") AS join_date_fmt
				,a.update_flag
			FROM sch_bonus_quarter_manager_info a
			LEFT JOIN top_mbr_bsc b
			ON a.manager_no = b.user_no
			WHERE 1=1
			<choose>
				<when test='viewType == "Team"'>
					AND a.work_type = 3
					<if test="srchBaseYear != 9999">
						AND a.base_year = #{srchBaseYear}
					</if>
					<if test="srchStatus != 9999">
						AND a.user_state = #{srchStatus}
					</if>
					<if test="srchQuarterFlag != 9999">
						AND a.quarter_flag = #{srchQuarterFlag}
					</if>		
					<if test="srchUserName != ''">
						AND a.manager_name LIKE CONCAT('%',#{srchUserName},'%')
					</if>		
					<if test="srchCenterList != ''">
						AND a.team_center = #{srchCenterList}
					</if>		
					<if test="tmSearchMain != ''">
						AND a.team_id = #{tmSearchMain}
					</if>					
				</when>
				
				<when test='viewType == "Center"'>
					<if test="srchBaseYearCenter != 9999">
						AND a.base_year = #{srchBaseYearCenter}
					</if>
					<if test="srchStatusCenter != 9999">
						AND a.user_state = #{srchStatusCenter}
					</if>
					<if test="srchQuarterFlagCenter != 9999">
						AND a.quarter_flag = #{srchQuarterFlagCenter}
					</if>		
					<if test="srchUserNameCenter != ''">
						AND a.manager_name LIKE CONCAT('%',#{srchUserNameCenter},'%')
					</if>		
					<if test="srchCenterListCenter != ''">
						AND a.team_center = #{srchCenterListCenter}
					</if>		
					<if test="srchSectorList != ''">
						AND a.team_sector = #{srchSectorList}
					</if>
					AND a.work_type = 14				
				</when>			
			</choose>
			ORDER BY a.quarter_flag DESC, a.team_group_order DESC, a.team_order DESC
		)GA		
	</select>
	
	<!-- 관리자 기준 직원 성과급 스케줄러 로그조회 -->
	<select id="selectSchBonusMemberQuarterListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.skey
			,GA.user_no
			,GA.team_id
			,GA.team_center
			,GA.center_name
			,GA.team_sector
			,GA.team_sector_name			
			,GA.team_name
			,GA.work_level_name
			,GA.work_type_name
			,GA.user_name
			,GA.bonus_pay
			,GA.workday_cnt
			,GA.workday_interval			
			,GA.workday_per
			,GA.workload_target
			,GA.workload_cnt
			,GA.workload_per						
			,GA.base_year			
			,GA.base_date
			,GA.quarter_flag
			,GA.base_date_fmt
			,GA.reg_date			
			,GA.reg_date_fmt
			,GA.sdate_fmt
			,GA.edate_fmt
			,GA.user_state
			,GA.out_date
			,GA.out_date_fmt
			,GA.manager_name
			,GA.join_date
			,GA.join_date_fmt
			,GA.bonus_career_state
			,CASE
				WHEN GA.bonus_career_state = 2
				THEN GA.join_date_fmt
				WHEN GA.bonus_career_state = 1
				THEN DATE_ADD(GA.join_date_fmt, INTERVAL 3 MONTH)
				ELSE DATE_ADD(GA.join_date_fmt, INTERVAL 1 YEAR)
			END AS work_sdate
		FROM(
			SELECT 
				a.skey
				,a.user_no
				,a.team_id
				,a.team_center
				,a.center_name
				,a.team_sector
				,a.team_sector_name			
				,a.team_name
				,a.work_level_name
				,a.work_type_name
				,a.user_name
				,a.bonus_pay
				,a.workday_cnt
				,a.workday_interval			
				,a.workday_per
				,a.workload_target
				,a.workload_cnt
				,a.workload_per						
				,a.base_year			
				,a.base_date
				,a.quarter_flag
				,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
				,a.reg_date			
				,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
				,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
				,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt
				,b.user_state
				,IFNULL(b.out_date,'') AS out_date
				,IFNULL(FROM_UNIXTIME(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
				,a.manager_name
				,b.join_date
				,from_unixtime(b.join_date,"%Y-%m-%d") AS join_date_fmt
				,a.bonus_career_state
			FROM sch_bonus_quarter_member_daily a
			LEFT JOIN top_mbr_bsc b
			ON a.user_no = b.user_no
			WHERE 1=1		
			<if test="srchUserName != ''">
				AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
			</if>
			<if test="srchManagerName != ''">
				AND a.manager_name LIKE CONCAT('%',#{srchManagerName},'%')
			</if>		
			<if test="srchCenterList != ''">
				AND a.team_center = #{srchCenterList}
			</if>
			<if test="srchSectorList != ''">
				AND a.team_sector = #{srchSectorList}
			</if>
			<if test="tmSearchMain != ''">
				AND a.team_id = #{tmSearchMain}
			</if>
			<if test="srchBaseYear != 9999">
				AND a.base_year = #{srchBaseYear}
			</if>		
			<if test="srchSdate != ''">
				AND a.base_date >= #{srchSdate}
			</if>
			<if test="srchEdate != ''">
				AND a.base_date &lt;= #{srchEdate}
			</if>
			<if test="srchQuarterFlag != 9">
				AND a.quarter_flag = #{srchQuarterFlag}
			</if>		
			ORDER BY a.quarter_flag ASC, a.skey ASC 
		)GA		
	</select>
	
	<!-- 팀 기준 성과급 스케줄러 로그조회 -->
	<select id="selectSchBonusTeamQuarterListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,a.quarter_flag
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date			
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,DATE_FORMAT(a.sdate,'%Y-%m-%d') AS sdate_fmt
			,DATE_FORMAT(a.edate,'%Y-%m-%d') AS edate_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_team_quarter_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1		
		<if test="srchUserName != ''">
			AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
		</if>		
		<if test="srchCenterList != ''">
			AND a.team_center = #{srchCenterList}
		</if>
		<if test="srchSectorList != ''">
			AND a.team_sector = #{srchSectorList}
		</if>
		<if test="tmSearchMain != ''">
			AND a.team_id = #{tmSearchMain}
		</if>
		<if test="srchBaseYear != 9999">
			AND a.base_year = #{srchBaseYear}
		</if>		
		<if test="srchSdate != ''">
			AND a.base_date >= #{srchSdate}
		</if>
		<if test="srchEdate != ''">
			AND a.base_date &lt;= #{srchEdate}
		</if>
		<if test="srchQuarterFlag != 9">
			AND a.quarter_flag = #{srchQuarterFlag}
		</if>
		<if test="srchUserState == 0">
			AND b.user_state != 1
		</if>
		<if test="srchUserState == 1">
			AND b.user_state = 1
		</if>
		ORDER BY a.quarter_flag ASC, a.skey ASC 
	</select>
	
	<!-- 개인 기준 성과급 연간 스케줄러 로그조회 -->
	<select id="selectSchBonusListYearSearch" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year			
			,a.base_date
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_year_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1		
		<if test="srchUserName != ''">
			AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
		</if>		
		<if test="srchCenterList != ''">
			AND a.team_center = #{srchCenterList}
		</if>
		<if test="srchSectorList != ''">
			AND a.team_sector = #{srchSectorList}
		</if>
		<if test="tmSearchMain != ''">
			AND a.team_id = #{tmSearchMain}
		</if>
		<if test="srchBaseYear != 9999">
			AND a.base_year = #{srchBaseYear}
		</if>		
		<if test="srchSdate != ''">
			AND a.base_date >= #{srchSdate}
		</if>
		<if test="srchEdate != ''">
			AND a.base_date &lt;= #{srchEdate}
		</if>
		<if test="srchUserState == 0">
			AND b.user_state != 1
		</if>
		<if test="srchUserState == 1">
			AND b.user_state = 1
		</if>
		ORDER BY a.skey ASC
	</select>
	
	<!-- 개인 기준 성과급 분기 스케줄러 로그조회 -->
	<select id="selectSchBonusListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT 
			a.skey
			,a.user_no
			,a.team_id
			,a.team_center
			,a.center_name
			,a.team_sector
			,a.team_sector_name			
			,a.team_name
			,a.work_level_name
			,a.work_type_name
			,a.user_name
			,a.bonus_pay
			,a.workday_cnt
			,a.workday_interval			
			,a.workday_per
			,a.workload_target
			,a.workload_cnt
			,a.workload_per						
			,a.base_year
			,a.quater_flag
			,a.base_date
			,DATE_FORMAT(a.base_date,'%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date,'%Y-%m-%d') AS reg_date_fmt
			,b.user_state
			,IFNULL(b.out_date,'') AS out_date
			,IFNULL(DATE_FORMAT(b.out_date,'%Y-%m-%d'),'') AS out_date_fmt
		FROM sch_bonus_daily a
		LEFT JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		WHERE 1=1		
		<if test="srchUserName != ''">
			AND a.user_name LIKE CONCAT('%',#{srchUserName},'%')
		</if>		
		<if test="srchCenterList != ''">
			AND a.team_center = #{srchCenterList}
		</if>
		<if test="srchSectorList != ''">
			AND a.team_sector = #{srchSectorList}
		</if>
		<if test="tmSearchMain != ''">
			AND a.team_id = #{tmSearchMain}
		</if>
		<if test="srchBaseYear != 9999">
			AND a.base_year = #{srchBaseYear}
		</if>
		<if test="srchQuaterFlag != 9">
			AND a.quater_flag = #{srchQuaterFlag}
		</if>
		<if test="srchSdate != ''">
			AND a.base_date >= #{srchSdate}
		</if>
		<if test="srchEdate != ''">
			AND a.base_date &lt;= #{srchEdate}
		</if>
		<if test="srchUserState == 0">
			AND b.user_state != 1
		</if>
		<if test="srchUserState == 1">
			AND b.user_state = 1
		</if>
		ORDER BY a.skey ASC
	</select>

	<insert id="insertTeamEquipmentSchedule" parameterType="hashmap">
		INSERT INTO top_equipment_schedule (
			team_id
			,member_cnt
			,eq_1_1
			,eq_1_2
			,eq_2_1
			,eq_2_2
			,eq_4_1
			,eq_4_2
			,eq_5_1
			,eq_5_2
			,eq_9_1
			,eq_9_2
			,base_date
			,reg_date
		) VALUES (
			#{team_id}
			,#{member_cnt}
			,#{eq_1_1}
			,#{eq_1_2}
			,#{eq_2_1}
			,#{eq_2_2}
			,#{eq_4_1}
			,#{eq_4_2}
			,#{eq_5_1}
			,#{eq_5_2}
			,#{eq_9_1}
			,#{eq_9_2}
			,#{base_date}
			,NOW()
		)
	</insert>
	
	<select id="getTeamEquipmentScheduleChk" parameterType="hashmap" resultType="Integer">
		SELECT 
			COUNT(*) as Cnt
		FROM top_equipment_schedule
		WHERE team_id = #{team_id}
		AND base_date = #{base_date}
	</select>

	<!-- 전체 팀 장비 통계목록 불러오기 -->
	<select id="getAllTeamListByEquipmentSchedule" resultType="hashmap">
		SELECT
			GB.member_cnt
			,GB.team_id
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 1 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_1_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 1 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_1_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 2 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_2_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 2 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_2_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 4 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_4_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 4 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_4_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 5 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_5_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 5 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_5_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 9 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_9_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 9 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_9_2
		FROM(
			SELECT
				GA.member_cnt
				,GA.group_name
				,GA.group_id
				,GA.team_group_order
				,GA.team_id
				,GA.team_name		
			FROM(     
			     SELECT 
					(SELECT COUNT(*) FROM top_mbr_bsc WHERE user_state != 1 AND team_id_loc = a.team_id) AS member_cnt	
					,(SELECT team_name FROM top_tm_bsc WHERE team_group_order = a.team_group_order AND team_level = 0) AS group_name
					,(SELECT team_id FROM top_tm_bsc WHERE team_group_order = a.team_group_order AND team_level = 0) AS group_id
					,a.team_group_order
					,a.team_id
					,a.team_name		
			     FROM top_tm_bsc a
			     WHERE a.team_level > 0				     
				     AND a.team_id != 999
				     AND a.only_statistics = 0	     
			     ORDER BY team_group_order DESC, team_order DESC, team_level
				)GA
				WHERE GA.member_cnt > 0		
		)GB
	</select>
	
	<!-- 사업부 별 특정일자의 장비 값 가져오기 -->
	<select id="getTeamListByTypeToDate" parameterType="hashmap" resultType="hashmap">
		SELECT
			GB.member_cnt
			,GB.group_name
			,GB.group_id
			,GB.team_group_order
			,GB.team_id
			,GB.team_name
			,(SELECT eq_1_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_1_1
			,(SELECT eq_1_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_1_2
			,(SELECT eq_2_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_2_1
			,(SELECT eq_2_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_2_2
			,(SELECT eq_4_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_4_1
			,(SELECT eq_4_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_4_2
			,(SELECT eq_5_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_5_1
			,(SELECT eq_5_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_5_2
			,(SELECT eq_9_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_9_1
			,(SELECT eq_9_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = #{selDate}) AS eq_9_2
			
			,(SELECT eq_1_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_1_1_before
			,(SELECT eq_1_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_1_2_before
			,(SELECT eq_2_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_2_1_before
			,(SELECT eq_2_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_2_2_before
			,(SELECT eq_4_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_4_1_before
			,(SELECT eq_4_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_4_2_before
			,(SELECT eq_5_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_5_1_before
			,(SELECT eq_5_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_5_2_before
			,(SELECT eq_9_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_9_1_before
			,(SELECT eq_9_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_ADD(#{selDate}, INTERVAL-1 MONTH)) AS eq_9_2_before

		FROM(
			SELECT
				GA.member_cnt
				,GA.group_name
				,GA.group_id
				,GA.team_group_order
				,GA.team_id
				,GA.team_name		
			FROM(     
			     SELECT 
					(SELECT COUNT(*) FROM top_mbr_bsc WHERE user_state != 1 AND team_id_loc = a.team_id) AS member_cnt	
					,(SELECT team_name FROM top_tm_bsc WHERE team_group_order = a.team_group_order AND team_level = 0) AS group_name
					,(SELECT team_id FROM top_tm_bsc WHERE team_group_order = a.team_group_order AND team_level = 0) AS group_id
					,a.team_group_order
					,a.team_id
					,a.team_name		
			     FROM top_tm_bsc a
			     WHERE a.team_level > 0
				     AND a.team_type = #{team_type}
				     AND a.team_id != 999
				     AND a.only_statistics = 0	     
			     ORDER BY team_group_order DESC, team_order DESC, team_level
				)GA
				WHERE GA.member_cnt > 0		
		)GB
	</select>

	<!-- 사업부 별 목록 및 인원수 불러오기 -->
	<select id="getTeamListByType" parameterType="String" resultType="hashmap">
		SELECT
			GB.member_cnt
			,GB.group_name
			,GB.group_id
			,GB.team_group_order
			,GB.team_id
			,GB.team_name
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 1 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_1_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 1 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_1_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 2 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_2_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 2 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_2_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 4 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_4_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 4 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_4_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 5 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_5_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 5 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_5_2
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 9 AND eq_state = 1 AND is_del = 0 AND team_id = GB.team_id) AS eq_9_1
			,(SELECT COUNT(*) FROM top_equipment WHERE eq_type = 9 AND eq_state = 2 AND is_del = 0 AND team_id = GB.team_id) AS eq_9_2
			
			,(SELECT eq_1_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_1_1_before
			,(SELECT eq_1_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_1_2_before
			,(SELECT eq_2_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_2_1_before
			,(SELECT eq_2_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_2_2_before
			,(SELECT eq_4_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_4_1_before
			,(SELECT eq_4_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_4_2_before
			,(SELECT eq_5_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_5_1_before
			,(SELECT eq_5_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_5_2_before
			,(SELECT eq_9_1 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_9_1_before
			,(SELECT eq_9_2 FROM top_equipment_schedule WHERE team_id = GB.team_id AND base_date = DATE_FORMAT(DATE_ADD(NOW(), INTERVAL-1 MONTH), '%Y-%m-%d')) AS eq_9_2_before
		FROM(
			SELECT
				GA.member_cnt
				,GA.group_name
				,GA.group_id
				,GA.team_group_order
				,GA.team_id
				,GA.team_name		
			FROM(     
			     SELECT 
					(SELECT COUNT(*) FROM top_mbr_bsc WHERE user_state != 1 AND team_id_loc = a.team_id) AS member_cnt	
					,(SELECT team_name FROM top_tm_bsc WHERE team_group_order = a.team_group_order AND team_level = 0) AS group_name
					,(SELECT team_id FROM top_tm_bsc WHERE team_group_order = a.team_group_order AND team_level = 0) AS group_id
					,a.team_group_order
					,a.team_id
					,a.team_name		
			     FROM top_tm_bsc a
			     WHERE a.team_level > 0
				     AND a.team_type = #{team_type}
				     AND a.team_id != 999
				     AND a.only_statistics = 0	     
			     ORDER BY team_group_order DESC, team_order DESC, team_level
				)GA
				WHERE GA.member_cnt > 0		
		)GB
	</select>
	
	<select id="selectCardLabelList" parameterType="hashmap" resultType="hashmap">
		SELECT
			a.ckey
			,a.user_no
			,getTopMbrBscUserName(a.user_no) as user_name
			,a.team_id
			,a.card_number
			,a.card_state
			,a.card_type
			,a.card_uid			
			,a.card_serial_no
		FROM top_card a
		WHERE a.ckey IN (${label_ckey_array})
	</select>
	
	<select id="selectEquipmentLabelList" parameterType="hashmap" resultType="hashmap">
		SELECT
			GA.serial_no
			,GA.user_no
			,GA.team_id
			,GA.eq_no
			,GA.eq_state
			,GA.eq_type
			,GA.eq_memo
			,DATE_FORMAT(GA.reg_date, '%Y-%m-%d') AS reg_date			
			,GA.close_date			
			,GA.eq_price
			,GA.center_name
			,GA.team_name
			,GA.user_name
			,GA.eq_type_nm
			,GA.eq_state_nm
			,GA.team_type
			,GA.is_del
			,GA.del_date
			,CASE GA.work_type				
				WHEN 1 THEN 1
				WHEN 2 THEN 2
				WHEN 6 THEN 3
				WHEN 14 THEN 4
				WHEN 15 THEN 5
				WHEN 3 THEN 6
				WHEN 7 THEN 7
				WHEN 4 THEN 8
				WHEN 8 THEN 9
				WHEN 5 THEN 10
				WHEN 9 THEN 11
				WHEN 10 THEN 12
				WHEN 12 THEN 13
				WHEN 11 THEN 14
				WHEN 13 THEN 15	
				ELSE 99
			END AS new_work_order
			,GA.team_group_order
			,GA.team_order
			,GA.work_rank
			,GA.work_level
			,GA.join_date
			,GA.cpu_info
			,GA.cpu_info_nm
			,GA.memory_size
		FROM
			(
			SELECT
				a.serial_no
				,a.user_no
				,a.team_id
				,a.eq_no
				,a.eq_state
				,a.eq_type
				,a.eq_memo
				,a.reg_date
				,DATE_FORMAT(a.close_date, '%Y-%m-%d') AS close_date			
				,a.eq_price
				,(SELECT work_type FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_type
				,(SELECT work_rank FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_rank
				,(SELECT work_level FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_level
				,(SELECT join_date FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS join_date
				,(SELECT user_state FROM top_mbr_bsc WHERE user_no = a.user_no ) AS user_state
				,getTopTmBscCenterName(a.team_id) AS center_name
				,getTopTmBscTeamName(a.team_id) AS team_name
				,getTopMbrBscUserName(a.user_no) AS user_name
				,getCodeValue("top_equipment", "eq_type", a.eq_type) AS eq_type_nm
				,getCodeValue("top_equipment", "eq_state", a.eq_state) AS eq_state_nm
				,b.team_type	
				,a.is_del
				,a.cpu_info
				,getCodeValue("top_equipment", "cpu_info", a.cpu_info) AS cpu_info_nm
				,a.memory_size
				,DATE_FORMAT(a.del_date, '%Y-%m-%d') AS del_date
				,b.team_group_order
				,b.team_order								
			FROM top_equipment a
			LEFT JOIN top_tm_bsc b 
			ON a.team_id = b.team_id
			WHERE a.serial_no IN (${label_serial_no_array})	
			)GA
		WHERE 1=1
		ORDER BY  GA.team_group_order DESC, GA.team_order DESC, new_work_order, GA.work_level DESC, GA.work_rank DESC, GA.join_date, GA.user_name DESC	
	</select>

	<select id="selectEquipmentLabelList_20240131" parameterType="hashmap" resultType="hashmap">
		SELECT
			a.serial_no
			,a.user_no
			,a.team_id
			,a.eq_no
			,a.eq_state
			,a.eq_type
			,a.eq_memo
			,date_format(a.reg_date, '%Y-%m-%d') as reg_date
			,date_format(a.close_date, '%Y-%m-%d') as close_date			
			,a.eq_price
			,getTopTmBscCenterName(a.team_id) as center_name
			,getTopTmBscTeamName(a.team_id) as team_name
			,getTopMbrBscUserName(a.user_no) as user_name
			,getCodeValue("top_equipment", "eq_type", a.eq_type) AS eq_type_nm
			,getCodeValue("top_equipment", "eq_state", a.eq_state) AS eq_state_nm
			,b.team_type
			,a.is_del
			,a.del_date
		FROM top_equipment a
		LEFT JOIN top_tm_bsc b 
		ON a.team_id = b.team_id	
		WHERE a.serial_no IN (${label_serial_no_array})	
	</select>

	<!-- 관리자(IT팀) 메모정보 가저오기 -->	
	<select id="selectItMemoInfoByFkey" parameterType="hashmap" resultType="hashmap">
		SELECT
			pkey
			,fkey
			,category_type
			,memo_content
			,writer_user_no
			,getTopMbrBscUserName(writer_user_no) as user_name
			,reg_date
			,DATE_FORMAT(reg_date, '%Y-%m-%d') AS reg_date_fmt
		FROM top_it_memo
		WHERE fkey = #{fkey}
		AND category_type = #{category_type}
		ORDER BY reg_date DESC
	</select>

	<!-- 관리자(IT팀) 메모추가 -->
	<insert id="insertItMemo" parameterType="hashmap">
		INSERT INTO top_it_memo(
			fkey
			,category_type
			,memo_content
			,writer_user_no
			,reg_date
		)VALUES(
			#{fkey}
			,#{category_type}
			,#{memo_content}
			,#{writer_user_no}
			,now()
		)		
	</insert>
	
	<!-- 팀기준 분기별 성과급 스케줄러 관리자 수정 -->
	<update id="updateSchBonusTeamQuarterInfoBySkey" parameterType="hashmap">
		UPDATE sch_bonus_team_quarter_daily SET
			bonus_pay = #{editBonusPay}
			,workday_cnt = #{editWorkdayCnt}
			,workday_interval = #{editWorkdayInterval}
			,workday_per = #{editWorkdayPer}
			,workload_target = #{editWorkloadTarget}
			,workload_cnt = #{editWorkloadCnt}
			,workload_per = #{editWorkloadPer}
			,base_date = #{editBaseDate}		
		WHERE skey = #{editSkey}
	</update>
	
	<!-- 팀기준 성과급 스케줄러 관리자 수정 -->
	<update id="updateSchBonusTeamInfoBySkey" parameterType="hashmap">
		UPDATE sch_bonus_team_daily SET
			bonus_pay = #{editBonusPay}
			,workday_cnt = #{editWorkdayCnt}
			,workday_interval = #{editWorkdayInterval}
			,workday_per = #{editWorkdayPer}
			,workload_target = #{editWorkloadTarget}
			,workload_cnt = #{editWorkloadCnt}
			,workload_per = #{editWorkloadPer}
			,base_date = #{editBaseDate}		
		WHERE skey = #{editSkey}
	</update>
	
	<!-- 개인기준 연간 성과급 스케줄러 관리자 수정 -->
	<update id="updateSchBonusYearInfoBySkey" parameterType="hashmap">
		UPDATE sch_bonus_year_daily SET
			bonus_pay = #{editBonusPay}
			,workday_cnt = #{editWorkdayCnt}
			,workday_interval = #{editWorkdayInterval}
			,workday_per = #{editWorkdayPer}
			,workload_target = #{editWorkloadTarget}
			,workload_cnt = #{editWorkloadCnt}
			,workload_per = #{editWorkloadPer}
			,base_date = #{editBaseDate}		
		WHERE skey = #{editSkey}
	</update>
	
	<!-- 개인기준 분기 성과급 스케줄러 관리자 수정 -->
	<update id="updateSchBonusInfoBySkey" parameterType="hashmap">
		UPDATE sch_bonus_daily SET
			bonus_pay = #{editBonusPay}
			,workday_cnt = #{editWorkdayCnt}
			,workday_interval = #{editWorkdayInterval}
			,workday_per = #{editWorkdayPer}
			,workload_target = #{editWorkloadTarget}
			,workload_cnt = #{editWorkloadCnt}
			,workload_per = #{editWorkloadPer}
			,base_date = #{editBaseDate}		
		WHERE skey = #{editSkey}
	</update>
	
	<!-- 팀아이디가 변경됨에 따라 관리자(IT팀) 메모 fkey 수정 -->
	<update id="updateItMemoByFkey" parameterType="hashmap">
		UPDATE top_it_memo SET
			fkey = #{new_fkey}
		WHERE fkey = #{org_fkey}
		AND category_type = #{category_type}
	</update>
	
	<!-- 외래키 삭제에 따른 관리자(IT팀) 메모삭제 -->
	<delete id="deleteItMemoByFkey" parameterType="hashmap">
		DELETE FROM top_it_memo
		WHERE fkey = #{fkey}
		AND category_type = #{category_type}
	</delete>
	
	<!-- 관리자(IT팀) 메모수정 -->
	<update id="updateItMemo" parameterType="hashmap">
		UPDATE top_it_memo SET
			memo_content = #{memo_content}
			,writer_user_no = #{writer_user_no}
		WHERE pkey = #{pkey}
	</update>
	
	<!-- 관리자(IT팀) 메모삭제 -->
	<delete id="deleteItMemo" parameterType="hashmap">
		DELETE FROM top_it_memo
		WHERE pkey = #{pkey}
	</delete>

	<!-- 계약관리 보고서종류 추가 -->
	<insert id="insertContractCode" parameterType="hashmap">
		INSERT INTO top_contract_template_code(
			code_type
			,code_name
			,is_del
			,reg_date			
		)VALUES(
			#{code_type}
			,#{code_name}
			,#{is_del}
			,now()
		)
	</insert>
	
	<!-- 계약관리 보고서종류 갱신 -->
	<update id="updateContractCode" parameterType="hashmap">
		UPDATE top_contract_template_code SET
			code_name = #{code_name}
			,is_del = #{is_del}
		WHERE code_type = #{code_type}
		AND ckey = #{ckey}
	</update>
	
	<!-- 계약서 종류 삭제 -->
	<delete id="deleteContractCode" parameterType="hashmap">
		DELETE FROM top_contract_template_code
		WHERE ckey = #{ckey}		
	</delete>
	
	<!-- 계약서 첨부파일 삭제 -->
	<delete id="deleteContractFile" parameterType="hashmap">
		DELETE FROM top_contract_template_file
		WHERE tkey = #{tkey}		
	</delete>
	
	<!-- 계약서 정보 삭제 -->
	<delete id="deleteContractInfo" parameterType="hashmap">
		DELETE FROM top_contract_template
		WHERE tkey = #{tkey}		
	</delete>	
	
	<!-- 계약관리 정보 수정 -->
	<update id="updateContractTemplate" parameterType="hashMap">
		UPDATE  top_contract_template SET
			team_type = #{team_type}
			,c_type = #{c_type}
			,t_subject = #{t_subject} 
			,t_username = #{t_username}
			,con_sdate = #{con_sdate}
			<choose>
				<when test='con_edate == ""'>
					,con_edate = NULL		
				</when>
				<otherwise>
					,con_edate = #{con_edate}
				</otherwise>
			</choose>
			,sign_date = #{sign_date}
			,c_area = #{c_area}			
			,user_no = #{user_no}
			,t_content = #{t_content}
			,file_cnt = #{file_cnt}
		WHERE tkey = #{tkey}
	</update>
	
	<!-- 계약서 로그 등록 -->
	<insert id="insertContractTemplateLog" parameterType="hashMap">
		INSERT INTO top_contract_template_log (
			reg_user_no
			<if test='tkey != null and tkey != ""'>
				,tkey
			</if>
			,action_flag
			,reg_content
			,reg_ip
			,reg_date
		) VALUES (
			#{reg_user_no}
			<if test='tkey != null and tkey != ""'>
				,#{tkey}
			</if>			
			,#{action_flag}
			,#{reg_content}
			,#{reg_ip}
			,now()
		)
	</insert>
	<!-- 계약서 첨부파일 등록 -->
	<insert id="insertContractTemplateFile" parameterType="hashMap">
		INSERT INTO top_contract_template_file (
			tkey
			,file_path
			,file_org_name
			,file_enc_name
			,reg_date
		) VALUES (
			#{tkey}
			,#{file_path}
			,#{file_org_name}
			,#{file_enc_name}
			,now()
		)
	</insert>	
	
	<!-- 계약관리 보고서 등록 -->
	<insert id="insertContractTemplate" parameterType="hashMap" useGeneratedKeys="true" keyProperty="tkey" keyColumn="tkey">
		INSERT INTO top_contract_template (
			team_type
			,c_type 
			,t_subject
			,t_username
			,con_sdate
			<if test='con_edate != null and con_edate != ""'> 
			,con_edate 
			</if>
			,sign_date
			,c_area 
			,reg_date 
			,user_no
			<if test='t_content != null and t_content != ""'>
			,t_content 
			</if>
			,file_cnt			
		) VALUES (
			#{team_type}
			,#{c_type} 
			,#{t_subject}
			,#{t_username}
			,#{con_sdate}
			<if test='con_edate != null and con_edate != ""'> 
			,#{con_edate} 
			</if>
			,#{sign_date}
			,#{c_area} 
			,now() 
			,#{user_no}
			<if test='t_content != null and t_content != ""'>
			,#{t_content} 
			</if>
			,0
		)		
	</insert>
	
	<update id="updateContractTemplateFileNum" parameterType="hashMap">
		UPDATE top_contract_template SET
			file_cnt = #{file_cnt}
		WHERE tkey = #{tkey}
	</update>
	
	<!-- 검색된 계약서정보 가져오기 -->
	<select id="selectContractListExcel" parameterType="hashmap" resultType="hashmap">
		SELECT
			a.tkey
			,a.team_type
			,a.c_type
			,(select code_name from top_contract_template_code where ckey = a.c_type) as c_type_val
			,a.t_subject
			,a.t_username
			,a.con_sdate
			,DATE_FORMAT(a.con_sdate, '%Y-%m-%d') AS con_sdate_fmt
			,a.con_edate
			,DATE_FORMAT(a.con_edate, '%Y-%m-%d') AS con_edate_fmt
			,a.sign_date
			,DATE_FORMAT(a.sign_date, '%Y-%m-%d') AS sign_date_fmt
			,a.c_area
			,(select code_name from top_contract_template_code where ckey = a.c_area) as c_area_val
			,a.reg_date
			,DATE_FORMAT(a.reg_date, '%Y-%m-%d') AS reg_date_fmt
			,a.user_no
			,getTopMbrBscUserName(a.user_no) AS user_name
			,a.t_content
			,a.file_cnt	
		FROM top_contract_template a
		WHERE 1=1
		<if test='exelConType != 0'>
			AND a.c_type = #{exelConType}
		</if>
		<if test='exelTeamType != 9'>
			AND a.team_type = #{exelTeamType}
		</if>
		<if test='exelConArea != 0'>
			AND a.c_area = #{exelConArea}
		</if>		
		<choose>
			<when test="exelConState == 1">
				AND ( (a.con_sdate &lt; now() AND a.con_edate > now() ) OR a.con_edate is NULL )								
			</when>
			<when test="exelConState == 2">
				AND a.con_edate &lt; now()
			</when>			
		</choose>
		<if test='exelTSubject != ""'>
			AND a.t_subject like CONCAT('%',#{exelTSubject},'%')
		</if>
		ORDER BY a.reg_date DESC		
	</select>
	
	<!-- 검색된 계약서정보 가져오기 -->
	<select id="selectContractListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			a.tkey
			,a.team_type
			,a.c_type
			,(select code_name from top_contract_template_code where ckey = a.c_type) as c_type_val
			,a.t_subject
			,a.t_username
			,a.con_sdate
			,DATE_FORMAT(a.con_sdate, '%Y-%m-%d') AS con_sdate_fmt
			,a.con_edate
			,DATE_FORMAT(a.con_edate, '%Y-%m-%d') AS con_edate_fmt
			,a.sign_date
			,DATE_FORMAT(a.sign_date, '%Y-%m-%d') AS sign_date_fmt
			,a.c_area
			,(select code_name from top_contract_template_code where ckey = a.c_area) as c_area_val
			,a.reg_date
			,DATE_FORMAT(a.reg_date, '%Y-%m-%d') AS reg_date_fmt
			,a.user_no
			,getTopMbrBscUserName(a.user_no) AS user_name
			,a.t_content
			,a.file_cnt
			,(SELECT fkey FROM top_contract_template_file WHERE tkey = a.tkey LIMIT 1) AS fkey
		FROM top_contract_template a		
		WHERE 1=1
		<if test='srchConType != 0'>
			AND a.c_type = #{srchConType}
		</if>
		<if test='srchTeamType != 9'>
			AND a.team_type = #{srchTeamType}
		</if>
		<if test='srchConArea != 0'>
			AND a.c_area = #{srchConArea}
		</if>		
		<choose>
			<when test="srchConState == 1">
				AND ( (a.con_sdate &lt; now() AND a.con_edate > now() ) OR a.con_edate is NULL )								
			</when>
			<when test="srchConState == 2">
				AND a.con_edate &lt; now()
			</when>			
		</choose>
		<if test='srchTSubject != ""'>
			AND a.t_subject like CONCAT('%',#{srchTSubject},'%')
		</if>
		ORDER BY a.reg_date DESC
		LIMIT #{limitPage}, #{sizePerPage}
	</select>
	
	<select id="getContractFileList"  parameterType="hashmap" resultType="hashmap">
		SELECT
			fkey
			,tkey
			,file_path
			,file_org_name
			,file_enc_name
		FROM top_contract_template_file
		WHERE tkey = #{tkey}
		ORDER BY reg_date
	</select>
	
	<select id="getContractDetailInfo"  parameterType="hashmap" resultType="hashmap">
		SELECT
			a.tkey
			,a.team_type
			,a.c_type
			,(select code_name from top_contract_template_code where ckey = a.c_type) as c_type_val
			,a.t_subject
			,a.t_username
			,a.con_sdate
			,DATE_FORMAT(a.con_sdate, '%Y-%m-%d') AS con_sdate_fmt
			,a.con_edate
			,DATE_FORMAT(a.con_edate, '%Y-%m-%d') AS con_edate_fmt
			,a.sign_date
			,DATE_FORMAT(a.sign_date, '%Y-%m-%d') AS sign_date_fmt
			,a.c_area
			,(select code_name from top_contract_template_code where ckey = a.c_area) as c_area_val
			,a.reg_date
			,DATE_FORMAT(a.reg_date, '%Y-%m-%d') AS reg_date_fmt
			,a.user_no
			,getTopMbrBscUserName(a.user_no) AS user_name
			,a.t_content
			,a.file_cnt
		FROM top_contract_template a
		WHERE 1=1
			and a.tkey = #{tkey}		
	</select>
	
	<select id="getContractMaxTkey" resultType="String">
		SELECT
			MAX(tkey) as tkey
		FROM top_contract_template
	</select>
	
	<delete id="delContractFileDel" parameterType="hashmap">
		DELETE FROM top_contract_template_file
		WHERE fkey = #{fkey}
	</delete>
	
	<select id="getContractFileCnt" parameterType="hashmap" resultType="integer">
		SELECT
			COUNT(*) cnt
		FROM top_contract_template_file
		WHERE tkey = #{tkey}
	</select>
	
	<select id="getContractFileInfo" parameterType="hashmap" resultType="hashmap">
		SELECT
			a.fkey
			,a.tkey
			,a.file_path
			,a.file_enc_name
			,a.file_org_name					
		FROM top_contract_template_file a
		WHERE 1=1
			and a.fkey = #{fkey}		
	</select>
	
	<!-- 검색된 계약서정보 가져오기 -->
	<select id="selectContractListSearchCnt" parameterType="hashmap" resultType="integer">
		SELECT
			count(*) as Cnt				
		FROM top_contract_template a
		WHERE 1=1
		<if test='srchConType != 0'>
			AND a.c_type = #{srchConType}
		</if>
		<if test='srchTeamType != 9'>
			AND a.team_type = #{srchTeamType}
		</if>
		<if test='srchConArea != 0'>
			AND a.c_area = #{srchConArea}
		</if>		
		<choose>
			<when test="srchConState == 1">
				AND ( (a.con_sdate &lt; now() AND a.con_edate > now() ) OR a.con_edate is NULL )								
			</when>
			<when test="srchConState == 2">
				AND a.con_edate &lt; now()
			</when>			
		</choose>
		<if test='srchTSubject != ""'>
			AND a.t_subject like CONCAT('%',#{srchTSubject},'%')
		</if>	
	</select>
	
	<!-- 계약관리 보고서 종류 가져오기 -->
	<select id="selectContractCode" parameterType="hashMap" resultType="hashMap">
		SELECT
			ckey
			,code_type
			,code_name
			,is_del
			,reg_date
			,DATE_FORMAT(reg_date, '%Y-%m-%d') AS reg_date_fmt
		FROM top_contract_template_code
		WHERE code_type = #{code_type}
		<if test='is_del != null and is_del != ""'>
			AND is_del = #{is_del}
		</if>
		ORDER BY code_name, reg_date DESC
	</select>

	<!-- 수임등록 정보 삭제 -->
	<delete id="deleteWritten" parameterType="String">
		DELETE FROM top_rpt_written_info WHERE serial_no = #{serial_no}
	</delete>
	
	<!-- 등록일자 기준으로 이내첩수를 추가한다. -->
	<insert id="insertWrittenTransCnt" parameterType="HashMap">
		INSERT INTO top_rpt_written_info (
			user_no
			,base_date
			,trans_cnt
			,reg_date
		) VALUES (
			#{user_no}
			,#{base_date}
			,#{trans_cnt}
			,now()
		)	
	</insert>
	
	<!-- 등록일자 기준으로 이내첩수를 갱신한다. -->
	<update id="updateWrittenTransCnt" parameterType="HashMap">
		UPDATE top_rpt_written_info SET
			trans_cnt = (trans_cnt + ${trans_cnt})
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}
	</update>
	
	<!-- 수임일자 기준으로 취소, 이내첩건수를 환산하여 갱신한다. -->
	<update id="updateWrittenSuimCnt" parameterType="HashMap">
		UPDATE top_rpt_written_info SET
			suim_cnt = (suim_cnt - ${cancel_cnt})
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{suim_date}
	</update>
	
	<!-- 등록일자 기준으로 취소수를 갱신한다. -->
	<update id="updateWrittenCancelCnt" parameterType="HashMap">
		UPDATE top_rpt_written_info SET
			cancel_cnt = (cancel_cnt + ${cancel_cnt})
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}
	</update>

	<!-- 수임등록 테이블 정보 갱신 -->
	<update id="updateWrittenList" parameterType="HashMap">
		UPDATE top_rpt_written_info SET
			<if test='suim_cnt != null and suim_cnt != ""'>
				suim_cnt = #{suim_cnt}
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,end_cnt = #{end_cnt}
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>				
				,unsolve_cnt = #{unsolve_cnt}
			</if>			
			<if test='cancel_cnt != null and cancel_cnt != ""'>
				,cancel_cnt = #{cancel_cnt}
			</if>
			<if test='trans_cnt !=null and trans_cnt != ""'>
				,trans_cnt = #{trans_cnt}
			</if>
			<if test='ptnr_id !=null and ptnr_id != ""'>
				,ptnr_id = #{ptnr_id}
			</if>			
			,base_date = #{base_date}
			,team_id = #{team_id}						
			,reg_date = now()
		WHERE user_no = #{user_no}
		AND base_date = #{base_date}	
	</update>
	
	<!-- 수임로그기록 추가 -->
	<insert id="insertWrittenListLog" parameterType="HashMap">
		INSERT INTO top_rpt_written_log (
			user_no
			,trans_user_no
			,log_user_no
			,log_action
			,log_ip
			,team_id
			<if test='suim_cnt != null and suim_cnt != ""'>
				,suim_cnt
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,end_cnt
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>
				,unsolve_cnt
			</if>			
			<if test='log_cancel_cnt != null and log_cancel_cnt != ""'>
				,cancel_cnt
			</if>
			<if test='log_trans_cnt != null and log_trans_cnt != ""'>
				,trans_cnt
			</if>
			,suim_date			
			,base_date			
			,log_reg_date			
		) VALUES (
			#{user_no}
			,#{trans_user_no}
			,#{log_user_no}
			,#{log_action}
			,#{log_ip}
			,#{team_id}
			<if test='suim_cnt != null and suim_cnt != ""'>
				,#{suim_cnt}
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,#{end_cnt}
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>
				,#{unsolve_cnt}
			</if>			
			<if test='log_cancel_cnt != null and log_cancel_cnt != ""'>
				,#{log_cancel_cnt}
			</if>
			<if test='log_trans_cnt != null and log_trans_cnt != ""'>
				,#{log_trans_cnt}
			</if>
			,#{suim_date}			
			,#{base_date}
			,now()
		)
	</insert>
	
	<!-- 수임등록 테이블에 수임일기준으로 추가 -->
	<insert id="insertWrittenListSuimDate" parameterType="HashMap">
		INSERT INTO top_rpt_written_info (
			user_no
			,team_id
			<if test='suim_cnt != null and suim_cnt != ""'>
				,suim_cnt
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,end_cnt
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>
				,unsolve_cnt
			</if>			
			<if test='cancel_cnt != null and cancel_cnt != ""'>
				,cancel_cnt
			</if>
			<if test='trans_cnt != null and trans_cnt != ""'>
				,trans_cnt
			</if>			
			,base_date
			,reg_date			
		) VALUES (
			#{user_no}
			,#{team_id}
			<if test='suim_cnt != null and suim_cnt != ""'>
				,#{suim_cnt}
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,#{end_cnt}
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>
				,#{unsolve_cnt}
			</if>
			<if test='cancel_cnt != null and cancel_cnt != ""'>
				,#{cancel_cnt}
			</if>
			<if test='trans_cnt != null and trans_cnt != ""'>
				,#{trans_cnt}
			</if>			
			,#{suim_date}
			,now()
		)
	</insert>
	
	<!-- 수임등록 테이블 추가 -->
	<insert id="insertWrittenList" parameterType="HashMap">
		INSERT INTO top_rpt_written_info (
			user_no
			,team_id			
			<if test='ptnr_id != null and ptnr_id != ""'>
				,ptnr_id
			</if>
			<if test='suim_cnt != null and suim_cnt != ""'>
				,suim_cnt
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,end_cnt
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>
				,unsolve_cnt
			</if>			
			<if test='cancel_cnt != null and cancel_cnt != ""'>
				,cancel_cnt
			</if>
			<if test='trans_cnt != null and trans_cnt != ""'>
				,trans_cnt
			</if>			
			,base_date
			,reg_date			
		) VALUES (
			#{user_no}
			,#{team_id}
			,#{ptnr_id}
			<if test='suim_cnt != null and suim_cnt != ""'>
				,#{suim_cnt}
			</if>
			<if test='end_cnt != null and end_cnt != ""'>
				,#{end_cnt}
			</if>
			<if test='unsolve_cnt != null and unsolve_cnt != ""'>
				,#{unsolve_cnt}
			</if>
			<if test='cancel_cnt != null and cancel_cnt != ""'>
				,#{cancel_cnt}
			</if>
			<if test='trans_cnt != null and trans_cnt != ""'>
				,#{trans_cnt}
			</if>			
			,#{base_date}
			,now()
		)
	</insert>
	<!-- 직원 이름 가져오기 -->
	<select id="getUsername" parameterType="HashMap" resultType="String">
		SELECT 
			user_name
		FROM top_mbr_bsc
		WHERE user_no = #{user_no}		
	</select>
	
	<!-- 등록하려는 날짜보다 기존에 입력된 날짜가 큰 데이터가 있는지 체크-->
	<select id="selectWrittenOverdateChk" parameterType="HashMap" resultType="integer">
		SELECT 
			count(*) 
		FROM  top_rpt_written_info
		WHERE user_no = #{user_no}
		AND base_date > #{base_date}
	</select>
	
	<!-- 등록된 마지막 미결건수 갱신하기 -->
	<update id="updateWrittenLastUnsolve"  parameterType="HashMap">
		UPDATE	top_rpt_written_info SET 
			unsolve_cnt = #{last_unsolve_cnt}
		WHERE serial_no =
			(
				SELECT serial_no FROM
				(
					SELECT 
						serial_no 
					FROM top_rpt_written_info b
					WHERE user_no = #{user_no} 
					ORDER BY base_date DESC LIMIT 1
				) tmp
			)	
	</update>
	
	<!-- 등록된 마지막 미결건수 가져오기 -->
	<select id="selectWrittenLastOneUnsolveCount" parameterType="HashMap" resultType="integer">
		SELECT
			IF(COUNT(GA.unsolve_cnt)=0, 0, GA.unsolve_cnt) AS unsolve_cnt
		FROM
			(		
		SELECT
			unsolve_cnt	
			FROM top_rpt_written_info
			WHERE user_no = #{user_no}			
			ORDER BY base_date DESC
			LIMIT 0,1
		)GA
	</select>
	
	<!-- 등록된 마지막 미결건수 가져오기 -->
	<select id="selectWrittenLastUnsolveCount" parameterType="HashMap" resultType="integer">
		SELECT
			IF(COUNT(GA.unsolve_cnt)=0, 0, GA.unsolve_cnt) AS unsolve_cnt
		FROM
			(		
		SELECT
			unsolve_cnt	
			FROM top_rpt_written_info
			WHERE user_no = #{user_no}
			AND team_id = #{team_id}
			AND base_date &lt; #{base_date}
			ORDER BY base_date DESC
			LIMIT 0,1
		)GA
	</select>
	
	<!-- 수임등록일기준 수임등록 카운트 -->
	<select id="selectWrittenListBeforeTrans" parameterType="HashMap" resultType="integer">
		SELECT 
			IFNULL(SUM(trans_cnt),0) AS before_trans
		FROM top_rpt_written_log
		WHERE user_no = #{user_no}
		AND is_del = 0
		AND base_date = #{base_date}
		AND suim_date != #{base_date}				
	</select>
	
	<!-- 수임등록일기준 수임등록 카운트 -->
	<select id="selectWrittenListBeforeCancel" parameterType="HashMap" resultType="integer">
		SELECT 
			IFNULL(SUM(cancel_cnt),0) AS before_cancel
		FROM top_rpt_written_log
		WHERE user_no = #{user_no}
		AND is_del = 0
		AND base_date = #{base_date}
		AND suim_date != #{base_date}				
	</select>
	
	<!-- 수임등록일기준 수임등록 카운트 -->
	<select id="selectWrittenListCountSuim" parameterType="HashMap" resultType="integer">
		SELECT
			count(*) as Cnt
		FROM top_rpt_written_info
		WHERE user_no = #{user_no}
		AND base_date = #{suim_date}		
	</select>
	
	<!-- 수임등록 테이블 데이터 카운트 -->
	<select id="selectWrittenListCount" parameterType="HashMap" resultType="integer">
		SELECT
			count(*) as Cnt
		FROM top_rpt_written_info
		WHERE user_no = #{user_no}
		AND base_date = #{base_date}		
	</select>
	
	<!-- 수임건수 통계 정보 가져오기 -->
	<select id="selectWrittenInfoTotal" parameterType="hashMap" resultType="AsraMap">
		SELECT
			GA.user_no
			,SUM(GA.bm_suim_cnt) AS bm_suim_cnt
			,SUM(GA.tm_suim_cnt) AS tm_suim_cnt
			,SUM(GA.bw_suim_cnt) AS bw_suim_cnt
			,SUM(GA.tw_suim_cnt) AS tw_suim_cnt
		
			,SUM(GA.bm_end_cnt) AS bm_end_cnt
			,SUM(GA.tm_end_cnt) AS tm_end_cnt
			,SUM(GA.bw_end_cnt) AS bw_end_cnt
			,SUM(GA.tw_end_cnt) AS tw_end_cnt
		
			,SUM(GA.bm_unsolve_cnt) AS bm_unsolve_cnt
			,SUM(GA.tm_unsolve_cnt) AS tm_unsolve_cnt
			,SUM(GA.bw_unsolve_cnt) AS bw_unsolve_cnt
			,SUM(GA.tw_unsolve_cnt) AS tw_unsolve_cnt
		
		FROM
		(
			SELECT
				user_no
				,SUM(IFNULL(suim_cnt,0)) AS bm_suim_cnt
				,0 AS tm_suim_cnt
				,0 AS bw_suim_cnt
				,0 AS tw_suim_cnt
		
				,SUM(IFNULL(end_cnt,0)) AS bm_end_cnt
				,0 AS tm_end_cnt
				,0 AS bw_end_cnt
				,0 AS tw_end_cnt
		
				,SUM(IFNULL(unsolve_cnt,0)) AS bm_unsolve_cnt
				,0 AS tm_unsolve_cnt
				,0 AS bw_unsolve_cnt
				,0 AS tw_unsolve_cnt
		
			FROM top_rpt_written_info
			WHERE 1=1
			AND user_no = #{user_no}
			AND team_id = #{team_id}
			AND base_date >= #{bm_sdate}
			AND base_date &lt;= #{bm_edate}
		
			UNION ALL
		
			SELECT
				user_no
				,0 AS bm_suim_cnt
				,SUM(IFNULL(suim_cnt,0)) AS tm_suim_cnt		
				,0 AS bw_suim_cnt
				,0 AS tw_suim_cnt
		
				,0 AS bm_end_cnt
				,SUM(IFNULL(end_cnt,0)) AS tm_end_cnt
				,0 AS bw_end_cnt
				,0 AS tw_end_cnt
		
				,0 AS bm_unsolve_cnt
				,SUM(IFNULL(unsolve_cnt,0)) AS tm_unsolve_cnt		
				,0 AS bw_unsolve_cnt
				,0 AS tw_unsolve_cnt
		
			FROM top_rpt_written_info
			WHERE 1=1
			AND user_no = #{user_no}
			AND team_id = #{team_id}
			AND base_date >= #{tm_sdate}
			AND base_date &lt;= #{tm_edate}
			
			UNION ALL

			SELECT
				user_no
				,0 as bm_suim_cnt
				,0 as tm_suim_cnt		
				,SUM(IFNULL(suim_cnt,0)) as bw_suim_cnt				
				,0 as tw_suim_cnt
		
				,0 as bm_end_cnt
				,0 as tm_end_cnt
				,SUM(IFNULL(end_cnt,0)) as bw_end_cnt
				,0 as tw_end_cnt
		
				,0 as bm_unsolve_cnt
				,0 as tm_unsolve_cnt
				,SUM(IFNULL(unsolve_cnt,0)) as bw_unsolve_cnt
				,0 as tw_unsolve_cnt
		
			FROM top_rpt_written_info
			WHERE 1=1
			AND user_no = #{user_no}
			AND team_id = #{team_id}
			AND base_date >= #{bw_sdate}
			AND base_date &lt;= #{bw_edate}
			
			UNION ALL

			SELECT
				user_no
				,0 as bm_suim_cnt
				,0 as tm_suim_cnt		
				,0 as bw_suim_cnt
				,SUM(IFNULL(suim_cnt,0)) as tw_suim_cnt
		
				,0 as bm_end_cnt
				,0 as tm_end_cnt
				,0 as bw_end_cnt
				,SUM(IFNULL(end_cnt,0)) as tw_end_cnt				
		
				,0 as bm_unsolve_cnt
				,0 as tm_unsolve_cnt
				,0 as bw_unsolve_cnt
				,SUM(IFNULL(unsolve_cnt,0)) as tw_unsolve_cnt				
		
			FROM top_rpt_written_info
			WHERE 1=1
			AND user_no = #{user_no}
			AND team_id = #{team_id}
			AND base_date >= #{tw_sdate}
			AND base_date &lt;= #{tw_edate}
		)GA
	</select>
	<!-- 수임건수 통계 정보 가져오기 -->
	
	<select id="selectWrittenSuimCnt" parameterType="hashMap" resultType="Integer">
		SELECT
			IFNULL(SUM(suim_cnt),0) AS suim_cnt			
		FROM top_rpt_written_info
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}	
	</select>
	
	<select id="selectWrittenTransCnt" parameterType="hashMap" resultType="Integer">
		SELECT
			IFNULL(SUM(trans_cnt),0) AS trans_cnt			
		FROM top_rpt_written_info
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}	
	</select>
	
	<select id="selectWrittenCancelCnt" parameterType="hashMap" resultType="Integer">
		SELECT
			IFNULL(SUM(cancel_cnt),0) AS cancel_cnt			
		FROM top_rpt_written_info
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}	
	</select>
	
	<select id="selectSimpleTeamId" parameterType="String" resultType="String">
		SELECT 
			team_id_main as team_id
		FROM top_mbr_bsc 
		WHERE user_no = #{user_no}
	</select>
	
	<select id="selectSimpleUsername" parameterType="String" resultType="String">
		SELECT 
			getTopMbrBscUserName(#{user_no}) as user_name
		FROM DUAL
	</select>
	
	<update id="updateWrittenLogDel" parameterType="hashMap">
		UPDATE	top_rpt_written_log	SET 
			is_del = 1
		WHERE 1=1
		AND serial_no = #{serial_no}	
	</update>
	
	<select id="selectWrittenLogInfo" parameterType="hashMap" resultType="AsraMap">
		SELECT
			serial_no
			,user_no
			,getTopMbrBscUserName(user_no) as user_name
			,trans_user_no
			,log_user_no
			,log_action
			,log_ip
			,team_id
			,getTopTmBscTeamName(team_id) AS team_name
			,suim_cnt
			,end_cnt
			,unsolve_cnt
			,cancel_cnt
			,trans_cnt
			,base_date
			,DATE_FORMAT(base_date, '%Y-%m-%d') AS base_date_fmt
			,suim_date
			,DATE_FORMAT(suim_date, '%Y-%m-%d') AS suim_date_fmt
			,is_del
			,log_reg_date
			,DATE_FORMAT(log_reg_date, '%Y-%m-%d') AS log_reg_date_fmt
		FROM top_rpt_written_log
		WHERE 1=1
		AND serial_no = #{serial_no}	
	</select>
	
	<select id="selectWrittenInfoSimple" parameterType="hashMap" resultType="AsraMap">
		SELECT
			IFNULL(SUM(suim_cnt),0) AS suim_cnt
			,IFNULL(SUM(end_cnt),0) AS end_cnt
		FROM top_rpt_written_info
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}	
	</select>
	
	<!-- 수임건수 정보 가져오기 -->
	<select id="selectWrittenInfo" parameterType="hashMap" resultType="AsraMap">
		SELECT
			serial_no
			,user_no
			,IFNULL(suim_cnt,0) AS suim_cnt
			,IFNULL(end_cnt,0) AS end_cnt
			,IFNULL(unsolve_cnt,0) AS unsolve_cnt
			,IFNULL(cancel_cnt,0) AS cancel_cnt
			,IFNULL(trans_cnt,0) AS trans_cnt
			,base_date
			,DATE_FORMAT(base_date, '%Y-%m-%d') AS base_date_fmt
			,reg_date
			,DATE_FORMAT(reg_date, '%Y-%m-%d') AS reg_date_fmt						
		FROM top_rpt_written_info
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}		
	</select>
	
	<!-- 서면심사 팀을 발령당시기준으로 보여주기위해 팀아이디를 수임건수 테이블에서 가져온다. -->
	<select id="selectWrittenMemberSearchList" parameterType="HashMap" resultType="AsraMap">		
		SELECT 
			GB.user_no
			,GB.user_name
			,GB.work_type
			,GB.work_level
			,GB.work_level_cd
			,GB.team_id
			,getTopTmBscCenterName(GB.team_id) AS center_name
			,getTopTmBscTeamName(GB.team_id) AS team_name 
			,GB.team_group_order
			,GB.team_order	
		FROM
			(
				SELECT
					GA.user_no
					,GA.user_name
					,GA.work_type
					,GA.work_level
					,GA.work_level_cd
					,GA.team_id
					,c.team_group_order
					,c.team_order
				FROM
				(			
				SELECT 
					a.user_no
					,a.team_id
					,b.user_name
					,b.work_type
					,b.work_level
					,getCodeValue('top_mbr_bsc', 'work_level', b.work_level) AS work_level_cd			
				FROM top_rpt_written_info a, top_mbr_bsc b
				WHERE a.user_no = b.user_no
				<if test="s_out_user != 1">
				AND b.user_state != 1
				</if>
				<if test='s_user_no !=""'>
				AND a.user_no = #{s_user_no}
				</if>	
				AND a.base_date = #{s_base_date}
				)GA INNER JOIN top_tm_bsc c
				ON GA.team_id = c.team_id
				WHERE 1=1
				<if test='s_team_id != ""'>
				AND GA.team_id = #{s_team_id}
				</if>
			)GB
		ORDER BY GB.team_group_order DESC, GB.team_order DESC, GB.work_type ASC, GB.work_level DESC, GB.user_no ASC
	</select>
	
	<!-- 서면등록 테이블에 등록된 기준 정보 조회(기간내 내용 전부표시)-->
	<select id="selectWrittenSearchOne" parameterType="HashMap" resultType="AsraMap">
		SELECT
			a.serial_no
			,a.user_no
			,b.user_name
			,b.work_type
			,b.work_level
			,getCodeValue('top_mbr_bsc', 'work_level', b.work_level) AS work_level_cd
			,c.team_id
			,getTopTmBscCenterName(c.team_id) AS center_name
			,getTopTmBscTeamName(c.team_id) AS team_name
			,c.team_group_order
			,c.team_order
			,a.suim_cnt
			,a.end_cnt			
			,a.unsolve_cnt
			,a.cancel_cnt
			,a.trans_cnt
			,(a.trans_cnt * -1) as trans_cnt_minus
			,a.base_date
			,DATE_FORMAT(a.base_date, '%Y-%m-%d') AS base_date_fmt
			,a.reg_date
			,DATE_FORMAT(a.reg_date, '%Y-%m-%d') AS reg_date_fmt
			,a.ptnr_id as ptnr_id
			,getTopPtnrBscPtnrNick(a.ptnr_id) as ptnr_name
		FROM top_rpt_written_info a
		INNER JOIN top_mbr_bsc b
		ON a.user_no = b.user_no
		INNER JOIN top_tm_bsc c
		ON a.team_id = c.team_id
		WHERE 1=1
		AND a.base_date >= #{s_base_date}
		AND a.base_date &lt;= #{e_base_date}
		<if test='s_team_id != ""'>
		AND a.team_id = #{s_team_id}
		</if>
		<if test='s_ptnr_id != 0'>
		AND a.ptnr_id = #{s_ptnr_id}
		</if>		
		<if test='s_user_no !=""'>
		AND a.user_no = #{s_user_no}
		</if>
		ORDER BY c.team_group_order DESC, c.team_order DESC, b.work_type ASC, b.work_level DESC, a.user_no ASC, a.base_date DESC
	</select>
	
	<!-- 서면등록 테이블에 등록된 기준 정보(기간합산값) 조회-->
	<select id="selectWrittenSearchList" parameterType="HashMap" resultType="AsraMap">
		SELECT
			GA.serial_no
			,GA.user_no
			,GA.user_name
			,GA.work_type
			,GA.work_level
			,GA.work_level_cd
			,GA.team_id
			,GA.center_name
			,GA.team_name
			,GA.team_group_order
			,GA.team_order
			,SUM(GA.suim_cnt) suim_cnt
			,SUM(GA.end_cnt) end_cnt
			,GA.unsolve_cnt
			,SUM(GA.cancel_cnt) cancel_cnt
			,SUM(GA.trans_cnt) trans_cnt
			,(SUM(GA.trans_cnt) * -1) as trans_cnt_minus			
			,GA.base_date
			,GA.base_date_fmt
			,GA.reg_date
			,GA.reg_date_fmt
			,GA.ptnr_id
			,GA.ptnr_name
		FROM
			(
			SELECT
				a.serial_no
				,a.user_no
				,b.user_name
				,b.work_type
				,b.work_level
				,getCodeValue('top_mbr_bsc', 'work_level', b.work_level) AS work_level_cd
				,c.team_id
				,getTopTmBscCenterName(c.team_id) AS center_name
				,getTopTmBscTeamName(c.team_id) AS team_name
				,c.team_group_order
				,c.team_order
				,a.suim_cnt
				,a.end_cnt
				,a.unsolve_cnt
				,a.cancel_cnt
				,a.trans_cnt
				,a.base_date
				,DATE_FORMAT(a.base_date, '%Y-%m-%d') AS base_date_fmt
				,a.reg_date
				,DATE_FORMAT(a.reg_date, '%Y-%m-%d') AS reg_date_fmt
				,a.ptnr_id as ptnr_id
				,getTopPtnrBscPtnrNick(a.ptnr_id) as ptnr_name
			FROM top_rpt_written_info a
			INNER JOIN top_mbr_bsc b
			ON a.user_no = b.user_no
			INNER JOIN top_tm_bsc c
			ON a.team_id = c.team_id
			WHERE 1=1
			AND a.base_date >= #{s_base_date}
			AND a.base_date &lt;= #{e_base_date}
			<if test='s_team_id != ""'>
			AND a.team_id = #{s_team_id}
			</if>
			<if test='s_user_no !=""'>
			AND a.user_no = #{s_user_no}
			</if>						
			ORDER BY base_date DESC
			)GA
		GROUP BY GA.user_no
		ORDER BY GA.team_group_order DESC, GA.team_order DESC, GA.work_type ASC, GA.work_level DESC, GA.user_no ASC
	</select>
	
	<!-- 서면심사 팀에 속한 사용자정보(사용자,팀)에 수임등록 테이블 leftJoin where 조건넣어야함-->
	<select id="selectWrittenMemberList" parameterType="HashMap" resultType="AsraMap">		
		SELECT a.user_no
			,a.user_name
			,a.work_type
			,a.work_level
			,getCodeValue('top_mbr_bsc', 'work_level', a.work_level) as work_level_cd
			,b.team_id
			,getTopTmBscCenterName(b.team_id) AS center_name
			,getTopTmBscTeamName(b.team_id) AS team_name 
			,b.team_group_order
			,b.team_order	
			,b.written_ptnr_id as ptnr_id
			,getTopPtnrBscPtnrNick(b.written_ptnr_id) as ptnr_name  
		FROM top_mbr_bsc a
		INNER JOIN top_tm_bsc b
		ON a.team_id_main = b.team_id
		WHERE 1=1
		AND b.team_written = 1
		<if test="s_out_user != 1">
		AND a.user_state != 1
		</if>
		<if test='s_team_id != ""'>
		AND a.team_id_main = #{s_team_id}
		</if>
		<if test='s_ptnr_id != 0'>
		AND b.written_ptnr_id = #{s_ptnr_id}
		</if>
		<if test='s_user_no !=""'>
		AND a.user_no = #{s_user_no}
		</if>						
	ORDER BY b.team_group_order DESC, b.team_order DESC, a.work_type ASC, a.work_level DESC, a.user_no ASC
	</select>
	
	<!-- 사용자정보(사용자,팀)에 수임등록 테이블 leftJoin where 조건넣어야함-->
	<select id="selectWrittenMemberList_20200319" parameterType="HashMap" resultType="AsraMap">		
		SELECT a.user_no
			,a.user_name
			,a.work_type
			,a.work_level
			,b.team_id
			,getTopTmBscCenterName(b.team_id) AS center_name
			,getTopTmBscTeamName(b.team_id) AS team_name 
			,b.team_group_order
			,b.team_order	  
		FROM top_mbr_bsc a
		INNER JOIN top_tm_bsc b
		ON a.team_id_main = b.team_id
		WHERE 1=1
		<if test="s_out_user != 1">
		AND a.user_state != 1
		</if>
		<if test='s_team_id != ""'>
		AND a.team_id_main = #{s_team_id}
		</if>
		<if test='s_user_no !=""'>
		AND a.user_no = #{s_user_no}
		</if>						
	ORDER BY b.team_group_order DESC, b.team_order DESC, a.work_type ASC, a.work_level DESC, a.user_no ASC
	</select>

	<!-- 사용자정보(사용자,팀)에 수임등록 테이블 leftJoin where 조건넣어야함-->
	<select id="selectWrittenMemberList_20200317" parameterType="HashMap" resultType="AsraMap">
		SELECT
			GA.user_no
			,getTopTmBscCenterName(GA.team_id) AS center_name
			,getTopTmBscTeamName(GA.team_id) AS team_name
			,GA.user_name
			,c.serial_no
			,IFNULL(c.suim_cnt,0) AS suim_cnt
			,IFNULL(c.end_cnt,0) AS end_cnt
			,IFNULL(c.unsolve_cnt,0) AS unsolve_cnt	
			,c.base_date
			,DATE_FORMAT(c.base_date, '%Y-%m-%d') AS base_date_fmt
			,c.reg_date
			,DATE_FORMAT(c.reg_date, '%Y-%m-%d') AS reg_date_fmt
		FROM
			(
			SELECT a.user_no
			  ,a.user_name
			  ,a.work_type
			  ,a.work_level
			  ,b.team_id
			  ,b.team_group_order
			  ,b.team_order	  
			FROM top_mbr_bsc a
			INNER JOIN top_tm_bsc b
			ON a.team_id_main = b.team_id
			WHERE 1=1
			<if test="s_out_user != 1">
			AND a.user_state != 1
			</if>
			<if test='s_team_id != ""'>
			AND a.team_id_main = #{s_team_id}
			</if>
			<if test='s_user_no !=""'>
			AND a.user_no = #{s_user_no}
			</if>
			) GA
			
		LEFT JOIN top_rpt_written_info c 
		ON GA.user_no = c.user_no
		WHERE 1=1
		<if test='s_base_date != ""'>
			AND (c.base_date = #{s_base_date} or c.base_date is null)
		</if>		
		ORDER BY GA.team_group_order DESC, GA.team_order DESC, GA.work_type ASC, GA.work_level DESC, GA.user_no ASC
	</select>
	
	<!-- 서면심사 팀의 퇴사자 포함 사용자 목록 가져오기 -->
	<select id="selectWrittenTopMemberListAll" parameterType="HashMap" resultType="AsraMap">
		SELECT a.user_no
			,IF (a.user_state = 1,CONCAT(a.user_name,'[퇴사자]'),a.user_name) AS user_name	  
			  ,b.team_name
			  ,b.team_id
		  FROM top_mbr_bsc a
		 INNER JOIN top_tm_bsc b
		    ON a.team_id_main = b.team_id
		 WHERE 1 = 1 
		 AND b.team_written = 1
		 ORDER BY b.team_group_order DESC, b.team_order DESC, a.WORK_TYPE ASC, a.WORK_LEVEL DESC, a.USER_NO ASC	
	</select>

	<!-- 퇴사자 포함 사용자 목록 가져오기 -->
	<select id="selectTopMemberListAll" parameterType="HashMap" resultType="AsraMap">
		SELECT a.user_no
			,IF (a.user_state = 1,CONCAT(a.user_name,'[퇴사자]'),a.user_name) AS user_name	  
			  ,b.team_name
			  ,b.team_id
		  FROM top_mbr_bsc a
		 INNER JOIN top_tm_bsc b
		    ON a.team_id_main = b.team_id
		 WHERE 1 = 1 
		 ORDER BY b.team_group_order DESC, b.team_order DESC, a.WORK_TYPE ASC, a.WORK_LEVEL DESC, a.USER_NO ASC	
	</select>
	
	<!-- 서면심사팀의 퇴사자 제외 사용자 목록 가져오기 -->
	<select id="selectWrittenTopMemberList" parameterType="HashMap" resultType="AsraMap">
		SELECT a.user_no
			  ,a.user_name				
			  ,b.team_name
			  ,b.team_id
		  FROM top_mbr_bsc a
		 INNER JOIN top_tm_bsc b
		    ON a.team_id_main = b.team_id
		 WHERE 1 = 1
		 AND user_state != 1 
		 AND b.team_written = 1
		 ORDER BY b.team_group_order DESC, b.team_order DESC, a.WORK_TYPE ASC, a.WORK_LEVEL DESC, a.USER_NO ASC	
	</select>
	
	<!-- 퇴사자 제외 사용자 목록 가져오기 -->
	<select id="selectTopMemberList" parameterType="HashMap" resultType="AsraMap">
		SELECT a.user_no
			  ,a.user_name				
			  ,b.team_name
			  ,b.team_id
		  FROM top_mbr_bsc a
		 INNER JOIN top_tm_bsc b
		    ON a.team_id_main = b.team_id
		 WHERE 1 = 1
		 AND user_state != 1 
		 ORDER BY b.team_group_order DESC, b.team_order DESC, a.WORK_TYPE ASC, a.WORK_LEVEL DESC, a.USER_NO ASC	
	</select>
	
	<!-- 서면심사 이내첩 로그 정보 가져오기 -->
	<select id="selectWrittenTransList" parameterType="hashmap" resultType="AsraMap">
		SELECT
			GA.log_reg_date
			,GA.log_reg_date_fmt
			,GA.trans_cnt
			,(GA.trans_cnt * -1) as trans_cnt_minus
			,GA.log_user_no
			,GA.log_user_name
			,GA.trans_flag
			,GA.trans_user_no
			,GA.trans_user_name
			,GA.suim_date
			,DATE_FORMAT(GA.suim_date, '%Y-%m-%d') AS suim_date_fmt
		FROM
			(
				SELECT 
					log_reg_date
					,DATE_FORMAT(log_reg_date, '%Y-%m-%d') AS log_reg_date_fmt
					,trans_cnt
					,log_user_no
					,getTopMbrBscUserName(log_user_no) AS log_user_name
					,'이첩' AS trans_flag
					,trans_user_no				
					,getTopMbrBscUserName(trans_user_no) AS trans_user_name
					,suim_date
				FROM top_rpt_written_log 
				WHERE 1=1
				AND user_no = #{user_no}
				AND base_date = #{base_date}
				AND log_action = #{log_action}
				AND is_del = 0
				
				<!-- UNION ALL
				
				SELECT 
					log_reg_date
					,DATE_FORMAT(log_reg_date, '%Y-%m-%d') AS log_reg_date_fmt
					,trans_cnt
					,log_user_no
					,getTopMbrBscUserName(log_user_no) AS log_user_name
					,'내첩' AS trans_flag
					,trans_user_no				
					,getTopMbrBscUserName(trans_user_no) AS trans_user_name
					,suim_date				
				FROM top_rpt_written_log 
				WHERE 1=1
				AND trans_user_no = #{user_no}
				AND base_date = #{base_date}			
				AND log_action = #{log_action}
				AND is_del = 0 -->			
			)GA
					
		ORDER BY GA.log_reg_date DESC	
	</select>
	
	<!-- 서면심사 취소 로그 정보 가져오기 -->
	<select id="selectWrittenCancelList" parameterType="hashmap" resultType="AsraMap">
		SELECT 
			serial_no
			,log_reg_date
			,DATE_FORMAT(log_reg_date, '%Y-%m-%d') AS log_reg_date_fmt
			,suim_date
			,DATE_FORMAT(suim_date, '%Y-%m-%d') AS suim_date_fmt
			,cancel_cnt
			,log_user_no
			,getTopMbrBscUserName(log_user_no) AS log_user_name
		FROM top_rpt_written_log 
		WHERE 1=1
		AND user_no = #{user_no}
		AND base_date = #{base_date}
		AND log_action = #{log_action}
		AND is_del = 0
		ORDER BY log_reg_date DESC
	</select>
	
	<!-- 서면심사 팀 가져오기 (서면심사는 team_level 을 0으로 고정한다.)-->
	<select id="selectWrittenTeamList" parameterType="hashmap" resultType="AsraMap">
        SELECT  A.TEAM_ID
			,A.TEAM_NAME
			,A.TEAM_TYPE
			,"0" as TEAM_LEVEL
			,getTopTmBscCenterName(A.TEAM_ID) AS CENTER_NAME
			,getTopTmBscTeamName(A.TEAM_ID) AS TEAM_NAME
			,A.written_ptnr_id
			,getTopPtnrBscPtnrNick(A.written_ptnr_id) ptnr_name
          FROM  top_tm_bsc A
         WHERE  1=1
         AND team_written = 1
        ORDER BY A.TEAM_GROUP_ORDER DESC, A.TEAM_ORDER DESC, A.TEAM_ID DESC
    </select>
    
    <!-- 서면심사 팀 가져오기 (서면심사는 team_level 을 0으로 고정한다.)-->
	<select id="selectWrittenSearchTeamList" parameterType="hashmap" resultType="AsraMap">
        SELECT  A.TEAM_ID
			,A.TEAM_NAME
			,A.TEAM_TYPE
			,"0" as TEAM_LEVEL
			,getTopTmBscCenterName(A.TEAM_ID) AS CENTER_NAME
			,getTopTmBscTeamName(A.TEAM_ID) AS TEAM_NAME
			,A.written_ptnr_id
			,getTopPtnrBscPtnrNick(A.written_ptnr_id) ptnr_name
          FROM  top_tm_bsc A
         WHERE  1=1
         AND team_written = 1
         AND team_id IN (${sTeamlist})
        ORDER BY A.TEAM_GROUP_ORDER DESC, A.TEAM_ORDER DESC, A.TEAM_ID DESC
    </select>
    
    <!-- 팀별 수임,종결,취소, 이내첩 미결건수 가져오기 -->
    <select id="selectWrittenCalTeamList" parameterType="hashmap" resultType="AsraMap">
    	SELECT
			GB.team_id
			,getTopTmBscCenterName(GB.team_id) AS center_name
			,getTopTmBscTeamName(GB.team_id) AS team_name	
			,IFNULL(SUM(GB.suim_cnt),0) AS suim_cnt
			,IFNULL(SUM(GB.end_cnt),0) AS end_cnt
			,IFNULL(SUM(GB.unsolve_cnt),0) AS unsolve_cnt
			,IFNULL(SUM(GB.cancel_cnt),0) AS cancel_cnt
			,IFNULL(SUM(GB.trans_cnt),0) AS trans_cnt
			,IFNULL(MAX(GB.base_date),'-') AS base_date			
			,IFNULL(DATE_FORMAT(MAX(GB.base_date), '%Y-%m-%d'),'-') AS base_date_fmt
			,IFNULL(MAX(GB.reg_date),'-') AS reg_date			
			,IFNULL(DATE_FORMAT(MAX(GB.reg_date), '%Y-%m-%d'),'-') AS reg_date_fmt
		FROM (
					(
						SELECT	
							team_id
							,0 AS suim_cnt
							,0 AS end_cnt
							,GA.unsolve_cnt
							,0 AS cancel_cnt
							,0 AS trans_cnt
							,GA.base_date
							,GA.reg_date		
						FROM
							(
				
								SELECT
									user_no
									,team_id
									,0 AS suim_cnt
									,0 AS end_cnt
									,unsolve_cnt
									,0 AS cancel_cnt
									,0 AS trans_cnt
									,base_date
									,reg_date				
								FROM top_rpt_written_info
								WHERE 1=1
								AND base_date >= #{s_base_date}
								AND base_date &lt;= #{e_base_date}
								AND team_id = #{cal_team_id}			
								ORDER BY base_date DESC			
							)GA
						GROUP BY GA.user_no
					)
		
				UNION ALL
			
					(
				
						SELECT		
							team_id
							,suim_cnt
							,end_cnt
							,0 AS unsolve_cnt
							,cancel_cnt
							,trans_cnt
							,base_date AS base_date
							,reg_date AS reg_date
						FROM top_rpt_written_info
						WHERE 1=1
						AND base_date >= #{s_base_date}
						AND base_date &lt;= #{e_base_date}
						AND team_id = #{cal_team_id}
						ORDER BY base_date DESC
					)
			)GB
    </select>
    
    <!-- 부문목록 가져오기 -->
    <select id="selectSectorList" parameterType="hashmap" resultType="AsraMap">
    	SELECT 
			col_cd AS team_sector
			,col_val AS sector_name
		FROM sysadm_codedic 
		WHERE tbl_nm = 'top_tm_bsc'
		AND col_nm = 'team_sector'
    </select>
    
    <!-- 전체 센터목록 가져오기 -->
    <select id="selectCenterListAll" parameterType="hashmap" resultType="AsraMap">
    	SELECT
			GB.team_center
			,(SELECT col_val FROM sysadm_codedic WHERE col_cd = GB.team_center AND tbl_nm = 'top_tm_bsc' AND col_nm = 'team_center') AS center_name
		FROM
		(		
			SELECT
				DISTINCT(GA.team_center) AS team_center
			FROM 
			(		
				SELECT 
					(SELECT COUNT(*) FROM top_mbr_bsc WHERE user_state != 1 AND team_id_loc = a.team_id) + (SELECT COUNT(*) FROM top_mbr_bsc_sub WHERE team_id_main = a.team_id) cnt	
					, a.*
					FROM top_tm_bsc a
					WHERE a.team_level > 0					
					AND a.only_statistics = 0			      
			)GA
			WHERE GA.cnt > 0
		)GB
		WHERE 1=1
		ORDER BY team_center
    </select>
    
    <!-- 물보험 센터목록 가져오기 -->
    <select id="selectCenterList" parameterType="hashmap" resultType="AsraMap">
    	SELECT
			GB.team_center
			,(SELECT col_val FROM sysadm_codedic WHERE col_cd = GB.team_center AND tbl_nm = 'top_tm_bsc' AND col_nm = 'team_center') AS center_name
		FROM
		(		
			SELECT
				DISTINCT(GA.team_center) AS team_center
			FROM 
			(		
				SELECT 
					(SELECT COUNT(*) FROM top_mbr_bsc WHERE user_state != 1 AND team_id_loc = a.team_id) + (SELECT COUNT(*) FROM top_mbr_bsc_sub WHERE team_id_main = a.team_id) cnt	
					, a.*
					FROM top_tm_bsc a
					WHERE a.team_level > 0
					AND a.team_type IN (0,1)
					AND a.only_statistics = 0			      
			)GA
			WHERE GA.cnt > 0
		)GB
		WHERE 1=1
		ORDER BY team_center
    </select>

	<!-- 팀전체목록 가져오기 -->
	<select id="selectTeamList" parameterType="hashmap" resultType="AsraMap">
        SELECT  A.TEAM_ID
               ,A.TEAM_NAME
               ,A.TEAM_TYPE
               ,A.TEAM_LEVEL
          FROM  top_tm_bsc A
         WHERE  1=1           
        ORDER BY A.TEAM_GROUP_ORDER DESC, A.TEAM_ORDER DESC, A.TEAM_ID DESC
    </select>
    
    <!-- 장비 일괄 수정 by top3009 -->    
    <delete id="deleteEquipmentAll" parameterType="HashMap" >
		DELETE FROM top_equipment
		WHERE serial_no in ( ${serial_no} )
	</delete>
	
	<select id="selectTeamName" parameterType="String" resultType="String">
		SELECT
			team_name
		FROM top_tm_bsc 
		WHERE team_id = #{team_id}
	</select>
	
	<select id="selectUserName" parameterType="String" resultType="String">
		SELECT
			user_name
		FROM top_mbr_bsc 
		WHERE user_no = #{user_no}
	</select>
    
    <!-- 장비 일괄 수정 by top3009 -->
    <update id="updateEquipmentAll" parameterType="HashMap">
    	UPDATE top_equipment SET
	   		<if test="action == 'AU'">
	   			team_id = #{team_id}
	   		</if>
	   		<if test="action == 'AC'">
	   			eq_state = #{eq_state}
	   			,close_date = now()
	   		</if>
	   		<if test="action == 'AD'">
	   			is_del = 1
	   			,del_date = now()
	   		</if>    	
    	WHERE serial_no in ( ${serial_no} )
    </update>
    
    <!-- 카드삭제 -->
    <update id="updateDelCard" parameterType="HashMap">
    	UPDATE top_card SET
    		is_del = 1
    		,del_date = now()
    	WHERE ckey = #{ckey}
    </update>
    
    <!-- 카드 수정 -->
    <update id="updateCard" parameterType="HashMap">
    	UPDATE top_card SET
	   		user_no = #{user_no}
			 ,team_id = #{team_id}
			 ,card_number = #{card_number}
			 ,card_state = #{card_state}
			 ,card_type = #{card_type}
			 ,card_zone = #{card_zone}
			 ,card_memo = #{card_memo}
			 ,card_uid = #{card_uid}
			 ,card_serial_no = #{card_serial_no}			 
			 <if test='reg_date != ""'>
			 	,reg_date = #{reg_date}
			 </if>			 
			 ,mod_date = now()			 
    	WHERE ckey = #{ckey}    	
    </update>
    
    <!-- 장비 수정 by top3009 -->
    <update id="updateEquipment" parameterType="HashMap">
    	UPDATE top_equipment SET
	   		user_no = #{user_no}
			 ,team_id = #{team_id}
			 ,eq_no = #{eq_no}
			 ,eq_state = #{eq_state}
			 ,eq_type = #{eq_type}
			 ,eq_memo = #{eq_memo}
			 ,eq_price = #{eq_price}
			 ,cpu_info = #{cpu_info}
			 ,memory_size = #{memory_size}
			 <if test='reg_date != ""'>
			 	,reg_date = #{reg_date}
			 </if>
			 <if test='close_date != ""'>
			 	,close_date = #{close_date}
			 </if>    	
    	WHERE serial_no = #{serial_no}
    </update>
    
    <!-- 카드관리 등록 로그 -->
    <insert id="insertCardLog" parameterType="HashMap">
    	INSERT INTO top_card_log (
			 ckey
			 ,log_user_no
			 ,log_action
			 ,log_content
			 ,log_ip
			 ,log_reg_date
			 ,user_name
			 ,team_name
		) VALUES (
			#{ckey}
			 ,#{log_user_no}
			 ,#{log_action}
			 ,#{log_content}
			 ,#{log_ip}
			 ,now()
			 ,#{user_name}
			 ,#{team_name}
		)
    </insert>
    
    <!-- 장비 등록 로그 by top3009 -->
    <insert id="insertEquipmentLog" parameterType="HashMap">
		INSERT INTO top_equipment_log (
			 serial_no
			 ,log_user_no
			 ,log_action
			 ,log_content
			 ,log_ip
			 ,log_reg_date
			 ,user_name
			 ,team_name
		) VALUES (
			#{serial_no}
			 ,#{log_user_no}
			 ,#{log_action}
			 ,#{log_content}
			 ,#{log_ip}
			 ,now()
			 ,#{user_name}
			 ,#{team_name}
		)
	</insert>
	
	<!-- 마이그래이션 카드등록 -->
	<insert id="insertMigCardInfo" parameterType="HashMap">
		INSERT INTO top_card (
			 user_no
			 ,team_id
			 ,card_number
			 ,card_state
			 ,card_type			 
			 ,reg_date			 
			 <if test='card_serial_no != null and card_serial_no != ""'>
			 	,card_serial_no
			 </if>
			 <if test='card_zone != null and card_zone != ""'>
			 	,card_zone
			 </if>
		) VALUES (
			#{user_no}
			 ,#{team_id}
			 ,#{card_number}
			 ,#{card_state}
			 ,#{card_type}			 			 
			 <choose>
				<when test='reg_date != null and reg_date != ""'>,#{reg_date}</when>
				<otherwise>,now()</otherwise>
			</choose>
			<if test='card_serial_no != null and card_serial_no != ""'>
				,#{card_serial_no}
			</if>
			<if test='card_zone != null and card_zone != ""'>
				,#{card_zone}
			</if>
		)
	</insert>
	
	<!-- 카드등록 -->
	<insert id="insertCard" parameterType="HashMap" useGeneratedKeys="true" keyProperty="ckey">
		INSERT INTO top_card (
			 user_no
			 ,team_id
			 ,card_number
			 ,card_state
			 ,card_type
			 ,card_memo
			 ,card_zone
			 ,card_uid
			 ,card_serial_no
			 ,reg_date
		) VALUES (
			#{user_no}
			 ,#{team_id}
			 ,#{card_number}
			 ,#{card_state}
			 ,#{card_type}
			 ,#{card_memo}
			 ,#{card_zone}
			 ,#{card_uid}
			 ,#{card_serial_no}
			<choose>
				<when test='reg_date != ""'>,#{reg_date}</when>
				<otherwise>,now()</otherwise>
			</choose>			
		)	
	</insert>
	
	<!-- 장비 등록 by top3009 -->
	<insert id="insertEquipment" parameterType="HashMap" useGeneratedKeys="true" keyProperty="serial_no">
		INSERT INTO top_equipment (
			 user_no
			 ,team_id
			 ,eq_no
			 ,eq_state
			 ,eq_type
			 ,eq_memo
			 ,reg_date
			 <if test='close_date != ""'>
			 	,close_date
			 </if>
			 ,eq_price
			 ,cpu_info
			 ,memory_size
		) VALUES (
			#{user_no}
			,#{team_id}
			,#{eq_no}			
			,#{eq_state}
			,#{eq_type}
			,#{eq_memo}
			<choose>
				<when test='reg_date != ""'>,#{reg_date}</when>
				<otherwise>,now()</otherwise>
			</choose>
			<if test='close_date != ""'>
			 	,#{close_date}
			 </if>			
			,#{eq_price}
			,#{cpu_info}
			,#{memory_size}
		)
	</insert>
	
	<!-- 카드 번호 중복체크 -->
	<select id="selectCardNumberChk" parameterType="HashMap" resultType="int">
		SELECT
			count(*) as cnt
		FROM top_card
		WHERE card_number = #{card_number}
		AND is_del = 0	
	</select>

	<!-- 장비 일련번호 중복 체크 by top3009 -->
	<select id="selectEqnoChk" parameterType="HashMap" resultType="int">
		SELECT
			count(*) as cnt
		FROM top_equipment
		WHERE eq_no = #{eq_no}
		AND is_del = 0	
	</select>
	
	<!-- 카드 정보 상세보기 -->
	<select id="selectCardLogList" parameterType="String" resultType="kr.co.toplac.sysadm.CardLogBean">	
		SELECT
			log_no
			,ckey
			,log_user_no
			,getTopMbrBscUserName(log_user_no) as log_user_name
			,log_action
			,log_content
			,log_ip
			,date_format(log_reg_date, '%Y-%m-%d') as log_reg_date
			,user_name
			,team_name
		FROM top_card_log 	
		WHERE ckey = #{ckey}
		ORDER BY log_no desc		
	</select>
	
	<!-- 장비 통계 예외내역 조회 (장비의 팀이 존재하지 않는 경우 조회) -->
	<select id="selectEquipmentTroubleList" resultType="HashMap">
		SELECT
			GB.team_id
			,GB.team_name
			,getTopTmBscCenterName(GB.team_id) AS center_name
			,e.user_no
			,IFNULL(getTopMbrBscUserName(e.user_no),'') AS user_name
			,e.serial_no
			,e.eq_state
			,e.eq_type
			,getCodeValue("top_equipment", "eq_type", e.eq_type) AS eq_type_nm
			,getCodeValue("top_equipment", "eq_state", e.eq_state) AS eq_state_nm
			,e.eq_no
		FROM
		(
		
			SELECT
				GA.team_id
				,GA.team_name
			FROM(
				SELECT 
					(SELECT COUNT(*) FROM top_mbr_bsc WHERE user_state != 1 AND team_id_loc = a.team_id) AS member_cnt
					,a.team_id
					,a.team_name
				FROM top_tm_bsc a
				WHERE a.team_id != 999
				ORDER BY team_group_order DESC, team_order DESC, team_level
			)GA
			WHERE GA.member_cnt = 0
		)GB, top_equipment e
		WHERE GB.team_id = e.team_id
	
	</select>
	
	<!-- 장비 상세보기 조회 쿼리 by top3009 -->
	<select id="selectEquipmentLogList" parameterType="String" resultType="kr.co.toplac.sysadm.EquipmentLogBean">	
		SELECT
			log_no
			,serial_no
			,log_user_no
			,getTopMbrBscUserName(log_user_no) as log_user_name
			,log_action
			,log_content
			,log_ip
			,date_format(log_reg_date, '%Y-%m-%d') as log_reg_date
			,user_name
			,team_name
		FROM top_equipment_log 	
		WHERE serial_no = #{serial_no}
		ORDER BY log_no desc		
	</select>
	
	<!-- 카드 상세보기 조회 -->
	<select id="selectCardOne" parameterType="String" resultType="kr.co.toplac.sysadm.CardBean">
		SELECT
			a.ckey
			,a.user_no
			,a.team_id
			,a.card_number
			,a.card_state
			,a.card_type
			,a.card_zone
			,a.card_memo
			,date_format(a.reg_date, '%Y-%m-%d') as reg_date
			,date_format(a.mod_date, '%Y-%m-%d') as mod_date			
			,getTopTmBscCenterName(a.team_id) as center_name
			,getTopTmBscTeamName(a.team_id) as team_name
			,getTopMbrBscUserName(a.user_no) as user_name
			,getCodeValue("top_card", "card_type", a.card_type) AS card_type_nm
			,getCodeValue("top_card", "card_state", a.card_state) AS card_state_nm
			,getCodeValue("top_card", "card_zone", a.card_zone) AS card_zone_nm
			,b.team_type
			,a.is_del
			,a.del_date
			,a.card_uid
			,a.card_serial_no
		FROM top_card a
		LEFT JOIN top_tm_bsc b ON a.team_id = b.team_id	
		WHERE a.ckey = #{ckey}
	</select>
	
	<!-- 장비 상세보기 조회 쿼리 by top3009 -->
	<select id="selectEquipmentOne" parameterType="String" resultType="kr.co.toplac.sysadm.EquipmentBean">	
		SELECT
			a.serial_no
			,a.user_no
			,a.team_id
			,a.eq_no
			,a.eq_state
			,a.eq_type
			,a.eq_memo
			,date_format(a.reg_date, '%Y-%m-%d') as reg_date
			,date_format(a.close_date, '%Y-%m-%d') as close_date			
			,a.eq_price
			,getTopTmBscCenterName(a.team_id) as center_name
			,getTopTmBscTeamName(a.team_id) as team_name
			,getTopMbrBscUserName(a.user_no) as user_name
			,getCodeValue("top_equipment", "eq_type", a.eq_type) AS eq_type_nm
			,getCodeValue("top_equipment", "eq_state", a.eq_state) AS eq_state_nm
			,a.cpu_info
			,getCodeValue("top_equipment", "cpu_info", a.cpu_info) AS cpu_info_nm
			,a.memory_size
			,b.team_type
			,a.is_del
			,a.del_date
		FROM top_equipment a
		LEFT JOIN top_tm_bsc b ON a.team_id = b.team_id	
		WHERE a.serial_no = #{serial_no}		
	</select>
	
	<select id="selectEquipmentTypeCode" resultType="kr.co.toplac.sysadm.EquipmentSummaryBean">
		SELECT 
			tbl_nm
			,col_nm
			,col_cd
			,col_val
		FROM sysadm_codedic 
		WHERE tbl_nm = 'top_equipment' AND col_nm = 'eq_type'
		order by col_cd	
	</select>
	
	<update id="updateEquipmentTeamSync" parameterType="HashMap">
		UPDATE top_equipment
	  	   SET team_id = #{team_id_loc}
	  	 WHERE serial_no = #{serial_no}	
	</update>
	
	<select id="selectMemberTeamLoc" parameterType="integer" resultType="integer">
		SELECT
			team_id_loc
		FROM top_mbr_bsc
		WHERE user_no = #{user_no}	
	</select>
	
	<!-- 팀업데이트 대상 장비목록 -->
	<select id="selectEquipmentListExcept" parameterType="HashMap" resultType="kr.co.toplac.sysadm.EquipmentBean">
		SELECT
			serial_no
			,user_no
			,team_id
		FROM top_equipment
		WHERE is_del = 0
		AND user_no not in (0,99999)	
	</select>
	
	<!-- 동기화 카드 목록 조회 -->	
	<select id="selectSyncCardList" resultType="HashMap">
		SELECT
			skey
			,user_name
			,card_number
			,card_serial_no	
		FROM top_card_sync
		ORDER BY skey	
	</select>
	
	<select id="selectInsaCardInfo" parameterType="String" resultType="HashMap">
		SELECT 
			user_no
			,team_id_main AS team_id
			,user_state
			,DATE_FORMAT(FROM_UNIXTIME(join_date), '%Y-%m-%d') AS reg_date
		FROM top_mbr_bsc
		WHERE user_name = #{realName}
		AND user_state != 1
	</select>
	
	<select id="selectInsaCardChk" parameterType="String" resultType="Integer">
		SELECT 
			COUNT(*) 
		FROM top_mbr_bsc
		WHERE user_name = #{user_name}
		AND user_state != 1
	</select>
	
	<select id="selectSyncCardChk" parameterType="String" resultType="Integer">
		SELECT 
			COUNT(*) 
		FROM top_card
		WHERE card_number = #{card_number}
	</select>
	
	<!-- 1종 사업부 카드 집계 정보 -->
	<select id="selectCardSummary1Info" resultType="HashMap">
		SELECT
			COUNT(CASE WHEN card_type = 0 THEN 1 END) AS normal_1_cnt
			,COUNT(CASE WHEN card_type = 1 THEN 1 END) AS temp_1_cnt
			,COUNT(CASE WHEN card_type = 2 THEN 1 END) AS public_1_cnt			
			,COUNT(CASE WHEN card_state = 0 THEN 1 END) AS state_1_0_cnt
			,COUNT(CASE WHEN card_state = 1 THEN 1 END) AS state_1_1_cnt
			,COUNT(CASE WHEN card_state = 2 THEN 1 END) AS state_1_2_cnt
			,COUNT(CASE WHEN card_state = 3 THEN 1 END) AS state_1_3_cnt
			,COUNT(CASE WHEN card_state = 9 THEN 1 END) AS state_1_9_cnt			
		FROM(
			SELECT	
				GA.card_state
				,GA.card_type
				,GA.team_type
			FROM
			(
				SELECT 	
					a.card_state
					,a.card_type
					,IFNULL(b.team_type,9) AS team_type
				FROM top_card a
				LEFT JOIN top_tm_bsc b
				ON a.team_id = b.team_id	
			)GA
			WHERE GA.team_type IN( 0, 1)
		)GB
	</select>
	
	<!-- 4종 사업부 카드 집계 정보 -->
	<select id="selectCardSummary4Info" resultType="HashMap">
		SELECT
			COUNT(CASE WHEN card_type = 0 THEN 1 END) AS normal_4_cnt
			,COUNT(CASE WHEN card_type = 1 THEN 1 END) AS temp_4_cnt
			,COUNT(CASE WHEN card_type = 2 THEN 1 END) AS public_4_cnt			
			,COUNT(CASE WHEN card_state = 0 THEN 1 END) AS state_4_0_cnt
			,COUNT(CASE WHEN card_state = 1 THEN 1 END) AS state_4_1_cnt			
			,COUNT(CASE WHEN card_state = 2 THEN 1 END) AS state_4_2_cnt
			,COUNT(CASE WHEN card_state = 3 THEN 1 END) AS state_4_3_cnt
			,COUNT(CASE WHEN card_state = 9 THEN 1 END) AS state_4_9_cnt			
		FROM(
			SELECT	
				GA.card_state
				,GA.card_type
				,GA.team_type
			FROM
			(
				SELECT 	
					a.card_state
					,a.card_type
					,IFNULL(b.team_type,9) AS team_type
				FROM top_card a
				LEFT JOIN top_tm_bsc b
				ON a.team_id = b.team_id	
			)GA
			WHERE GA.team_type = 4
		)GB
	</select>
	
	<!-- 기타 카드 집계 정보 -->
	<select id="selectCardSummary9Info" resultType="HashMap">
		SELECT
			COUNT(CASE WHEN card_type = 0 THEN 1 END) AS normal_9_cnt
			,COUNT(CASE WHEN card_type = 1 THEN 1 END) AS temp_9_cnt
			,COUNT(CASE WHEN card_type = 2 THEN 1 END) AS public_9_cnt			
			,COUNT(CASE WHEN card_state = 0 THEN 1 END) AS state_9_0_cnt
			,COUNT(CASE WHEN card_state = 1 THEN 1 END) AS state_9_1_cnt
			,COUNT(CASE WHEN card_state = 2 THEN 1 END) AS state_9_2_cnt
			,COUNT(CASE WHEN card_state = 3 THEN 1 END) AS state_9_3_cnt
			,COUNT(CASE WHEN card_state = 9 THEN 1 END) AS state_9_9_cnt			
		FROM(
			SELECT	
				GA.card_state
				,GA.card_type
				,GA.team_type
			FROM
			(
				SELECT 	
					a.card_state
					,a.card_type
					,IFNULL(b.team_type,9) AS team_type
				FROM top_card a
				LEFT JOIN top_tm_bsc b
				ON a.team_id = b.team_id	
			)GA
			WHERE GA.team_type = 9
		)GB
	</select>
	
	<!-- 카드목록 조회 쿼리 -->
	<select id="selectCardList" parameterType="HashMap" resultType="kr.co.toplac.sysadm.CardBean">
		SELECT
			GA.ckey
			,GA.user_no
			,GA.team_id
			,GA.card_number
			,GA.card_state
			,GA.card_type
			,GA.card_zone			
			,GA.card_memo
			,DATE_FORMAT(GA.reg_date, '%Y-%m-%d') AS reg_date
			,DATE_FORMAT(GA.mod_date, '%Y-%m-%d') AS mod_date			
			,GA.center_name
			,GA.team_name
			,GA.user_name
			,GA.card_type_nm
			,GA.card_state_nm
			,GA.card_zone_nm
			,GA.team_type
			,GA.is_del
			,GA.del_date
			,CASE GA.work_type				
				WHEN 1 THEN 1
				WHEN 2 THEN 2
				WHEN 6 THEN 3
				WHEN 14 THEN 4
				WHEN 15 THEN 5
				WHEN 3 THEN 6
				WHEN 7 THEN 7
				WHEN 4 THEN 8
				WHEN 8 THEN 9
				WHEN 5 THEN 10
				WHEN 9 THEN 11
				WHEN 10 THEN 12
				WHEN 12 THEN 13
				WHEN 11 THEN 14
				WHEN 13 THEN 15	
				ELSE 99
			END AS new_work_order
			,GA.team_group_order
			,GA.team_order
			,GA.work_rank
			,GA.work_level
			,GA.join_date
			,GA.card_uid
			,GA.card_serial_no
		FROM
			(
			SELECT
				a.ckey
				,a.user_no
				,a.team_id				
				,a.card_number
				,a.card_state
				,a.card_type
				,a.card_zone				
				,a.card_memo
				,a.reg_date	
				,a.mod_date
				,(SELECT work_type FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_type
				,(SELECT work_rank FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_rank
				,(SELECT work_level FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_level
				,(SELECT join_date FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS join_date
				,(SELECT user_state FROM top_mbr_bsc WHERE user_no = a.user_no ) AS user_state
				,getTopTmBscCenterName(a.team_id) AS center_name
				,getTopTmBscTeamName(a.team_id) AS team_name
				,getTopMbrBscUserName(a.user_no) AS user_name
				,getCodeValue("top_card", "card_type", a.card_type) AS card_type_nm
				,getCodeValue("top_card", "card_state", a.card_state) AS card_state_nm
				,getCodeValue("top_card", "card_zone", a.card_zone) AS card_zone_nm
				,b.team_type
				,a.is_del
				,DATE_FORMAT(a.del_date, '%Y-%m-%d') AS del_date
				,b.team_group_order
				,b.team_order
				,a.card_uid
				,a.card_serial_no								
			FROM top_card a
			LEFT JOIN top_tm_bsc b ON a.team_id = b.team_id	
			)GA
		WHERE 1=1
		<if test="srchGubunMain == 1">AND GA.team_type in (0,1)</if>
		<if test="srchGubunMain == 4">AND GA.team_type = 4</if>
		<if test='tmSearchMain != ""'>AND GA.team_id = #{tmSearchMain}</if>
		<if test='srchCardStateMain != ""'>AND GA.card_state = #{srchCardStateMain}</if>
		<if test='srchCardTypeMain != ""'>AND GA.card_type = #{srchCardTypeMain}</if>
		<if test='srchCardZoneMain != ""'>AND GA.card_zone = #{srchCardZoneMain}</if>		
		<if test='srchUserNoMain != ""'>AND GA.user_no = #{srchUserNoMain}</if>
		
		<if test='regSdate != ""'>AND GA.reg_date >= #{regSdate}</if>
		<if test='regEdate != ""'>AND GA.reg_date &lt;= #{regEdate}</if>
		
		<if test='modSdate != ""'>AND GA.mod_date >= #{modSdate}</if>
		<if test='modEdate != ""'>AND DATE_ADD(GA.mod_date, INTERVAL -1 DAY) &lt;= #{modEdate}</if>
		
		<if test='del_view_val != "1"'>AND GA.is_del = 0</if>		
		
		<if test="out_view_val == 1">AND GA.user_state = 1</if>
		
		<if test='srchCardNoMain != ""'>AND GA.card_number like CONCAT('%',#{srchCardNoMain},'%')</if>
		
		<if test='srchCardMemoMain != ""'>AND GA.card_memo like CONCAT('%',#{srchCardMemoMain},'%')</if>
		<if test='srchCardUidMain != ""'>AND GA.card_uid like CONCAT('%',#{srchCardUidMain},'%')</if>
		<if test='srchCardSerialNo != ""'>AND GA.card_serial_no like CONCAT('%',#{srchCardSerialNo},'%')</if>
				
		${sQueryOrder}	
	</select>
	
	
	<!-- 장비목록 조회 쿼리 by top3009 -->
	<select id="selectEquipmentList" parameterType="HashMap" resultType="kr.co.toplac.sysadm.EquipmentBean">	
		SELECT
			GA.serial_no
			,GA.user_no
			,GA.team_id
			,GA.eq_no
			,GA.eq_state
			,GA.eq_type
			,GA.eq_memo
			,DATE_FORMAT(GA.reg_date, '%Y-%m-%d') AS reg_date			
			,GA.close_date			
			,GA.eq_price
			,GA.center_name
			,GA.team_name
			,GA.user_name
			,GA.eq_type_nm
			,GA.eq_state_nm
			,GA.team_type
			,GA.is_del
			,GA.del_date
			,CASE GA.work_type				
				WHEN 1 THEN 1
				WHEN 2 THEN 2
				WHEN 6 THEN 3
				WHEN 14 THEN 4
				WHEN 15 THEN 5
				WHEN 3 THEN 6
				WHEN 7 THEN 7
				WHEN 4 THEN 8
				WHEN 8 THEN 9
				WHEN 5 THEN 10
				WHEN 9 THEN 11
				WHEN 10 THEN 12
				WHEN 12 THEN 13
				WHEN 11 THEN 14
				WHEN 13 THEN 15	
				ELSE 99
			END AS new_work_order
			,GA.team_group_order
			,GA.team_order
			,GA.work_rank
			,GA.work_level
			,GA.join_date
			,GA.cpu_info
			,GA.cpu_info_nm
			,GA.memory_size
		FROM
			(
			SELECT
				a.serial_no
				,a.user_no
				,a.team_id
				,a.eq_no
				,a.eq_state
				,a.eq_type
				,a.eq_memo
				,a.reg_date
				,DATE_FORMAT(a.close_date, '%Y-%m-%d') AS close_date			
				,a.eq_price
				<!-- user_state = 0 -->
				,(SELECT work_type FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_type
				,(SELECT work_rank FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_rank
				,(SELECT work_level FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS work_level
				,(SELECT join_date FROM top_mbr_bsc WHERE user_no = a.user_no AND user_state != 1) AS join_date
				,(SELECT user_state FROM top_mbr_bsc WHERE user_no = a.user_no ) AS user_state
				,getTopTmBscCenterName(a.team_id) AS center_name
				,getTopTmBscTeamName(a.team_id) AS team_name
				,getTopMbrBscUserName(a.user_no) AS user_name
				,getCodeValue("top_equipment", "eq_type", a.eq_type) AS eq_type_nm
				,getCodeValue("top_equipment", "eq_state", a.eq_state) AS eq_state_nm
				,b.team_type	
				,a.is_del
				,a.cpu_info
				,getCodeValue("top_equipment", "cpu_info", a.cpu_info) AS cpu_info_nm
				,a.memory_size
				,DATE_FORMAT(a.del_date, '%Y-%m-%d') AS del_date
				,b.team_group_order
				,b.team_order								
			FROM top_equipment a
			LEFT JOIN top_tm_bsc b 
			ON a.team_id = b.team_id	
			)GA
		WHERE 1=1
		<if test="srchGubunMain == 1">AND GA.team_type in (0,1)</if>
		<if test="srchGubunMain == 4">AND GA.team_type = 4</if>
		<if test='tmSearchMain != ""'>AND GA.team_id = #{tmSearchMain}</if>
		<if test="srchEqStateMain != 0">AND GA.eq_state = #{srchEqStateMain}</if>
		<if test="srchEqTypeMain != 0">AND GA.eq_type = #{srchEqTypeMain}</if>		
		<if test='srchUserNoMain != ""'>AND GA.user_no = #{srchUserNoMain}</if>
		
		<if test='srchCpuInfo != ""'>AND GA.cpu_info = #{srchCpuInfo}</if>
		<if test='srchMemorySizeStart != ""'>AND GA.memory_size >= #{srchMemorySizeStart}</if>
		<if test='srchMemorySizeEnd != ""'>AND GA.memory_size &lt;= #{srchMemorySizeEnd}</if>
		
		<if test='regSdate != ""'>AND GA.reg_date >= #{regSdate}</if>
		<if test='regEdate != ""'>AND GA.reg_date &lt;= #{regEdate}</if>
		
		<if test='closeSdate != ""'>AND GA.close_date >= #{closeSdate}</if>
		<if test='closeEdate != ""'>AND GA.close_date &lt;= #{closeEdate}</if>
		
		<if test='del_view_val != "1"'>AND GA.is_del = 0</if>		
		
		<if test="out_view_val == 1">AND GA.user_state = 1</if>
		
		<if test='srchEqNoMain != ""'>AND GA.eq_no like CONCAT('%',#{srchEqNoMain},'%')</if>
				
		${sQueryOrder}				
	</select>
	
	<!-- 장비목록 갯수 조회 쿼리(향후 페이징이 필요하면 사용) by top3009 -->
	<select id="selectEquipmentListCnt" parameterType="HashMap" resultType="int">
		SELECT 
			count(*) as Cnt			
		FROM top_equipment
		WHERE  1=1					
	</select>
	
	<!-- 장비 타입에 따른 장비통계 갯수 by top3009 -->
	<select id="selectEquipmentTypeCnt" parameterType="HashMap" resultType="int">
		SELECT 
			count(*) as Cnt			
		FROM top_equipment
		WHERE eq_state = #{eq_state}
		AND eq_type = #{eq_type}
		AND is_del = 0					
	</select>
 
	<select id="selectMemberList" resultType="HashMap" parameterType="HashMap">
		SELECT a.user_no userNo
			  ,a.ip_addr ipAddr
			  ,a.computer_no computerNo
			  ,a.monitor_no_1 monitorNo1
			  ,a.monitor_no_2 monitorNo2
			  ,a.mod_date modDate
			  ,getTopMbrBscUserName(a.user_no) userName
			  ,getTopTmBscCenterName(b.team_id) centerName
			  ,getTopTmBscTeamName(b.team_id) teamName
		  FROM sysadm_device a
		 INNER JOIN (SELECT user_no,team_order, team_group_order, team_id FROM top_mbr_bsc aa INNER JOIN top_tm_bsc bb ON aa.team_id_loc = bb.team_id) b
		    ON a.user_no = b.user_no
		 ORDER BY team_group_order desc, team_order desc
		 LIMIT #{limitPage}, #{sizePerPage} 
	</select>
	
	<select id="selectMemberListCnt" resultType="Long">
		SELECT COUNT(*)
		  FROM sysadm_device a
		 INNER JOIN (SELECT user_no,team_order, team_group_order, team_id FROM top_mbr_bsc aa INNER JOIN top_tm_bsc bb ON aa.team_id_loc = bb.team_id) b
		    ON a.user_no = b.user_no
		 ORDER BY team_group_order desc, team_order desc	
	</select>
	
	<select id="selectRptHelpManageList" resultType="HashMap" parameterType="HashMap">
		SELECT 
			TA.suim_rpt_no
			,TA.suim_accept_no
			,TH.serial_no
			,TH.client_team
			,TH.client_id 
			,getTopMbrBscUserName(TH.client_id) AS client_name
			,getTopTmBscTeamName(TH.client_team) AS client_team_name
			,TH.accept_id
			,TH.accept_team
			,getTopMbrBscUserName(TH.accept_id) AS accept_name
			,getTopTmBscTeamName(TH.accept_team) AS accept_team_name
			,TH.help_memo
		FROM top_rpt_head TA, top_rpt_help TH
		WHERE TA.suim_rpt_no = TH.suim_rpt_no
		AND TA.suim_accept_no = #{srchSuimAcceptNo}
	</select>
	
	<select id="selectRptCloseDate" resultType="HashMap" parameterType="HashMap">
		SELECT suim_rpt_no
			  ,suim_accept_no
			  ,FROM_UNIXTIME(close_date,"%Y-%m-%d") close_date
			  ,getTopPtnrBscPtnrNick(ptnr_id) ptnr_nick
  		  FROM top_rpt_head
  		 WHERE 1=1
  		 <if test='srchSuimAcceptNo != null and srchSuimAcceptNo != ""'> 
  		 	AND suim_accept_no like CONCAT('%',#{srchSuimAcceptNo},'%')
  		 </if>
  		 limit 0, 1000
	</select>
	
	<select id="selectTeamIdByUserNo" resultType="String" parameterType="HashMap">
		SELECT 
			IFNULL(team_id_main,'') AS team_id
			,COUNT(*) as cnt
		FROM top_mbr_bsc
		WHERE user_no = #{edit_user_no}
	</select>
	
	<delete id="deleteRptHelpClientInfo" parameterType="HashMap">
		DELETE FROM top_rpt_help WHERE serial_no = #{serial_no}
	</delete>
	
	<update id="updateRptHelpClientInfo" parameterType="HashMap">
		UPDATE top_rpt_help SET
			client_id = #{edit_user_no}
			,client_team = #{edit_team_id}
		WHERE serial_no = #{serial_no}
	</update>
	
	<update id="updateRptCloseDate" parameterType="HashMap">
		UPDATE top_rpt_head
	  	   SET close_date = UNIX_TIMESTAMP(#{close_date})
	  	 WHERE suim_rpt_no = #{suim_rpt_no}
	
	</update>
	
	<insert id="insertTopSuitWordAuth" parameterType="HashMap">
		INSERT INTO top_suit_word_auth (
			user_no
			,reg_date
		) VALUES (
			#{user_no}
			,now()
		)
	</insert>
	
	<delete id="deleteTopSuitWordAuth" parameterType="HashMap">
		DELETE FROM top_suit_word_auth WHERE user_no = #{user_no}
	</delete>
	
	<select id="countTopSuitWordAuth" resultType="Integer" parameterType="String">
		SELECT COUNT(*) FROM top_suit_word_auth
		WHERE user_no = #{user_no}
	</select>
	
	<select id="selectTopSuitWordAuthMemberList" resultType="HashMap" parameterType="HashMap">
		SELECT 
			TA.user_no	
			,TB.user_name
			,TB.user_state
			,getTopTmBscTeamName(TB.team_id_main) AS team_name
			,TA.reg_date
			,DATE_FORMAT(TA.reg_date, '%Y-%m-%d') AS reg_date_fmt
		FROM top_suit_word_auth TA
		LEFT JOIN top_mbr_bsc TB
		ON TA.user_no = TB.user_no
	</select>
	
</mapper>
